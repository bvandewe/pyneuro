
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="../event-driven/" rel="prev"/>
<link href="../resource-oriented-architecture/" rel="next"/>
<link href="../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.6.20" name="generator"/>
<title>Repository - Neuroglia Python Framework</title>
<link href="../../assets/stylesheets/main.e53b48f4.min.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body data-md-color-accent="blue" data-md-color-primary="blue" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#repository-pattern">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Neuroglia Python Framework" class="md-header__button md-logo" data-md-component="logo" href="../.." title="Neuroglia Python Framework">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Neuroglia Python Framework
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Repository
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="blue" data-md-color-media="" data-md-color-primary="blue" data-md-color-scheme="default" id="__palette_0" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="blue" data-md-color-media="" data-md-color-primary="blue" data-md-color-scheme="slate" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
</form>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<a aria-label="Share" class="md-search__icon md-icon" data-clipboard="" data-clipboard-text="" data-md-component="search-share" href="javascript:void(0)" tabindex="-1" title="Share">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"></path></svg>
</a>
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
</nav>
<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="../..">
        
  
  
    
  
  Home

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../getting-started/">
          
  
  
  Getting Started

        </a>
</li>
<li class="md-tabs__item md-tabs__item--active">
<a class="md-tabs__link" href="../">
          
  
  
  Patterns

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../features/">
          
  
  
  Features

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../guides/">
          
  
  
  Guides

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../samples/">
          
  
  
  Sample Applications

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../architecture/">
        
  
  
    
  
  Architecture

      </a>
</li>
</ul>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Neuroglia Python Framework" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="Neuroglia Python Framework">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
    Neuroglia Python Framework
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../..">
<span class="md-ellipsis">
    Home
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
<span class="md-ellipsis">
    Getting Started
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../getting-started/">
<span class="md-ellipsis">
    Overview
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../guides/3-min-bootstrap/">
<span class="md-ellipsis">
    3-Minute Bootstrap
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../guides/local-development/">
<span class="md-ellipsis">
    Local Development Setup
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../guides/mario-pizzeria-tutorial/">
<span class="md-ellipsis">
    Mario's Pizzeria Tutorial
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
<span class="md-ellipsis">
    Patterns
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
            Patterns
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../">
<span class="md-ellipsis">
    Overview
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../clean-architecture/">
<span class="md-ellipsis">
    Clean Architecture
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../cqrs/">
<span class="md-ellipsis">
    CQRS
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../event-driven/">
<span class="md-ellipsis">
    Event-Driven
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    Repository
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    Repository
    
  </span>
</a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#overview">
<span class="md-ellipsis">
      🎯 Overview
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#benefits">
<span class="md-ellipsis">
      ✅ Benefits
    </span>
</a>
<nav aria-label="✅ Benefits" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#1-storage-independence">
<span class="md-ellipsis">
      1. Storage Independence
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-testability">
<span class="md-ellipsis">
      2. Testability
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3-centralized-querying">
<span class="md-ellipsis">
      3. Centralized Querying
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#data-flow">
<span class="md-ellipsis">
      🔄 Data Flow
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#use-cases">
<span class="md-ellipsis">
      🎯 Use Cases
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#implementation-in-marios-pizzeria">
<span class="md-ellipsis">
      🍕 Implementation in Mario's Pizzeria
    </span>
</a>
<nav aria-label="🍕 Implementation in Mario's Pizzeria" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#repository-interface">
<span class="md-ellipsis">
      Repository Interface
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#mongodb-implementation">
<span class="md-ellipsis">
      MongoDB Implementation
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#file-based-implementation">
<span class="md-ellipsis">
      File-Based Implementation
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#in-memory-implementation-testing">
<span class="md-ellipsis">
      In-Memory Implementation (Testing)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#repository-registration">
<span class="md-ellipsis">
      Repository Registration
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#testing-with-repositories">
<span class="md-ellipsis">
      🧪 Testing with Repositories
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#related-patterns">
<span class="md-ellipsis">
      🔗 Related Patterns
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../resource-oriented-architecture/">
<span class="md-ellipsis">
    Resource-Oriented Architecture
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../watcher-reconciliation-patterns/">
<span class="md-ellipsis">
    Watcher &amp; Reconciliation Patterns
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../watcher-reconciliation-execution/">
<span class="md-ellipsis">
    Watcher &amp; Reconciliation Execution
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
<span class="md-ellipsis">
    Features
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            Features
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../features/">
<span class="md-ellipsis">
    Overview
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../features/dependency-injection/">
<span class="md-ellipsis">
    Dependency Injection
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../features/cqrs-mediation/">
<span class="md-ellipsis">
    CQRS &amp; Mediation
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../features/mvc-controllers/">
<span class="md-ellipsis">
    MVC Controllers
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../features/data-access/">
<span class="md-ellipsis">
    Data Access
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../features/event-sourcing/">
<span class="md-ellipsis">
    Event Sourcing
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../features/serialization/">
<span class="md-ellipsis">
    Serialization
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../features/object-mapping/">
<span class="md-ellipsis">
    Object Mapping
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../features/reactive-programming/">
<span class="md-ellipsis">
    Reactive Programming
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../features/mermaid-diagrams/">
<span class="md-ellipsis">
    Mermaid Diagrams
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
<span class="md-ellipsis">
    Guides
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
            Guides
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../guides/">
<span class="md-ellipsis">
    Overview
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../guides/project-setup/">
<span class="md-ellipsis">
    Project Setup
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../guides/testing-setup/">
<span class="md-ellipsis">
    Testing Setup
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
<span class="md-ellipsis">
    Sample Applications
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_6_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_6">
<span class="md-nav__icon md-icon"></span>
            Sample Applications
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../samples/">
<span class="md-ellipsis">
    Overview
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../samples/openbank/">
<span class="md-ellipsis">
    OpenBank
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../samples/api_gateway/">
<span class="md-ellipsis">
    API Gateway
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../samples/desktop_controller/">
<span class="md-ellipsis">
    Desktop Controller
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../samples/lab-resource-manager/">
<span class="md-ellipsis">
    Lab Resource Manager
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../architecture/">
<span class="md-ellipsis">
    Architecture
    
  </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#overview">
<span class="md-ellipsis">
      🎯 Overview
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#benefits">
<span class="md-ellipsis">
      ✅ Benefits
    </span>
</a>
<nav aria-label="✅ Benefits" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#1-storage-independence">
<span class="md-ellipsis">
      1. Storage Independence
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-testability">
<span class="md-ellipsis">
      2. Testability
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3-centralized-querying">
<span class="md-ellipsis">
      3. Centralized Querying
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#data-flow">
<span class="md-ellipsis">
      🔄 Data Flow
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#use-cases">
<span class="md-ellipsis">
      🎯 Use Cases
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#implementation-in-marios-pizzeria">
<span class="md-ellipsis">
      🍕 Implementation in Mario's Pizzeria
    </span>
</a>
<nav aria-label="🍕 Implementation in Mario's Pizzeria" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#repository-interface">
<span class="md-ellipsis">
      Repository Interface
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#mongodb-implementation">
<span class="md-ellipsis">
      MongoDB Implementation
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#file-based-implementation">
<span class="md-ellipsis">
      File-Based Implementation
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#in-memory-implementation-testing">
<span class="md-ellipsis">
      In-Memory Implementation (Testing)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#repository-registration">
<span class="md-ellipsis">
      Repository Registration
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#testing-with-repositories">
<span class="md-ellipsis">
      🧪 Testing with Repositories
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#related-patterns">
<span class="md-ellipsis">
      🔗 Related Patterns
    </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="repository-pattern">🗄️ Repository Pattern<a class="headerlink" href="#repository-pattern" title="Permanent link">¶</a></h1>
<div class="admonition warning">
<p class="admonition-title">🚧 Under Construction</p>
</div>
<p>This page is currently being developed with comprehensive examples from Mario's Pizzeria. More detailed implementations and code samples are being added.</p>
<p>The Repository pattern abstracts data access logic and provides a uniform interface for accessing domain objects, regardless of the underlying storage mechanism.</p>
<h2 id="overview">🎯 Overview<a class="headerlink" href="#overview" title="Permanent link">¶</a></h2>
<p>The Repository pattern encapsulates the logic needed to access data sources, centralizing common data access functionality for better maintainability and decoupling infrastructure from the domain model. Mario's Pizzeria demonstrates this through order, menu, and customer data management.</p>
<pre class="mermaid"><code>flowchart TD
    subgraph "🍕 Mario's Pizzeria Data Access"
        subgraph Domain["🏛️ Domain Layer"]
            OrderEntity[Order Entity]
            MenuEntity[Menu Entity]
            CustomerEntity[Customer Entity]
        end

        subgraph Application["💼 Application Layer"]
            OrderHandler[Order Handlers]
            MenuHandler[Menu Handlers]
            CustomerHandler[Customer Handlers]
        end

        subgraph Repositories["🗄️ Repository Interfaces"]
            IOrderRepo[IOrderRepository]
            IMenuRepo[IMenuRepository]
            ICustomerRepo[ICustomerRepository]
        end

        subgraph Implementation["🔌 Repository Implementations"]
            MongoOrderRepo[MongoOrderRepository]
            FileMenuRepo[FileMenuRepository]
            SqlCustomerRepo[SqlCustomerRepository]
            InMemoryRepo[InMemoryRepository]
        end

        subgraph Storage["💾 Storage Systems"]
            MongoDB[(MongoDB)]
            FileSystem[(JSON Files)]
            PostgreSQL[(PostgreSQL)]
            Memory[(In-Memory)]
        end
    end

    OrderHandler --&gt; IOrderRepo
    MenuHandler --&gt; IMenuRepo
    CustomerHandler --&gt; ICustomerRepo

    IOrderRepo -.-&gt; MongoOrderRepo
    IMenuRepo -.-&gt; FileMenuRepo
    ICustomerRepo -.-&gt; SqlCustomerRepo

    MongoOrderRepo --&gt; MongoDB
    FileMenuRepo --&gt; FileSystem
    SqlCustomerRepo --&gt; PostgreSQL
    InMemoryRepo --&gt; Memory

    IOrderRepo -.-&gt; InMemoryRepo
    IMenuRepo -.-&gt; InMemoryRepo
    ICustomerRepo -.-&gt; InMemoryRepo</code></pre>
<h2 id="benefits">✅ Benefits<a class="headerlink" href="#benefits" title="Permanent link">¶</a></h2>
<h3 id="1-storage-independence">1. <strong>Storage Independence</strong><a class="headerlink" href="#1-storage-independence" title="Permanent link">¶</a></h3>
<p>Business logic doesn't depend on specific storage implementations:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Domain service works with any repository implementation</span>
<span class="k">class</span><span class="w"> </span><span class="nc">OrderService</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order_repository</span><span class="p">:</span> <span class="n">OrderRepository</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_repository</span> <span class="o">=</span> <span class="n">order_repository</span>  <span class="c1"># Interface, not implementation</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">process_order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order</span><span class="p">:</span> <span class="n">Order</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="c1"># Business logic is storage-agnostic</span>
        <span class="k">if</span> <span class="n">order</span><span class="o">.</span><span class="n">total</span> <span class="o">&gt;</span> <span class="n">Decimal</span><span class="p">(</span><span class="s1">'100'</span><span class="p">):</span>
            <span class="n">order</span><span class="o">.</span><span class="n">apply_discount</span><span class="p">(</span><span class="n">Decimal</span><span class="p">(</span><span class="s1">'0.1'</span><span class="p">))</span>  <span class="c1"># 10% discount for large orders</span>

        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_repository</span><span class="o">.</span><span class="n">save_async</span><span class="p">(</span><span class="n">order</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>

<span class="c1"># Can swap implementations without changing business logic</span>
<span class="c1"># services.add_scoped(OrderRepository, MongoOrderRepository)  # Production</span>
<span class="c1"># services.add_scoped(OrderRepository, InMemoryOrderRepository)  # Testing</span>
</code></pre></div>
<h3 id="2-testability">2. <strong>Testability</strong><a class="headerlink" href="#2-testability" title="Permanent link">¶</a></h3>
<p>Easy to mock repositories for unit testing:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">TestOrderService</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">setup_method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mock_repository</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="n">spec</span><span class="o">=</span><span class="n">OrderRepository</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">service</span> <span class="o">=</span> <span class="n">OrderService</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mock_repository</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_large_order_gets_discount</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Arrange</span>
        <span class="n">order</span> <span class="o">=</span> <span class="n">Order</span><span class="p">(</span><span class="n">customer_id</span><span class="o">=</span><span class="s2">"123"</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="n">Decimal</span><span class="p">(</span><span class="s1">'150'</span><span class="p">))</span>

        <span class="c1"># Act</span>
        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">service</span><span class="o">.</span><span class="n">process_order</span><span class="p">(</span><span class="n">order</span><span class="p">)</span>

        <span class="c1"># Assert</span>
        <span class="k">assert</span> <span class="n">order</span><span class="o">.</span><span class="n">total</span> <span class="o">==</span> <span class="n">Decimal</span><span class="p">(</span><span class="s1">'135'</span><span class="p">)</span>  <span class="c1"># 10% discount applied</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mock_repository</span><span class="o">.</span><span class="n">save_async</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span><span class="n">order</span><span class="p">)</span>
</code></pre></div>
<h3 id="3-centralized-querying">3. <strong>Centralized Querying</strong><a class="headerlink" href="#3-centralized-querying" title="Permanent link">¶</a></h3>
<p>Complex queries are encapsulated in the repository:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">OrderRepository</span><span class="p">(</span><span class="n">Repository</span><span class="p">[</span><span class="n">Order</span><span class="p">,</span> <span class="nb">str</span><span class="p">]):</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">find_orders_by_customer_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">customer_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Order</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""Find all orders for a specific customer"""</span>
        <span class="k">pass</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">find_orders_by_date_range_async</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">start_date</span><span class="p">:</span> <span class="n">datetime</span><span class="p">,</span>
        <span class="n">end_date</span><span class="p">:</span> <span class="n">datetime</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Order</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""Find orders within a date range"""</span>
        <span class="k">pass</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">find_popular_pizzas_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">days</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">PopularPizzaStats</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""Get pizza popularity statistics"""</span>
        <span class="k">pass</span>
</code></pre></div>
<h2 id="data-flow">🔄 Data Flow<a class="headerlink" href="#data-flow" title="Permanent link">¶</a></h2>
<p>Order management demonstrates repository data flow:</p>
<pre class="mermaid"><code>sequenceDiagram
    participant Client
    participant Handler as Order Handler
    participant Repo as Order Repository
    participant MongoDB as MongoDB
    participant FileSystem as File System

    Note over Client,FileSystem: Save Order Flow
    Client-&gt;&gt;+Handler: PlaceOrderCommand
    Handler-&gt;&gt;Handler: Create Order entity
    Handler-&gt;&gt;+Repo: save_async(order)

    alt MongoDB Implementation
        Repo-&gt;&gt;+MongoDB: Insert document
        MongoDB--&gt;&gt;-Repo: Success
    else File Implementation
        Repo-&gt;&gt;+FileSystem: Write JSON file
        FileSystem--&gt;&gt;-Repo: Success
    end

    Repo--&gt;&gt;-Handler: Order saved
    Handler--&gt;&gt;-Client: OrderDto result

    Note over Client,FileSystem: Query Orders Flow
    Client-&gt;&gt;+Handler: GetOrderHistoryQuery
    Handler-&gt;&gt;+Repo: find_orders_by_customer_async(customer_id)

    alt MongoDB Implementation
        Repo-&gt;&gt;+MongoDB: Find query with aggregation
        MongoDB--&gt;&gt;-Repo: Order documents
    else File Implementation
        Repo-&gt;&gt;+FileSystem: Read and filter JSON files
        FileSystem--&gt;&gt;-Repo: Order data
    end

    Repo--&gt;&gt;-Handler: List[Order]
    Handler-&gt;&gt;Handler: Map to DTOs
    Handler--&gt;&gt;-Client: List[OrderDto]</code></pre>
<h2 id="use-cases">🎯 Use Cases<a class="headerlink" href="#use-cases" title="Permanent link">¶</a></h2>
<p>Repository pattern is ideal for:</p>
<ul>
<li><strong>Multiple Storage Options</strong>: Support different databases/storage systems</li>
<li><strong>Complex Queries</strong>: Encapsulate sophisticated data access logic</li>
<li><strong>Testing</strong>: Easy mocking and unit testing</li>
<li><strong>Legacy Integration</strong>: Abstract away legacy system complexity</li>
</ul>
<h2 id="implementation-in-marios-pizzeria">🍕 Implementation in Mario's Pizzeria<a class="headerlink" href="#implementation-in-marios-pizzeria" title="Permanent link">¶</a></h2>
<h3 id="repository-interface">Repository Interface<a class="headerlink" href="#repository-interface" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Abstract base repository for all entities</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Repository</span><span class="p">(</span><span class="n">ABC</span><span class="p">,</span> <span class="n">Generic</span><span class="p">[</span><span class="n">TEntity</span><span class="p">,</span> <span class="n">TKey</span><span class="p">]):</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_by_id_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="n">TKey</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TEntity</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""Get entity by ID"""</span>
        <span class="k">pass</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">save_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entity</span><span class="p">:</span> <span class="n">TEntity</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Save or update entity"""</span>
        <span class="k">pass</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">delete_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="n">TKey</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Delete entity by ID"""</span>
        <span class="k">pass</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">find_all_async</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">TEntity</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""Get all entities"""</span>
        <span class="k">pass</span>

<span class="c1"># Order-specific repository interface</span>
<span class="k">class</span><span class="w"> </span><span class="nc">OrderRepository</span><span class="p">(</span><span class="n">Repository</span><span class="p">[</span><span class="n">Order</span><span class="p">,</span> <span class="nb">str</span><span class="p">]):</span>
    <span class="nd">@abstractmethod</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">find_by_customer_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">customer_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Order</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""Find orders for a specific customer"""</span>
        <span class="k">pass</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">find_by_status_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">:</span> <span class="n">OrderStatus</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Order</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""Find orders by status"""</span>
        <span class="k">pass</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">find_by_date_range_async</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">start_date</span><span class="p">:</span> <span class="n">datetime</span><span class="p">,</span>
        <span class="n">end_date</span><span class="p">:</span> <span class="n">datetime</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Order</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""Find orders within date range"""</span>
        <span class="k">pass</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_daily_sales_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">date</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DailySalesReport</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Get sales report for specific date"""</span>
        <span class="k">pass</span>
</code></pre></div>
<h3 id="mongodb-implementation">MongoDB Implementation<a class="headerlink" href="#mongodb-implementation" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">MongoOrderRepository</span><span class="p">(</span><span class="n">OrderRepository</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collection</span><span class="p">:</span> <span class="n">Collection</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_collection</span> <span class="o">=</span> <span class="n">collection</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_by_id_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Order</span><span class="p">]:</span>
        <span class="n">document</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collection</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">"_id"</span><span class="p">:</span> <span class="n">order_id</span><span class="p">})</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_document_to_entity</span><span class="p">(</span><span class="n">document</span><span class="p">)</span> <span class="k">if</span> <span class="n">document</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">save_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order</span><span class="p">:</span> <span class="n">Order</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">document</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entity_to_document</span><span class="p">(</span><span class="n">order</span><span class="p">)</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collection</span><span class="o">.</span><span class="n">replace_one</span><span class="p">(</span>
            <span class="p">{</span><span class="s2">"_id"</span><span class="p">:</span> <span class="n">order</span><span class="o">.</span><span class="n">id</span><span class="p">},</span>
            <span class="n">document</span><span class="p">,</span>
            <span class="n">upsert</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">find_by_customer_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">customer_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Order</span><span class="p">]:</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collection</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">"customer_id"</span><span class="p">:</span> <span class="n">customer_id</span><span class="p">})</span>
        <span class="n">documents</span> <span class="o">=</span> <span class="k">await</span> <span class="n">cursor</span><span class="o">.</span><span class="n">to_list</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_document_to_entity</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">documents</span><span class="p">]</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">find_by_status_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">:</span> <span class="n">OrderStatus</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Order</span><span class="p">]:</span>
        <span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collection</span><span class="o">.</span><span class="n">find</span><span class="p">({</span><span class="s2">"status"</span><span class="p">:</span> <span class="n">status</span><span class="o">.</span><span class="n">value</span><span class="p">})</span>
        <span class="n">documents</span> <span class="o">=</span> <span class="k">await</span> <span class="n">cursor</span><span class="o">.</span><span class="n">to_list</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_document_to_entity</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span> <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">documents</span><span class="p">]</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_daily_sales_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">date</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DailySalesReport</span><span class="p">:</span>
        <span class="n">start_datetime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">min</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
        <span class="n">end_datetime</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">combine</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">max</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>

        <span class="n">pipeline</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s2">"$match"</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">"created_at"</span><span class="p">:</span> <span class="p">{</span>
                        <span class="s2">"$gte"</span><span class="p">:</span> <span class="n">start_datetime</span><span class="p">,</span>
                        <span class="s2">"$lt"</span><span class="p">:</span> <span class="n">end_datetime</span>
                    <span class="p">},</span>
                    <span class="s2">"status"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$ne"</span><span class="p">:</span> <span class="s2">"cancelled"</span><span class="p">}</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="s2">"$group"</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s2">"_id"</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="s2">"total_orders"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$sum"</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
                    <span class="s2">"total_revenue"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$sum"</span><span class="p">:</span> <span class="s2">"$total"</span><span class="p">},</span>
                    <span class="s2">"avg_order_value"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"$avg"</span><span class="p">:</span> <span class="s2">"$total"</span><span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">]</span>

        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_collection</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">pipeline</span><span class="p">)</span><span class="o">.</span><span class="n">to_list</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">DailySalesReport</span><span class="p">(</span>
                <span class="n">date</span><span class="o">=</span><span class="n">date</span><span class="p">,</span>
                <span class="n">total_orders</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">"total_orders"</span><span class="p">],</span>
                <span class="n">total_revenue</span><span class="o">=</span><span class="n">Decimal</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">"total_revenue"</span><span class="p">])),</span>
                <span class="n">average_order_value</span><span class="o">=</span><span class="n">Decimal</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">"avg_order_value"</span><span class="p">]))</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">DailySalesReport</span><span class="p">(</span><span class="n">date</span><span class="o">=</span><span class="n">date</span><span class="p">,</span> <span class="n">total_orders</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">total_revenue</span><span class="o">=</span><span class="n">Decimal</span><span class="p">(</span><span class="s1">'0'</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_entity_to_document</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order</span><span class="p">:</span> <span class="n">Order</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">"_id"</span><span class="p">:</span> <span class="n">order</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s2">"customer_id"</span><span class="p">:</span> <span class="n">order</span><span class="o">.</span><span class="n">customer_id</span><span class="p">,</span>
            <span class="s2">"items"</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">"name"</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">pizza_name</span><span class="p">,</span>
                    <span class="s2">"size"</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">size</span><span class="p">,</span>
                    <span class="s2">"quantity"</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">quantity</span><span class="p">,</span>
                    <span class="s2">"price"</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">price</span><span class="p">)</span>
                <span class="p">}</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">order</span><span class="o">.</span><span class="n">items</span>
            <span class="p">],</span>
            <span class="s2">"total"</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">order</span><span class="o">.</span><span class="n">total</span><span class="p">),</span>
            <span class="s2">"status"</span><span class="p">:</span> <span class="n">order</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="s2">"delivery_address"</span><span class="p">:</span> <span class="n">order</span><span class="o">.</span><span class="n">delivery_address</span><span class="p">,</span>
            <span class="s2">"special_instructions"</span><span class="p">:</span> <span class="n">order</span><span class="o">.</span><span class="n">special_instructions</span><span class="p">,</span>
            <span class="s2">"created_at"</span><span class="p">:</span> <span class="n">order</span><span class="o">.</span><span class="n">created_at</span><span class="p">,</span>
            <span class="s2">"updated_at"</span><span class="p">:</span> <span class="n">order</span><span class="o">.</span><span class="n">updated_at</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_document_to_entity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Order</span><span class="p">:</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">OrderItem</span><span class="p">(</span>
                <span class="n">pizza_name</span><span class="o">=</span><span class="n">item</span><span class="p">[</span><span class="s2">"name"</span><span class="p">],</span>
                <span class="n">size</span><span class="o">=</span><span class="n">PizzaSize</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s2">"size"</span><span class="p">]),</span>
                <span class="n">quantity</span><span class="o">=</span><span class="n">item</span><span class="p">[</span><span class="s2">"quantity"</span><span class="p">],</span>
                <span class="n">price</span><span class="o">=</span><span class="n">Decimal</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s2">"price"</span><span class="p">]))</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">document</span><span class="p">[</span><span class="s2">"items"</span><span class="p">]</span>
        <span class="p">]</span>

        <span class="n">order</span> <span class="o">=</span> <span class="n">Order</span><span class="p">(</span>
            <span class="nb">id</span><span class="o">=</span><span class="n">document</span><span class="p">[</span><span class="s2">"_id"</span><span class="p">],</span>
            <span class="n">customer_id</span><span class="o">=</span><span class="n">document</span><span class="p">[</span><span class="s2">"customer_id"</span><span class="p">],</span>
            <span class="n">items</span><span class="o">=</span><span class="n">items</span><span class="p">,</span>
            <span class="n">delivery_address</span><span class="o">=</span><span class="n">document</span><span class="p">[</span><span class="s2">"delivery_address"</span><span class="p">],</span>
            <span class="n">special_instructions</span><span class="o">=</span><span class="n">document</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"special_instructions"</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">order</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">OrderStatus</span><span class="p">(</span><span class="n">document</span><span class="p">[</span><span class="s2">"status"</span><span class="p">])</span>
        <span class="n">order</span><span class="o">.</span><span class="n">created_at</span> <span class="o">=</span> <span class="n">document</span><span class="p">[</span><span class="s2">"created_at"</span><span class="p">]</span>
        <span class="n">order</span><span class="o">.</span><span class="n">updated_at</span> <span class="o">=</span> <span class="n">document</span><span class="p">[</span><span class="s2">"updated_at"</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">order</span>
</code></pre></div>
<h3 id="file-based-implementation">File-Based Implementation<a class="headerlink" href="#file-based-implementation" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">FileOrderRepository</span><span class="p">(</span><span class="n">OrderRepository</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">data_directory</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_by_id_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Order</span><span class="p">]:</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">order_id</span><span class="si">}</span><span class="s2">.json"</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">file_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">async</span> <span class="k">with</span> <span class="n">aiofiles</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">'r'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="k">await</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict_to_entity</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">save_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order</span><span class="p">:</span> <span class="n">Order</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_dir</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">order</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">.json"</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_entity_to_dict</span><span class="p">(</span><span class="n">order</span><span class="p">)</span>

        <span class="k">async</span> <span class="k">with</span> <span class="n">aiofiles</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">await</span> <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">DecimalEncoder</span><span class="p">))</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">find_by_customer_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">customer_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Order</span><span class="p">]:</span>
        <span class="n">orders</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">async</span> <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iterate_order_files</span><span class="p">():</span>
            <span class="k">async</span> <span class="k">with</span> <span class="n">aiofiles</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">'r'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="k">await</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
                <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s2">"customer_id"</span><span class="p">]</span> <span class="o">==</span> <span class="n">customer_id</span><span class="p">:</span>
                    <span class="n">orders</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_dict_to_entity</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">orders</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_daily_sales_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">date</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DailySalesReport</span><span class="p">:</span>
        <span class="n">total_orders</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">total_revenue</span> <span class="o">=</span> <span class="n">Decimal</span><span class="p">(</span><span class="s1">'0'</span><span class="p">)</span>

        <span class="k">async</span> <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iterate_order_files</span><span class="p">():</span>
            <span class="k">async</span> <span class="k">with</span> <span class="n">aiofiles</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s1">'r'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="k">await</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
                <span class="n">order_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">"created_at"</span><span class="p">])</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>

                <span class="k">if</span> <span class="n">order_date</span> <span class="o">==</span> <span class="n">date</span> <span class="ow">and</span> <span class="n">data</span><span class="p">[</span><span class="s2">"status"</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">"cancelled"</span><span class="p">:</span>
                    <span class="n">total_orders</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">total_revenue</span> <span class="o">+=</span> <span class="n">Decimal</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">"total"</span><span class="p">]))</span>

        <span class="n">avg_order_value</span> <span class="o">=</span> <span class="n">total_revenue</span> <span class="o">/</span> <span class="n">total_orders</span> <span class="k">if</span> <span class="n">total_orders</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">Decimal</span><span class="p">(</span><span class="s1">'0'</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">DailySalesReport</span><span class="p">(</span>
            <span class="n">date</span><span class="o">=</span><span class="n">date</span><span class="p">,</span>
            <span class="n">total_orders</span><span class="o">=</span><span class="n">total_orders</span><span class="p">,</span>
            <span class="n">total_revenue</span><span class="o">=</span><span class="n">total_revenue</span><span class="p">,</span>
            <span class="n">average_order_value</span><span class="o">=</span><span class="n">avg_order_value</span>
        <span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_iterate_order_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_dir</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">"*.json"</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">file_path</span>
</code></pre></div>
<h3 id="in-memory-implementation-testing">In-Memory Implementation (Testing)<a class="headerlink" href="#in-memory-implementation-testing" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">InMemoryOrderRepository</span><span class="p">(</span><span class="n">OrderRepository</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_orders</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Order</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_by_id_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Order</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_orders</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">order_id</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">save_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order</span><span class="p">:</span> <span class="n">Order</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Create deep copy to avoid reference issues in tests</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_orders</span><span class="p">[</span><span class="n">order</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">order</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">delete_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">order_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_orders</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_orders</span><span class="p">[</span><span class="n">order_id</span><span class="p">]</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">find_all_async</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Order</span><span class="p">]:</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_orders</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">find_by_customer_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">customer_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Order</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">order</span> <span class="k">for</span> <span class="n">order</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_orders</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">order</span><span class="o">.</span><span class="n">customer_id</span> <span class="o">==</span> <span class="n">customer_id</span><span class="p">]</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">find_by_status_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">:</span> <span class="n">OrderStatus</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Order</span><span class="p">]:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">order</span> <span class="k">for</span> <span class="n">order</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_orders</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">order</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">status</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""Helper method for testing"""</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_orders</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</code></pre></div>
<h3 id="repository-registration">Repository Registration<a class="headerlink" href="#repository-registration" title="Permanent link">¶</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">RepositoryConfiguration</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">configure_repositories</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">services</span><span class="p">:</span> <span class="n">ServiceCollection</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">AppConfig</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">config</span><span class="o">.</span><span class="n">storage_type</span> <span class="o">==</span> <span class="s2">"mongodb"</span><span class="p">:</span>
            <span class="c1"># MongoDB implementation</span>
            <span class="n">services</span><span class="o">.</span><span class="n">add_singleton</span><span class="p">(</span><span class="k">lambda</span> <span class="n">sp</span><span class="p">:</span> <span class="n">MongoClient</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">mongodb_connection</span><span class="p">))</span>
            <span class="n">services</span><span class="o">.</span><span class="n">add_scoped</span><span class="p">(</span><span class="k">lambda</span> <span class="n">sp</span><span class="p">:</span> <span class="n">MongoOrderRepository</span><span class="p">(</span>
                <span class="n">sp</span><span class="o">.</span><span class="n">get_service</span><span class="p">(</span><span class="n">MongoClient</span><span class="p">)</span><span class="o">.</span><span class="n">orders_db</span><span class="o">.</span><span class="n">orders</span>
            <span class="p">))</span>

        <span class="k">elif</span> <span class="n">config</span><span class="o">.</span><span class="n">storage_type</span> <span class="o">==</span> <span class="s2">"file"</span><span class="p">:</span>
            <span class="c1"># File-based implementation</span>
            <span class="n">services</span><span class="o">.</span><span class="n">add_scoped</span><span class="p">(</span><span class="k">lambda</span> <span class="n">sp</span><span class="p">:</span> <span class="n">FileOrderRepository</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">data_directory</span><span class="p">))</span>

        <span class="k">elif</span> <span class="n">config</span><span class="o">.</span><span class="n">storage_type</span> <span class="o">==</span> <span class="s2">"memory"</span><span class="p">:</span>
            <span class="c1"># In-memory implementation (testing)</span>
            <span class="n">services</span><span class="o">.</span><span class="n">add_singleton</span><span class="p">(</span><span class="n">InMemoryOrderRepository</span><span class="p">)</span>

        <span class="c1"># Register interface to implementation</span>
        <span class="n">services</span><span class="o">.</span><span class="n">add_scoped</span><span class="p">(</span><span class="n">OrderRepository</span><span class="p">,</span>
                          <span class="k">lambda</span> <span class="n">sp</span><span class="p">:</span> <span class="n">sp</span><span class="o">.</span><span class="n">get_service</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">repository_implementation</span><span class="p">))</span>
</code></pre></div>
<h2 id="testing-with-repositories">🧪 Testing with Repositories<a class="headerlink" href="#testing-with-repositories" title="Permanent link">¶</a></h2>
<div class="highlight"><pre><span></span><code><span class="c1"># Unit testing with mocked repositories</span>
<span class="k">class</span><span class="w"> </span><span class="nc">TestOrderService</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">setup_method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mock_repository</span> <span class="o">=</span> <span class="n">Mock</span><span class="p">(</span><span class="n">spec</span><span class="o">=</span><span class="n">OrderRepository</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">service</span> <span class="o">=</span> <span class="n">OrderService</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mock_repository</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_get_customer_orders</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Arrange</span>
        <span class="n">expected_orders</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">Order</span><span class="p">(</span><span class="n">customer_id</span><span class="o">=</span><span class="s2">"123"</span><span class="p">,</span> <span class="n">items</span><span class="o">=</span><span class="p">[]),</span>
            <span class="n">Order</span><span class="p">(</span><span class="n">customer_id</span><span class="o">=</span><span class="s2">"123"</span><span class="p">,</span> <span class="n">items</span><span class="o">=</span><span class="p">[])</span>
        <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mock_repository</span><span class="o">.</span><span class="n">find_by_customer_async</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">expected_orders</span>

        <span class="c1"># Act</span>
        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">service</span><span class="o">.</span><span class="n">get_customer_orders</span><span class="p">(</span><span class="s2">"123"</span><span class="p">)</span>

        <span class="c1"># Assert</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mock_repository</span><span class="o">.</span><span class="n">find_by_customer_async</span><span class="o">.</span><span class="n">assert_called_once_with</span><span class="p">(</span><span class="s2">"123"</span><span class="p">)</span>

<span class="c1"># Integration testing with real repositories</span>
<span class="k">class</span><span class="w"> </span><span class="nc">TestOrderRepositoryIntegration</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">setup_method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">repository</span> <span class="o">=</span> <span class="n">InMemoryOrderRepository</span><span class="p">()</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_save_and_retrieve_order</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Arrange</span>
        <span class="n">order</span> <span class="o">=</span> <span class="n">Order</span><span class="p">(</span>
            <span class="n">customer_id</span><span class="o">=</span><span class="s2">"123"</span><span class="p">,</span>
            <span class="n">items</span><span class="o">=</span><span class="p">[</span><span class="n">OrderItem</span><span class="p">(</span><span class="s2">"Margherita"</span><span class="p">,</span> <span class="n">PizzaSize</span><span class="o">.</span><span class="n">LARGE</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">(</span><span class="s1">'15.99'</span><span class="p">))]</span>
        <span class="p">)</span>

        <span class="c1"># Act</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">repository</span><span class="o">.</span><span class="n">save_async</span><span class="p">(</span><span class="n">order</span><span class="p">)</span>
        <span class="n">retrieved</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">repository</span><span class="o">.</span><span class="n">get_by_id_async</span><span class="p">(</span><span class="n">order</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

        <span class="c1"># Assert</span>
        <span class="k">assert</span> <span class="n">retrieved</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">assert</span> <span class="n">retrieved</span><span class="o">.</span><span class="n">customer_id</span> <span class="o">==</span> <span class="s2">"123"</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">retrieved</span><span class="o">.</span><span class="n">items</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
</code></pre></div>
<h2 id="related-patterns">🔗 Related Patterns<a class="headerlink" href="#related-patterns" title="Permanent link">¶</a></h2>
<ul>
<li><strong><a href="../clean-architecture/">Clean Architecture</a></strong> - Repositories belong in the integration layer</li>
<li><strong><a href="../cqrs/">CQRS Pattern</a></strong> - Separate repositories for commands and queries</li>
<li><strong><a href="../event-driven/">Event-Driven Pattern</a></strong> - Repositories can publish domain events</li>
</ul>
<hr/>
<p><em>This pattern guide demonstrates the Repository pattern using Mario's Pizzeria's data access layer. The abstraction enables storage flexibility and comprehensive testing strategies.</em> 🗄️</p>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  Back to top
</button>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
<div class="md-social">
<a class="md-social__link" href="https://github.com/bvandewe/pyneuro" rel="noopener" target="_blank" title="github.com">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg>
</a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.expand", "navigation.top", "search.highlight", "search.share"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
<script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
</body>
</html>