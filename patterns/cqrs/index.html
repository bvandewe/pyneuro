
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="../clean-architecture/" rel="prev"/>
<link href="../event-driven/" rel="next"/>
<link href="../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.6.20" name="generator"/>
<title>CQRS - Neuroglia Python Framework</title>
<link href="../../assets/stylesheets/main.e53b48f4.min.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body data-md-color-accent="blue" data-md-color-primary="blue" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#cqrs-pattern">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Neuroglia Python Framework" class="md-header__button md-logo" data-md-component="logo" href="../.." title="Neuroglia Python Framework">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Neuroglia Python Framework
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              CQRS
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="blue" data-md-color-media="" data-md-color-primary="blue" data-md-color-scheme="default" id="__palette_0" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="blue" data-md-color-media="" data-md-color-primary="blue" data-md-color-scheme="slate" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
</form>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<a aria-label="Share" class="md-search__icon md-icon" data-clipboard="" data-clipboard-text="" data-md-component="search-share" href="javascript:void(0)" tabindex="-1" title="Share">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"></path></svg>
</a>
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
</nav>
<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="../..">
        
  
  
    
  
  Home

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../getting-started/">
          
  
  
  Getting Started

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../mario-pizzeria/">
        
  
  
    
  
  Mario Pizzeria

      </a>
</li>
<li class="md-tabs__item md-tabs__item--active">
<a class="md-tabs__link" href="../">
          
  
  
  Patterns

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../features/">
          
  
  
  Features

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../guides/">
          
  
  
  Guides

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../samples/">
          
  
  
  Samples

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../references/source_code_naming_convention/">
          
  
  
  References

        </a>
</li>
</ul>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Neuroglia Python Framework" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="Neuroglia Python Framework">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
    Neuroglia Python Framework
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../..">
<span class="md-ellipsis">
    Home
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
<span class="md-ellipsis">
    Getting Started
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../getting-started/">
<span class="md-ellipsis">
    Overview
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../guides/3-min-bootstrap/">
<span class="md-ellipsis">
    3-Minute Bootstrap
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../guides/local-development/">
<span class="md-ellipsis">
    Local Development Setup
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../guides/mario-pizzeria-tutorial/">
<span class="md-ellipsis">
    Mario's Pizzeria Tutorial
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../mario-pizzeria/">
<span class="md-ellipsis">
    Mario Pizzeria
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
<span class="md-ellipsis">
    Patterns
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            Patterns
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../">
<span class="md-ellipsis">
    Overview
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../clean-architecture/">
<span class="md-ellipsis">
    Clean Architecture
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    CQRS
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    CQRS
    
  </span>
</a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#overview">
<span class="md-ellipsis">
      ğŸ¯ Overview
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#benefits">
<span class="md-ellipsis">
      âœ… Benefits
    </span>
</a>
<nav aria-label="âœ… Benefits" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#1-optimized-performance">
<span class="md-ellipsis">
      1. Optimized Performance
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-independent-scaling">
<span class="md-ellipsis">
      2. Independent Scaling
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3-clear-separation-of-concerns">
<span class="md-ellipsis">
      3. Clear Separation of Concerns
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#data-flow">
<span class="md-ellipsis">
      ğŸ”„ Data Flow
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#use-cases">
<span class="md-ellipsis">
      ğŸ¯ Use Cases
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#implementation-in-marios-pizzeria">
<span class="md-ellipsis">
      ğŸ• Implementation in Mario's Pizzeria
    </span>
</a>
<nav aria-label="ğŸ• Implementation in Mario's Pizzeria" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#commands-write-operations">
<span class="md-ellipsis">
      Commands (Write Operations)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#queries-read-operations">
<span class="md-ellipsis">
      Queries (Read Operations)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#controller-integration">
<span class="md-ellipsis">
      Controller Integration
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#read-model-optimization">
<span class="md-ellipsis">
      Read Model Optimization
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#testing-cqrs">
<span class="md-ellipsis">
      ğŸ§ª Testing CQRS
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#related-patterns">
<span class="md-ellipsis">
      ğŸ”— Related Patterns
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../event-driven/">
<span class="md-ellipsis">
    Event-Driven
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../repository/">
<span class="md-ellipsis">
    Repository
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../resource-oriented-architecture/">
<span class="md-ellipsis">
    Resource-Oriented Architecture
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../watcher-reconciliation-patterns/">
<span class="md-ellipsis">
    Watcher &amp; Reconciliation Patterns
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../watcher-reconciliation-execution/">
<span class="md-ellipsis">
    Watcher &amp; Reconciliation Execution
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
<span class="md-ellipsis">
    Features
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
            Features
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../features/">
<span class="md-ellipsis">
    Overview
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../features/dependency-injection/">
<span class="md-ellipsis">
    Dependency Injection
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../features/cqrs-mediation/">
<span class="md-ellipsis">
    CQRS &amp; Mediation
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../features/mvc-controllers/">
<span class="md-ellipsis">
    MVC Controllers
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../features/data-access/">
<span class="md-ellipsis">
    Data Access
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../features/event-sourcing/">
<span class="md-ellipsis">
    Event Sourcing
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../features/serialization/">
<span class="md-ellipsis">
    Serialization
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../features/object-mapping/">
<span class="md-ellipsis">
    Object Mapping
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../features/reactive-programming/">
<span class="md-ellipsis">
    Reactive Programming
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../features/background-task-scheduling/">
<span class="md-ellipsis">
    Background Task Scheduling
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../features/redis-cache-repository/">
<span class="md-ellipsis">
    Redis Cache Repository
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../features/http-service-client/">
<span class="md-ellipsis">
    HTTP Service Client
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../features/case-conversion-utilities/">
<span class="md-ellipsis">
    Case Conversion Utilities
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../features/enhanced-model-validation/">
<span class="md-ellipsis">
    Enhanced Model Validation
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../features/mermaid-diagrams/">
<span class="md-ellipsis">
    Mermaid Diagrams
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
<span class="md-ellipsis">
    Guides
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_6_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_6">
<span class="md-nav__icon md-icon"></span>
            Guides
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../guides/">
<span class="md-ellipsis">
    Overview
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../guides/project-setup/">
<span class="md-ellipsis">
    Project Setup
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../guides/testing-setup/">
<span class="md-ellipsis">
    Testing Setup
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_7" type="checkbox"/>
<label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
<span class="md-ellipsis">
    Samples
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_7_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_7">
<span class="md-nav__icon md-icon"></span>
            Samples
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../samples/">
<span class="md-ellipsis">
    Overview
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../samples/openbank/">
<span class="md-ellipsis">
    OpenBank
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../samples/api_gateway/">
<span class="md-ellipsis">
    API Gateway
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../samples/desktop_controller/">
<span class="md-ellipsis">
    Desktop Controller
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_8" type="checkbox"/>
<label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
<span class="md-ellipsis">
    References
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_8_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_8">
<span class="md-nav__icon md-icon"></span>
            References
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../references/source_code_naming_convention/">
<span class="md-ellipsis">
    Source Code Naming Conventions
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../references/12-factor-app/">
<span class="md-ellipsis">
    12-Factor App
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../references/python_type_hints/">
<span class="md-ellipsis">
    Python Type Hints
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../references/python_generic_types/">
<span class="md-ellipsis">
    Python Generic Types
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../references/python_modular_code/">
<span class="md-ellipsis">
    Python Modular Code
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../references/python_object_oriented/">
<span class="md-ellipsis">
    Python Object-Oriented Programming
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#overview">
<span class="md-ellipsis">
      ğŸ¯ Overview
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#benefits">
<span class="md-ellipsis">
      âœ… Benefits
    </span>
</a>
<nav aria-label="âœ… Benefits" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#1-optimized-performance">
<span class="md-ellipsis">
      1. Optimized Performance
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-independent-scaling">
<span class="md-ellipsis">
      2. Independent Scaling
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3-clear-separation-of-concerns">
<span class="md-ellipsis">
      3. Clear Separation of Concerns
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#data-flow">
<span class="md-ellipsis">
      ğŸ”„ Data Flow
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#use-cases">
<span class="md-ellipsis">
      ğŸ¯ Use Cases
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#implementation-in-marios-pizzeria">
<span class="md-ellipsis">
      ğŸ• Implementation in Mario's Pizzeria
    </span>
</a>
<nav aria-label="ğŸ• Implementation in Mario's Pizzeria" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#commands-write-operations">
<span class="md-ellipsis">
      Commands (Write Operations)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#queries-read-operations">
<span class="md-ellipsis">
      Queries (Read Operations)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#controller-integration">
<span class="md-ellipsis">
      Controller Integration
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#read-model-optimization">
<span class="md-ellipsis">
      Read Model Optimization
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#testing-cqrs">
<span class="md-ellipsis">
      ğŸ§ª Testing CQRS
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#related-patterns">
<span class="md-ellipsis">
      ğŸ”— Related Patterns
    </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="cqrs-pattern">ğŸ¯ CQRS Pattern<a class="headerlink" href="#cqrs-pattern" title="Permanent link">Â¶</a></h1>
<div class="admonition warning">
<p class="admonition-title">ğŸš§ Under Construction</p>
</div>
<p>This page is currently being developed with comprehensive examples from Mario's Pizzeria. More detailed implementations and code samples are being added.</p>
<p>Command Query Responsibility Segregation (CQRS) separates read and write operations into distinct models, enabling optimized data access patterns and scalable architecture.</p>
<h2 id="overview">ğŸ¯ Overview<a class="headerlink" href="#overview" title="Permanent link">Â¶</a></h2>
<p>CQRS divides your application's operations into two distinct paths: <strong>Commands</strong> for writes (state changes) and <strong>Queries</strong> for reads (data retrieval). Mario's Pizzeria demonstrates this pattern through its order management and menu systems.</p>
<pre class="mermaid"><code>flowchart TD
    Client[Customer/Staff]

    subgraph "ğŸ¯ CQRS Separation"
        subgraph Commands["ğŸ“ Write Side (Commands)"]
            PlaceOrder[PlaceOrderCommand]
            UpdateMenu[UpdateMenuCommand]
            ProcessPayment[ProcessPaymentCommand]
        end

        subgraph Queries["ğŸ“– Read Side (Queries)"]
            GetMenu[GetMenuQuery]
            GetOrder[GetOrderByIdQuery]
            GetOrderHistory[GetOrderHistoryQuery]
        end
    end

    subgraph Mediator["ğŸ­ Mediator"]
        CommandHandlers[Command Handlers]
        QueryHandlers[Query Handlers]
    end

    subgraph Storage["ğŸ’¾ Data Storage"]
        WriteDB[(Write Database&lt;br/&gt;MongoDB)]
        ReadDB[(Read Models&lt;br/&gt;Optimized Views)]
        EventStore[(Event Store&lt;br/&gt;Order History)]
    end

    Client --&gt;|"ğŸ• Place Order"| PlaceOrder
    Client --&gt;|"ğŸ“‹ Get Menu"| GetMenu
    Client --&gt;|"ğŸ“Š Order Status"| GetOrder

    PlaceOrder --&gt; CommandHandlers
    GetMenu --&gt; QueryHandlers
    GetOrder --&gt; QueryHandlers

    CommandHandlers --&gt;|"ğŸ’¾ Persist"| WriteDB
    CommandHandlers --&gt;|"ğŸ“¡ Events"| EventStore
    QueryHandlers --&gt;|"ğŸ” Read"| ReadDB

    WriteDB -.-&gt;|"ğŸ”„ Sync"| ReadDB
    EventStore -.-&gt;|"ğŸ“ˆ Project"| ReadDB</code></pre>
<h2 id="benefits">âœ… Benefits<a class="headerlink" href="#benefits" title="Permanent link">Â¶</a></h2>
<h3 id="1-optimized-performance">1. <strong>Optimized Performance</strong><a class="headerlink" href="#1-optimized-performance" title="Permanent link">Â¶</a></h3>
<p>Different models for reads and writes enable performance optimization:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Write Model - Normalized for consistency</span>
<span class="k">class</span><span class="w"> </span><span class="nc">PlaceOrderCommand</span><span class="p">(</span><span class="n">Command</span><span class="p">[</span><span class="n">OperationResult</span><span class="p">[</span><span class="n">OrderDto</span><span class="p">]]):</span>
    <span class="n">customer_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">items</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">OrderItemDto</span><span class="p">]</span>
    <span class="n">delivery_address</span><span class="p">:</span> <span class="n">AddressDto</span>
    <span class="n">payment_method</span><span class="p">:</span> <span class="n">PaymentMethodDto</span>

<span class="c1"># Read Model - Denormalized for speed</span>
<span class="k">class</span><span class="w"> </span><span class="nc">OrderSummaryDto</span><span class="p">:</span>
    <span class="n">order_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">customer_name</span><span class="p">:</span> <span class="nb">str</span>  <span class="c1"># Denormalized</span>
    <span class="n">total_amount</span><span class="p">:</span> <span class="n">Decimal</span>
    <span class="n">status</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">estimated_delivery</span><span class="p">:</span> <span class="n">datetime</span>
    <span class="n">items_count</span><span class="p">:</span> <span class="nb">int</span>  <span class="c1"># Pre-calculated</span>
</code></pre></div>
<h3 id="2-independent-scaling">2. <strong>Independent Scaling</strong><a class="headerlink" href="#2-independent-scaling" title="Permanent link">Â¶</a></h3>
<p>Read and write sides can scale independently based on usage patterns:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Heavy read operations don't impact write performance</span>
<span class="k">class</span><span class="w"> </span><span class="nc">GetPopularPizzasQuery</span><span class="p">(</span><span class="n">Query</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PopularPizzaDto</span><span class="p">]]):</span>
    <span class="n">time_period</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">"last_30_days"</span>
    <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span>

<span class="c1"># Complex writes don't slow down simple reads</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ProcessOrderWorkflowCommand</span><span class="p">(</span><span class="n">Command</span><span class="p">[</span><span class="n">OperationResult</span><span class="p">]):</span>
    <span class="n">order_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="c1"># Complex business logic with multiple validations</span>
</code></pre></div>
<h3 id="3-clear-separation-of-concerns">3. <strong>Clear Separation of Concerns</strong><a class="headerlink" href="#3-clear-separation-of-concerns" title="Permanent link">Â¶</a></h3>
<p>Commands handle business logic while queries focus on data presentation.</p>
<h2 id="data-flow">ğŸ”„ Data Flow<a class="headerlink" href="#data-flow" title="Permanent link">Â¶</a></h2>
<p>The pizza ordering process demonstrates CQRS data flow:</p>
<pre class="mermaid"><code>sequenceDiagram
    participant Customer
    participant API as API Controller
    participant Med as Mediator
    participant CH as Command Handler
    participant QH as Query Handler
    participant WDB as Write DB
    participant RDB as Read DB
    participant ES as Event Store

    Note over Customer,ES: ğŸ“ Command Flow (Write)
    Customer-&gt;&gt;+API: Place Pizza Order
    API-&gt;&gt;+Med: PlaceOrderCommand
    Med-&gt;&gt;+CH: Route to handler

    CH-&gt;&gt;CH: Validate business rules
    CH-&gt;&gt;+WDB: Save normalized order
    WDB--&gt;&gt;-CH: Order persisted

    CH-&gt;&gt;+ES: Store OrderPlacedEvent
    ES--&gt;&gt;-CH: Event saved

    CH--&gt;&gt;-Med: Success result
    Med--&gt;&gt;-API: OrderDto
    API--&gt;&gt;-Customer: 201 Created

    Note over Customer,ES: ğŸ“– Query Flow (Read)
    Customer-&gt;&gt;+API: Get Order Status
    API-&gt;&gt;+Med: GetOrderByIdQuery
    Med-&gt;&gt;+QH: Route to handler

    QH-&gt;&gt;+RDB: Read denormalized view
    RDB--&gt;&gt;-QH: Order summary

    QH--&gt;&gt;-Med: OrderSummaryDto
    Med--&gt;&gt;-API: Result
    API--&gt;&gt;-Customer: 200 OK

    Note over WDB,RDB: ğŸ”„ Background Sync
    ES-&gt;&gt;RDB: Project events to read models
    WDB-&gt;&gt;RDB: Sync latest changes</code></pre>
<h2 id="use-cases">ğŸ¯ Use Cases<a class="headerlink" href="#use-cases" title="Permanent link">Â¶</a></h2>
<p>CQRS is particularly effective for:</p>
<ul>
<li><strong>High-Traffic Applications</strong>: Different read/write performance requirements</li>
<li><strong>Complex Business Logic</strong>: Commands handle intricate workflows</li>
<li><strong>Reporting Systems</strong>: Optimized read models for analytics</li>
<li><strong>Event-Driven Systems</strong>: Natural fit with event sourcing</li>
</ul>
<h2 id="implementation-in-marios-pizzeria">ğŸ• Implementation in Mario's Pizzeria<a class="headerlink" href="#implementation-in-marios-pizzeria" title="Permanent link">Â¶</a></h2>
<h3 id="commands-write-operations">Commands (Write Operations)<a class="headerlink" href="#commands-write-operations" title="Permanent link">Â¶</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Command: Place a pizza order</span>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">PlaceOrderCommand</span><span class="p">(</span><span class="n">Command</span><span class="p">[</span><span class="n">OperationResult</span><span class="p">[</span><span class="n">OrderDto</span><span class="p">]]):</span>
    <span class="n">customer_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">pizzas</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">PizzaSelectionDto</span><span class="p">]</span>
    <span class="n">delivery_address</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">payment_method</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">special_instructions</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">class</span><span class="w"> </span><span class="nc">PlaceOrderHandler</span><span class="p">(</span><span class="n">CommandHandler</span><span class="p">[</span><span class="n">PlaceOrderCommand</span><span class="p">,</span> <span class="n">OperationResult</span><span class="p">[</span><span class="n">OrderDto</span><span class="p">]]):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">order_repository</span><span class="p">:</span> <span class="n">OrderRepository</span><span class="p">,</span>
                 <span class="n">payment_service</span><span class="p">:</span> <span class="n">PaymentService</span><span class="p">,</span>
                 <span class="n">inventory_service</span><span class="p">:</span> <span class="n">InventoryService</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_order_repo</span> <span class="o">=</span> <span class="n">order_repository</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_payment</span> <span class="o">=</span> <span class="n">payment_service</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_inventory</span> <span class="o">=</span> <span class="n">inventory_service</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">handle_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">:</span> <span class="n">PlaceOrderCommand</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OperationResult</span><span class="p">[</span><span class="n">OrderDto</span><span class="p">]:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># 1. Validate business rules</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inventory</span><span class="o">.</span><span class="n">check_availability</span><span class="p">(</span><span class="n">command</span><span class="o">.</span><span class="n">pizzas</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bad_request</span><span class="p">(</span><span class="s2">"Some pizzas are not available"</span><span class="p">)</span>

            <span class="c1"># 2. Create domain entity</span>
            <span class="n">order</span> <span class="o">=</span> <span class="n">Order</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
                <span class="n">customer_id</span><span class="o">=</span><span class="n">command</span><span class="o">.</span><span class="n">customer_id</span><span class="p">,</span>
                <span class="n">pizzas</span><span class="o">=</span><span class="n">command</span><span class="o">.</span><span class="n">pizzas</span><span class="p">,</span>
                <span class="n">delivery_address</span><span class="o">=</span><span class="n">command</span><span class="o">.</span><span class="n">delivery_address</span>
            <span class="p">)</span>

            <span class="c1"># 3. Process payment</span>
            <span class="n">payment_result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_payment</span><span class="o">.</span><span class="n">charge_async</span><span class="p">(</span>
                <span class="n">order</span><span class="o">.</span><span class="n">total</span><span class="p">,</span> <span class="n">command</span><span class="o">.</span><span class="n">payment_method</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">payment_result</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bad_request</span><span class="p">(</span><span class="s2">"Payment failed"</span><span class="p">)</span>

            <span class="c1"># 4. Persist order</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_order_repo</span><span class="o">.</span><span class="n">save_async</span><span class="p">(</span><span class="n">order</span><span class="p">)</span>

            <span class="c1"># 5. Return result</span>
            <span class="n">dto</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="n">OrderDto</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">created</span><span class="p">(</span><span class="n">dto</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">internal_server_error</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Order placement failed: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</code></pre></div>
<h3 id="queries-read-operations">Queries (Read Operations)<a class="headerlink" href="#queries-read-operations" title="Permanent link">Â¶</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Query: Get menu with pricing</span>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">GetMenuQuery</span><span class="p">(</span><span class="n">Query</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">MenuItemDto</span><span class="p">]]):</span>
    <span class="n">category</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">include_unavailable</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>

<span class="k">class</span><span class="w"> </span><span class="nc">GetMenuHandler</span><span class="p">(</span><span class="n">QueryHandler</span><span class="p">[</span><span class="n">GetMenuQuery</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">MenuItemDto</span><span class="p">]]):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">menu_read_repository</span><span class="p">:</span> <span class="n">MenuReadRepository</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_menu_repo</span> <span class="o">=</span> <span class="n">menu_read_repository</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">handle_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="n">GetMenuQuery</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">MenuItemDto</span><span class="p">]:</span>
        <span class="c1"># Optimized read from denormalized menu view</span>
        <span class="n">menu_items</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_menu_repo</span><span class="o">.</span><span class="n">get_menu_items_async</span><span class="p">(</span>
            <span class="n">category</span><span class="o">=</span><span class="n">query</span><span class="o">.</span><span class="n">category</span><span class="p">,</span>
            <span class="n">include_unavailable</span><span class="o">=</span><span class="n">query</span><span class="o">.</span><span class="n">include_unavailable</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">MenuItemDto</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">menu_items</span><span class="p">]</span>

<span class="c1"># Query: Get order history with analytics</span>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">GetOrderHistoryQuery</span><span class="p">(</span><span class="n">Query</span><span class="p">[</span><span class="n">OrderHistoryDto</span><span class="p">]):</span>
    <span class="n">customer_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">page</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">page_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span>

<span class="k">class</span><span class="w"> </span><span class="nc">GetOrderHistoryHandler</span><span class="p">(</span><span class="n">QueryHandler</span><span class="p">[</span><span class="n">GetOrderHistoryQuery</span><span class="p">,</span> <span class="n">OrderHistoryDto</span><span class="p">]):</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">handle_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="n">GetOrderHistoryQuery</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OrderHistoryDto</span><span class="p">:</span>
        <span class="c1"># Read from optimized history view with pre-calculated stats</span>
        <span class="n">history</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_order_read_repo</span><span class="o">.</span><span class="n">get_customer_history_async</span><span class="p">(</span>
            <span class="n">customer_id</span><span class="o">=</span><span class="n">query</span><span class="o">.</span><span class="n">customer_id</span><span class="p">,</span>
            <span class="n">page</span><span class="o">=</span><span class="n">query</span><span class="o">.</span><span class="n">page</span><span class="p">,</span>
            <span class="n">page_size</span><span class="o">=</span><span class="n">query</span><span class="o">.</span><span class="n">page_size</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">OrderHistoryDto</span><span class="p">(</span>
            <span class="n">orders</span><span class="o">=</span><span class="n">history</span><span class="o">.</span><span class="n">orders</span><span class="p">,</span>
            <span class="n">total_orders</span><span class="o">=</span><span class="n">history</span><span class="o">.</span><span class="n">total_count</span><span class="p">,</span>
            <span class="n">total_spent</span><span class="o">=</span><span class="n">history</span><span class="o">.</span><span class="n">lifetime_value</span><span class="p">,</span>  <span class="c1"># Pre-calculated</span>
            <span class="n">favorite_pizzas</span><span class="o">=</span><span class="n">history</span><span class="o">.</span><span class="n">top_pizzas</span><span class="p">,</span>  <span class="c1"># Pre-calculated</span>
            <span class="n">page</span><span class="o">=</span><span class="n">query</span><span class="o">.</span><span class="n">page</span><span class="p">,</span>
            <span class="n">page_size</span><span class="o">=</span><span class="n">query</span><span class="o">.</span><span class="n">page_size</span>
        <span class="p">)</span>
</code></pre></div>
<h3 id="controller-integration">Controller Integration<a class="headerlink" href="#controller-integration" title="Permanent link">Â¶</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Controllers use mediator to route commands and queries</span>
<span class="k">class</span><span class="w"> </span><span class="nc">OrdersController</span><span class="p">(</span><span class="n">ControllerBase</span><span class="p">):</span>

    <span class="nd">@post</span><span class="p">(</span><span class="s2">"/"</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">OrderDto</span><span class="p">,</span> <span class="n">status_code</span><span class="o">=</span><span class="mi">201</span><span class="p">)</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">place_order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="n">PlaceOrderRequest</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OrderDto</span><span class="p">:</span>
        <span class="c1"># Route to command handler</span>
        <span class="n">command</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">PlaceOrderCommand</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">mediator</span><span class="o">.</span><span class="n">execute_async</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="nd">@get</span><span class="p">(</span><span class="s2">"/</span><span class="si">{order_id}</span><span class="s2">"</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">OrderDto</span><span class="p">)</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OrderDto</span><span class="p">:</span>
        <span class="c1"># Route to query handler</span>
        <span class="n">query</span> <span class="o">=</span> <span class="n">GetOrderByIdQuery</span><span class="p">(</span><span class="n">order_id</span><span class="o">=</span><span class="n">order_id</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">mediator</span><span class="o">.</span><span class="n">execute_async</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="nd">@get</span><span class="p">(</span><span class="s2">"/"</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">List</span><span class="p">[</span><span class="n">OrderSummaryDto</span><span class="p">])</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_orders</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                        <span class="n">customer_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="n">status</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">OrderSummaryDto</span><span class="p">]:</span>
        <span class="c1"># Route to query handler with filters</span>
        <span class="n">query</span> <span class="o">=</span> <span class="n">GetOrdersQuery</span><span class="p">(</span><span class="n">customer_id</span><span class="o">=</span><span class="n">customer_id</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="n">status</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">mediator</span><span class="o">.</span><span class="n">execute_async</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>
</code></pre></div>
<h3 id="read-model-optimization">Read Model Optimization<a class="headerlink" href="#read-model-optimization" title="Permanent link">Â¶</a></h3>
<div class="highlight"><pre><span></span><code><span class="c1"># Optimized read models for different use cases</span>
<span class="k">class</span><span class="w"> </span><span class="nc">OrderSummaryDto</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Lightweight order summary for lists"""</span>
    <span class="n">order_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">customer_name</span><span class="p">:</span> <span class="nb">str</span>  <span class="c1"># Denormalized</span>
    <span class="n">total</span><span class="p">:</span> <span class="n">Decimal</span>
    <span class="n">status</span><span class="p">:</span> <span class="n">OrderStatus</span>
    <span class="n">order_date</span><span class="p">:</span> <span class="n">datetime</span>
    <span class="n">estimated_delivery</span><span class="p">:</span> <span class="n">datetime</span>

<span class="k">class</span><span class="w"> </span><span class="nc">OrderDetailDto</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Complete order details for single order view"""</span>
    <span class="n">order_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">customer</span><span class="p">:</span> <span class="n">CustomerDto</span>  <span class="c1"># Full customer details</span>
    <span class="n">items</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">OrderItemDetailDto</span><span class="p">]</span>  <span class="c1"># Expanded item details</span>
    <span class="n">payment</span><span class="p">:</span> <span class="n">PaymentDetailDto</span>
    <span class="n">delivery</span><span class="p">:</span> <span class="n">DeliveryDetailDto</span>
    <span class="n">timeline</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">OrderEventDto</span><span class="p">]</span>  <span class="c1"># Order history</span>
    <span class="n">total_breakdown</span><span class="p">:</span> <span class="n">OrderTotalDto</span>  <span class="c1"># Tax, discounts, etc.</span>
</code></pre></div>
<h2 id="testing-cqrs">ğŸ§ª Testing CQRS<a class="headerlink" href="#testing-cqrs" title="Permanent link">Â¶</a></h2>
<div class="highlight"><pre><span></span><code><span class="c1"># Test commands and queries separately</span>
<span class="k">class</span><span class="w"> </span><span class="nc">TestPlaceOrderCommand</span><span class="p">:</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_place_order_success</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Arrange</span>
        <span class="n">handler</span> <span class="o">=</span> <span class="n">PlaceOrderHandler</span><span class="p">(</span><span class="n">mock_repo</span><span class="p">,</span> <span class="n">mock_payment</span><span class="p">,</span> <span class="n">mock_inventory</span><span class="p">)</span>
        <span class="n">command</span> <span class="o">=</span> <span class="n">PlaceOrderCommand</span><span class="p">(</span>
            <span class="n">customer_id</span><span class="o">=</span><span class="s2">"123"</span><span class="p">,</span>
            <span class="n">pizzas</span><span class="o">=</span><span class="p">[</span><span class="n">PizzaSelectionDto</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"Margherita"</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">"Large"</span><span class="p">)]</span>
        <span class="p">)</span>

        <span class="c1"># Act</span>
        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">handler</span><span class="o">.</span><span class="n">handle_async</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

        <span class="c1"># Assert</span>
        <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">is_success</span>
        <span class="n">mock_repo</span><span class="o">.</span><span class="n">save_async</span><span class="o">.</span><span class="n">assert_called_once</span><span class="p">()</span>

<span class="k">class</span><span class="w"> </span><span class="nc">TestGetMenuQuery</span><span class="p">:</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_get_menu_filters_by_category</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Arrange</span>
        <span class="n">handler</span> <span class="o">=</span> <span class="n">GetMenuHandler</span><span class="p">(</span><span class="n">mock_read_repo</span><span class="p">)</span>
        <span class="n">query</span> <span class="o">=</span> <span class="n">GetMenuQuery</span><span class="p">(</span><span class="n">category</span><span class="o">=</span><span class="s2">"Pizza"</span><span class="p">)</span>

        <span class="c1"># Act</span>
        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">handler</span><span class="o">.</span><span class="n">handle_async</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>

        <span class="c1"># Assert</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">category</span> <span class="o">==</span> <span class="s2">"Pizza"</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">result</span><span class="p">)</span>
</code></pre></div>
<h2 id="related-patterns">ğŸ”— Related Patterns<a class="headerlink" href="#related-patterns" title="Permanent link">Â¶</a></h2>
<ul>
<li><strong><a href="../clean-architecture/">Clean Architecture</a></strong> - CQRS fits naturally in the application layer</li>
<li><strong><a href="../event-driven/">Event-Driven Pattern</a></strong> - Commands often produce events</li>
<li><strong><a href="../repository/">Repository Pattern</a></strong> - Separate repositories for reads and writes</li>
</ul>
<hr/>
<p><em>This pattern guide demonstrates CQRS using Mario's Pizzeria's order and menu management systems. The separation of commands and queries enables optimized, scalable data access patterns.</em> ğŸ¯</p>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  Back to top
</button>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
<div class="md-social">
<a class="md-social__link" href="https://github.com/bvandewe/pyneuro" rel="noopener" target="_blank" title="github.com">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg>
</a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.expand", "navigation.top", "search.highlight", "search.share"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
<script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
</body>
</html>