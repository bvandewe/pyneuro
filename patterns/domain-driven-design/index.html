
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="../clean-architecture/" rel="prev"/>
<link href="../dependency-injection/" rel="next"/>
<link href="../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.6.20" name="generator"/>
<title>Domain Driven Design - Neuroglia Python Framework</title>
<link href="../../assets/stylesheets/main.e53b48f4.min.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body data-md-color-accent="blue" data-md-color-primary="blue" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#domain-driven-design-pattern">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Neuroglia Python Framework" class="md-header__button md-logo" data-md-component="logo" href="../.." title="Neuroglia Python Framework">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Neuroglia Python Framework
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Domain Driven Design
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="blue" data-md-color-media="" data-md-color-primary="blue" data-md-color-scheme="default" id="__palette_0" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="blue" data-md-color-media="" data-md-color-primary="blue" data-md-color-scheme="slate" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
</form>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<a aria-label="Share" class="md-search__icon md-icon" data-clipboard="" data-clipboard-text="" data-md-component="search-share" href="javascript:void(0)" tabindex="-1" title="Share">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"></path></svg>
</a>
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
</nav>
<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="../..">
        
  
  
    
  
  Home

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../getting-started/">
          
  
  
  Getting Started

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../mario-pizzeria/">
          
  
  
  Mario's Pizzeria

        </a>
</li>
<li class="md-tabs__item md-tabs__item--active">
<a class="md-tabs__link" href="../">
          
  
  
  Patterns

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../features/">
          
  
  
  Features

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../guides/">
          
  
  
  Guides

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../samples/">
          
  
  
  Samples

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../references/oauth-oidc-jwt/">
          
  
  
  References

        </a>
</li>
</ul>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Neuroglia Python Framework" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="Neuroglia Python Framework">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
    Neuroglia Python Framework
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../..">
<span class="md-ellipsis">
    Home
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
<span class="md-ellipsis">
    Getting Started
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../getting-started/">
<span class="md-ellipsis">
    Overview
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../guides/3-min-bootstrap/">
<span class="md-ellipsis">
    3-Minute Bootstrap
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../guides/local-development/">
<span class="md-ellipsis">
    Local Development Setup
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../guides/mario-pizzeria-tutorial/">
<span class="md-ellipsis">
    Mario's Pizzeria Tutorial
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
<span class="md-ellipsis">
    Mario's Pizzeria
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
            Mario's Pizzeria
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../mario-pizzeria/">
<span class="md-ellipsis">
    Case Study Overview
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../mario-pizzeria/business-analysis/">
<span class="md-ellipsis">
    Business Analysis
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../mario-pizzeria/technical-architecture/">
<span class="md-ellipsis">
    Technical Architecture
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../mario-pizzeria/domain-design/">
<span class="md-ellipsis">
    Domain Design
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../mario-pizzeria/implementation-guide/">
<span class="md-ellipsis">
    Implementation Guide
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../mario-pizzeria/testing-deployment/">
<span class="md-ellipsis">
    Testing &amp; Deployment
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
<span class="md-ellipsis">
    Patterns
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            Patterns
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../">
<span class="md-ellipsis">
    Overview
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../clean-architecture/">
<span class="md-ellipsis">
    Clean Architecture
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    Domain Driven Design
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    Domain Driven Design
    
  </span>
</a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#pattern-overview">
<span class="md-ellipsis">
      ğŸ¯ Pattern Overview
    </span>
</a>
<nav aria-label="ğŸ¯ Pattern Overview" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#core-ddd-principles">
<span class="md-ellipsis">
      ğŸŒŸ Core DDD Principles
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#framework-integration">
<span class="md-ellipsis">
      ğŸ”„ Framework Integration
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#core-domain-abstractions">
<span class="md-ellipsis">
      ğŸ• Core Domain Abstractions
    </span>
</a>
<nav aria-label="ğŸ• Core Domain Abstractions" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#1-entity-base-class">
<span class="md-ellipsis">
      1. Entity Base Class
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-domain-events">
<span class="md-ellipsis">
      2. Domain Events
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3-aggregate-root">
<span class="md-ellipsis">
      3. Aggregate Root
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#transaction-flow-with-multiple-domain-events">
<span class="md-ellipsis">
      ğŸ”„ Transaction Flow with Multiple Domain Events
    </span>
</a>
<nav aria-label="ğŸ”„ Transaction Flow with Multiple Domain Events" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#complex-business-transaction-example">
<span class="md-ellipsis">
      Complex Business Transaction Example
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#transaction-flow-visualization">
<span class="md-ellipsis">
      Transaction Flow Visualization
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#domain-events-vs-integration-events">
<span class="md-ellipsis">
      ğŸŒ Domain Events vs Integration Events
    </span>
</a>
<nav aria-label="ğŸŒ Domain Events vs Integration Events" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#domain-event-integration-event-flow">
<span class="md-ellipsis">
      Domain Event â†’ Integration Event Flow
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#event-types-comparison">
<span class="md-ellipsis">
      Event Types Comparison
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#event-sourcing-vs-traditional-implementation">
<span class="md-ellipsis">
      ğŸ¯ Event Sourcing vs Traditional Implementation
    </span>
</a>
<nav aria-label="ğŸ¯ Event Sourcing vs Traditional Implementation" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#traditional-crud-implementation">
<span class="md-ellipsis">
      Traditional CRUD Implementation
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#event-sourcing-implementation">
<span class="md-ellipsis">
      Event Sourcing Implementation
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#implementation-comparison">
<span class="md-ellipsis">
      Implementation Comparison
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#data-flow-across-layers">
<span class="md-ellipsis">
      ğŸ—ï¸ Data Flow Across Layers
    </span>
</a>
<nav aria-label="ğŸ—ï¸ Data Flow Across Layers" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#complete-request-response-flow">
<span class="md-ellipsis">
      Complete Request-Response Flow
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#data-transformation-flow">
<span class="md-ellipsis">
      Data Transformation Flow
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#when-to-use-domain-driven-design">
<span class="md-ellipsis">
      ğŸ¯ When to Use Domain Driven Design
    </span>
</a>
<nav aria-label="ğŸ¯ When to Use Domain Driven Design" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#ideal-use-cases">
<span class="md-ellipsis">
      âœ… Ideal Use Cases
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#consider-alternatives-when">
<span class="md-ellipsis">
      âŒ Consider Alternatives When
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#migration-path">
<span class="md-ellipsis">
      ğŸš€ Migration Path
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#related-patterns">
<span class="md-ellipsis">
      ğŸ”— Related Patterns
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../dependency-injection/">
<span class="md-ellipsis">
    Dependency Injection
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../cqrs/">
<span class="md-ellipsis">
    CQRS &amp; Mediation
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../event-driven/">
<span class="md-ellipsis">
    Event-Driven
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../event-sourcing/">
<span class="md-ellipsis">
    Event Sourcing
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../reactive-programming/">
<span class="md-ellipsis">
    Reactive Programming
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../repository/">
<span class="md-ellipsis">
    Repository
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../resource-oriented-architecture/">
<span class="md-ellipsis">
    Resource-Oriented Architecture
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../watcher-reconciliation-patterns/">
<span class="md-ellipsis">
    Watcher &amp; Reconciliation Patterns
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../watcher-reconciliation-execution/">
<span class="md-ellipsis">
    Watcher &amp; Reconciliation Execution
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
<span class="md-ellipsis">
    Features
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
            Features
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../features/">
<span class="md-ellipsis">
    Overview
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../features/mvc-controllers/">
<span class="md-ellipsis">
    MVC Controllers
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../features/data-access/">
<span class="md-ellipsis">
    Data Access
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../features/serialization/">
<span class="md-ellipsis">
    Serialization
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../features/object-mapping/">
<span class="md-ellipsis">
    Object Mapping
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../features/background-task-scheduling/">
<span class="md-ellipsis">
    Background Task Scheduling
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../features/redis-cache-repository/">
<span class="md-ellipsis">
    Redis Cache Repository
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../features/http-service-client/">
<span class="md-ellipsis">
    HTTP Service Client
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../features/case-conversion-utilities/">
<span class="md-ellipsis">
    Case Conversion Utilities
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../features/enhanced-model-validation/">
<span class="md-ellipsis">
    Enhanced Model Validation
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../features/mermaid-diagrams/">
<span class="md-ellipsis">
    Mermaid Diagrams
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
<span class="md-ellipsis">
    Guides
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_6_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_6">
<span class="md-nav__icon md-icon"></span>
            Guides
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../guides/">
<span class="md-ellipsis">
    Overview
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../guides/project-setup/">
<span class="md-ellipsis">
    Project Setup
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../guides/testing-setup/">
<span class="md-ellipsis">
    Testing Setup
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_7" type="checkbox"/>
<label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
<span class="md-ellipsis">
    Samples
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_7_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_7">
<span class="md-nav__icon md-icon"></span>
            Samples
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../samples/">
<span class="md-ellipsis">
    Overview
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../samples/openbank/">
<span class="md-ellipsis">
    OpenBank
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../samples/api_gateway/">
<span class="md-ellipsis">
    API Gateway
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../samples/desktop_controller/">
<span class="md-ellipsis">
    Desktop Controller
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_8" type="checkbox"/>
<label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
<span class="md-ellipsis">
    References
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_8_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_8">
<span class="md-nav__icon md-icon"></span>
            References
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../references/oauth-oidc-jwt/">
<span class="md-ellipsis">
    OAuth, OIDC &amp; JWT
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../references/source_code_naming_convention/">
<span class="md-ellipsis">
    Source Code Naming Conventions
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../references/12-factor-app/">
<span class="md-ellipsis">
    12-Factor App
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../references/python_type_hints/">
<span class="md-ellipsis">
    Python Type Hints
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../references/python_modular_code/">
<span class="md-ellipsis">
    Python Modular Code
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../references/python_object_oriented/">
<span class="md-ellipsis">
    Python Object-Oriented Programming
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../references/python_generic_types/">
<span class="md-ellipsis">
    Python Generic Types
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#pattern-overview">
<span class="md-ellipsis">
      ğŸ¯ Pattern Overview
    </span>
</a>
<nav aria-label="ğŸ¯ Pattern Overview" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#core-ddd-principles">
<span class="md-ellipsis">
      ğŸŒŸ Core DDD Principles
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#framework-integration">
<span class="md-ellipsis">
      ğŸ”„ Framework Integration
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#core-domain-abstractions">
<span class="md-ellipsis">
      ğŸ• Core Domain Abstractions
    </span>
</a>
<nav aria-label="ğŸ• Core Domain Abstractions" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#1-entity-base-class">
<span class="md-ellipsis">
      1. Entity Base Class
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-domain-events">
<span class="md-ellipsis">
      2. Domain Events
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3-aggregate-root">
<span class="md-ellipsis">
      3. Aggregate Root
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#transaction-flow-with-multiple-domain-events">
<span class="md-ellipsis">
      ğŸ”„ Transaction Flow with Multiple Domain Events
    </span>
</a>
<nav aria-label="ğŸ”„ Transaction Flow with Multiple Domain Events" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#complex-business-transaction-example">
<span class="md-ellipsis">
      Complex Business Transaction Example
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#transaction-flow-visualization">
<span class="md-ellipsis">
      Transaction Flow Visualization
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#domain-events-vs-integration-events">
<span class="md-ellipsis">
      ğŸŒ Domain Events vs Integration Events
    </span>
</a>
<nav aria-label="ğŸŒ Domain Events vs Integration Events" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#domain-event-integration-event-flow">
<span class="md-ellipsis">
      Domain Event â†’ Integration Event Flow
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#event-types-comparison">
<span class="md-ellipsis">
      Event Types Comparison
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#event-sourcing-vs-traditional-implementation">
<span class="md-ellipsis">
      ğŸ¯ Event Sourcing vs Traditional Implementation
    </span>
</a>
<nav aria-label="ğŸ¯ Event Sourcing vs Traditional Implementation" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#traditional-crud-implementation">
<span class="md-ellipsis">
      Traditional CRUD Implementation
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#event-sourcing-implementation">
<span class="md-ellipsis">
      Event Sourcing Implementation
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#implementation-comparison">
<span class="md-ellipsis">
      Implementation Comparison
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#data-flow-across-layers">
<span class="md-ellipsis">
      ğŸ—ï¸ Data Flow Across Layers
    </span>
</a>
<nav aria-label="ğŸ—ï¸ Data Flow Across Layers" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#complete-request-response-flow">
<span class="md-ellipsis">
      Complete Request-Response Flow
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#data-transformation-flow">
<span class="md-ellipsis">
      Data Transformation Flow
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#when-to-use-domain-driven-design">
<span class="md-ellipsis">
      ğŸ¯ When to Use Domain Driven Design
    </span>
</a>
<nav aria-label="ğŸ¯ When to Use Domain Driven Design" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#ideal-use-cases">
<span class="md-ellipsis">
      âœ… Ideal Use Cases
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#consider-alternatives-when">
<span class="md-ellipsis">
      âŒ Consider Alternatives When
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#migration-path">
<span class="md-ellipsis">
      ğŸš€ Migration Path
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#related-patterns">
<span class="md-ellipsis">
      ğŸ”— Related Patterns
    </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="domain-driven-design-pattern">ğŸ›ï¸ Domain Driven Design Pattern<a class="headerlink" href="#domain-driven-design-pattern" title="Permanent link">Â¶</a></h1>
<p>Domain Driven Design (DDD) forms the architectural foundation of the Neuroglia framework, providing core
abstractions and patterns that enable rich, expressive domain models while maintaining clean separation of concerns.
This pattern serves as the primary reference for understanding how domain logic flows through the API, Application,
Domain, and Integration layers.</p>
<h2 id="pattern-overview">ğŸ¯ Pattern Overview<a class="headerlink" href="#pattern-overview" title="Permanent link">Â¶</a></h2>
<p><strong>Domain Driven Design</strong> is a software development methodology that emphasizes modeling complex business domains
through rich domain models, ubiquitous language, and strategic design patterns. The Neuroglia framework implements
DDD principles through a comprehensive set of base abstractions that support both traditional CRUD operations and
advanced patterns like event sourcing.</p>
<h3 id="core-ddd-principles">ğŸŒŸ Core DDD Principles<a class="headerlink" href="#core-ddd-principles" title="Permanent link">Â¶</a></h3>
<ul>
<li><strong>ğŸ›ï¸ Rich Domain Models</strong>: Business logic lives in domain entities, not in services</li>
<li><strong>ğŸ—£ï¸ Ubiquitous Language</strong>: Common vocabulary shared between business and technical teams</li>
<li><strong>ğŸ¯ Bounded Contexts</strong>: Clear boundaries around cohesive domain models</li>
<li><strong>ğŸ“š Aggregate Boundaries</strong>: Consistency boundaries that encapsulate business invariants</li>
<li><strong>âš¡ Domain Events</strong>: First-class representation of business events and state changes</li>
</ul>
<h3 id="framework-integration">ğŸ”„ Framework Integration<a class="headerlink" href="#framework-integration" title="Permanent link">Â¶</a></h3>
<p>The framework provides core abstractions that seamlessly integrate with all architectural layers:</p>
<pre class="mermaid"><code>graph TB
    subgraph "ğŸŒ API Layer"
        Controllers["Controllers&lt;br/&gt;HTTP Endpoints"]
        DTOs["DTOs&lt;br/&gt;Data Transfer Objects"]
    end

    subgraph "ğŸ’¼ Application Layer"
        Commands["Commands&lt;br/&gt;Write Operations"]
        Queries["Queries&lt;br/&gt;Read Operations"]
        Handlers["Handlers&lt;br/&gt;Business Orchestration"]
    end

    subgraph "ğŸ›ï¸ Domain Layer"
        Entities["Entities&lt;br/&gt;Business Objects"]
        Aggregates["Aggregate Roots&lt;br/&gt;Consistency Boundaries"]
        DomainEvents["Domain Events&lt;br/&gt;Business Events"]
        ValueObjects["Value Objects&lt;br/&gt;Immutable Data"]
    end

    subgraph "ğŸ”Œ Integration Layer"
        Repositories["Repositories&lt;br/&gt;Data Access"]
        EventBus["Event Bus&lt;br/&gt;Integration Events"]
        ExternalAPIs["External APIs&lt;br/&gt;Third-party Services"]
    end

    Controllers --&gt; Commands
    Controllers --&gt; Queries
    Commands --&gt; Handlers
    Queries --&gt; Handlers
    Handlers --&gt; Aggregates
    Handlers --&gt; Repositories
    Aggregates --&gt; DomainEvents
    DomainEvents --&gt; EventBus
    Repositories --&gt; ExternalAPIs

    style Entities fill:#e8f5e8
    style Aggregates fill:#e8f5e8
    style DomainEvents fill:#fff3e0
    style ValueObjects fill:#e8f5e8</code></pre>
<h2 id="core-domain-abstractions">ğŸ• Core Domain Abstractions<a class="headerlink" href="#core-domain-abstractions" title="Permanent link">Â¶</a></h2>
<h3 id="1-entity-base-class">1. Entity Base Class<a class="headerlink" href="#1-entity-base-class" title="Permanent link">Â¶</a></h3>
<p><strong>Entities</strong> represent objects with distinct identity that persist over time:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">neuroglia.data.abstractions</span><span class="w"> </span><span class="kn">import</span> <span class="n">Entity</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">uuid</span>

<span class="k">class</span><span class="w"> </span><span class="nc">Pizza</span><span class="p">(</span><span class="n">Entity</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">"""Pizza entity with business logic and identity"""</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">price</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">ingredients</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="nb">id</span> <span class="ow">or</span> <span class="sa">f</span><span class="s2">"pizza_</span><span class="si">{</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span><span class="o">.</span><span class="n">hex</span><span class="p">[:</span><span class="mi">8</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">price</span> <span class="o">=</span> <span class="n">price</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ingredients</span> <span class="o">=</span> <span class="n">ingredients</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_available</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">created_at</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

        <span class="c1"># Business rule validation</span>
        <span class="k">if</span> <span class="n">price</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Pizza price must be positive"</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ingredients</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Pizza must have at least one ingredient"</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_ingredient</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ingredient</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Add ingredient with business rule validation"""</span>
        <span class="k">if</span> <span class="n">ingredient</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ingredients</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Ingredient '</span><span class="si">{</span><span class="n">ingredient</span><span class="si">}</span><span class="s2">' already exists"</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ingredients</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ingredient</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">price</span> <span class="o">+=</span> <span class="mf">2.50</span>  <span class="c1"># Business rule: each ingredient adds $2.50</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updated_at</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">remove_ingredient</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ingredient</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Remove ingredient with business validation"""</span>
        <span class="k">if</span> <span class="n">ingredient</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ingredients</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Ingredient '</span><span class="si">{</span><span class="n">ingredient</span><span class="si">}</span><span class="s2">' not found"</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ingredients</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Pizza must have at least one ingredient"</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ingredients</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">ingredient</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">price</span> <span class="o">-=</span> <span class="mf">2.50</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updated_at</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">make_unavailable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reason</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Business operation to make pizza unavailable"""</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_available</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unavailable_reason</span> <span class="o">=</span> <span class="n">reason</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updated_at</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</code></pre></div>
<h3 id="2-domain-events">2. Domain Events<a class="headerlink" href="#2-domain-events" title="Permanent link">Â¶</a></h3>
<p><strong>Domain Events</strong> represent important business occurrences that other parts of the system need to know about:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">neuroglia.data.abstractions</span><span class="w"> </span><span class="kn">import</span> <span class="n">DomainEvent</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">decimal</span><span class="w"> </span><span class="kn">import</span> <span class="n">Decimal</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">PizzaOrderPlacedEvent</span><span class="p">(</span><span class="n">DomainEvent</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">"""Domain event representing a pizza order being placed"""</span>
    <span class="n">customer_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">items</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span>
    <span class="n">total_amount</span><span class="p">:</span> <span class="n">Decimal</span>
    <span class="n">special_instructions</span><span class="p">:</span> <span class="nb">str</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aggregate_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">customer_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">items</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
                 <span class="n">total_amount</span><span class="p">:</span> <span class="n">Decimal</span><span class="p">,</span> <span class="n">special_instructions</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">""</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">aggregate_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">customer_id</span> <span class="o">=</span> <span class="n">customer_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">items</span> <span class="o">=</span> <span class="n">items</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_amount</span> <span class="o">=</span> <span class="n">total_amount</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">special_instructions</span> <span class="o">=</span> <span class="n">special_instructions</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">OrderStatusChangedEvent</span><span class="p">(</span><span class="n">DomainEvent</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">"""Domain event representing order status changes"""</span>
    <span class="n">previous_status</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">new_status</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">changed_by</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">reason</span><span class="p">:</span> <span class="nb">str</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aggregate_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">previous_status</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">new_status</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                 <span class="n">changed_by</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">reason</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">""</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">aggregate_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">previous_status</span> <span class="o">=</span> <span class="n">previous_status</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new_status</span> <span class="o">=</span> <span class="n">new_status</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">changed_by</span> <span class="o">=</span> <span class="n">changed_by</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reason</span> <span class="o">=</span> <span class="n">reason</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">PaymentProcessedEvent</span><span class="p">(</span><span class="n">DomainEvent</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">"""Domain event representing successful payment processing"""</span>
    <span class="n">payment_method</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">amount</span><span class="p">:</span> <span class="n">Decimal</span>
    <span class="n">transaction_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">processed_at</span><span class="p">:</span> <span class="n">datetime</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">aggregate_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">payment_method</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">amount</span><span class="p">:</span> <span class="n">Decimal</span><span class="p">,</span>
                 <span class="n">transaction_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">aggregate_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">payment_method</span> <span class="o">=</span> <span class="n">payment_method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">amount</span> <span class="o">=</span> <span class="n">amount</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transaction_id</span> <span class="o">=</span> <span class="n">transaction_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processed_at</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
</code></pre></div>
<h3 id="3-aggregate-root">3. Aggregate Root<a class="headerlink" href="#3-aggregate-root" title="Permanent link">Â¶</a></h3>
<p><strong>Aggregate Roots</strong> define consistency boundaries and coordinate multiple entities:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">neuroglia.data.abstractions</span><span class="w"> </span><span class="kn">import</span> <span class="n">AggregateRoot</span><span class="p">,</span> <span class="n">AggregateState</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">multipledispatch</span><span class="w"> </span><span class="kn">import</span> <span class="n">dispatch</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">enum</span><span class="w"> </span><span class="kn">import</span> <span class="n">Enum</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span>

<span class="k">class</span><span class="w"> </span><span class="nc">OrderStatus</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">PENDING</span> <span class="o">=</span> <span class="s2">"PENDING"</span>
    <span class="n">CONFIRMED</span> <span class="o">=</span> <span class="s2">"CONFIRMED"</span>
    <span class="n">PREPARING</span> <span class="o">=</span> <span class="s2">"PREPARING"</span>
    <span class="n">READY</span> <span class="o">=</span> <span class="s2">"READY"</span>
    <span class="n">DELIVERED</span> <span class="o">=</span> <span class="s2">"DELIVERED"</span>
    <span class="n">CANCELLED</span> <span class="o">=</span> <span class="s2">"CANCELLED"</span>

<span class="k">class</span><span class="w"> </span><span class="nc">PizzaOrderState</span><span class="p">(</span><span class="n">AggregateState</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">"""State for pizza order aggregate"""</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">customer_id</span> <span class="o">=</span> <span class="s2">""</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_amount</span> <span class="o">=</span> <span class="n">Decimal</span><span class="p">(</span><span class="s1">'0.00'</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">OrderStatus</span><span class="o">.</span><span class="n">PENDING</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">special_instructions</span> <span class="o">=</span> <span class="s2">""</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">estimated_delivery</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">payment_status</span> <span class="o">=</span> <span class="s2">"UNPAID"</span>

    <span class="nd">@dispatch</span><span class="p">(</span><span class="n">PizzaOrderPlacedEvent</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">PizzaOrderPlacedEvent</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""Apply order placed event to state"""</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">aggregate_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">customer_id</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">customer_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">items</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_amount</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">total_amount</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">special_instructions</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">special_instructions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">created_at</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">created_at</span>

    <span class="nd">@dispatch</span><span class="p">(</span><span class="n">OrderStatusChangedEvent</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">OrderStatusChangedEvent</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""Apply status change event to state"""</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">OrderStatus</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">new_status</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_modified</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">created_at</span>

    <span class="nd">@dispatch</span><span class="p">(</span><span class="n">PaymentProcessedEvent</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">on</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">PaymentProcessedEvent</span><span class="p">):</span>
<span class="w">        </span><span class="sd">"""Apply payment processed event to state"""</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">payment_status</span> <span class="o">=</span> <span class="s2">"PAID"</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_modified</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">created_at</span>

<span class="k">class</span><span class="w"> </span><span class="nc">PizzaOrderAggregate</span><span class="p">(</span><span class="n">AggregateRoot</span><span class="p">[</span><span class="n">PizzaOrderState</span><span class="p">,</span> <span class="nb">str</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">"""Pizza order aggregate root implementing business rules"""</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">order_id</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">order_id</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">place_order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">customer_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">items</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
                   <span class="n">special_instructions</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">""</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Place a new pizza order with business validation"""</span>

        <span class="c1"># Business rule validation</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">items</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Order must contain at least one item"</span><span class="p">)</span>

        <span class="c1"># Calculate total with business rules</span>
        <span class="n">total</span> <span class="o">=</span> <span class="n">Decimal</span><span class="p">(</span><span class="s1">'0.00'</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">'quantity'</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Item quantity must be positive"</span><span class="p">)</span>
            <span class="n">total</span> <span class="o">+=</span> <span class="n">Decimal</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">[</span><span class="s1">'price'</span><span class="p">]))</span> <span class="o">*</span> <span class="n">item</span><span class="p">[</span><span class="s1">'quantity'</span><span class="p">]</span>

        <span class="c1"># Minimum order business rule</span>
        <span class="k">if</span> <span class="n">total</span> <span class="o">&lt;</span> <span class="n">Decimal</span><span class="p">(</span><span class="s1">'10.00'</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Minimum order amount is $10.00"</span><span class="p">)</span>

        <span class="c1"># Create and apply domain event</span>
        <span class="n">event</span> <span class="o">=</span> <span class="n">PizzaOrderPlacedEvent</span><span class="p">(</span>
            <span class="n">aggregate_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="n">customer_id</span><span class="o">=</span><span class="n">customer_id</span><span class="p">,</span>
            <span class="n">items</span><span class="o">=</span><span class="n">items</span><span class="p">,</span>
            <span class="n">total_amount</span><span class="o">=</span><span class="n">total</span><span class="p">,</span>
            <span class="n">special_instructions</span><span class="o">=</span><span class="n">special_instructions</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register_event</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">confirm_order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">estimated_delivery</span><span class="p">:</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">confirmed_by</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Confirm order with business rules"""</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">status</span> <span class="o">!=</span> <span class="n">OrderStatus</span><span class="o">.</span><span class="n">PENDING</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Cannot confirm order in </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2"> status"</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">estimated_delivery</span> <span class="o">=</span> <span class="n">estimated_delivery</span>

        <span class="c1"># Create status change event</span>
        <span class="n">event</span> <span class="o">=</span> <span class="n">OrderStatusChangedEvent</span><span class="p">(</span>
            <span class="n">aggregate_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="n">previous_status</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="n">new_status</span><span class="o">=</span><span class="n">OrderStatus</span><span class="o">.</span><span class="n">CONFIRMED</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="n">changed_by</span><span class="o">=</span><span class="n">confirmed_by</span><span class="p">,</span>
            <span class="n">reason</span><span class="o">=</span><span class="s2">"Order confirmed by kitchen"</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register_event</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">process_payment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">payment_method</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">transaction_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Process payment with business validation"""</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">payment_status</span> <span class="o">==</span> <span class="s2">"PAID"</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Order is already paid"</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">OrderStatus</span><span class="o">.</span><span class="n">CANCELLED</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Cannot process payment for cancelled order"</span><span class="p">)</span>

        <span class="n">event</span> <span class="o">=</span> <span class="n">PaymentProcessedEvent</span><span class="p">(</span>
            <span class="n">aggregate_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="n">payment_method</span><span class="o">=</span><span class="n">payment_method</span><span class="p">,</span>
            <span class="n">amount</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">total_amount</span><span class="p">,</span>
            <span class="n">transaction_id</span><span class="o">=</span><span class="n">transaction_id</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register_event</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">cancel_order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reason</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">cancelled_by</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Cancel order with business rules"""</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">status</span> <span class="ow">in</span> <span class="p">[</span><span class="n">OrderStatus</span><span class="o">.</span><span class="n">DELIVERED</span><span class="p">,</span> <span class="n">OrderStatus</span><span class="o">.</span><span class="n">CANCELLED</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Cannot cancel order in </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2"> status"</span><span class="p">)</span>

        <span class="n">event</span> <span class="o">=</span> <span class="n">OrderStatusChangedEvent</span><span class="p">(</span>
            <span class="n">aggregate_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="n">previous_status</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="n">new_status</span><span class="o">=</span><span class="n">OrderStatus</span><span class="o">.</span><span class="n">CANCELLED</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="n">changed_by</span><span class="o">=</span><span class="n">cancelled_by</span><span class="p">,</span>
            <span class="n">reason</span><span class="o">=</span><span class="n">reason</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register_event</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
</code></pre></div>
<h2 id="transaction-flow-with-multiple-domain-events">ğŸ”„ Transaction Flow with Multiple Domain Events<a class="headerlink" href="#transaction-flow-with-multiple-domain-events" title="Permanent link">Â¶</a></h2>
<p>When a single command requires multiple domain events, the framework ensures transactional consistency through the aggregate boundary:</p>
<h3 id="complex-business-transaction-example">Complex Business Transaction Example<a class="headerlink" href="#complex-business-transaction-example" title="Permanent link">Â¶</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">decimal</span><span class="w"> </span><span class="kn">import</span> <span class="n">Decimal</span>

<span class="k">class</span><span class="w"> </span><span class="nc">OrderWithPromotionAggregate</span><span class="p">(</span><span class="n">AggregateRoot</span><span class="p">[</span><span class="n">PizzaOrderState</span><span class="p">,</span> <span class="nb">str</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">"""Extended order aggregate with promotion handling"""</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">place_order_with_promotion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">customer_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">items</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
                                  <span class="n">promotion_code</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Place order with potential promotion - multiple events in single transaction"""</span>

        <span class="c1"># Step 1: Validate and place base order</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">place_order</span><span class="p">(</span><span class="n">customer_id</span><span class="p">,</span> <span class="n">items</span><span class="p">)</span>

        <span class="c1"># Step 2: Apply promotion if valid</span>
        <span class="k">if</span> <span class="n">promotion_code</span><span class="p">:</span>
            <span class="n">discount_amount</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_and_calculate_promotion</span><span class="p">(</span><span class="n">promotion_code</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">discount_amount</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># Create promotion applied event</span>
                <span class="n">promotion_event</span> <span class="o">=</span> <span class="n">PromotionAppliedEvent</span><span class="p">(</span>
                    <span class="n">aggregate_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                    <span class="n">promotion_code</span><span class="o">=</span><span class="n">promotion_code</span><span class="p">,</span>
                    <span class="n">discount_amount</span><span class="o">=</span><span class="n">discount_amount</span><span class="p">,</span>
                    <span class="n">original_amount</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">total_amount</span>
                <span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="n">promotion_event</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">register_event</span><span class="p">(</span><span class="n">promotion_event</span><span class="p">)</span>

        <span class="c1"># Step 3: Check for loyalty points</span>
        <span class="n">loyalty_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_loyalty_points</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">loyalty_points</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">loyalty_event</span> <span class="o">=</span> <span class="n">LoyaltyPointsEarnedEvent</span><span class="p">(</span>
                <span class="n">aggregate_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                <span class="n">customer_id</span><span class="o">=</span><span class="n">customer_id</span><span class="p">,</span>
                <span class="n">points_earned</span><span class="o">=</span><span class="n">loyalty_points</span><span class="p">,</span>
                <span class="n">transaction_amount</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">total_amount</span>
            <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">register_event</span><span class="p">(</span><span class="n">loyalty_event</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_validate_and_calculate_promotion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">promotion_code</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Decimal</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Business logic for promotion validation"""</span>
        <span class="n">promotions</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">"FIRST10"</span><span class="p">:</span> <span class="n">Decimal</span><span class="p">(</span><span class="s1">'10.00'</span><span class="p">),</span>
            <span class="s2">"STUDENT15"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">total_amount</span> <span class="o">*</span> <span class="n">Decimal</span><span class="p">(</span><span class="s1">'0.15'</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">promotions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">promotion_code</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">(</span><span class="s1">'0.00'</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_calculate_loyalty_points</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Business logic for loyalty points calculation"""</span>
        <span class="c1"># 1 point per dollar spent</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">total_amount</span><span class="p">)</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">PromotionAppliedEvent</span><span class="p">(</span><span class="n">DomainEvent</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">"""Domain event for promotion application"""</span>
    <span class="n">promotion_code</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">discount_amount</span><span class="p">:</span> <span class="n">Decimal</span>
    <span class="n">original_amount</span><span class="p">:</span> <span class="n">Decimal</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">LoyaltyPointsEarnedEvent</span><span class="p">(</span><span class="n">DomainEvent</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">"""Domain event for loyalty points"""</span>
    <span class="n">customer_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">points_earned</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">transaction_amount</span><span class="p">:</span> <span class="n">Decimal</span>
</code></pre></div>
<h3 id="transaction-flow-visualization">Transaction Flow Visualization<a class="headerlink" href="#transaction-flow-visualization" title="Permanent link">Â¶</a></h3>
<pre class="mermaid"><code>sequenceDiagram
    participant API as ğŸŒ API Controller
    participant CMD as ğŸ’¼ Command Handler
    participant AGG as ğŸ›ï¸ Aggregate Root
    participant REPO as ğŸ”Œ Repository
    participant BUS as ğŸ“¡ Event Bus

    API-&gt;&gt;CMD: PlaceOrderWithPromotionCommand

    Note over CMD,AGG: Single Transaction Boundary
    CMD-&gt;&gt;AGG: place_order_with_promotion()

    AGG-&gt;&gt;AGG: validate_order_items()
    AGG-&gt;&gt;AGG: register_event(OrderPlacedEvent)

    AGG-&gt;&gt;AGG: validate_promotion()
    AGG-&gt;&gt;AGG: register_event(PromotionAppliedEvent)

    AGG-&gt;&gt;AGG: calculate_loyalty_points()
    AGG-&gt;&gt;AGG: register_event(LoyaltyPointsEarnedEvent)

    CMD-&gt;&gt;REPO: save_async(aggregate)

    Note over REPO: Atomic Save Operation
    REPO-&gt;&gt;REPO: persist_state()
    REPO-&gt;&gt;BUS: publish_domain_events()

    Note over BUS: Event Publishing (After Commit)
    BUS-&gt;&gt;BUS: OrderPlacedEvent â†’ Integration
    BUS-&gt;&gt;BUS: PromotionAppliedEvent â†’ Marketing
    BUS-&gt;&gt;BUS: LoyaltyPointsEarnedEvent â†’ Customer Service

    REPO--&gt;&gt;CMD: Success
    CMD--&gt;&gt;API: OperationResult&lt;OrderDto&gt;</code></pre>
<h2 id="domain-events-vs-integration-events">ğŸŒ Domain Events vs Integration Events<a class="headerlink" href="#domain-events-vs-integration-events" title="Permanent link">Â¶</a></h2>
<p>The framework distinguishes between <strong>Domain Events</strong> (internal business events) and <strong>Integration Events</strong> (cross-boundary communication):</p>
<h3 id="domain-event-integration-event-flow">Domain Event â†’ Integration Event Flow<a class="headerlink" href="#domain-event-integration-event-flow" title="Permanent link">Â¶</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">neuroglia.eventing</span><span class="w"> </span><span class="kn">import</span> <span class="n">DomainEventHandler</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">neuroglia.eventing.cloud_events</span><span class="w"> </span><span class="kn">import</span> <span class="n">CloudEvent</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span>

<span class="k">class</span><span class="w"> </span><span class="nc">OrderDomainEventHandler</span><span class="p">(</span><span class="n">DomainEventHandler</span><span class="p">[</span><span class="n">PizzaOrderPlacedEvent</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">"""Handles domain events and publishes integration events"""</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event_bus</span><span class="p">:</span> <span class="n">EventBus</span><span class="p">,</span> <span class="n">mapper</span><span class="p">:</span> <span class="n">Mapper</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_bus</span> <span class="o">=</span> <span class="n">event_bus</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span> <span class="o">=</span> <span class="n">mapper</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">handle_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">domain_event</span><span class="p">:</span> <span class="n">PizzaOrderPlacedEvent</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Convert domain event to integration event (CloudEvent)"""</span>

        <span class="c1"># Transform domain event to integration event data</span>
        <span class="n">integration_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">"orderId"</span><span class="p">:</span> <span class="n">domain_event</span><span class="o">.</span><span class="n">aggregate_id</span><span class="p">,</span>
            <span class="s2">"customerId"</span><span class="p">:</span> <span class="n">domain_event</span><span class="o">.</span><span class="n">customer_id</span><span class="p">,</span>
            <span class="s2">"totalAmount"</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">domain_event</span><span class="o">.</span><span class="n">total_amount</span><span class="p">),</span>
            <span class="s2">"items"</span><span class="p">:</span> <span class="n">domain_event</span><span class="o">.</span><span class="n">items</span><span class="p">,</span>
            <span class="s2">"orderPlacedAt"</span><span class="p">:</span> <span class="n">domain_event</span><span class="o">.</span><span class="n">created_at</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
        <span class="p">}</span>

        <span class="c1"># Create CloudEvent for external systems</span>
        <span class="n">cloud_event</span> <span class="o">=</span> <span class="n">CloudEvent</span><span class="p">(</span>
            <span class="n">source</span><span class="o">=</span><span class="s2">"mario-pizzeria/orders"</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="s2">"com.mario-pizzeria.order.placed.v1"</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="n">integration_data</span><span class="p">,</span>
            <span class="n">datacontenttype</span><span class="o">=</span><span class="s2">"application/json"</span>
        <span class="p">)</span>

        <span class="c1"># Publish to external systems</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_bus</span><span class="o">.</span><span class="n">publish_async</span><span class="p">(</span><span class="n">cloud_event</span><span class="p">)</span>

        <span class="c1"># Handle internal business workflows</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_notify_kitchen</span><span class="p">(</span><span class="n">domain_event</span><span class="p">)</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_inventory</span><span class="p">(</span><span class="n">domain_event</span><span class="p">)</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_send_customer_confirmation</span><span class="p">(</span><span class="n">domain_event</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_notify_kitchen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">PizzaOrderPlacedEvent</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Internal business workflow - kitchen notification"""</span>
        <span class="n">kitchen_notification</span> <span class="o">=</span> <span class="n">KitchenOrderReceivedEvent</span><span class="p">(</span>
            <span class="n">order_id</span><span class="o">=</span><span class="n">event</span><span class="o">.</span><span class="n">aggregate_id</span><span class="p">,</span>
            <span class="n">items</span><span class="o">=</span><span class="n">event</span><span class="o">.</span><span class="n">items</span><span class="p">,</span>
            <span class="n">special_instructions</span><span class="o">=</span><span class="n">event</span><span class="o">.</span><span class="n">special_instructions</span>
        <span class="p">)</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_bus</span><span class="o">.</span><span class="n">publish_async</span><span class="p">(</span><span class="n">kitchen_notification</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_update_inventory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">PizzaOrderPlacedEvent</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Internal business workflow - inventory management"""</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">event</span><span class="o">.</span><span class="n">items</span><span class="p">:</span>
            <span class="n">inventory_event</span> <span class="o">=</span> <span class="n">IngredientReservedEvent</span><span class="p">(</span>
                <span class="n">pizza_type</span><span class="o">=</span><span class="n">item</span><span class="p">[</span><span class="s1">'name'</span><span class="p">],</span>
                <span class="n">quantity</span><span class="o">=</span><span class="n">item</span><span class="p">[</span><span class="s1">'quantity'</span><span class="p">],</span>
                <span class="n">order_id</span><span class="o">=</span><span class="n">event</span><span class="o">.</span><span class="n">aggregate_id</span>
            <span class="p">)</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_bus</span><span class="o">.</span><span class="n">publish_async</span><span class="p">(</span><span class="n">inventory_event</span><span class="p">)</span>
</code></pre></div>
<h3 id="event-types-comparison">Event Types Comparison<a class="headerlink" href="#event-types-comparison" title="Permanent link">Â¶</a></h3>
<table>
<thead>
<tr>
<th>Aspect</th>
<th>Domain Events</th>
<th>Integration Events (CloudEvents)</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Scope</strong></td>
<td>Internal to bounded context</td>
<td>Cross-boundary communication</td>
</tr>
<tr>
<td><strong>Format</strong></td>
<td>Domain-specific objects</td>
<td>Standardized CloudEvent format</td>
</tr>
<tr>
<td><strong>Audience</strong></td>
<td>Internal domain handlers</td>
<td>External systems &amp; services</td>
</tr>
<tr>
<td><strong>Coupling</strong></td>
<td>Tightly coupled to domain</td>
<td>Loosely coupled via contracts</td>
</tr>
<tr>
<td><strong>Evolution</strong></td>
<td>Can change with domain</td>
<td>Must maintain backward compatibility</td>
</tr>
<tr>
<td><strong>Examples</strong></td>
<td><code>OrderPlacedEvent</code>, <code>PaymentProcessedEvent</code></td>
<td><code>com.mario-pizzeria.order.placed.v1</code></td>
</tr>
</tbody>
</table>
<pre class="mermaid"><code>flowchart TB
    subgraph "ğŸ›ï¸ Domain Layer"
        DomainOp["Domain Operation&lt;br/&gt;(place_order)"]
        DomainEvent["Domain Event&lt;br/&gt;(OrderPlacedEvent)"]
    end

    subgraph "ğŸ’¼ Application Layer"
        EventHandler["Domain Event Handler&lt;br/&gt;(OrderDomainEventHandler)"]
        Transform["Event Transformation&lt;br/&gt;(Domain â†’ Integration)"]
    end

    subgraph "ğŸ”Œ Integration Layer"
        CloudEvent["Integration Event&lt;br/&gt;(CloudEvent)"]
        EventBus["Event Bus&lt;br/&gt;(External Publishing)"]
    end

    subgraph "ğŸŒ External Systems"
        Payment["Payment Service"]
        Inventory["Inventory System"]
        Analytics["Analytics Platform"]
        CRM["Customer CRM"]
    end

    DomainOp --&gt; DomainEvent
    DomainEvent --&gt; EventHandler
    EventHandler --&gt; Transform
    Transform --&gt; CloudEvent
    CloudEvent --&gt; EventBus
    EventBus --&gt; Payment
    EventBus --&gt; Inventory
    EventBus --&gt; Analytics
    EventBus --&gt; CRM

    style DomainEvent fill:#e8f5e8
    style CloudEvent fill:#fff3e0
    style Transform fill:#e3f2fd</code></pre>
<h2 id="event-sourcing-vs-traditional-implementation">ğŸ¯ Event Sourcing vs Traditional Implementation<a class="headerlink" href="#event-sourcing-vs-traditional-implementation" title="Permanent link">Â¶</a></h2>
<p>The framework supports both traditional state-based and event sourcing implementations:</p>
<h3 id="traditional-crud-implementation">Traditional CRUD Implementation<a class="headerlink" href="#traditional-crud-implementation" title="Permanent link">Â¶</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">TraditionalOrderService</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Traditional CRUD approach - current state only"""</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">repository</span><span class="p">:</span> <span class="n">Repository</span><span class="p">[</span><span class="n">PizzaOrder</span><span class="p">,</span> <span class="nb">str</span><span class="p">]):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">repository</span> <span class="o">=</span> <span class="n">repository</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">place_order_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">:</span> <span class="n">PlaceOrderCommand</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PizzaOrder</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Traditional approach - direct state mutation"""</span>

        <span class="c1"># Create order entity with current state</span>
        <span class="n">order</span> <span class="o">=</span> <span class="n">PizzaOrder</span><span class="p">(</span>
            <span class="n">customer_id</span><span class="o">=</span><span class="n">command</span><span class="o">.</span><span class="n">customer_id</span><span class="p">,</span>
            <span class="n">items</span><span class="o">=</span><span class="n">command</span><span class="o">.</span><span class="n">items</span><span class="p">,</span>
            <span class="n">total_amount</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_calculate_total</span><span class="p">(</span><span class="n">command</span><span class="o">.</span><span class="n">items</span><span class="p">),</span>
            <span class="n">status</span><span class="o">=</span><span class="n">OrderStatus</span><span class="o">.</span><span class="n">PENDING</span><span class="p">,</span>
            <span class="n">created_at</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="c1"># Validate business rules</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_order</span><span class="p">(</span><span class="n">order</span><span class="p">)</span>

        <span class="c1"># Save current state only</span>
        <span class="n">saved_order</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">repository</span><span class="o">.</span><span class="n">add_async</span><span class="p">(</span><span class="n">order</span><span class="p">)</span>

        <span class="c1"># Manually trigger side effects</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_send_notifications</span><span class="p">(</span><span class="n">saved_order</span><span class="p">)</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_update_inventory</span><span class="p">(</span><span class="n">saved_order</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">saved_order</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">update_status_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">new_status</span><span class="p">:</span> <span class="n">OrderStatus</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PizzaOrder</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Traditional approach - direct state update"""</span>
        <span class="n">order</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">repository</span><span class="o">.</span><span class="n">get_async</span><span class="p">(</span><span class="n">order_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">order</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Order not found"</span><span class="p">)</span>

        <span class="c1"># Direct state mutation (loses history)</span>
        <span class="n">old_status</span> <span class="o">=</span> <span class="n">order</span><span class="o">.</span><span class="n">status</span>
        <span class="n">order</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">new_status</span>
        <span class="n">order</span><span class="o">.</span><span class="n">updated_at</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

        <span class="c1"># Save updated state (old state is lost)</span>
        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">repository</span><span class="o">.</span><span class="n">update_async</span><span class="p">(</span><span class="n">order</span><span class="p">)</span>
</code></pre></div>
<h3 id="event-sourcing-implementation">Event Sourcing Implementation<a class="headerlink" href="#event-sourcing-implementation" title="Permanent link">Â¶</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">neuroglia.data.infrastructure.event_sourcing</span><span class="w"> </span><span class="kn">import</span> <span class="n">EventSourcingRepository</span>

<span class="k">class</span><span class="w"> </span><span class="nc">EventSourcedOrderService</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Event sourcing approach - complete history preservation"""</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">repository</span><span class="p">:</span> <span class="n">EventSourcingRepository</span><span class="p">[</span><span class="n">PizzaOrderAggregate</span><span class="p">,</span> <span class="nb">str</span><span class="p">]):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">repository</span> <span class="o">=</span> <span class="n">repository</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">place_order_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">:</span> <span class="n">PlaceOrderCommand</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PizzaOrderAggregate</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Event sourcing approach - event-based state building"""</span>

        <span class="c1"># Create new aggregate</span>
        <span class="n">aggregate</span> <span class="o">=</span> <span class="n">PizzaOrderAggregate</span><span class="p">(</span><span class="sa">f</span><span class="s2">"order_</span><span class="si">{</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span><span class="o">.</span><span class="n">hex</span><span class="p">[:</span><span class="mi">8</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

        <span class="c1"># Apply business operation (generates events)</span>
        <span class="n">aggregate</span><span class="o">.</span><span class="n">place_order</span><span class="p">(</span>
            <span class="n">customer_id</span><span class="o">=</span><span class="n">command</span><span class="o">.</span><span class="n">customer_id</span><span class="p">,</span>
            <span class="n">items</span><span class="o">=</span><span class="n">command</span><span class="o">.</span><span class="n">items</span><span class="p">,</span>
            <span class="n">special_instructions</span><span class="o">=</span><span class="n">command</span><span class="o">.</span><span class="n">special_instructions</span>
        <span class="p">)</span>

        <span class="c1"># Repository saves events and publishes them</span>
        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">repository</span><span class="o">.</span><span class="n">add_async</span><span class="p">(</span><span class="n">aggregate</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">update_status_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">new_status</span><span class="p">:</span> <span class="n">OrderStatus</span><span class="p">,</span>
                                 <span class="n">changed_by</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">reason</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PizzaOrderAggregate</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Event sourcing approach - reconstruct from events"""</span>

        <span class="c1"># Reconstruct aggregate from events</span>
        <span class="n">aggregate</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">repository</span><span class="o">.</span><span class="n">get_async</span><span class="p">(</span><span class="n">order_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">aggregate</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Order not found"</span><span class="p">)</span>

        <span class="c1"># Apply business operation (generates new events)</span>
        <span class="k">if</span> <span class="n">new_status</span> <span class="o">==</span> <span class="n">OrderStatus</span><span class="o">.</span><span class="n">CONFIRMED</span><span class="p">:</span>
            <span class="n">aggregate</span><span class="o">.</span><span class="n">confirm_order</span><span class="p">(</span>
                <span class="n">estimated_delivery</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="mi">30</span><span class="p">),</span>
                <span class="n">confirmed_by</span><span class="o">=</span><span class="n">changed_by</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">new_status</span> <span class="o">==</span> <span class="n">OrderStatus</span><span class="o">.</span><span class="n">CANCELLED</span><span class="p">:</span>
            <span class="n">aggregate</span><span class="o">.</span><span class="n">cancel_order</span><span class="p">(</span><span class="n">reason</span><span class="p">,</span> <span class="n">changed_by</span><span class="p">)</span>

        <span class="c1"># Save new events (all history preserved)</span>
        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">repository</span><span class="o">.</span><span class="n">update_async</span><span class="p">(</span><span class="n">aggregate</span><span class="p">)</span>
</code></pre></div>
<h3 id="implementation-comparison">Implementation Comparison<a class="headerlink" href="#implementation-comparison" title="Permanent link">Â¶</a></h3>
<table>
<thead>
<tr>
<th>Aspect</th>
<th>Traditional CRUD</th>
<th>Event Sourcing</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>State Storage</strong></td>
<td>Current state only</td>
<td>Complete event history</td>
</tr>
<tr>
<td><strong>History</strong></td>
<td>Lost on updates</td>
<td>Full audit trail preserved</td>
</tr>
<tr>
<td><strong>Rollback</strong></td>
<td>Manual snapshots required</td>
<td>Replay to any point in time</td>
</tr>
<tr>
<td><strong>Analytics</strong></td>
<td>Limited to current state</td>
<td>Rich temporal analysis</td>
</tr>
<tr>
<td><strong>Debugging</strong></td>
<td>Current state only</td>
<td>Complete operation history</td>
</tr>
<tr>
<td><strong>Performance</strong></td>
<td>Fast reads</td>
<td>Fast writes, reads via projections</td>
</tr>
<tr>
<td><strong>Complexity</strong></td>
<td>Lower</td>
<td>Higher initial complexity</td>
</tr>
</tbody>
</table>
<pre class="mermaid"><code>flowchart LR
    subgraph "ğŸ“Š Traditional CRUD"
        CRUD_State["Current State&lt;br/&gt;âŒ History Lost"]
        CRUD_DB[("Database&lt;br/&gt;Single Record")]
    end

    subgraph "ğŸ“ˆ Event Sourcing"
        Events["Event Stream&lt;br/&gt;ğŸ“œ Complete History"]
        EventStore[("Event Store&lt;br/&gt;Immutable Events")]
        Projections["Read Models&lt;br/&gt;ğŸ“Š Optimized Views"]
    end

    subgraph "ğŸ” Capabilities Comparison"
        Audit["âœ… Audit Trail"]
        Rollback["âœ… Time Travel"]
        Analytics["âœ… Business Intelligence"]
        Debugging["âœ… Complete Debugging"]
    end

    CRUD_State --&gt; CRUD_DB
    Events --&gt; EventStore
    EventStore --&gt; Projections

    Events --&gt; Audit
    Events --&gt; Rollback
    Events --&gt; Analytics
    Events --&gt; Debugging

    style Events fill:#e8f5e8
    style EventStore fill:#fff3e0
    style Projections fill:#e3f2fd
    style CRUD_State fill:#ffebee</code></pre>
<h2 id="data-flow-across-layers">ğŸ—ï¸ Data Flow Across Layers<a class="headerlink" href="#data-flow-across-layers" title="Permanent link">Â¶</a></h2>
<h3 id="complete-request-response-flow">Complete Request-Response Flow<a class="headerlink" href="#complete-request-response-flow" title="Permanent link">Â¶</a></h3>
<pre class="mermaid"><code>sequenceDiagram
    participant Client as ğŸŒ Client
    participant Controller as ğŸ® API Controller
    participant Handler as ğŸ’¼ Command Handler
    participant Aggregate as ğŸ›ï¸ Aggregate Root
    participant Repository as ğŸ”Œ Repository
    participant EventBus as ğŸ“¡ Event Bus
    participant Integration as ğŸŒ External Systems

    Client-&gt;&gt;Controller: POST /orders (PlaceOrderDto)

    Note over Controller: ğŸ”„ DTO â†’ Command Mapping
    Controller-&gt;&gt;Controller: Map DTO to PlaceOrderCommand

    Controller-&gt;&gt;Handler: mediator.execute_async(command)

    Note over Handler: ğŸ’¼ Application Logic
    Handler-&gt;&gt;Handler: Validate command
    Handler-&gt;&gt;Aggregate: Create/Load aggregate

    Note over Aggregate: ğŸ›ï¸ Domain Logic
    Aggregate-&gt;&gt;Aggregate: Apply business rules
    Aggregate-&gt;&gt;Aggregate: Generate domain events

    Handler-&gt;&gt;Repository: save_async(aggregate)

    Note over Repository: ğŸ”Œ Persistence
    Repository-&gt;&gt;Repository: Save aggregate state
    Repository-&gt;&gt;Repository: Extract pending events

    loop For each Domain Event
        Repository-&gt;&gt;EventBus: publish_domain_event()
        EventBus-&gt;&gt;EventBus: Convert to integration event
        EventBus-&gt;&gt;Integration: Publish CloudEvent
    end

    Repository--&gt;&gt;Handler: Persisted aggregate
    Handler-&gt;&gt;Handler: Map aggregate to DTO
    Handler--&gt;&gt;Controller: OperationResult&lt;OrderDto&gt;
    Controller--&gt;&gt;Client: HTTP 201 Created (OrderDto)

    Note over Integration: ğŸŒ External Processing
    Integration-&gt;&gt;Integration: Payment processing
    Integration-&gt;&gt;Integration: Inventory updates
    Integration-&gt;&gt;Integration: Customer notifications</code></pre>
<h3 id="data-transformation-flow">Data Transformation Flow<a class="headerlink" href="#data-transformation-flow" title="Permanent link">Â¶</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">neuroglia.mvc</span><span class="w"> </span><span class="kn">import</span> <span class="n">ControllerBase</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">neuroglia.mediation</span><span class="w"> </span><span class="kn">import</span> <span class="n">Mediator</span><span class="p">,</span> <span class="n">Command</span><span class="p">,</span> <span class="n">OperationResult</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">neuroglia.mapping</span><span class="w"> </span><span class="kn">import</span> <span class="n">Mapper</span>

<span class="c1"># 1. API Layer - Controllers and DTOs</span>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">PlaceOrderDto</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Data Transfer Object for API requests"""</span>
    <span class="n">customer_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">items</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span>
    <span class="n">special_instructions</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">""</span>

<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">OrderDto</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Data Transfer Object for API responses"""</span>
    <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">customer_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">items</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span>
    <span class="n">total_amount</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">status</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">created_at</span><span class="p">:</span> <span class="nb">str</span>

<span class="k">class</span><span class="w"> </span><span class="nc">OrdersController</span><span class="p">(</span><span class="n">ControllerBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""API Controller handling HTTP requests"""</span>

    <span class="nd">@post</span><span class="p">(</span><span class="s2">"/orders"</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">OrderDto</span><span class="p">,</span> <span class="n">status_code</span><span class="o">=</span><span class="mi">201</span><span class="p">)</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">place_order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dto</span><span class="p">:</span> <span class="n">PlaceOrderDto</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OrderDto</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""ğŸŒ API Layer: Transform DTO to Command"""</span>
        <span class="n">command</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">dto</span><span class="p">,</span> <span class="n">PlaceOrderCommand</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">mediator</span><span class="o">.</span><span class="n">execute_async</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

<span class="c1"># 2. Application Layer - Commands and Handlers</span>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">PlaceOrderCommand</span><span class="p">(</span><span class="n">Command</span><span class="p">[</span><span class="n">OperationResult</span><span class="p">[</span><span class="n">OrderDto</span><span class="p">]]):</span>
<span class="w">    </span><span class="sd">"""Application command for placing orders"""</span>
    <span class="n">customer_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">items</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span>
    <span class="n">special_instructions</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">""</span>

<span class="k">class</span><span class="w"> </span><span class="nc">PlaceOrderHandler</span><span class="p">(</span><span class="n">CommandHandler</span><span class="p">[</span><span class="n">PlaceOrderCommand</span><span class="p">,</span> <span class="n">OperationResult</span><span class="p">[</span><span class="n">OrderDto</span><span class="p">]]):</span>
<span class="w">    </span><span class="sd">"""ğŸ’¼ Application Layer: Business orchestration"""</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">repository</span><span class="p">:</span> <span class="n">Repository</span><span class="p">[</span><span class="n">PizzaOrderAggregate</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
                 <span class="n">mapper</span><span class="p">:</span> <span class="n">Mapper</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">repository</span> <span class="o">=</span> <span class="n">repository</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span> <span class="o">=</span> <span class="n">mapper</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">handle_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">:</span> <span class="n">PlaceOrderCommand</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OperationResult</span><span class="p">[</span><span class="n">OrderDto</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""Handle command with domain coordination"""</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Create domain aggregate</span>
            <span class="n">aggregate</span> <span class="o">=</span> <span class="n">PizzaOrderAggregate</span><span class="p">()</span>

            <span class="c1"># Apply domain operation</span>
            <span class="n">aggregate</span><span class="o">.</span><span class="n">place_order</span><span class="p">(</span>
                <span class="n">customer_id</span><span class="o">=</span><span class="n">command</span><span class="o">.</span><span class="n">customer_id</span><span class="p">,</span>
                <span class="n">items</span><span class="o">=</span><span class="n">command</span><span class="o">.</span><span class="n">items</span><span class="p">,</span>
                <span class="n">special_instructions</span><span class="o">=</span><span class="n">command</span><span class="o">.</span><span class="n">special_instructions</span>
            <span class="p">)</span>

            <span class="c1"># Persist with events</span>
            <span class="n">saved_aggregate</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">repository</span><span class="o">.</span><span class="n">add_async</span><span class="p">(</span><span class="n">aggregate</span><span class="p">)</span>

            <span class="c1"># Transform back to DTO</span>
            <span class="n">dto</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">saved_aggregate</span><span class="o">.</span><span class="n">state</span><span class="p">,</span> <span class="n">OrderDto</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">created</span><span class="p">(</span><span class="n">dto</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bad_request</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">internal_server_error</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Failed to place order: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="c1"># 3. Integration Layer - Event Handlers</span>
<span class="k">class</span><span class="w"> </span><span class="nc">OrderIntegrationEventHandler</span><span class="p">(</span><span class="n">DomainEventHandler</span><span class="p">[</span><span class="n">PizzaOrderPlacedEvent</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">"""ğŸ”Œ Integration Layer: External system coordination"""</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">handle_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">PizzaOrderPlacedEvent</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Transform domain events to integration events"""</span>

        <span class="c1"># Convert to CloudEvent for external systems</span>
        <span class="n">cloud_event</span> <span class="o">=</span> <span class="n">CloudEvent</span><span class="p">(</span>
            <span class="n">source</span><span class="o">=</span><span class="s2">"mario-pizzeria/orders"</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="s2">"com.mario-pizzeria.order.placed.v1"</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">"orderId"</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">aggregate_id</span><span class="p">,</span>
                <span class="s2">"customerId"</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">customer_id</span><span class="p">,</span>
                <span class="s2">"totalAmount"</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">total_amount</span><span class="p">),</span>
                <span class="s2">"timestamp"</span><span class="p">:</span> <span class="n">event</span><span class="o">.</span><span class="n">created_at</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_bus</span><span class="o">.</span><span class="n">publish_async</span><span class="p">(</span><span class="n">cloud_event</span><span class="p">)</span>
</code></pre></div>
<h2 id="when-to-use-domain-driven-design">ğŸ¯ When to Use Domain Driven Design<a class="headerlink" href="#when-to-use-domain-driven-design" title="Permanent link">Â¶</a></h2>
<h3 id="ideal-use-cases">âœ… Ideal Use Cases<a class="headerlink" href="#ideal-use-cases" title="Permanent link">Â¶</a></h3>
<ul>
<li><strong>Complex Business Logic</strong>: Rich domain rules and workflows</li>
<li><strong>Long-term Projects</strong>: Systems that will evolve over years</li>
<li><strong>Large Teams</strong>: Multiple developers working on same domain</li>
<li><strong>Event-driven Systems</strong>: Business events drive system behavior</li>
<li><strong>Audit Requirements</strong>: Need complete operation history</li>
<li><strong>Collaborative Development</strong>: Business experts and developers working together</li>
</ul>
<h3 id="consider-alternatives-when">âŒ Consider Alternatives When<a class="headerlink" href="#consider-alternatives-when" title="Permanent link">Â¶</a></h3>
<ul>
<li><strong>Simple CRUD</strong>: Basic data entry with minimal business rules</li>
<li><strong>Short-term Projects</strong>: Quick prototypes or temporary solutions</li>
<li><strong>Small Teams</strong>: 1-2 developers with simple requirements</li>
<li><strong>Performance Critical</strong>: Microsecond latency requirements</li>
<li><strong>Read-heavy Systems</strong>: Mostly queries with minimal writes</li>
</ul>
<h3 id="migration-path">ğŸš€ Migration Path<a class="headerlink" href="#migration-path" title="Permanent link">Â¶</a></h3>
<pre class="mermaid"><code>flowchart TB
    subgraph "ğŸ“Š Current State: Simple CRUD"
        CRUD["Entity Classes&lt;br/&gt;Basic Repositories"]
        Services["Service Classes&lt;br/&gt;Business Logic"]
    end

    subgraph "ğŸ¯ Target State: Rich Domain Model"
        Entities["Rich Entities&lt;br/&gt;Business Behavior"]
        Aggregates["Aggregate Roots&lt;br/&gt;Consistency Boundaries"]
        Events["Domain Events&lt;br/&gt;Business Events"]
    end

    subgraph "ğŸ”„ Migration Steps"
        Step1["1. Extract Business Logic&lt;br/&gt;Move logic from services to entities"]
        Step2["2. Identify Aggregates&lt;br/&gt;Define consistency boundaries"]
        Step3["3. Add Domain Events&lt;br/&gt;Capture business occurrences"]
        Step4["4. Implement Event Sourcing&lt;br/&gt;Optional advanced pattern"]
    end

    CRUD --&gt; Step1
    Services --&gt; Step1
    Step1 --&gt; Step2
    Step2 --&gt; Step3
    Step3 --&gt; Step4
    Step4 --&gt; Entities
    Step4 --&gt; Aggregates
    Step4 --&gt; Events

    style Step1 fill:#e3f2fd
    style Step2 fill:#e8f5e8
    style Step3 fill:#fff3e0
    style Step4 fill:#f3e5f5</code></pre>
<h2 id="related-patterns">ğŸ”— Related Patterns<a class="headerlink" href="#related-patterns" title="Permanent link">Â¶</a></h2>
<ul>
<li><strong><a href="../clean-architecture/">ğŸ—ï¸ Clean Architecture</a></strong> - Foundational layering that supports DDD</li>
<li><strong><a href="../cqrs/">ğŸ“¡ CQRS &amp; Mediation</a></strong> - Command/Query patterns for domain operations</li>
<li><strong><a href="../event-sourcing/">ğŸ¯ Event Sourcing</a></strong> - Advanced persistence using domain events</li>
<li><strong><a href="../event-driven/">ğŸ”„ Event-Driven Architecture</a></strong> - System integration through domain events</li>
<li><strong><a href="../repository/">ğŸ’¾ Repository Pattern</a></strong> - Data access abstraction for aggregates</li>
</ul>
<hr/>
<p><em>Domain Driven Design provides the foundation for building maintainable, business-focused applications. The Neuroglia
framework's abstractions support both simple domain models and advanced patterns like event sourcing, allowing teams
to evolve their architecture as complexity grows.</em></p>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  Back to top
</button>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
<div class="md-social">
<a class="md-social__link" href="https://github.com/bvandewe/pyneuro" rel="noopener" target="_blank" title="github.com">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg>
</a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.expand", "navigation.top", "search.highlight", "search.share"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
<script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
</body>
</html>