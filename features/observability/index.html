
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="A lightweight, opinionated Python framework built on FastAPI that enforces clean architecture principles" name="description"/>
<link href="https://bvandewe.github.io/pyneuro/features/observability/" rel="canonical"/>
<link href="../serialization/" rel="prev"/>
<link href="../enhanced-model-validation/" rel="next"/>
<link href="../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.7.1" name="generator"/>
<title>Observability - Neuroglia Python Framework</title>
<link href="../../assets/stylesheets/main.484c7ddc.min.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/palette.ab4e12ef.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body data-md-color-accent="blue" data-md-color-primary="blue" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#observability-with-opentelemetry">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Neuroglia Python Framework" class="md-header__button md-logo" data-md-component="logo" href="../.." title="Neuroglia Python Framework">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Neuroglia Python Framework
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Observability
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="blue" data-md-color-media="" data-md-color-primary="blue" data-md-color-scheme="default" id="__palette_0" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="blue" data-md-color-media="" data-md-color-primary="blue" data-md-color-scheme="slate" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
</form>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<a aria-label="Share" class="md-search__icon md-icon" data-clipboard="" data-clipboard-text="" data-md-component="search-share" href="javascript:void(0)" tabindex="-1" title="Share">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"></path></svg>
</a>
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/bvandewe/pyneuro" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"></path></svg>
</div>
<div class="md-source__repository">
    bvandewe/pyneuro
  </div>
</a>
</div>
</nav>
<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="../..">
          
  
  
  Home

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../mario-pizzeria/">
          
  
  
  Mario's Pizzeria

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../patterns/">
          
  
  
  Patterns

        </a>
</li>
<li class="md-tabs__item md-tabs__item--active">
<a class="md-tabs__link" href="../">
          
  
  
  Features

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../guides/">
          
  
  
  Guides

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../references/oauth-oidc-jwt/">
          
  
  
  References

        </a>
</li>
</ul>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Neuroglia Python Framework" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="Neuroglia Python Framework">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
    Neuroglia Python Framework
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/bvandewe/pyneuro" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"></path></svg>
</div>
<div class="md-source__repository">
    bvandewe/pyneuro
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
<span class="md-ellipsis">
    
  
    Home
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_1_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_1">
<span class="md-nav__icon md-icon"></span>
            
  
    Home
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../..">
<span class="md-ellipsis">
    
  
    Welcome
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../documentation-philosophy/">
<span class="md-ellipsis">
    
  
    ‚ö†Ô∏è Documentation Philosophy
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../getting-started/">
<span class="md-ellipsis">
    
  
    Getting Started
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../guides/local-development/">
<span class="md-ellipsis">
    
  
    Local Dev Setup
  

    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_1_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_1_5" id="__nav_1_5_label" tabindex="0">
<span class="md-ellipsis">
    
  
    Tutorials
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_1_5_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_1_5">
<span class="md-nav__icon md-icon"></span>
            
  
    Tutorials
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../tutorials/">
<span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../tutorials/mario-pizzeria-01-setup/">
<span class="md-ellipsis">
    
  
    1. Project Setup
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../tutorials/mario-pizzeria-02-domain/">
<span class="md-ellipsis">
    
  
    2. Domain Model
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../tutorials/mario-pizzeria-03-cqrs/">
<span class="md-ellipsis">
    
  
    3. CQRS &amp; Commands
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../tutorials/mario-pizzeria-04-api/">
<span class="md-ellipsis">
    
  
    4. API Controllers
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../tutorials/mario-pizzeria-05-events/">
<span class="md-ellipsis">
    
  
    5. Event-Driven Workflows
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../tutorials/mario-pizzeria-06-persistence/">
<span class="md-ellipsis">
    
  
    6. Data Persistence
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../tutorials/mario-pizzeria-07-auth/">
<span class="md-ellipsis">
    
  
    7. Authentication &amp; Security
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../tutorials/mario-pizzeria-08-observability/">
<span class="md-ellipsis">
    
  
    8. Observability
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../tutorials/mario-pizzeria-09-deployment/">
<span class="md-ellipsis">
    
  
    9. Production Deployment
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_1_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_1_6" id="__nav_1_6_label" tabindex="0">
<span class="md-ellipsis">
    
  
    Sample Applications
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_1_6_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_1_6">
<span class="md-nav__icon md-icon"></span>
            
  
    Sample Applications
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../samples/">
<span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../mario-pizzeria/">
<span class="md-ellipsis">
    
  
    üçï Mario's Pizzeria - CQRS &amp; Event-Driven
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../samples/openbank/">
<span class="md-ellipsis">
    
  
    üè¶ OpenBank - Event Sourcing
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../samples/simple-ui/">
<span class="md-ellipsis">
    
  
    üé® Simple UI - SubApp Pattern
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../samples/api_gateway/">
<span class="md-ellipsis">
    
  
    API Gateway
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../samples/desktop_controller/">
<span class="md-ellipsis">
    
  
    Desktop Controller
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
<span class="md-ellipsis">
    
  
    Mario's Pizzeria
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
            
  
    Mario's Pizzeria
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../mario-pizzeria/">
<span class="md-ellipsis">
    
  
    üçï Mario's Pizzeria - CQRS &amp; Event-Driven
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../mario-pizzeria/business-analysis/">
<span class="md-ellipsis">
    
  
    Business Analysis
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../mario-pizzeria/domain-design/">
<span class="md-ellipsis">
    
  
    Domain Design
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../mario-pizzeria/technical-architecture/">
<span class="md-ellipsis">
    
  
    Technical Architecture
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../mario-pizzeria/implementation-guide/">
<span class="md-ellipsis">
    
  
    Implementation Guide
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../mario-pizzeria/testing-deployment/">
<span class="md-ellipsis">
    
  
    Testing &amp; Deployment
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
<span class="md-ellipsis">
    
  
    Patterns
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
            
  
    Patterns
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../patterns/">
<span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_3_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
<span class="md-ellipsis">
    
  
    Foundation
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_2_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_2">
<span class="md-nav__icon md-icon"></span>
            
  
    Foundation
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../patterns/clean-architecture/">
<span class="md-ellipsis">
    
  
    Clean Architecture
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../patterns/domain-driven-design/">
<span class="md-ellipsis">
    
  
    Domain-Driven Design
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../patterns/cqrs/">
<span class="md-ellipsis">
    
  
    CQRS
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../patterns/event-driven/">
<span class="md-ellipsis">
    
  
    Event-Driven Architecture
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../patterns/repository/">
<span class="md-ellipsis">
    
  
    Repository Pattern
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../patterns/dependency-injection/">
<span class="md-ellipsis">
    
  
    Dependency Injection
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_3_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
<span class="md-ellipsis">
    
  
    Implementation
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_3_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_3">
<span class="md-nav__icon md-icon"></span>
            
  
    Implementation
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../patterns/unit-of-work/">
<span class="md-ellipsis">
    
  
    Unit of Work
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../patterns/pipeline-behaviors/">
<span class="md-ellipsis">
    
  
    Pipeline Behaviors
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../patterns/event-sourcing/">
<span class="md-ellipsis">
    
  
    Event Sourcing
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../patterns/reactive-programming/">
<span class="md-ellipsis">
    
  
    Reactive Programming
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_3_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
<span class="md-ellipsis">
    
  
    Advanced
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_4_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_4">
<span class="md-nav__icon md-icon"></span>
            
  
    Advanced
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../patterns/resource-oriented-architecture/">
<span class="md-ellipsis">
    
  
    Resource-Oriented Architecture
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../patterns/watcher-reconciliation-patterns/">
<span class="md-ellipsis">
    
  
    Watcher-Reconciliation Patterns
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../patterns/watcher-reconciliation-execution/">
<span class="md-ellipsis">
    
  
    Watcher-Reconciliation Execution
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../patterns/persistence-patterns/">
<span class="md-ellipsis">
    
  
    Persistence Patterns
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
<span class="md-ellipsis">
    
  
    Features
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            
  
    Features
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../">
<span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_4_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="">
<span class="md-ellipsis">
    
  
    Core
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_2_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_2">
<span class="md-nav__icon md-icon"></span>
            
  
    Core
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../simple-cqrs/">
<span class="md-ellipsis">
    
  
    Simple CQRS
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../mvc-controllers/">
<span class="md-ellipsis">
    
  
    MVC Controllers
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../data-access/">
<span class="md-ellipsis">
    
  
    Data Access
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../object-mapping/">
<span class="md-ellipsis">
    
  
    Object Mapping
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../serialization/">
<span class="md-ellipsis">
    
  
    Serialization
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    
  
    Observability
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    
  
    Observability
  

    
  </span>
</a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#table-of-contents">
<span class="md-ellipsis">
      
        üìö Table of Contents
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#what-why-observability">
<span class="md-ellipsis">
      
        üéØ What &amp; Why Observability
      
    </span>
</a>
<nav aria-label="üéØ What &amp; Why Observability" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#why-you-need-observability">
<span class="md-ellipsis">
      
        Why You Need Observability
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#the-problem-without-observability">
<span class="md-ellipsis">
      
        The Problem Without Observability
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#the-solution-with-observability">
<span class="md-ellipsis">
      
        The Solution With Observability
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#architecture-overview-for-beginners">
<span class="md-ellipsis">
      
        üèóÔ∏è Architecture Overview for Beginners
      
    </span>
</a>
<nav aria-label="üèóÔ∏è Architecture Overview for Beginners" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#the-complete-observability-stack">
<span class="md-ellipsis">
      
        The Complete Observability Stack
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#the-three-pillars-explained">
<span class="md-ellipsis">
      
        The Three Pillars Explained
      
    </span>
</a>
<nav aria-label="The Three Pillars Explained" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#1-metrics-what-is-happening">
<span class="md-ellipsis">
      
        1. üìä Metrics - "What is Happening?"
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-tracing-where-did-the-request-go">
<span class="md-ellipsis">
      
        2. üîç Tracing - "Where Did the Request Go?"
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3-logging-why-did-this-happen">
<span class="md-ellipsis">
      
        3. ÔøΩ Logging - "Why Did This Happen?"
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#why-use-opentelemetry-collector">
<span class="md-ellipsis">
      
        Why Use OpenTelemetry Collector?
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#quick-start">
<span class="md-ellipsis">
      
        üöÄ Quick Start
      
    </span>
</a>
<nav aria-label="üöÄ Quick Start" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#framework-style-configuration-recommended">
<span class="md-ellipsis">
      
        Framework-Style Configuration (Recommended)
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#manual-configuration-advanced">
<span class="md-ellipsis">
      
        Manual Configuration (Advanced)
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#infrastructure-setup">
<span class="md-ellipsis">
      
        üîß Infrastructure Setup
      
    </span>
</a>
<nav aria-label="üîß Infrastructure Setup" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#prerequisites">
<span class="md-ellipsis">
      
        Prerequisites
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#option-1-using-docker-compose-recommended">
<span class="md-ellipsis">
      
        Option 1: Using Docker Compose (Recommended)
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#option-2-kuberneteshelm-deployment">
<span class="md-ellipsis">
      
        Option 2: Kubernetes/Helm Deployment
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#verify-infrastructure-health">
<span class="md-ellipsis">
      
        Verify Infrastructure Health
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#configuration-files">
<span class="md-ellipsis">
      
        Configuration Files
      
    </span>
</a>
<nav aria-label="Configuration Files" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#otel-collector-configuration">
<span class="md-ellipsis">
      
        OTEL Collector Configuration
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#grafana-data-sources">
<span class="md-ellipsis">
      
        Grafana Data Sources
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#troubleshooting-infrastructure">
<span class="md-ellipsis">
      
        Troubleshooting Infrastructure
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#core-components">
<span class="md-ellipsis">
      
        üèóÔ∏è Core Components
      
    </span>
</a>
<nav aria-label="üèóÔ∏è Core Components" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#1-observability-framework-integration">
<span class="md-ellipsis">
      
        1. Observability Framework Integration
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-distributed-tracing">
<span class="md-ellipsis">
      
        2. Distributed Tracing
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3-metrics-collection">
<span class="md-ellipsis">
      
        3. Metrics Collection
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#4-structured-logging-with-trace-correlation">
<span class="md-ellipsis">
      
        4. Structured Logging with Trace Correlation
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#developer-implementation-guide">
<span class="md-ellipsis">
      
        ÔøΩ‚Äçüíª Developer Implementation Guide
      
    </span>
</a>
<nav aria-label="ÔøΩ‚Äçüíª Developer Implementation Guide" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#layer-1-api-layer-controllers">
<span class="md-ellipsis">
      
        Layer 1: API Layer (Controllers)
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#layer-2-application-layer-handlers">
<span class="md-ellipsis">
      
        Layer 2: Application Layer (Handlers)
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#layer-3-domain-layer-entities-services">
<span class="md-ellipsis">
      
        Layer 3: Domain Layer (Entities &amp; Services)
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#layer-4-integration-layer-repositories-external-services">
<span class="md-ellipsis">
      
        Layer 4: Integration Layer (Repositories &amp; External Services)
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#layer-specific-metric-types">
<span class="md-ellipsis">
      
        Layer-Specific Metric Types
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#understanding-metric-types">
<span class="md-ellipsis">
      
        üìä Understanding Metric Types
      
    </span>
</a>
<nav aria-label="üìä Understanding Metric Types" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#counter-ever-increasing-values">
<span class="md-ellipsis">
      
        Counter - Ever-Increasing Values
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#gauge-current-value">
<span class="md-ellipsis">
      
        Gauge - Current Value
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#histogram-distribution-of-values">
<span class="md-ellipsis">
      
        Histogram - Distribution of Values
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#comparison-table">
<span class="md-ellipsis">
      
        Comparison Table
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#real-world-metric-examples">
<span class="md-ellipsis">
      
        Real-World Metric Examples
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#data-flow-explained">
<span class="md-ellipsis">
      
        üåä Data Flow Explained
      
    </span>
</a>
<nav aria-label="üåä Data Flow Explained" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#complete-data-flow-architecture">
<span class="md-ellipsis">
      
        Complete Data Flow Architecture
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#step-by-step-flow">
<span class="md-ellipsis">
      
        Step-by-Step Flow
      
    </span>
</a>
<nav aria-label="Step-by-Step Flow" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#step-1-application-instrumentation">
<span class="md-ellipsis">
      
        Step 1: Application Instrumentation
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#step-2-otel-sdk-batching">
<span class="md-ellipsis">
      
        Step 2: OTEL SDK Batching
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#step-3-otel-collector-processing">
<span class="md-ellipsis">
      
        Step 3: OTEL Collector Processing
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#step-4-storage-in-backends">
<span class="md-ellipsis">
      
        Step 4: Storage in Backends
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#step-5-grafana-queries-and-correlation">
<span class="md-ellipsis">
      
        Step 5: Grafana Queries and Correlation
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#why-this-architecture">
<span class="md-ellipsis">
      
        Why This Architecture?
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#data-flow-performance-impact">
<span class="md-ellipsis">
      
        Data Flow Performance Impact
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#monitoring-the-data-flow">
<span class="md-ellipsis">
      
        Monitoring the Data Flow
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#real-world-example-marios-pizzeria">
<span class="md-ellipsis">
      
        ÔøΩüí° Real-World Example: Mario's Pizzeria
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_4_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="">
<span class="md-ellipsis">
    
  
    Validation &amp; Utilities
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_4_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_4">
<span class="md-nav__icon md-icon"></span>
            
  
    Validation &amp; Utilities
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../enhanced-model-validation/">
<span class="md-ellipsis">
    
  
    Model Validation
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../case-conversion-utilities/">
<span class="md-ellipsis">
    
  
    Case Conversion
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../configurable-type-discovery/">
<span class="md-ellipsis">
    
  
    Type Discovery
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_4_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_5" id="__nav_4_5_label" tabindex="">
<span class="md-ellipsis">
    
  
    Integration
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_5_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_5">
<span class="md-nav__icon md-icon"></span>
            
  
    Integration
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../http-service-client/">
<span class="md-ellipsis">
    
  
    HTTP Client
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../redis-cache-repository/">
<span class="md-ellipsis">
    
  
    Redis Cache
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../background-task-scheduling/">
<span class="md-ellipsis">
    
  
    Background Tasks
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_4_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_6" id="__nav_4_6_label" tabindex="">
<span class="md-ellipsis">
    
  
    Dev Tools
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_6_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_6">
<span class="md-nav__icon md-icon"></span>
            
  
    Dev Tools
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../resilient-handler-discovery/">
<span class="md-ellipsis">
    
  
    Handler Discovery
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../mermaid-diagrams/">
<span class="md-ellipsis">
    
  
    Mermaid Diagrams
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
<span class="md-ellipsis">
    
  
    Guides
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
            
  
    Guides
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../guides/">
<span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_5_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
<span class="md-ellipsis">
    
  
    Getting Started
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_2_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_2">
<span class="md-nav__icon md-icon"></span>
            
  
    Getting Started
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../guides/project-setup/">
<span class="md-ellipsis">
    
  
    Project Setup
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../guides/testing-setup/">
<span class="md-ellipsis">
    
  
    Testing Setup
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../guides/local-development/">
<span class="md-ellipsis">
    
  
    Local Dev Setup
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_5_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
<span class="md-ellipsis">
    
  
    Development
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_3_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_3">
<span class="md-nav__icon md-icon"></span>
            
  
    Development
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../guides/simple-ui-app/">
<span class="md-ellipsis">
    
  
    Simple UI Development
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../guides/jsonserializer-configuration/">
<span class="md-ellipsis">
    
  
    JsonSerializer Config
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../guides/motor-queryable-repositories/">
<span class="md-ellipsis">
    
  
    Motor Queryable Repositories
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../guides/custom-repository-mappings/">
<span class="md-ellipsis">
    
  
    Custom Repository Mappings
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_5_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_5_4" id="__nav_5_4_label" tabindex="0">
<span class="md-ellipsis">
    
  
    Operations
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_4_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_4">
<span class="md-nav__icon md-icon"></span>
            
  
    Operations
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../guides/opentelemetry-integration/">
<span class="md-ellipsis">
    
  
    OpenTelemetry Integration
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../guides/rbac-authorization/">
<span class="md-ellipsis">
    
  
    RBAC &amp; Authorization
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
<span class="md-ellipsis">
    
  
    References
  

    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_6_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_6">
<span class="md-nav__icon md-icon"></span>
            
  
    References
  

          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../references/oauth-oidc-jwt/">
<span class="md-ellipsis">
    
  
    OAuth &amp; JWT
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../references/12-factor-app/">
<span class="md-ellipsis">
    
  
    12-Factor App
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../references/persistence-documentation-guide/">
<span class="md-ellipsis">
    
  
    Persistence Guide
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../references/etcd_cheat_sheet/">
<span class="md-ellipsis">
    
  
    Etcd Cheat Sheet
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../references/source_code_naming_convention/">
<span class="md-ellipsis">
    
  
    Naming Conventions
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../references/python_typing_guide/">
<span class="md-ellipsis">
    
  
    Python Typing
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../references/python_modular_code/">
<span class="md-ellipsis">
    
  
    Modular Code
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../references/python_object_oriented/">
<span class="md-ellipsis">
    
  
    OOP Guide
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../references/test-mermaid/">
<span class="md-ellipsis">
    
  
    Mermaid Reference
  

    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../ai-agent-guide/">
<span class="md-ellipsis">
    
  
    AI Agent Guide
  

    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#table-of-contents">
<span class="md-ellipsis">
      
        üìö Table of Contents
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#what-why-observability">
<span class="md-ellipsis">
      
        üéØ What &amp; Why Observability
      
    </span>
</a>
<nav aria-label="üéØ What &amp; Why Observability" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#why-you-need-observability">
<span class="md-ellipsis">
      
        Why You Need Observability
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#the-problem-without-observability">
<span class="md-ellipsis">
      
        The Problem Without Observability
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#the-solution-with-observability">
<span class="md-ellipsis">
      
        The Solution With Observability
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#architecture-overview-for-beginners">
<span class="md-ellipsis">
      
        üèóÔ∏è Architecture Overview for Beginners
      
    </span>
</a>
<nav aria-label="üèóÔ∏è Architecture Overview for Beginners" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#the-complete-observability-stack">
<span class="md-ellipsis">
      
        The Complete Observability Stack
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#the-three-pillars-explained">
<span class="md-ellipsis">
      
        The Three Pillars Explained
      
    </span>
</a>
<nav aria-label="The Three Pillars Explained" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#1-metrics-what-is-happening">
<span class="md-ellipsis">
      
        1. üìä Metrics - "What is Happening?"
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-tracing-where-did-the-request-go">
<span class="md-ellipsis">
      
        2. üîç Tracing - "Where Did the Request Go?"
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3-logging-why-did-this-happen">
<span class="md-ellipsis">
      
        3. ÔøΩ Logging - "Why Did This Happen?"
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#why-use-opentelemetry-collector">
<span class="md-ellipsis">
      
        Why Use OpenTelemetry Collector?
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#quick-start">
<span class="md-ellipsis">
      
        üöÄ Quick Start
      
    </span>
</a>
<nav aria-label="üöÄ Quick Start" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#framework-style-configuration-recommended">
<span class="md-ellipsis">
      
        Framework-Style Configuration (Recommended)
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#manual-configuration-advanced">
<span class="md-ellipsis">
      
        Manual Configuration (Advanced)
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#infrastructure-setup">
<span class="md-ellipsis">
      
        üîß Infrastructure Setup
      
    </span>
</a>
<nav aria-label="üîß Infrastructure Setup" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#prerequisites">
<span class="md-ellipsis">
      
        Prerequisites
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#option-1-using-docker-compose-recommended">
<span class="md-ellipsis">
      
        Option 1: Using Docker Compose (Recommended)
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#option-2-kuberneteshelm-deployment">
<span class="md-ellipsis">
      
        Option 2: Kubernetes/Helm Deployment
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#verify-infrastructure-health">
<span class="md-ellipsis">
      
        Verify Infrastructure Health
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#configuration-files">
<span class="md-ellipsis">
      
        Configuration Files
      
    </span>
</a>
<nav aria-label="Configuration Files" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#otel-collector-configuration">
<span class="md-ellipsis">
      
        OTEL Collector Configuration
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#grafana-data-sources">
<span class="md-ellipsis">
      
        Grafana Data Sources
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#troubleshooting-infrastructure">
<span class="md-ellipsis">
      
        Troubleshooting Infrastructure
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#core-components">
<span class="md-ellipsis">
      
        üèóÔ∏è Core Components
      
    </span>
</a>
<nav aria-label="üèóÔ∏è Core Components" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#1-observability-framework-integration">
<span class="md-ellipsis">
      
        1. Observability Framework Integration
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-distributed-tracing">
<span class="md-ellipsis">
      
        2. Distributed Tracing
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3-metrics-collection">
<span class="md-ellipsis">
      
        3. Metrics Collection
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#4-structured-logging-with-trace-correlation">
<span class="md-ellipsis">
      
        4. Structured Logging with Trace Correlation
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#developer-implementation-guide">
<span class="md-ellipsis">
      
        ÔøΩ‚Äçüíª Developer Implementation Guide
      
    </span>
</a>
<nav aria-label="ÔøΩ‚Äçüíª Developer Implementation Guide" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#layer-1-api-layer-controllers">
<span class="md-ellipsis">
      
        Layer 1: API Layer (Controllers)
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#layer-2-application-layer-handlers">
<span class="md-ellipsis">
      
        Layer 2: Application Layer (Handlers)
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#layer-3-domain-layer-entities-services">
<span class="md-ellipsis">
      
        Layer 3: Domain Layer (Entities &amp; Services)
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#layer-4-integration-layer-repositories-external-services">
<span class="md-ellipsis">
      
        Layer 4: Integration Layer (Repositories &amp; External Services)
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#layer-specific-metric-types">
<span class="md-ellipsis">
      
        Layer-Specific Metric Types
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#understanding-metric-types">
<span class="md-ellipsis">
      
        üìä Understanding Metric Types
      
    </span>
</a>
<nav aria-label="üìä Understanding Metric Types" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#counter-ever-increasing-values">
<span class="md-ellipsis">
      
        Counter - Ever-Increasing Values
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#gauge-current-value">
<span class="md-ellipsis">
      
        Gauge - Current Value
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#histogram-distribution-of-values">
<span class="md-ellipsis">
      
        Histogram - Distribution of Values
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#comparison-table">
<span class="md-ellipsis">
      
        Comparison Table
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#real-world-metric-examples">
<span class="md-ellipsis">
      
        Real-World Metric Examples
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#data-flow-explained">
<span class="md-ellipsis">
      
        üåä Data Flow Explained
      
    </span>
</a>
<nav aria-label="üåä Data Flow Explained" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#complete-data-flow-architecture">
<span class="md-ellipsis">
      
        Complete Data Flow Architecture
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#step-by-step-flow">
<span class="md-ellipsis">
      
        Step-by-Step Flow
      
    </span>
</a>
<nav aria-label="Step-by-Step Flow" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#step-1-application-instrumentation">
<span class="md-ellipsis">
      
        Step 1: Application Instrumentation
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#step-2-otel-sdk-batching">
<span class="md-ellipsis">
      
        Step 2: OTEL SDK Batching
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#step-3-otel-collector-processing">
<span class="md-ellipsis">
      
        Step 3: OTEL Collector Processing
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#step-4-storage-in-backends">
<span class="md-ellipsis">
      
        Step 4: Storage in Backends
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#step-5-grafana-queries-and-correlation">
<span class="md-ellipsis">
      
        Step 5: Grafana Queries and Correlation
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#why-this-architecture">
<span class="md-ellipsis">
      
        Why This Architecture?
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#data-flow-performance-impact">
<span class="md-ellipsis">
      
        Data Flow Performance Impact
      
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#monitoring-the-data-flow">
<span class="md-ellipsis">
      
        Monitoring the Data Flow
      
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#real-world-example-marios-pizzeria">
<span class="md-ellipsis">
      
        ÔøΩüí° Real-World Example: Mario's Pizzeria
      
    </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="observability-with-opentelemetry">üî≠ Observability with OpenTelemetry<a class="headerlink" href="#observability-with-opentelemetry" title="Permanent link">¬∂</a></h1>
<p><em>Estimated reading time: 25 minutes | Audience: Beginners to Advanced Developers</em></p>
<h2 id="table-of-contents">üìö Table of Contents<a class="headerlink" href="#table-of-contents" title="Permanent link">¬∂</a></h2>
<ul>
<li><a href="#-what--why-observability">üéØ What &amp; Why Observability</a></li>
<li><a href="#Ô∏è-architecture-overview-for-beginners">üèóÔ∏è Architecture Overview for Beginners</a></li>
<li><a href="#-quick-start">üöÄ Quick Start</a></li>
<li><a href="#-infrastructure-setup">üîß Infrastructure Setup</a></li>
<li><a href="#-developer-implementation-guide">üë®‚Äçüíª Developer Implementation Guide</a></li>
<li><a href="#-understanding-metric-types">üìä Understanding Metric Types</a></li>
<li><a href="#-data-flow-explained">üåä Data Flow Explained</a></li>
<li><a href="#-real-world-example">üí° Real-World Example</a></li>
<li><a href="#-advanced-features">üî• Advanced Features</a></li>
<li><a href="#-api-reference">üìñ API Reference</a></li>
</ul>
<h2 id="what-why-observability">üéØ What &amp; Why Observability<a class="headerlink" href="#what-why-observability" title="Permanent link">¬∂</a></h2>
<p><strong>Observability</strong> is the ability to understand what's happening inside your application by examining its outputs. The Neuroglia framework provides comprehensive observability through <strong>OpenTelemetry integration</strong>, supporting the three pillars:</p>
<ol>
<li><strong>Metrics</strong> - What's happening (counters, gauges, histograms)</li>
<li><strong>Tracing</strong> - Where requests flow (distributed traces across services)</li>
<li><strong>Logging</strong> - Why things happened (structured logs with trace correlation)</li>
</ol>
<h3 id="why-you-need-observability">Why You Need Observability<a class="headerlink" href="#why-you-need-observability" title="Permanent link">¬∂</a></h3>
<p>Without observability, troubleshooting distributed systems is like debugging in the dark:</p>
<ul>
<li>‚ùì <strong>Which service is slow?</strong> - No visibility into request flow</li>
<li>‚ùì <strong>Why did it fail?</strong> - No correlation between logs and requests</li>
<li>‚ùì <strong>Is performance degrading?</strong> - No historical metrics</li>
<li>‚ùì <strong>What's the user impact?</strong> - No business metrics tracking</li>
</ul>
<h3 id="the-problem-without-observability">The Problem Without Observability<a class="headerlink" href="#the-problem-without-observability" title="Permanent link">¬∂</a></h3>
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="c1"># ‚ùå Without observability - debugging is painful</span>
</span><span id="__span-0-2"><a href="#__codelineno-0-2" id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">"/orders"</span><span class="p">)</span>
</span><span id="__span-0-3"><a href="#__codelineno-0-3" id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">create_order</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="__span-0-4"><a href="#__codelineno-0-4" id="__codelineno-0-4" name="__codelineno-0-4"></a>    <span class="c1"># Why is this slow?</span>
</span><span id="__span-0-5"><a href="#__codelineno-0-5" id="__codelineno-0-5" name="__codelineno-0-5"></a>    <span class="c1"># Which service failed?</span>
</span><span id="__span-0-6"><a href="#__codelineno-0-6" id="__codelineno-0-6" name="__codelineno-0-6"></a>    <span class="c1"># How many orders per minute?</span>
</span><span id="__span-0-7"><a href="#__codelineno-0-7" id="__codelineno-0-7" name="__codelineno-0-7"></a>    <span class="c1"># What's the error rate?</span>
</span><span id="__span-0-8"><a href="#__codelineno-0-8" id="__codelineno-0-8" name="__codelineno-0-8"></a>    <span class="n">order</span> <span class="o">=</span> <span class="k">await</span> <span class="n">order_service</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="__span-0-9"><a href="#__codelineno-0-9" id="__codelineno-0-9" name="__codelineno-0-9"></a>    <span class="k">return</span> <span class="n">order</span>
</span></code></pre></div>
<h3 id="the-solution-with-observability">The Solution With Observability<a class="headerlink" href="#the-solution-with-observability" title="Permanent link">¬∂</a></h3>
<div class="language-python highlight"><pre><span></span><code><span id="__span-1-1"><a href="#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="c1"># ‚úÖ With observability - full visibility</span>
</span><span id="__span-1-2"><a href="#__codelineno-1-2" id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">neuroglia.observability</span><span class="w"> </span><span class="kn">import</span> <span class="n">Observability</span>
</span><span id="__span-1-3"><a href="#__codelineno-1-3" id="__codelineno-1-3" name="__codelineno-1-3"></a>
</span><span id="__span-1-4"><a href="#__codelineno-1-4" id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="n">builder</span> <span class="o">=</span> <span class="n">WebApplicationBuilder</span><span class="p">(</span><span class="n">app_settings</span><span class="p">)</span>
</span><span id="__span-1-5"><a href="#__codelineno-1-5" id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="n">Observability</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">builder</span><span class="p">)</span>  <span class="c1"># Automatic instrumentation!</span>
</span><span id="__span-1-6"><a href="#__codelineno-1-6" id="__codelineno-1-6" name="__codelineno-1-6"></a>
</span><span id="__span-1-7"><a href="#__codelineno-1-7" id="__codelineno-1-7" name="__codelineno-1-7"></a><span class="c1"># Now you get:</span>
</span><span id="__span-1-8"><a href="#__codelineno-1-8" id="__codelineno-1-8" name="__codelineno-1-8"></a><span class="c1"># - Automatic request tracing</span>
</span><span id="__span-1-9"><a href="#__codelineno-1-9" id="__codelineno-1-9" name="__codelineno-1-9"></a><span class="c1"># - Response time metrics</span>
</span><span id="__span-1-10"><a href="#__codelineno-1-10" id="__codelineno-1-10" name="__codelineno-1-10"></a><span class="c1"># - Correlated logs with trace IDs</span>
</span><span id="__span-1-11"><a href="#__codelineno-1-11" id="__codelineno-1-11" name="__codelineno-1-11"></a><span class="c1"># - Service dependency maps</span>
</span><span id="__span-1-12"><a href="#__codelineno-1-12" id="__codelineno-1-12" name="__codelineno-1-12"></a><span class="c1"># - Error rate tracking</span>
</span><span id="__span-1-13"><a href="#__codelineno-1-13" id="__codelineno-1-13" name="__codelineno-1-13"></a><span class="c1"># - System metrics (CPU, memory)</span>
</span></code></pre></div>
<h2 id="architecture-overview-for-beginners">üèóÔ∏è Architecture Overview for Beginners<a class="headerlink" href="#architecture-overview-for-beginners" title="Permanent link">¬∂</a></h2>
<h3 id="the-complete-observability-stack">The Complete Observability Stack<a class="headerlink" href="#the-complete-observability-stack" title="Permanent link">¬∂</a></h3>
<p>Understanding the observability stack is crucial. Here's how all components work together:</p>
<pre class="mermaid"><code>graph TB
    subgraph "Your Application"
        A[FastAPI App]
        B[OTEL SDK]
        C[Automatic&lt;br/&gt;Instrumentation]
        D[Manual&lt;br/&gt;Instrumentation]

        A --&gt; B
        C --&gt; B
        D --&gt; B
    end

    subgraph "Data Collection"
        E[OTEL Collector&lt;br/&gt;:4317 gRPC]
        F[Receivers]
        G[Processors]
        H[Exporters]

        E --&gt; F
        F --&gt; G
        G --&gt; H
    end

    subgraph "Storage Backends"
        I[Tempo&lt;br/&gt;Traces]
        J[Prometheus&lt;br/&gt;Metrics]
        K[Loki&lt;br/&gt;Logs]
    end

    subgraph "Visualization"
        L[Grafana&lt;br/&gt;:3000]
        M[Dashboards]
        N[Alerts]

        L --&gt; M
        L --&gt; N
    end

    B --&gt;|OTLP/gRPC| E
    H --&gt;|Push Traces| I
    H --&gt;|Push Metrics| J
    H --&gt;|Push Logs| K
    I --&gt; L
    J --&gt; L
    K --&gt; L

    style A fill:#e3f2fd
    style B fill:#fff3e0
    style E fill:#f3e5f5
    style I fill:#e8f5e9
    style J fill:#fce4ec
    style K fill:#fff9c4
    style L fill:#e0f2f1</code></pre>
<h3 id="the-three-pillars-explained">The Three Pillars Explained<a class="headerlink" href="#the-three-pillars-explained" title="Permanent link">¬∂</a></h3>
<h4 id="1-metrics-what-is-happening">1. üìä Metrics - "What is Happening?"<a class="headerlink" href="#1-metrics-what-is-happening" title="Permanent link">¬∂</a></h4>
<p><strong>Purpose</strong>: Quantitative measurements over time</p>
<p><strong>Types</strong>:</p>
<ul>
<li><strong>Counter</strong>: Monotonically increasing value (e.g., total orders, requests)</li>
<li><strong>Gauge</strong>: Current value that can go up/down (e.g., active connections, queue size)</li>
<li><strong>Histogram</strong>: Distribution of values (e.g., request duration, response size)</li>
</ul>
<p><strong>Example Metrics</strong>:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-2-1"><a href="#__codelineno-2-1" id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="n">orders_created_total</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="mi">247</span>  <span class="c1"># Counter</span>
</span><span id="__span-2-2"><a href="#__codelineno-2-2" id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="n">active_users</span> <span class="o">=</span> <span class="mi">32</span>             <span class="c1"># Gauge</span>
</span><span id="__span-2-3"><a href="#__codelineno-2-3" id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="n">request_duration_ms</span> <span class="o">=</span> <span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">67</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>  <span class="c1"># Histogram</span>
</span></code></pre></div>
<p><strong>Use Cases</strong>:</p>
<ul>
<li>Monitor system health (CPU, memory, disk)</li>
<li>Track business KPIs (orders/hour, revenue)</li>
<li>Measure performance (latency, throughput)</li>
<li>Set alerts on thresholds</li>
</ul>
<h4 id="2-tracing-where-did-the-request-go">2. üîç Tracing - "Where Did the Request Go?"<a class="headerlink" href="#2-tracing-where-did-the-request-go" title="Permanent link">¬∂</a></h4>
<p><strong>Purpose</strong>: Track request flow across services and layers</p>
<p><strong>Key Concepts</strong>:</p>
<ul>
<li><strong>Trace</strong>: Complete journey of a request</li>
<li><strong>Span</strong>: Single operation within a trace</li>
<li><strong>Parent/Child</strong>: Relationships between spans</li>
</ul>
<p><strong>Example Trace</strong>:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-3-1"><a href="#__codelineno-3-1" id="__codelineno-3-1" name="__codelineno-3-1"></a>Trace ID: abc123
</span><span id="__span-3-2"><a href="#__codelineno-3-2" id="__codelineno-3-2" name="__codelineno-3-2"></a>‚îú‚îÄ Span: HTTP POST /orders (200ms)
</span><span id="__span-3-3"><a href="#__codelineno-3-3" id="__codelineno-3-3" name="__codelineno-3-3"></a>   ‚îú‚îÄ Span: validate_order (10ms)
</span><span id="__span-3-4"><a href="#__codelineno-3-4" id="__codelineno-3-4" name="__codelineno-3-4"></a>   ‚îú‚îÄ Span: check_inventory (50ms)
</span><span id="__span-3-5"><a href="#__codelineno-3-5" id="__codelineno-3-5" name="__codelineno-3-5"></a>   ‚îÇ  ‚îî‚îÄ Span: MongoDB query (40ms)
</span><span id="__span-3-6"><a href="#__codelineno-3-6" id="__codelineno-3-6" name="__codelineno-3-6"></a>   ‚îú‚îÄ Span: process_payment (100ms)
</span><span id="__span-3-7"><a href="#__codelineno-3-7" id="__codelineno-3-7" name="__codelineno-3-7"></a>   ‚îÇ  ‚îî‚îÄ Span: HTTP POST to payment API (95ms)
</span><span id="__span-3-8"><a href="#__codelineno-3-8" id="__codelineno-3-8" name="__codelineno-3-8"></a>   ‚îî‚îÄ Span: save_order (40ms)
</span><span id="__span-3-9"><a href="#__codelineno-3-9" id="__codelineno-3-9" name="__codelineno-3-9"></a>      ‚îî‚îÄ Span: MongoDB insert (35ms)
</span></code></pre></div>
<p><strong>Use Cases</strong>:</p>
<ul>
<li>Identify bottlenecks in request processing</li>
<li>Debug distributed system failures</li>
<li>Understand service dependencies</li>
<li>Measure end-to-end latency</li>
</ul>
<h4 id="3-logging-why-did-this-happen">3. ÔøΩ Logging - "Why Did This Happen?"<a class="headerlink" href="#3-logging-why-did-this-happen" title="Permanent link">¬∂</a></h4>
<p><strong>Purpose</strong>: Structured event records with context</p>
<p><strong>Key Features</strong>:</p>
<ul>
<li><strong>Structured</strong>: JSON format, not plain text</li>
<li><strong>Trace Correlation</strong>: Every log includes trace_id and span_id</li>
<li><strong>Severity Levels</strong>: DEBUG, INFO, WARNING, ERROR, CRITICAL</li>
<li><strong>Context</strong>: Request ID, user ID, environment</li>
</ul>
<p><strong>Example Log</strong>:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-4-1"><a href="#__codelineno-4-1" id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="p">{</span>
</span><span id="__span-4-2"><a href="#__codelineno-4-2" id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="w">  </span><span class="nt">"timestamp"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2025-11-02T12:34:56.789Z"</span><span class="p">,</span>
</span><span id="__span-4-3"><a href="#__codelineno-4-3" id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="w">  </span><span class="nt">"level"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ERROR"</span><span class="p">,</span>
</span><span id="__span-4-4"><a href="#__codelineno-4-4" id="__codelineno-4-4" name="__codelineno-4-4"></a><span class="w">  </span><span class="nt">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Payment processing failed"</span><span class="p">,</span>
</span><span id="__span-4-5"><a href="#__codelineno-4-5" id="__codelineno-4-5" name="__codelineno-4-5"></a><span class="w">  </span><span class="nt">"trace_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"abc123"</span><span class="p">,</span>
</span><span id="__span-4-6"><a href="#__codelineno-4-6" id="__codelineno-4-6" name="__codelineno-4-6"></a><span class="w">  </span><span class="nt">"span_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"xyz789"</span><span class="p">,</span>
</span><span id="__span-4-7"><a href="#__codelineno-4-7" id="__codelineno-4-7" name="__codelineno-4-7"></a><span class="w">  </span><span class="nt">"service"</span><span class="p">:</span><span class="w"> </span><span class="s2">"mario-pizzeria"</span><span class="p">,</span>
</span><span id="__span-4-8"><a href="#__codelineno-4-8" id="__codelineno-4-8" name="__codelineno-4-8"></a><span class="w">  </span><span class="nt">"environment"</span><span class="p">:</span><span class="w"> </span><span class="s2">"production"</span><span class="p">,</span>
</span><span id="__span-4-9"><a href="#__codelineno-4-9" id="__codelineno-4-9" name="__codelineno-4-9"></a><span class="w">  </span><span class="nt">"order_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ORD-1234"</span><span class="p">,</span>
</span><span id="__span-4-10"><a href="#__codelineno-4-10" id="__codelineno-4-10" name="__codelineno-4-10"></a><span class="w">  </span><span class="nt">"error"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Insufficient funds"</span>
</span><span id="__span-4-11"><a href="#__codelineno-4-11" id="__codelineno-4-11" name="__codelineno-4-11"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong>Use Cases</strong>:</p>
<ul>
<li>Debug specific errors</li>
<li>Audit user actions</li>
<li>Correlate with traces and metrics</li>
<li>Root cause analysis</li>
</ul>
<h3 id="why-use-opentelemetry-collector">Why Use OpenTelemetry Collector?<a class="headerlink" href="#why-use-opentelemetry-collector" title="Permanent link">¬∂</a></h3>
<p>You might wonder: "Why not send data directly to Tempo/Prometheus/Loki?"</p>
<p><strong>Benefits of OTEL Collector</strong>:</p>
<ol>
<li><strong>Single Integration Point</strong></li>
<li>Your app only talks to one endpoint (<code>:4317</code>)</li>
<li>Change backends without code changes</li>
<li><strong>Data Processing</strong></li>
<li>Filter sensitive data before export</li>
<li>Batch data for efficiency</li>
<li>Sample high-volume traces</li>
<li><strong>Multiple Backends</strong></li>
<li>Export to multiple destinations simultaneously</li>
<li>Console export for debugging + production backends</li>
<li><strong>Resilience</strong></li>
<li>Buffer data during backend outages</li>
<li>Retry failed exports</li>
<li><strong>Performance</strong></li>
<li>Offload processing from your app</li>
<li>Compress and batch data efficiently</li>
</ol>
<p><strong>Direct vs Collector Architecture</strong>:</p>
<pre class="mermaid"><code>graph LR
    subgraph "‚ùå Without Collector"
        A1[App] --&gt;|Traces| T1[Tempo]
        A1 --&gt;|Metrics| P1[Prometheus]
        A1 --&gt;|Logs| L1[Loki]
    end

    subgraph "‚úÖ With Collector"
        A2[App] --&gt;|OTLP| C[Collector]
        C --&gt;|Process| C
        C --&gt;|Export| T2[Tempo]
        C --&gt;|Export| P2[Prometheus]
        C --&gt;|Export| L2[Loki]
    end

    style C fill:#f3e5f5</code></pre>
<p><strong>When to skip the collector</strong>: Only for very simple, single-service applications in development.</p>
<h2 id="quick-start">üöÄ Quick Start<a class="headerlink" href="#quick-start" title="Permanent link">¬∂</a></h2>
<h3 id="framework-style-configuration-recommended">Framework-Style Configuration (Recommended)<a class="headerlink" href="#framework-style-configuration-recommended" title="Permanent link">¬∂</a></h3>
<p>The easiest way to enable observability is through <code>WebApplicationBuilder</code>:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-5-1"><a href="#__codelineno-5-1" id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">neuroglia.hosting.web</span><span class="w"> </span><span class="kn">import</span> <span class="n">WebApplicationBuilder</span>
</span><span id="__span-5-2"><a href="#__codelineno-5-2" id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">neuroglia.observability</span><span class="w"> </span><span class="kn">import</span> <span class="n">Observability</span><span class="p">,</span> <span class="n">ApplicationSettingsWithObservability</span>
</span><span id="__span-5-3"><a href="#__codelineno-5-3" id="__codelineno-5-3" name="__codelineno-5-3"></a>
</span><span id="__span-5-4"><a href="#__codelineno-5-4" id="__codelineno-5-4" name="__codelineno-5-4"></a><span class="c1"># Step 1: Use settings class with observability</span>
</span><span id="__span-5-5"><a href="#__codelineno-5-5" id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="k">class</span><span class="w"> </span><span class="nc">PizzeriaSettings</span><span class="p">(</span><span class="n">ApplicationSettingsWithObservability</span><span class="p">):</span>
</span><span id="__span-5-6"><a href="#__codelineno-5-6" id="__codelineno-5-6" name="__codelineno-5-6"></a>    <span class="c1"># Your app settings</span>
</span><span id="__span-5-7"><a href="#__codelineno-5-7" id="__codelineno-5-7" name="__codelineno-5-7"></a>    <span class="n">database_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">"mongodb://localhost:27017"</span><span class="p">)</span>
</span><span id="__span-5-8"><a href="#__codelineno-5-8" id="__codelineno-5-8" name="__codelineno-5-8"></a>
</span><span id="__span-5-9"><a href="#__codelineno-5-9" id="__codelineno-5-9" name="__codelineno-5-9"></a>    <span class="c1"># Observability settings inherited:</span>
</span><span id="__span-5-10"><a href="#__codelineno-5-10" id="__codelineno-5-10" name="__codelineno-5-10"></a>    <span class="c1"># - service_name, service_version, deployment_environment</span>
</span><span id="__span-5-11"><a href="#__codelineno-5-11" id="__codelineno-5-11" name="__codelineno-5-11"></a>    <span class="c1"># - otel_enabled, otel_endpoint, tracing_enabled, metrics_enabled</span>
</span><span id="__span-5-12"><a href="#__codelineno-5-12" id="__codelineno-5-12" name="__codelineno-5-12"></a>    <span class="c1"># - instrument_fastapi, instrument_httpx, instrument_logging</span>
</span><span id="__span-5-13"><a href="#__codelineno-5-13" id="__codelineno-5-13" name="__codelineno-5-13"></a>
</span><span id="__span-5-14"><a href="#__codelineno-5-14" id="__codelineno-5-14" name="__codelineno-5-14"></a><span class="c1"># Step 2: Configure observability</span>
</span><span id="__span-5-15"><a href="#__codelineno-5-15" id="__codelineno-5-15" name="__codelineno-5-15"></a><span class="n">builder</span> <span class="o">=</span> <span class="n">WebApplicationBuilder</span><span class="p">(</span><span class="n">PizzeriaSettings</span><span class="p">())</span>
</span><span id="__span-5-16"><a href="#__codelineno-5-16" id="__codelineno-5-16" name="__codelineno-5-16"></a><span class="n">Observability</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">builder</span><span class="p">)</span>  <span class="c1"># Uses settings automatically</span>
</span><span id="__span-5-17"><a href="#__codelineno-5-17" id="__codelineno-5-17" name="__codelineno-5-17"></a>
</span><span id="__span-5-18"><a href="#__codelineno-5-18" id="__codelineno-5-18" name="__codelineno-5-18"></a><span class="c1"># Step 3: Build and run</span>
</span><span id="__span-5-19"><a href="#__codelineno-5-19" id="__codelineno-5-19" name="__codelineno-5-19"></a><span class="n">app</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
</span><span id="__span-5-20"><a href="#__codelineno-5-20" id="__codelineno-5-20" name="__codelineno-5-20"></a><span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</span><span id="__span-5-21"><a href="#__codelineno-5-21" id="__codelineno-5-21" name="__codelineno-5-21"></a>
</span><span id="__span-5-22"><a href="#__codelineno-5-22" id="__codelineno-5-22" name="__codelineno-5-22"></a><span class="c1"># üéâ You now have:</span>
</span><span id="__span-5-23"><a href="#__codelineno-5-23" id="__codelineno-5-23" name="__codelineno-5-23"></a><span class="c1"># - /metrics endpoint with Prometheus metrics</span>
</span><span id="__span-5-24"><a href="#__codelineno-5-24" id="__codelineno-5-24" name="__codelineno-5-24"></a><span class="c1"># - /health endpoint with service health</span>
</span><span id="__span-5-25"><a href="#__codelineno-5-25" id="__codelineno-5-25" name="__codelineno-5-25"></a><span class="c1"># - Distributed tracing to OTLP collector</span>
</span><span id="__span-5-26"><a href="#__codelineno-5-26" id="__codelineno-5-26" name="__codelineno-5-26"></a><span class="c1"># - Structured logs with trace correlation</span>
</span></code></pre></div>
<h3 id="manual-configuration-advanced">Manual Configuration (Advanced)<a class="headerlink" href="#manual-configuration-advanced" title="Permanent link">¬∂</a></h3>
<p>For fine-grained control:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-6-1"><a href="#__codelineno-6-1" id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">neuroglia.observability</span><span class="w"> </span><span class="kn">import</span> <span class="n">configure_opentelemetry</span>
</span><span id="__span-6-2"><a href="#__codelineno-6-2" id="__codelineno-6-2" name="__codelineno-6-2"></a>
</span><span id="__span-6-3"><a href="#__codelineno-6-3" id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="c1"># Configure OpenTelemetry directly</span>
</span><span id="__span-6-4"><a href="#__codelineno-6-4" id="__codelineno-6-4" name="__codelineno-6-4"></a><span class="n">configure_opentelemetry</span><span class="p">(</span>
</span><span id="__span-6-5"><a href="#__codelineno-6-5" id="__codelineno-6-5" name="__codelineno-6-5"></a>    <span class="n">service_name</span><span class="o">=</span><span class="s2">"mario-pizzeria"</span><span class="p">,</span>
</span><span id="__span-6-6"><a href="#__codelineno-6-6" id="__codelineno-6-6" name="__codelineno-6-6"></a>    <span class="n">service_version</span><span class="o">=</span><span class="s2">"1.0.0"</span><span class="p">,</span>
</span><span id="__span-6-7"><a href="#__codelineno-6-7" id="__codelineno-6-7" name="__codelineno-6-7"></a>    <span class="n">otlp_endpoint</span><span class="o">=</span><span class="s2">"http://otel-collector:4317"</span><span class="p">,</span>
</span><span id="__span-6-8"><a href="#__codelineno-6-8" id="__codelineno-6-8" name="__codelineno-6-8"></a>    <span class="n">enable_console_export</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># Set True for debugging</span>
</span><span id="__span-6-9"><a href="#__codelineno-6-9" id="__codelineno-6-9" name="__codelineno-6-9"></a>    <span class="n">deployment_environment</span><span class="o">=</span><span class="s2">"production"</span><span class="p">,</span>
</span><span id="__span-6-10"><a href="#__codelineno-6-10" id="__codelineno-6-10" name="__codelineno-6-10"></a>
</span><span id="__span-6-11"><a href="#__codelineno-6-11" id="__codelineno-6-11" name="__codelineno-6-11"></a>    <span class="c1"># Instrumentation toggles</span>
</span><span id="__span-6-12"><a href="#__codelineno-6-12" id="__codelineno-6-12" name="__codelineno-6-12"></a>    <span class="n">enable_fastapi_instrumentation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-6-13"><a href="#__codelineno-6-13" id="__codelineno-6-13" name="__codelineno-6-13"></a>    <span class="n">enable_httpx_instrumentation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-6-14"><a href="#__codelineno-6-14" id="__codelineno-6-14" name="__codelineno-6-14"></a>    <span class="n">enable_logging_instrumentation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-6-15"><a href="#__codelineno-6-15" id="__codelineno-6-15" name="__codelineno-6-15"></a>    <span class="n">enable_system_metrics</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-6-16"><a href="#__codelineno-6-16" id="__codelineno-6-16" name="__codelineno-6-16"></a>
</span><span id="__span-6-17"><a href="#__codelineno-6-17" id="__codelineno-6-17" name="__codelineno-6-17"></a>    <span class="c1"># Performance tuning</span>
</span><span id="__span-6-18"><a href="#__codelineno-6-18" id="__codelineno-6-18" name="__codelineno-6-18"></a>    <span class="n">batch_span_processor_max_queue_size</span><span class="o">=</span><span class="mi">2048</span><span class="p">,</span>
</span><span id="__span-6-19"><a href="#__codelineno-6-19" id="__codelineno-6-19" name="__codelineno-6-19"></a>    <span class="n">batch_span_processor_schedule_delay_millis</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span>
</span><span id="__span-6-20"><a href="#__codelineno-6-20" id="__codelineno-6-20" name="__codelineno-6-20"></a>    <span class="n">metric_export_interval_millis</span><span class="o">=</span><span class="mi">60000</span>  <span class="c1"># 1 minute</span>
</span><span id="__span-6-21"><a href="#__codelineno-6-21" id="__codelineno-6-21" name="__codelineno-6-21"></a><span class="p">)</span>
</span></code></pre></div>
<h2 id="infrastructure-setup">üîß Infrastructure Setup<a class="headerlink" href="#infrastructure-setup" title="Permanent link">¬∂</a></h2>
<p>Before instrumenting your code, you need to provision the observability stack. This section guides you through setting up the complete infrastructure.</p>
<h3 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permanent link">¬∂</a></h3>
<ul>
<li>Docker and Docker Compose installed</li>
<li>8GB RAM minimum (12GB recommended)</li>
<li>Ports available: 3000, 3100, 3200, 4317, 4318, 8888, 9090, 9095</li>
</ul>
<h3 id="option-1-using-docker-compose-recommended">Option 1: Using Docker Compose (Recommended)<a class="headerlink" href="#option-1-using-docker-compose-recommended" title="Permanent link">¬∂</a></h3>
<p>The Neuroglia framework provides a complete docker-compose configuration:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-7-1"><a href="#__codelineno-7-1" id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="c1"># deployment/docker-compose/docker-compose.shared.yml</span>
</span><span id="__span-7-2"><a href="#__codelineno-7-2" id="__codelineno-7-2" name="__codelineno-7-2"></a><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">"3.8"</span>
</span><span id="__span-7-3"><a href="#__codelineno-7-3" id="__codelineno-7-3" name="__codelineno-7-3"></a>
</span><span id="__span-7-4"><a href="#__codelineno-7-4" id="__codelineno-7-4" name="__codelineno-7-4"></a><span class="nt">services</span><span class="p">:</span>
</span><span id="__span-7-5"><a href="#__codelineno-7-5" id="__codelineno-7-5" name="__codelineno-7-5"></a><span class="w">  </span><span class="c1"># OpenTelemetry Collector - Central hub for telemetry</span>
</span><span id="__span-7-6"><a href="#__codelineno-7-6" id="__codelineno-7-6" name="__codelineno-7-6"></a><span class="w">  </span><span class="nt">otel-collector</span><span class="p">:</span>
</span><span id="__span-7-7"><a href="#__codelineno-7-7" id="__codelineno-7-7" name="__codelineno-7-7"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">otel/opentelemetry-collector-contrib:latest</span>
</span><span id="__span-7-8"><a href="#__codelineno-7-8" id="__codelineno-7-8" name="__codelineno-7-8"></a><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">otel-collector</span>
</span><span id="__span-7-9"><a href="#__codelineno-7-9" id="__codelineno-7-9" name="__codelineno-7-9"></a><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">"--config=/etc/otel-collector-config.yaml"</span><span class="p p-Indicator">]</span>
</span><span id="__span-7-10"><a href="#__codelineno-7-10" id="__codelineno-7-10" name="__codelineno-7-10"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-7-11"><a href="#__codelineno-7-11" id="__codelineno-7-11" name="__codelineno-7-11"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">../otel/otel-collector-config.yaml:/etc/otel-collector-config.yaml</span>
</span><span id="__span-7-12"><a href="#__codelineno-7-12" id="__codelineno-7-12" name="__codelineno-7-12"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-7-13"><a href="#__codelineno-7-13" id="__codelineno-7-13" name="__codelineno-7-13"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">"4317:4317"</span><span class="w"> </span><span class="c1"># OTLP gRPC receiver</span>
</span><span id="__span-7-14"><a href="#__codelineno-7-14" id="__codelineno-7-14" name="__codelineno-7-14"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">"4318:4318"</span><span class="w"> </span><span class="c1"># OTLP HTTP receiver</span>
</span><span id="__span-7-15"><a href="#__codelineno-7-15" id="__codelineno-7-15" name="__codelineno-7-15"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">"8888:8888"</span><span class="w"> </span><span class="c1"># Prometheus metrics about collector</span>
</span><span id="__span-7-16"><a href="#__codelineno-7-16" id="__codelineno-7-16" name="__codelineno-7-16"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">"13133:13133"</span><span class="w"> </span><span class="c1"># Health check endpoint</span>
</span><span id="__span-7-17"><a href="#__codelineno-7-17" id="__codelineno-7-17" name="__codelineno-7-17"></a><span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
</span><span id="__span-7-18"><a href="#__codelineno-7-18" id="__codelineno-7-18" name="__codelineno-7-18"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">observability</span>
</span><span id="__span-7-19"><a href="#__codelineno-7-19" id="__codelineno-7-19" name="__codelineno-7-19"></a>
</span><span id="__span-7-20"><a href="#__codelineno-7-20" id="__codelineno-7-20" name="__codelineno-7-20"></a><span class="w">  </span><span class="c1"># Tempo - Distributed tracing backend</span>
</span><span id="__span-7-21"><a href="#__codelineno-7-21" id="__codelineno-7-21" name="__codelineno-7-21"></a><span class="w">  </span><span class="nt">tempo</span><span class="p">:</span>
</span><span id="__span-7-22"><a href="#__codelineno-7-22" id="__codelineno-7-22" name="__codelineno-7-22"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">grafana/tempo:latest</span>
</span><span id="__span-7-23"><a href="#__codelineno-7-23" id="__codelineno-7-23" name="__codelineno-7-23"></a><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tempo</span>
</span><span id="__span-7-24"><a href="#__codelineno-7-24" id="__codelineno-7-24" name="__codelineno-7-24"></a><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">"-config.file=/etc/tempo.yaml"</span><span class="p p-Indicator">]</span>
</span><span id="__span-7-25"><a href="#__codelineno-7-25" id="__codelineno-7-25" name="__codelineno-7-25"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-7-26"><a href="#__codelineno-7-26" id="__codelineno-7-26" name="__codelineno-7-26"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">../tempo/tempo.yaml:/etc/tempo.yaml</span>
</span><span id="__span-7-27"><a href="#__codelineno-7-27" id="__codelineno-7-27" name="__codelineno-7-27"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tempo-data:/tmp/tempo</span>
</span><span id="__span-7-28"><a href="#__codelineno-7-28" id="__codelineno-7-28" name="__codelineno-7-28"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-7-29"><a href="#__codelineno-7-29" id="__codelineno-7-29" name="__codelineno-7-29"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">"3200:3200"</span><span class="w"> </span><span class="c1"># Tempo HTTP API</span>
</span><span id="__span-7-30"><a href="#__codelineno-7-30" id="__codelineno-7-30" name="__codelineno-7-30"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">"9095:9095"</span><span class="w"> </span><span class="c1"># Tempo gRPC API</span>
</span><span id="__span-7-31"><a href="#__codelineno-7-31" id="__codelineno-7-31" name="__codelineno-7-31"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">"4317"</span><span class="w"> </span><span class="c1"># OTLP gRPC receiver</span>
</span><span id="__span-7-32"><a href="#__codelineno-7-32" id="__codelineno-7-32" name="__codelineno-7-32"></a><span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
</span><span id="__span-7-33"><a href="#__codelineno-7-33" id="__codelineno-7-33" name="__codelineno-7-33"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">observability</span>
</span><span id="__span-7-34"><a href="#__codelineno-7-34" id="__codelineno-7-34" name="__codelineno-7-34"></a>
</span><span id="__span-7-35"><a href="#__codelineno-7-35" id="__codelineno-7-35" name="__codelineno-7-35"></a><span class="w">  </span><span class="c1"># Prometheus - Metrics storage and querying</span>
</span><span id="__span-7-36"><a href="#__codelineno-7-36" id="__codelineno-7-36" name="__codelineno-7-36"></a><span class="w">  </span><span class="nt">prometheus</span><span class="p">:</span>
</span><span id="__span-7-37"><a href="#__codelineno-7-37" id="__codelineno-7-37" name="__codelineno-7-37"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prom/prometheus:latest</span>
</span><span id="__span-7-38"><a href="#__codelineno-7-38" id="__codelineno-7-38" name="__codelineno-7-38"></a><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prometheus</span>
</span><span id="__span-7-39"><a href="#__codelineno-7-39" id="__codelineno-7-39" name="__codelineno-7-39"></a><span class="w">    </span><span class="nt">command</span><span class="p">:</span>
</span><span id="__span-7-40"><a href="#__codelineno-7-40" id="__codelineno-7-40" name="__codelineno-7-40"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">"--config.file=/etc/prometheus/prometheus.yml"</span>
</span><span id="__span-7-41"><a href="#__codelineno-7-41" id="__codelineno-7-41" name="__codelineno-7-41"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">"--storage.tsdb.path=/prometheus"</span>
</span><span id="__span-7-42"><a href="#__codelineno-7-42" id="__codelineno-7-42" name="__codelineno-7-42"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">"--web.console.libraries=/etc/prometheus/console_libraries"</span>
</span><span id="__span-7-43"><a href="#__codelineno-7-43" id="__codelineno-7-43" name="__codelineno-7-43"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">"--web.console.templates=/etc/prometheus/consoles"</span>
</span><span id="__span-7-44"><a href="#__codelineno-7-44" id="__codelineno-7-44" name="__codelineno-7-44"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">"--enable-feature=exemplar-storage"</span><span class="w"> </span><span class="c1"># Link metrics to traces</span>
</span><span id="__span-7-45"><a href="#__codelineno-7-45" id="__codelineno-7-45" name="__codelineno-7-45"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-7-46"><a href="#__codelineno-7-46" id="__codelineno-7-46" name="__codelineno-7-46"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">../prometheus/prometheus.yml:/etc/prometheus/prometheus.yml</span>
</span><span id="__span-7-47"><a href="#__codelineno-7-47" id="__codelineno-7-47" name="__codelineno-7-47"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prometheus-data:/prometheus</span>
</span><span id="__span-7-48"><a href="#__codelineno-7-48" id="__codelineno-7-48" name="__codelineno-7-48"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-7-49"><a href="#__codelineno-7-49" id="__codelineno-7-49" name="__codelineno-7-49"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">"9090:9090"</span>
</span><span id="__span-7-50"><a href="#__codelineno-7-50" id="__codelineno-7-50" name="__codelineno-7-50"></a><span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
</span><span id="__span-7-51"><a href="#__codelineno-7-51" id="__codelineno-7-51" name="__codelineno-7-51"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">observability</span>
</span><span id="__span-7-52"><a href="#__codelineno-7-52" id="__codelineno-7-52" name="__codelineno-7-52"></a>
</span><span id="__span-7-53"><a href="#__codelineno-7-53" id="__codelineno-7-53" name="__codelineno-7-53"></a><span class="w">  </span><span class="c1"># Loki - Log aggregation system</span>
</span><span id="__span-7-54"><a href="#__codelineno-7-54" id="__codelineno-7-54" name="__codelineno-7-54"></a><span class="w">  </span><span class="nt">loki</span><span class="p">:</span>
</span><span id="__span-7-55"><a href="#__codelineno-7-55" id="__codelineno-7-55" name="__codelineno-7-55"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">grafana/loki:latest</span>
</span><span id="__span-7-56"><a href="#__codelineno-7-56" id="__codelineno-7-56" name="__codelineno-7-56"></a><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">loki</span>
</span><span id="__span-7-57"><a href="#__codelineno-7-57" id="__codelineno-7-57" name="__codelineno-7-57"></a><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-config.file=/etc/loki/loki-config.yaml</span>
</span><span id="__span-7-58"><a href="#__codelineno-7-58" id="__codelineno-7-58" name="__codelineno-7-58"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-7-59"><a href="#__codelineno-7-59" id="__codelineno-7-59" name="__codelineno-7-59"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">../loki/loki-config.yaml:/etc/loki/loki-config.yaml</span>
</span><span id="__span-7-60"><a href="#__codelineno-7-60" id="__codelineno-7-60" name="__codelineno-7-60"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">loki-data:/loki</span>
</span><span id="__span-7-61"><a href="#__codelineno-7-61" id="__codelineno-7-61" name="__codelineno-7-61"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-7-62"><a href="#__codelineno-7-62" id="__codelineno-7-62" name="__codelineno-7-62"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">"3100:3100"</span>
</span><span id="__span-7-63"><a href="#__codelineno-7-63" id="__codelineno-7-63" name="__codelineno-7-63"></a><span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
</span><span id="__span-7-64"><a href="#__codelineno-7-64" id="__codelineno-7-64" name="__codelineno-7-64"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">observability</span>
</span><span id="__span-7-65"><a href="#__codelineno-7-65" id="__codelineno-7-65" name="__codelineno-7-65"></a>
</span><span id="__span-7-66"><a href="#__codelineno-7-66" id="__codelineno-7-66" name="__codelineno-7-66"></a><span class="w">  </span><span class="c1"># Grafana - Visualization and dashboards</span>
</span><span id="__span-7-67"><a href="#__codelineno-7-67" id="__codelineno-7-67" name="__codelineno-7-67"></a><span class="w">  </span><span class="nt">grafana</span><span class="p">:</span>
</span><span id="__span-7-68"><a href="#__codelineno-7-68" id="__codelineno-7-68" name="__codelineno-7-68"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">grafana/grafana:latest</span>
</span><span id="__span-7-69"><a href="#__codelineno-7-69" id="__codelineno-7-69" name="__codelineno-7-69"></a><span class="w">    </span><span class="nt">container_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">grafana</span>
</span><span id="__span-7-70"><a href="#__codelineno-7-70" id="__codelineno-7-70" name="__codelineno-7-70"></a><span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
</span><span id="__span-7-71"><a href="#__codelineno-7-71" id="__codelineno-7-71" name="__codelineno-7-71"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">GF_AUTH_ANONYMOUS_ENABLED=true</span>
</span><span id="__span-7-72"><a href="#__codelineno-7-72" id="__codelineno-7-72" name="__codelineno-7-72"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">GF_AUTH_ANONYMOUS_ORG_ROLE=Admin</span>
</span><span id="__span-7-73"><a href="#__codelineno-7-73" id="__codelineno-7-73" name="__codelineno-7-73"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">GF_FEATURE_TOGGLES_ENABLE=traceqlEditor</span>
</span><span id="__span-7-74"><a href="#__codelineno-7-74" id="__codelineno-7-74" name="__codelineno-7-74"></a><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-7-75"><a href="#__codelineno-7-75" id="__codelineno-7-75" name="__codelineno-7-75"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">../grafana/datasources:/etc/grafana/provisioning/datasources</span>
</span><span id="__span-7-76"><a href="#__codelineno-7-76" id="__codelineno-7-76" name="__codelineno-7-76"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">../grafana/dashboards:/etc/grafana/provisioning/dashboards</span>
</span><span id="__span-7-77"><a href="#__codelineno-7-77" id="__codelineno-7-77" name="__codelineno-7-77"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">grafana-data:/var/lib/grafana</span>
</span><span id="__span-7-78"><a href="#__codelineno-7-78" id="__codelineno-7-78" name="__codelineno-7-78"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-7-79"><a href="#__codelineno-7-79" id="__codelineno-7-79" name="__codelineno-7-79"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">"3000:3000"</span>
</span><span id="__span-7-80"><a href="#__codelineno-7-80" id="__codelineno-7-80" name="__codelineno-7-80"></a><span class="w">    </span><span class="nt">networks</span><span class="p">:</span>
</span><span id="__span-7-81"><a href="#__codelineno-7-81" id="__codelineno-7-81" name="__codelineno-7-81"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">observability</span>
</span><span id="__span-7-82"><a href="#__codelineno-7-82" id="__codelineno-7-82" name="__codelineno-7-82"></a><span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span>
</span><span id="__span-7-83"><a href="#__codelineno-7-83" id="__codelineno-7-83" name="__codelineno-7-83"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tempo</span>
</span><span id="__span-7-84"><a href="#__codelineno-7-84" id="__codelineno-7-84" name="__codelineno-7-84"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prometheus</span>
</span><span id="__span-7-85"><a href="#__codelineno-7-85" id="__codelineno-7-85" name="__codelineno-7-85"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">loki</span>
</span><span id="__span-7-86"><a href="#__codelineno-7-86" id="__codelineno-7-86" name="__codelineno-7-86"></a>
</span><span id="__span-7-87"><a href="#__codelineno-7-87" id="__codelineno-7-87" name="__codelineno-7-87"></a><span class="nt">networks</span><span class="p">:</span>
</span><span id="__span-7-88"><a href="#__codelineno-7-88" id="__codelineno-7-88" name="__codelineno-7-88"></a><span class="w">  </span><span class="nt">observability</span><span class="p">:</span>
</span><span id="__span-7-89"><a href="#__codelineno-7-89" id="__codelineno-7-89" name="__codelineno-7-89"></a><span class="w">    </span><span class="nt">driver</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">bridge</span>
</span><span id="__span-7-90"><a href="#__codelineno-7-90" id="__codelineno-7-90" name="__codelineno-7-90"></a>
</span><span id="__span-7-91"><a href="#__codelineno-7-91" id="__codelineno-7-91" name="__codelineno-7-91"></a><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-7-92"><a href="#__codelineno-7-92" id="__codelineno-7-92" name="__codelineno-7-92"></a><span class="w">  </span><span class="nt">tempo-data</span><span class="p">:</span>
</span><span id="__span-7-93"><a href="#__codelineno-7-93" id="__codelineno-7-93" name="__codelineno-7-93"></a><span class="w">  </span><span class="nt">prometheus-data</span><span class="p">:</span>
</span><span id="__span-7-94"><a href="#__codelineno-7-94" id="__codelineno-7-94" name="__codelineno-7-94"></a><span class="w">  </span><span class="nt">loki-data</span><span class="p">:</span>
</span><span id="__span-7-95"><a href="#__codelineno-7-95" id="__codelineno-7-95" name="__codelineno-7-95"></a><span class="w">  </span><span class="nt">grafana-data</span><span class="p">:</span>
</span></code></pre></div>
<p><strong>Start the stack</strong>:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a href="#__codelineno-8-1" id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="c1"># From project root</span>
</span><span id="__span-8-2"><a href="#__codelineno-8-2" id="__codelineno-8-2" name="__codelineno-8-2"></a><span class="nb">cd</span><span class="w"> </span>deployment/docker-compose
</span><span id="__span-8-3"><a href="#__codelineno-8-3" id="__codelineno-8-3" name="__codelineno-8-3"></a>docker-compose<span class="w"> </span>-f<span class="w"> </span>docker-compose.shared.yml<span class="w"> </span>up<span class="w"> </span>-d
</span><span id="__span-8-4"><a href="#__codelineno-8-4" id="__codelineno-8-4" name="__codelineno-8-4"></a>
</span><span id="__span-8-5"><a href="#__codelineno-8-5" id="__codelineno-8-5" name="__codelineno-8-5"></a><span class="c1"># Verify all services are running</span>
</span><span id="__span-8-6"><a href="#__codelineno-8-6" id="__codelineno-8-6" name="__codelineno-8-6"></a>docker-compose<span class="w"> </span>-f<span class="w"> </span>docker-compose.shared.yml<span class="w"> </span>ps
</span><span id="__span-8-7"><a href="#__codelineno-8-7" id="__codelineno-8-7" name="__codelineno-8-7"></a>
</span><span id="__span-8-8"><a href="#__codelineno-8-8" id="__codelineno-8-8" name="__codelineno-8-8"></a><span class="c1"># Check logs</span>
</span><span id="__span-8-9"><a href="#__codelineno-8-9" id="__codelineno-8-9" name="__codelineno-8-9"></a>docker-compose<span class="w"> </span>-f<span class="w"> </span>docker-compose.shared.yml<span class="w"> </span>logs<span class="w"> </span>-f<span class="w"> </span>grafana
</span></code></pre></div>
<p><strong>Access the services</strong>:</p>
<ul>
<li>üé® <strong>Grafana</strong>: <a href="http://localhost:3000">http://localhost:3000</a></li>
<li>üìä <strong>Prometheus</strong>: <a href="http://localhost:9090">http://localhost:9090</a></li>
<li>üîç <strong>Tempo</strong>: <a href="http://localhost:3200">http://localhost:3200</a></li>
<li>üìù <strong>Loki</strong>: <a href="http://localhost:3100">http://localhost:3100</a></li>
<li>üîÑ <strong>OTEL Collector</strong>: <a href="http://localhost:8888/metrics">http://localhost:8888/metrics</a></li>
</ul>
<h3 id="option-2-kuberneteshelm-deployment">Option 2: Kubernetes/Helm Deployment<a class="headerlink" href="#option-2-kuberneteshelm-deployment" title="Permanent link">¬∂</a></h3>
<p>For production Kubernetes deployments:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a href="#__codelineno-9-1" id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="c1"># Add Grafana helm repository</span>
</span><span id="__span-9-2"><a href="#__codelineno-9-2" id="__codelineno-9-2" name="__codelineno-9-2"></a>helm<span class="w"> </span>repo<span class="w"> </span>add<span class="w"> </span>grafana<span class="w"> </span>https://grafana.github.io/helm-charts
</span><span id="__span-9-3"><a href="#__codelineno-9-3" id="__codelineno-9-3" name="__codelineno-9-3"></a>helm<span class="w"> </span>repo<span class="w"> </span>update
</span><span id="__span-9-4"><a href="#__codelineno-9-4" id="__codelineno-9-4" name="__codelineno-9-4"></a>
</span><span id="__span-9-5"><a href="#__codelineno-9-5" id="__codelineno-9-5" name="__codelineno-9-5"></a><span class="c1"># Install Grafana stack</span>
</span><span id="__span-9-6"><a href="#__codelineno-9-6" id="__codelineno-9-6" name="__codelineno-9-6"></a>helm<span class="w"> </span>install<span class="w"> </span>observability<span class="w"> </span>grafana/grafana<span class="w"> </span><span class="se">\</span>
</span><span id="__span-9-7"><a href="#__codelineno-9-7" id="__codelineno-9-7" name="__codelineno-9-7"></a><span class="w">  </span>--namespace<span class="w"> </span>observability<span class="w"> </span><span class="se">\</span>
</span><span id="__span-9-8"><a href="#__codelineno-9-8" id="__codelineno-9-8" name="__codelineno-9-8"></a><span class="w">  </span>--create-namespace<span class="w"> </span><span class="se">\</span>
</span><span id="__span-9-9"><a href="#__codelineno-9-9" id="__codelineno-9-9" name="__codelineno-9-9"></a><span class="w">  </span>-f<span class="w"> </span>deployment/helm/values.yaml
</span></code></pre></div>
<h3 id="verify-infrastructure-health">Verify Infrastructure Health<a class="headerlink" href="#verify-infrastructure-health" title="Permanent link">¬∂</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-10-1"><a href="#__codelineno-10-1" id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="c1"># Check OTEL Collector health</span>
</span><span id="__span-10-2"><a href="#__codelineno-10-2" id="__codelineno-10-2" name="__codelineno-10-2"></a>curl<span class="w"> </span>http://localhost:13133
</span><span id="__span-10-3"><a href="#__codelineno-10-3" id="__codelineno-10-3" name="__codelineno-10-3"></a>
</span><span id="__span-10-4"><a href="#__codelineno-10-4" id="__codelineno-10-4" name="__codelineno-10-4"></a><span class="c1"># Check Prometheus targets</span>
</span><span id="__span-10-5"><a href="#__codelineno-10-5" id="__codelineno-10-5" name="__codelineno-10-5"></a>curl<span class="w"> </span>http://localhost:9090/api/v1/targets
</span><span id="__span-10-6"><a href="#__codelineno-10-6" id="__codelineno-10-6" name="__codelineno-10-6"></a>
</span><span id="__span-10-7"><a href="#__codelineno-10-7" id="__codelineno-10-7" name="__codelineno-10-7"></a><span class="c1"># Check Tempo readiness</span>
</span><span id="__span-10-8"><a href="#__codelineno-10-8" id="__codelineno-10-8" name="__codelineno-10-8"></a>curl<span class="w"> </span>http://localhost:3200/ready
</span><span id="__span-10-9"><a href="#__codelineno-10-9" id="__codelineno-10-9" name="__codelineno-10-9"></a>
</span><span id="__span-10-10"><a href="#__codelineno-10-10" id="__codelineno-10-10" name="__codelineno-10-10"></a><span class="c1"># Check Loki readiness</span>
</span><span id="__span-10-11"><a href="#__codelineno-10-11" id="__codelineno-10-11" name="__codelineno-10-11"></a>curl<span class="w"> </span>http://localhost:3100/ready
</span></code></pre></div>
<h3 id="configuration-files">Configuration Files<a class="headerlink" href="#configuration-files" title="Permanent link">¬∂</a></h3>
<h4 id="otel-collector-configuration">OTEL Collector Configuration<a class="headerlink" href="#otel-collector-configuration" title="Permanent link">¬∂</a></h4>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-11-1"><a href="#__codelineno-11-1" id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="c1"># deployment/otel/otel-collector-config.yaml</span>
</span><span id="__span-11-2"><a href="#__codelineno-11-2" id="__codelineno-11-2" name="__codelineno-11-2"></a><span class="nt">receivers</span><span class="p">:</span>
</span><span id="__span-11-3"><a href="#__codelineno-11-3" id="__codelineno-11-3" name="__codelineno-11-3"></a><span class="w">  </span><span class="nt">otlp</span><span class="p">:</span>
</span><span id="__span-11-4"><a href="#__codelineno-11-4" id="__codelineno-11-4" name="__codelineno-11-4"></a><span class="w">    </span><span class="nt">protocols</span><span class="p">:</span>
</span><span id="__span-11-5"><a href="#__codelineno-11-5" id="__codelineno-11-5" name="__codelineno-11-5"></a><span class="w">      </span><span class="nt">grpc</span><span class="p">:</span>
</span><span id="__span-11-6"><a href="#__codelineno-11-6" id="__codelineno-11-6" name="__codelineno-11-6"></a><span class="w">        </span><span class="nt">endpoint</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0.0.0:4317</span>
</span><span id="__span-11-7"><a href="#__codelineno-11-7" id="__codelineno-11-7" name="__codelineno-11-7"></a><span class="w">      </span><span class="nt">http</span><span class="p">:</span>
</span><span id="__span-11-8"><a href="#__codelineno-11-8" id="__codelineno-11-8" name="__codelineno-11-8"></a><span class="w">        </span><span class="nt">endpoint</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0.0.0:4318</span>
</span><span id="__span-11-9"><a href="#__codelineno-11-9" id="__codelineno-11-9" name="__codelineno-11-9"></a>
</span><span id="__span-11-10"><a href="#__codelineno-11-10" id="__codelineno-11-10" name="__codelineno-11-10"></a><span class="nt">processors</span><span class="p">:</span>
</span><span id="__span-11-11"><a href="#__codelineno-11-11" id="__codelineno-11-11" name="__codelineno-11-11"></a><span class="w">  </span><span class="nt">batch</span><span class="p">:</span>
</span><span id="__span-11-12"><a href="#__codelineno-11-12" id="__codelineno-11-12" name="__codelineno-11-12"></a><span class="w">    </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10s</span>
</span><span id="__span-11-13"><a href="#__codelineno-11-13" id="__codelineno-11-13" name="__codelineno-11-13"></a><span class="w">    </span><span class="nt">send_batch_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1024</span>
</span><span id="__span-11-14"><a href="#__codelineno-11-14" id="__codelineno-11-14" name="__codelineno-11-14"></a>
</span><span id="__span-11-15"><a href="#__codelineno-11-15" id="__codelineno-11-15" name="__codelineno-11-15"></a><span class="w">  </span><span class="nt">memory_limiter</span><span class="p">:</span>
</span><span id="__span-11-16"><a href="#__codelineno-11-16" id="__codelineno-11-16" name="__codelineno-11-16"></a><span class="w">    </span><span class="nt">check_interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1s</span>
</span><span id="__span-11-17"><a href="#__codelineno-11-17" id="__codelineno-11-17" name="__codelineno-11-17"></a><span class="w">    </span><span class="nt">limit_mib</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">512</span>
</span><span id="__span-11-18"><a href="#__codelineno-11-18" id="__codelineno-11-18" name="__codelineno-11-18"></a>
</span><span id="__span-11-19"><a href="#__codelineno-11-19" id="__codelineno-11-19" name="__codelineno-11-19"></a><span class="w">  </span><span class="nt">resource</span><span class="p">:</span>
</span><span id="__span-11-20"><a href="#__codelineno-11-20" id="__codelineno-11-20" name="__codelineno-11-20"></a><span class="w">    </span><span class="nt">attributes</span><span class="p">:</span>
</span><span id="__span-11-21"><a href="#__codelineno-11-21" id="__codelineno-11-21" name="__codelineno-11-21"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deployment.environment</span>
</span><span id="__span-11-22"><a href="#__codelineno-11-22" id="__codelineno-11-22" name="__codelineno-11-22"></a><span class="w">        </span><span class="nt">from_attribute</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">environment</span>
</span><span id="__span-11-23"><a href="#__codelineno-11-23" id="__codelineno-11-23" name="__codelineno-11-23"></a><span class="w">        </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">upsert</span>
</span><span id="__span-11-24"><a href="#__codelineno-11-24" id="__codelineno-11-24" name="__codelineno-11-24"></a>
</span><span id="__span-11-25"><a href="#__codelineno-11-25" id="__codelineno-11-25" name="__codelineno-11-25"></a><span class="nt">exporters</span><span class="p">:</span>
</span><span id="__span-11-26"><a href="#__codelineno-11-26" id="__codelineno-11-26" name="__codelineno-11-26"></a><span class="w">  </span><span class="c1"># Traces to Tempo</span>
</span><span id="__span-11-27"><a href="#__codelineno-11-27" id="__codelineno-11-27" name="__codelineno-11-27"></a><span class="w">  </span><span class="nt">otlp/tempo</span><span class="p">:</span>
</span><span id="__span-11-28"><a href="#__codelineno-11-28" id="__codelineno-11-28" name="__codelineno-11-28"></a><span class="w">    </span><span class="nt">endpoint</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tempo:4317</span>
</span><span id="__span-11-29"><a href="#__codelineno-11-29" id="__codelineno-11-29" name="__codelineno-11-29"></a><span class="w">    </span><span class="nt">tls</span><span class="p">:</span>
</span><span id="__span-11-30"><a href="#__codelineno-11-30" id="__codelineno-11-30" name="__codelineno-11-30"></a><span class="w">      </span><span class="nt">insecure</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-11-31"><a href="#__codelineno-11-31" id="__codelineno-11-31" name="__codelineno-11-31"></a>
</span><span id="__span-11-32"><a href="#__codelineno-11-32" id="__codelineno-11-32" name="__codelineno-11-32"></a><span class="w">  </span><span class="c1"># Metrics to Prometheus</span>
</span><span id="__span-11-33"><a href="#__codelineno-11-33" id="__codelineno-11-33" name="__codelineno-11-33"></a><span class="w">  </span><span class="nt">prometheus</span><span class="p">:</span>
</span><span id="__span-11-34"><a href="#__codelineno-11-34" id="__codelineno-11-34" name="__codelineno-11-34"></a><span class="w">    </span><span class="nt">endpoint</span><span class="p">:</span><span class="w"> </span><span class="s">"0.0.0.0:8889"</span>
</span><span id="__span-11-35"><a href="#__codelineno-11-35" id="__codelineno-11-35" name="__codelineno-11-35"></a><span class="w">    </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">neuroglia</span>
</span><span id="__span-11-36"><a href="#__codelineno-11-36" id="__codelineno-11-36" name="__codelineno-11-36"></a>
</span><span id="__span-11-37"><a href="#__codelineno-11-37" id="__codelineno-11-37" name="__codelineno-11-37"></a><span class="w">  </span><span class="c1"># Logs to Loki</span>
</span><span id="__span-11-38"><a href="#__codelineno-11-38" id="__codelineno-11-38" name="__codelineno-11-38"></a><span class="w">  </span><span class="nt">loki</span><span class="p">:</span>
</span><span id="__span-11-39"><a href="#__codelineno-11-39" id="__codelineno-11-39" name="__codelineno-11-39"></a><span class="w">    </span><span class="nt">endpoint</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://loki:3100/loki/api/v1/push</span>
</span><span id="__span-11-40"><a href="#__codelineno-11-40" id="__codelineno-11-40" name="__codelineno-11-40"></a>
</span><span id="__span-11-41"><a href="#__codelineno-11-41" id="__codelineno-11-41" name="__codelineno-11-41"></a><span class="w">  </span><span class="c1"># Console for debugging</span>
</span><span id="__span-11-42"><a href="#__codelineno-11-42" id="__codelineno-11-42" name="__codelineno-11-42"></a><span class="w">  </span><span class="nt">logging</span><span class="p">:</span>
</span><span id="__span-11-43"><a href="#__codelineno-11-43" id="__codelineno-11-43" name="__codelineno-11-43"></a><span class="w">    </span><span class="nt">loglevel</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">debug</span>
</span><span id="__span-11-44"><a href="#__codelineno-11-44" id="__codelineno-11-44" name="__codelineno-11-44"></a>
</span><span id="__span-11-45"><a href="#__codelineno-11-45" id="__codelineno-11-45" name="__codelineno-11-45"></a><span class="nt">service</span><span class="p">:</span>
</span><span id="__span-11-46"><a href="#__codelineno-11-46" id="__codelineno-11-46" name="__codelineno-11-46"></a><span class="w">  </span><span class="nt">pipelines</span><span class="p">:</span>
</span><span id="__span-11-47"><a href="#__codelineno-11-47" id="__codelineno-11-47" name="__codelineno-11-47"></a><span class="w">    </span><span class="nt">traces</span><span class="p">:</span>
</span><span id="__span-11-48"><a href="#__codelineno-11-48" id="__codelineno-11-48" name="__codelineno-11-48"></a><span class="w">      </span><span class="nt">receivers</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">otlp</span><span class="p p-Indicator">]</span>
</span><span id="__span-11-49"><a href="#__codelineno-11-49" id="__codelineno-11-49" name="__codelineno-11-49"></a><span class="w">      </span><span class="nt">processors</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">memory_limiter</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">batch</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">resource</span><span class="p p-Indicator">]</span>
</span><span id="__span-11-50"><a href="#__codelineno-11-50" id="__codelineno-11-50" name="__codelineno-11-50"></a><span class="w">      </span><span class="nt">exporters</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">otlp/tempo</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">logging</span><span class="p p-Indicator">]</span>
</span><span id="__span-11-51"><a href="#__codelineno-11-51" id="__codelineno-11-51" name="__codelineno-11-51"></a>
</span><span id="__span-11-52"><a href="#__codelineno-11-52" id="__codelineno-11-52" name="__codelineno-11-52"></a><span class="w">    </span><span class="nt">metrics</span><span class="p">:</span>
</span><span id="__span-11-53"><a href="#__codelineno-11-53" id="__codelineno-11-53" name="__codelineno-11-53"></a><span class="w">      </span><span class="nt">receivers</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">otlp</span><span class="p p-Indicator">]</span>
</span><span id="__span-11-54"><a href="#__codelineno-11-54" id="__codelineno-11-54" name="__codelineno-11-54"></a><span class="w">      </span><span class="nt">processors</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">memory_limiter</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">batch</span><span class="p p-Indicator">]</span>
</span><span id="__span-11-55"><a href="#__codelineno-11-55" id="__codelineno-11-55" name="__codelineno-11-55"></a><span class="w">      </span><span class="nt">exporters</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">prometheus</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">logging</span><span class="p p-Indicator">]</span>
</span><span id="__span-11-56"><a href="#__codelineno-11-56" id="__codelineno-11-56" name="__codelineno-11-56"></a>
</span><span id="__span-11-57"><a href="#__codelineno-11-57" id="__codelineno-11-57" name="__codelineno-11-57"></a><span class="w">    </span><span class="nt">logs</span><span class="p">:</span>
</span><span id="__span-11-58"><a href="#__codelineno-11-58" id="__codelineno-11-58" name="__codelineno-11-58"></a><span class="w">      </span><span class="nt">receivers</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">otlp</span><span class="p p-Indicator">]</span>
</span><span id="__span-11-59"><a href="#__codelineno-11-59" id="__codelineno-11-59" name="__codelineno-11-59"></a><span class="w">      </span><span class="nt">processors</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">memory_limiter</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">batch</span><span class="p p-Indicator">]</span>
</span><span id="__span-11-60"><a href="#__codelineno-11-60" id="__codelineno-11-60" name="__codelineno-11-60"></a><span class="w">      </span><span class="nt">exporters</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">loki</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">logging</span><span class="p p-Indicator">]</span>
</span></code></pre></div>
<h4 id="grafana-data-sources">Grafana Data Sources<a class="headerlink" href="#grafana-data-sources" title="Permanent link">¬∂</a></h4>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-12-1"><a href="#__codelineno-12-1" id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="c1"># deployment/grafana/datasources/datasources.yml</span>
</span><span id="__span-12-2"><a href="#__codelineno-12-2" id="__codelineno-12-2" name="__codelineno-12-2"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
</span><span id="__span-12-3"><a href="#__codelineno-12-3" id="__codelineno-12-3" name="__codelineno-12-3"></a>
</span><span id="__span-12-4"><a href="#__codelineno-12-4" id="__codelineno-12-4" name="__codelineno-12-4"></a><span class="nt">datasources</span><span class="p">:</span>
</span><span id="__span-12-5"><a href="#__codelineno-12-5" id="__codelineno-12-5" name="__codelineno-12-5"></a><span class="w">  </span><span class="c1"># Prometheus for metrics</span>
</span><span id="__span-12-6"><a href="#__codelineno-12-6" id="__codelineno-12-6" name="__codelineno-12-6"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Prometheus</span>
</span><span id="__span-12-7"><a href="#__codelineno-12-7" id="__codelineno-12-7" name="__codelineno-12-7"></a><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prometheus</span>
</span><span id="__span-12-8"><a href="#__codelineno-12-8" id="__codelineno-12-8" name="__codelineno-12-8"></a><span class="w">    </span><span class="nt">access</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">proxy</span>
</span><span id="__span-12-9"><a href="#__codelineno-12-9" id="__codelineno-12-9" name="__codelineno-12-9"></a><span class="w">    </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://prometheus:9090</span>
</span><span id="__span-12-10"><a href="#__codelineno-12-10" id="__codelineno-12-10" name="__codelineno-12-10"></a><span class="w">    </span><span class="nt">isDefault</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-12-11"><a href="#__codelineno-12-11" id="__codelineno-12-11" name="__codelineno-12-11"></a><span class="w">    </span><span class="nt">jsonData</span><span class="p">:</span>
</span><span id="__span-12-12"><a href="#__codelineno-12-12" id="__codelineno-12-12" name="__codelineno-12-12"></a><span class="w">      </span><span class="nt">timeInterval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">15s</span>
</span><span id="__span-12-13"><a href="#__codelineno-12-13" id="__codelineno-12-13" name="__codelineno-12-13"></a><span class="w">      </span><span class="nt">exemplarTraceIdDestinations</span><span class="p">:</span>
</span><span id="__span-12-14"><a href="#__codelineno-12-14" id="__codelineno-12-14" name="__codelineno-12-14"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">trace_id</span>
</span><span id="__span-12-15"><a href="#__codelineno-12-15" id="__codelineno-12-15" name="__codelineno-12-15"></a><span class="w">          </span><span class="nt">datasourceUid</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tempo</span>
</span><span id="__span-12-16"><a href="#__codelineno-12-16" id="__codelineno-12-16" name="__codelineno-12-16"></a>
</span><span id="__span-12-17"><a href="#__codelineno-12-17" id="__codelineno-12-17" name="__codelineno-12-17"></a><span class="w">  </span><span class="c1"># Tempo for traces</span>
</span><span id="__span-12-18"><a href="#__codelineno-12-18" id="__codelineno-12-18" name="__codelineno-12-18"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Tempo</span>
</span><span id="__span-12-19"><a href="#__codelineno-12-19" id="__codelineno-12-19" name="__codelineno-12-19"></a><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tempo</span>
</span><span id="__span-12-20"><a href="#__codelineno-12-20" id="__codelineno-12-20" name="__codelineno-12-20"></a><span class="w">    </span><span class="nt">access</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">proxy</span>
</span><span id="__span-12-21"><a href="#__codelineno-12-21" id="__codelineno-12-21" name="__codelineno-12-21"></a><span class="w">    </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://tempo:3200</span>
</span><span id="__span-12-22"><a href="#__codelineno-12-22" id="__codelineno-12-22" name="__codelineno-12-22"></a><span class="w">    </span><span class="nt">uid</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tempo</span>
</span><span id="__span-12-23"><a href="#__codelineno-12-23" id="__codelineno-12-23" name="__codelineno-12-23"></a><span class="w">    </span><span class="nt">jsonData</span><span class="p">:</span>
</span><span id="__span-12-24"><a href="#__codelineno-12-24" id="__codelineno-12-24" name="__codelineno-12-24"></a><span class="w">      </span><span class="nt">tracesToLogs</span><span class="p">:</span>
</span><span id="__span-12-25"><a href="#__codelineno-12-25" id="__codelineno-12-25" name="__codelineno-12-25"></a><span class="w">        </span><span class="nt">datasourceUid</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">loki</span>
</span><span id="__span-12-26"><a href="#__codelineno-12-26" id="__codelineno-12-26" name="__codelineno-12-26"></a><span class="w">        </span><span class="nt">filterByTraceID</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-12-27"><a href="#__codelineno-12-27" id="__codelineno-12-27" name="__codelineno-12-27"></a><span class="w">        </span><span class="nt">filterBySpanID</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-12-28"><a href="#__codelineno-12-28" id="__codelineno-12-28" name="__codelineno-12-28"></a><span class="w">      </span><span class="nt">serviceMap</span><span class="p">:</span>
</span><span id="__span-12-29"><a href="#__codelineno-12-29" id="__codelineno-12-29" name="__codelineno-12-29"></a><span class="w">        </span><span class="nt">datasourceUid</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prometheus</span>
</span><span id="__span-12-30"><a href="#__codelineno-12-30" id="__codelineno-12-30" name="__codelineno-12-30"></a>
</span><span id="__span-12-31"><a href="#__codelineno-12-31" id="__codelineno-12-31" name="__codelineno-12-31"></a><span class="w">  </span><span class="c1"># Loki for logs</span>
</span><span id="__span-12-32"><a href="#__codelineno-12-32" id="__codelineno-12-32" name="__codelineno-12-32"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Loki</span>
</span><span id="__span-12-33"><a href="#__codelineno-12-33" id="__codelineno-12-33" name="__codelineno-12-33"></a><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">loki</span>
</span><span id="__span-12-34"><a href="#__codelineno-12-34" id="__codelineno-12-34" name="__codelineno-12-34"></a><span class="w">    </span><span class="nt">access</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">proxy</span>
</span><span id="__span-12-35"><a href="#__codelineno-12-35" id="__codelineno-12-35" name="__codelineno-12-35"></a><span class="w">    </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">http://loki:3100</span>
</span><span id="__span-12-36"><a href="#__codelineno-12-36" id="__codelineno-12-36" name="__codelineno-12-36"></a><span class="w">    </span><span class="nt">uid</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">loki</span>
</span><span id="__span-12-37"><a href="#__codelineno-12-37" id="__codelineno-12-37" name="__codelineno-12-37"></a><span class="w">    </span><span class="nt">jsonData</span><span class="p">:</span>
</span><span id="__span-12-38"><a href="#__codelineno-12-38" id="__codelineno-12-38" name="__codelineno-12-38"></a><span class="w">      </span><span class="nt">derivedFields</span><span class="p">:</span>
</span><span id="__span-12-39"><a href="#__codelineno-12-39" id="__codelineno-12-39" name="__codelineno-12-39"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">datasourceUid</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tempo</span>
</span><span id="__span-12-40"><a href="#__codelineno-12-40" id="__codelineno-12-40" name="__codelineno-12-40"></a><span class="w">          </span><span class="nt">matcherRegex</span><span class="p">:</span><span class="w"> </span><span class="s">"trace_id=(\\w+)"</span>
</span><span id="__span-12-41"><a href="#__codelineno-12-41" id="__codelineno-12-41" name="__codelineno-12-41"></a><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TraceID</span>
</span><span id="__span-12-42"><a href="#__codelineno-12-42" id="__codelineno-12-42" name="__codelineno-12-42"></a><span class="w">          </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="s">"$${__value.raw}"</span>
</span></code></pre></div>
<h3 id="troubleshooting-infrastructure">Troubleshooting Infrastructure<a class="headerlink" href="#troubleshooting-infrastructure" title="Permanent link">¬∂</a></h3>
<p><strong>Problem</strong>: OTEL Collector not receiving data</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-13-1"><a href="#__codelineno-13-1" id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="c1"># Check collector logs</span>
</span><span id="__span-13-2"><a href="#__codelineno-13-2" id="__codelineno-13-2" name="__codelineno-13-2"></a>docker<span class="w"> </span>logs<span class="w"> </span>otel-collector
</span><span id="__span-13-3"><a href="#__codelineno-13-3" id="__codelineno-13-3" name="__codelineno-13-3"></a>
</span><span id="__span-13-4"><a href="#__codelineno-13-4" id="__codelineno-13-4" name="__codelineno-13-4"></a><span class="c1"># Verify endpoint is accessible from your app</span>
</span><span id="__span-13-5"><a href="#__codelineno-13-5" id="__codelineno-13-5" name="__codelineno-13-5"></a>curl<span class="w"> </span>http://localhost:4317
</span><span id="__span-13-6"><a href="#__codelineno-13-6" id="__codelineno-13-6" name="__codelineno-13-6"></a>
</span><span id="__span-13-7"><a href="#__codelineno-13-7" id="__codelineno-13-7" name="__codelineno-13-7"></a><span class="c1"># Check firewall rules</span>
</span><span id="__span-13-8"><a href="#__codelineno-13-8" id="__codelineno-13-8" name="__codelineno-13-8"></a>netstat<span class="w"> </span>-an<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span><span class="m">4317</span>
</span></code></pre></div>
<p><strong>Problem</strong>: Grafana can't connect to data sources</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-14-1"><a href="#__codelineno-14-1" id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="c1"># Check network connectivity</span>
</span><span id="__span-14-2"><a href="#__codelineno-14-2" id="__codelineno-14-2" name="__codelineno-14-2"></a>docker<span class="w"> </span>network<span class="w"> </span>inspect<span class="w"> </span>observability_observability
</span><span id="__span-14-3"><a href="#__codelineno-14-3" id="__codelineno-14-3" name="__codelineno-14-3"></a>
</span><span id="__span-14-4"><a href="#__codelineno-14-4" id="__codelineno-14-4" name="__codelineno-14-4"></a><span class="c1"># Test Prometheus from Grafana container</span>
</span><span id="__span-14-5"><a href="#__codelineno-14-5" id="__codelineno-14-5" name="__codelineno-14-5"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>grafana<span class="w"> </span>curl<span class="w"> </span>http://prometheus:9090/-/healthy
</span><span id="__span-14-6"><a href="#__codelineno-14-6" id="__codelineno-14-6" name="__codelineno-14-6"></a>
</span><span id="__span-14-7"><a href="#__codelineno-14-7" id="__codelineno-14-7" name="__codelineno-14-7"></a><span class="c1"># Check datasource configuration</span>
</span><span id="__span-14-8"><a href="#__codelineno-14-8" id="__codelineno-14-8" name="__codelineno-14-8"></a>curl<span class="w"> </span>http://localhost:3000/api/datasources
</span></code></pre></div>
<p><strong>Problem</strong>: High memory usage</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-15-1"><a href="#__codelineno-15-1" id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="c1"># Adjust OTEL Collector memory limits</span>
</span><span id="__span-15-2"><a href="#__codelineno-15-2" id="__codelineno-15-2" name="__codelineno-15-2"></a><span class="nt">processors</span><span class="p">:</span>
</span><span id="__span-15-3"><a href="#__codelineno-15-3" id="__codelineno-15-3" name="__codelineno-15-3"></a><span class="w">  </span><span class="nt">memory_limiter</span><span class="p">:</span>
</span><span id="__span-15-4"><a href="#__codelineno-15-4" id="__codelineno-15-4" name="__codelineno-15-4"></a><span class="w">    </span><span class="nt">check_interval</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1s</span>
</span><span id="__span-15-5"><a href="#__codelineno-15-5" id="__codelineno-15-5" name="__codelineno-15-5"></a><span class="w">    </span><span class="nt">limit_mib</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">256</span><span class="w"> </span><span class="c1"># Reduce if needed</span>
</span><span id="__span-15-6"><a href="#__codelineno-15-6" id="__codelineno-15-6" name="__codelineno-15-6"></a><span class="w">    </span><span class="nt">spike_limit_mib</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">64</span>
</span></code></pre></div>
<h2 id="core-components">üèóÔ∏è Core Components<a class="headerlink" href="#core-components" title="Permanent link">¬∂</a></h2>
<h3 id="1-observability-framework-integration">1. Observability Framework Integration<a class="headerlink" href="#1-observability-framework-integration" title="Permanent link">¬∂</a></h3>
<p>The <code>Observability</code> class provides framework-integrated configuration:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-16-1"><a href="#__codelineno-16-1" id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">neuroglia.observability</span><span class="w"> </span><span class="kn">import</span> <span class="n">Observability</span>
</span><span id="__span-16-2"><a href="#__codelineno-16-2" id="__codelineno-16-2" name="__codelineno-16-2"></a>
</span><span id="__span-16-3"><a href="#__codelineno-16-3" id="__codelineno-16-3" name="__codelineno-16-3"></a><span class="c1"># Basic configuration</span>
</span><span id="__span-16-4"><a href="#__codelineno-16-4" id="__codelineno-16-4" name="__codelineno-16-4"></a><span class="n">Observability</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">builder</span><span class="p">)</span>
</span><span id="__span-16-5"><a href="#__codelineno-16-5" id="__codelineno-16-5" name="__codelineno-16-5"></a>
</span><span id="__span-16-6"><a href="#__codelineno-16-6" id="__codelineno-16-6" name="__codelineno-16-6"></a><span class="c1"># With overrides</span>
</span><span id="__span-16-7"><a href="#__codelineno-16-7" id="__codelineno-16-7" name="__codelineno-16-7"></a><span class="n">Observability</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span>
</span><span id="__span-16-8"><a href="#__codelineno-16-8" id="__codelineno-16-8" name="__codelineno-16-8"></a>    <span class="n">builder</span><span class="p">,</span>
</span><span id="__span-16-9"><a href="#__codelineno-16-9" id="__codelineno-16-9" name="__codelineno-16-9"></a>    <span class="n">tracing_enabled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>      <span class="c1"># Override from settings</span>
</span><span id="__span-16-10"><a href="#__codelineno-16-10" id="__codelineno-16-10" name="__codelineno-16-10"></a>    <span class="n">metrics_enabled</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>      <span class="c1"># Override from settings</span>
</span><span id="__span-16-11"><a href="#__codelineno-16-11" id="__codelineno-16-11" name="__codelineno-16-11"></a>    <span class="n">logging_enabled</span><span class="o">=</span><span class="kc">True</span>       <span class="c1"># Override from settings</span>
</span><span id="__span-16-12"><a href="#__codelineno-16-12" id="__codelineno-16-12" name="__codelineno-16-12"></a><span class="p">)</span>
</span></code></pre></div>
<p><strong>Key Features:</strong></p>
<ul>
<li>Reads configuration from <code>app_settings</code> (must inherit from <code>ObservabilitySettingsMixin</code>)</li>
<li>Configures OpenTelemetry SDK based on enabled pillars</li>
<li>Registers <code>/metrics</code> and <code>/health</code> endpoints automatically</li>
<li>Applies tracing middleware to CQRS handlers</li>
</ul>
<h3 id="2-distributed-tracing">2. Distributed Tracing<a class="headerlink" href="#2-distributed-tracing" title="Permanent link">¬∂</a></h3>
<p>Trace requests across service boundaries with automatic span creation:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-17-1"><a href="#__codelineno-17-1" id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">neuroglia.observability</span><span class="w"> </span><span class="kn">import</span> <span class="n">trace_async</span><span class="p">,</span> <span class="n">get_tracer</span><span class="p">,</span> <span class="n">add_span_attributes</span>
</span><span id="__span-17-2"><a href="#__codelineno-17-2" id="__codelineno-17-2" name="__codelineno-17-2"></a>
</span><span id="__span-17-3"><a href="#__codelineno-17-3" id="__codelineno-17-3" name="__codelineno-17-3"></a><span class="c1"># Automatic tracing with decorator</span>
</span><span id="__span-17-4"><a href="#__codelineno-17-4" id="__codelineno-17-4" name="__codelineno-17-4"></a><span class="nd">@trace_async</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"create_order"</span><span class="p">)</span>  <span class="c1"># Custom span name</span>
</span><span id="__span-17-5"><a href="#__codelineno-17-5" id="__codelineno-17-5" name="__codelineno-17-5"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">create_order</span><span class="p">(</span><span class="n">order_data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="__span-17-6"><a href="#__codelineno-17-6" id="__codelineno-17-6" name="__codelineno-17-6"></a>    <span class="c1"># Span automatically created and closed</span>
</span><span id="__span-17-7"><a href="#__codelineno-17-7" id="__codelineno-17-7" name="__codelineno-17-7"></a>
</span><span id="__span-17-8"><a href="#__codelineno-17-8" id="__codelineno-17-8" name="__codelineno-17-8"></a>    <span class="c1"># Add custom attributes</span>
</span><span id="__span-17-9"><a href="#__codelineno-17-9" id="__codelineno-17-9" name="__codelineno-17-9"></a>    <span class="n">add_span_attributes</span><span class="p">({</span>
</span><span id="__span-17-10"><a href="#__codelineno-17-10" id="__codelineno-17-10" name="__codelineno-17-10"></a>        <span class="s2">"order.id"</span><span class="p">:</span> <span class="n">order_data</span><span class="p">[</span><span class="s2">"id"</span><span class="p">],</span>
</span><span id="__span-17-11"><a href="#__codelineno-17-11" id="__codelineno-17-11" name="__codelineno-17-11"></a>        <span class="s2">"order.total"</span><span class="p">:</span> <span class="n">order_data</span><span class="p">[</span><span class="s2">"total"</span><span class="p">],</span>
</span><span id="__span-17-12"><a href="#__codelineno-17-12" id="__codelineno-17-12" name="__codelineno-17-12"></a>        <span class="s2">"customer.type"</span><span class="p">:</span> <span class="s2">"premium"</span>
</span><span id="__span-17-13"><a href="#__codelineno-17-13" id="__codelineno-17-13" name="__codelineno-17-13"></a>    <span class="p">})</span>
</span><span id="__span-17-14"><a href="#__codelineno-17-14" id="__codelineno-17-14" name="__codelineno-17-14"></a>
</span><span id="__span-17-15"><a href="#__codelineno-17-15" id="__codelineno-17-15" name="__codelineno-17-15"></a>    <span class="c1"># Call other services - trace propagates automatically</span>
</span><span id="__span-17-16"><a href="#__codelineno-17-16" id="__codelineno-17-16" name="__codelineno-17-16"></a>    <span class="k">await</span> <span class="n">payment_service</span><span class="o">.</span><span class="n">charge</span><span class="p">(</span><span class="n">order_data</span><span class="p">[</span><span class="s2">"total"</span><span class="p">])</span>
</span><span id="__span-17-17"><a href="#__codelineno-17-17" id="__codelineno-17-17" name="__codelineno-17-17"></a>    <span class="k">await</span> <span class="n">inventory_service</span><span class="o">.</span><span class="n">reserve</span><span class="p">(</span><span class="n">order_data</span><span class="p">[</span><span class="s2">"items"</span><span class="p">])</span>
</span><span id="__span-17-18"><a href="#__codelineno-17-18" id="__codelineno-17-18" name="__codelineno-17-18"></a>
</span><span id="__span-17-19"><a href="#__codelineno-17-19" id="__codelineno-17-19" name="__codelineno-17-19"></a>    <span class="k">return</span> <span class="n">order</span>
</span><span id="__span-17-20"><a href="#__codelineno-17-20" id="__codelineno-17-20" name="__codelineno-17-20"></a>
</span><span id="__span-17-21"><a href="#__codelineno-17-21" id="__codelineno-17-21" name="__codelineno-17-21"></a><span class="c1"># Manual tracing for fine control</span>
</span><span id="__span-17-22"><a href="#__codelineno-17-22" id="__codelineno-17-22" name="__codelineno-17-22"></a><span class="n">tracer</span> <span class="o">=</span> <span class="n">get_tracer</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="__span-17-23"><a href="#__codelineno-17-23" id="__codelineno-17-23" name="__codelineno-17-23"></a>
</span><span id="__span-17-24"><a href="#__codelineno-17-24" id="__codelineno-17-24" name="__codelineno-17-24"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">process_payment</span><span class="p">(</span><span class="n">amount</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="__span-17-25"><a href="#__codelineno-17-25" id="__codelineno-17-25" name="__codelineno-17-25"></a>    <span class="k">with</span> <span class="n">tracer</span><span class="o">.</span><span class="n">start_as_current_span</span><span class="p">(</span><span class="s2">"payment_processing"</span><span class="p">)</span> <span class="k">as</span> <span class="n">span</span><span class="p">:</span>
</span><span id="__span-17-26"><a href="#__codelineno-17-26" id="__codelineno-17-26" name="__codelineno-17-26"></a>        <span class="n">span</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s2">"payment.amount"</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span>
</span><span id="__span-17-27"><a href="#__codelineno-17-27" id="__codelineno-17-27" name="__codelineno-17-27"></a>
</span><span id="__span-17-28"><a href="#__codelineno-17-28" id="__codelineno-17-28" name="__codelineno-17-28"></a>        <span class="c1"># Add events for important moments</span>
</span><span id="__span-17-29"><a href="#__codelineno-17-29" id="__codelineno-17-29" name="__codelineno-17-29"></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">neuroglia.observability</span><span class="w"> </span><span class="kn">import</span> <span class="n">add_span_event</span>
</span><span id="__span-17-30"><a href="#__codelineno-17-30" id="__codelineno-17-30" name="__codelineno-17-30"></a>        <span class="n">add_span_event</span><span class="p">(</span><span class="s2">"payment_validated"</span><span class="p">,</span> <span class="p">{</span>
</span><span id="__span-17-31"><a href="#__codelineno-17-31" id="__codelineno-17-31" name="__codelineno-17-31"></a>            <span class="s2">"validation_result"</span><span class="p">:</span> <span class="s2">"approved"</span>
</span><span id="__span-17-32"><a href="#__codelineno-17-32" id="__codelineno-17-32" name="__codelineno-17-32"></a>        <span class="p">})</span>
</span><span id="__span-17-33"><a href="#__codelineno-17-33" id="__codelineno-17-33" name="__codelineno-17-33"></a>
</span><span id="__span-17-34"><a href="#__codelineno-17-34" id="__codelineno-17-34" name="__codelineno-17-34"></a>        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">payment_gateway</span><span class="o">.</span><span class="n">charge</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span>
</span><span id="__span-17-35"><a href="#__codelineno-17-35" id="__codelineno-17-35" name="__codelineno-17-35"></a>        <span class="n">span</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s2">"payment.transaction_id"</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">transaction_id</span><span class="p">)</span>
</span><span id="__span-17-36"><a href="#__codelineno-17-36" id="__codelineno-17-36" name="__codelineno-17-36"></a>
</span><span id="__span-17-37"><a href="#__codelineno-17-37" id="__codelineno-17-37" name="__codelineno-17-37"></a>        <span class="k">return</span> <span class="n">result</span>
</span></code></pre></div>
<h3 id="3-metrics-collection">3. Metrics Collection<a class="headerlink" href="#3-metrics-collection" title="Permanent link">¬∂</a></h3>
<p>Create and record metrics for monitoring:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-18-1"><a href="#__codelineno-18-1" id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">neuroglia.observability</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_meter</span><span class="p">,</span> <span class="n">create_counter</span><span class="p">,</span> <span class="n">create_histogram</span>
</span><span id="__span-18-2"><a href="#__codelineno-18-2" id="__codelineno-18-2" name="__codelineno-18-2"></a>
</span><span id="__span-18-3"><a href="#__codelineno-18-3" id="__codelineno-18-3" name="__codelineno-18-3"></a><span class="c1"># Get meter for your component</span>
</span><span id="__span-18-4"><a href="#__codelineno-18-4" id="__codelineno-18-4" name="__codelineno-18-4"></a><span class="n">meter</span> <span class="o">=</span> <span class="n">get_meter</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="__span-18-5"><a href="#__codelineno-18-5" id="__codelineno-18-5" name="__codelineno-18-5"></a>
</span><span id="__span-18-6"><a href="#__codelineno-18-6" id="__codelineno-18-6" name="__codelineno-18-6"></a><span class="c1"># Create metrics</span>
</span><span id="__span-18-7"><a href="#__codelineno-18-7" id="__codelineno-18-7" name="__codelineno-18-7"></a><span class="n">order_counter</span> <span class="o">=</span> <span class="n">create_counter</span><span class="p">(</span>
</span><span id="__span-18-8"><a href="#__codelineno-18-8" id="__codelineno-18-8" name="__codelineno-18-8"></a>    <span class="n">meter</span><span class="p">,</span>
</span><span id="__span-18-9"><a href="#__codelineno-18-9" id="__codelineno-18-9" name="__codelineno-18-9"></a>    <span class="n">name</span><span class="o">=</span><span class="s2">"orders_created_total"</span><span class="p">,</span>
</span><span id="__span-18-10"><a href="#__codelineno-18-10" id="__codelineno-18-10" name="__codelineno-18-10"></a>    <span class="n">description</span><span class="o">=</span><span class="s2">"Total number of orders created"</span><span class="p">,</span>
</span><span id="__span-18-11"><a href="#__codelineno-18-11" id="__codelineno-18-11" name="__codelineno-18-11"></a>    <span class="n">unit</span><span class="o">=</span><span class="s2">"orders"</span>
</span><span id="__span-18-12"><a href="#__codelineno-18-12" id="__codelineno-18-12" name="__codelineno-18-12"></a><span class="p">)</span>
</span><span id="__span-18-13"><a href="#__codelineno-18-13" id="__codelineno-18-13" name="__codelineno-18-13"></a>
</span><span id="__span-18-14"><a href="#__codelineno-18-14" id="__codelineno-18-14" name="__codelineno-18-14"></a><span class="n">order_value_histogram</span> <span class="o">=</span> <span class="n">create_histogram</span><span class="p">(</span>
</span><span id="__span-18-15"><a href="#__codelineno-18-15" id="__codelineno-18-15" name="__codelineno-18-15"></a>    <span class="n">meter</span><span class="p">,</span>
</span><span id="__span-18-16"><a href="#__codelineno-18-16" id="__codelineno-18-16" name="__codelineno-18-16"></a>    <span class="n">name</span><span class="o">=</span><span class="s2">"order_value"</span><span class="p">,</span>
</span><span id="__span-18-17"><a href="#__codelineno-18-17" id="__codelineno-18-17" name="__codelineno-18-17"></a>    <span class="n">description</span><span class="o">=</span><span class="s2">"Distribution of order values"</span><span class="p">,</span>
</span><span id="__span-18-18"><a href="#__codelineno-18-18" id="__codelineno-18-18" name="__codelineno-18-18"></a>    <span class="n">unit</span><span class="o">=</span><span class="s2">"USD"</span>
</span><span id="__span-18-19"><a href="#__codelineno-18-19" id="__codelineno-18-19" name="__codelineno-18-19"></a><span class="p">)</span>
</span><span id="__span-18-20"><a href="#__codelineno-18-20" id="__codelineno-18-20" name="__codelineno-18-20"></a>
</span><span id="__span-18-21"><a href="#__codelineno-18-21" id="__codelineno-18-21" name="__codelineno-18-21"></a><span class="c1"># Record metrics</span>
</span><span id="__span-18-22"><a href="#__codelineno-18-22" id="__codelineno-18-22" name="__codelineno-18-22"></a><span class="k">def</span><span class="w"> </span><span class="nf">record_order_created</span><span class="p">(</span><span class="n">order</span><span class="p">:</span> <span class="n">Order</span><span class="p">):</span>
</span><span id="__span-18-23"><a href="#__codelineno-18-23" id="__codelineno-18-23" name="__codelineno-18-23"></a>    <span class="n">order_counter</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">{</span>
</span><span id="__span-18-24"><a href="#__codelineno-18-24" id="__codelineno-18-24" name="__codelineno-18-24"></a>        <span class="s2">"order.type"</span><span class="p">:</span> <span class="n">order</span><span class="o">.</span><span class="n">order_type</span><span class="p">,</span>
</span><span id="__span-18-25"><a href="#__codelineno-18-25" id="__codelineno-18-25" name="__codelineno-18-25"></a>        <span class="s2">"customer.segment"</span><span class="p">:</span> <span class="n">order</span><span class="o">.</span><span class="n">customer_segment</span>
</span><span id="__span-18-26"><a href="#__codelineno-18-26" id="__codelineno-18-26" name="__codelineno-18-26"></a>    <span class="p">})</span>
</span><span id="__span-18-27"><a href="#__codelineno-18-27" id="__codelineno-18-27" name="__codelineno-18-27"></a>
</span><span id="__span-18-28"><a href="#__codelineno-18-28" id="__codelineno-18-28" name="__codelineno-18-28"></a>    <span class="n">order_value_histogram</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="n">order</span><span class="o">.</span><span class="n">total_amount</span><span class="p">,</span> <span class="p">{</span>
</span><span id="__span-18-29"><a href="#__codelineno-18-29" id="__codelineno-18-29" name="__codelineno-18-29"></a>        <span class="s2">"order.type"</span><span class="p">:</span> <span class="n">order</span><span class="o">.</span><span class="n">order_type</span>
</span><span id="__span-18-30"><a href="#__codelineno-18-30" id="__codelineno-18-30" name="__codelineno-18-30"></a>    <span class="p">})</span>
</span></code></pre></div>
<p><strong>Available Metric Types:</strong></p>
<ul>
<li><strong>Counter</strong>: Monotonically increasing value (e.g., total requests)</li>
<li><strong>UpDownCounter</strong>: Can increase or decrease (e.g., active connections)</li>
<li><strong>Histogram</strong>: Distribution of values (e.g., request duration)</li>
<li><strong>ObservableGauge</strong>: Callback-based metric (e.g., queue size)</li>
</ul>
<h3 id="4-structured-logging-with-trace-correlation">4. Structured Logging with Trace Correlation<a class="headerlink" href="#4-structured-logging-with-trace-correlation" title="Permanent link">¬∂</a></h3>
<p>Logs automatically include trace context:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-19-1"><a href="#__codelineno-19-1" id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">neuroglia.observability</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_logger_with_trace_context</span><span class="p">,</span> <span class="n">log_with_trace</span>
</span><span id="__span-19-2"><a href="#__codelineno-19-2" id="__codelineno-19-2" name="__codelineno-19-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
</span><span id="__span-19-3"><a href="#__codelineno-19-3" id="__codelineno-19-3" name="__codelineno-19-3"></a>
</span><span id="__span-19-4"><a href="#__codelineno-19-4" id="__codelineno-19-4" name="__codelineno-19-4"></a><span class="c1"># Get logger with automatic trace correlation</span>
</span><span id="__span-19-5"><a href="#__codelineno-19-5" id="__codelineno-19-5" name="__codelineno-19-5"></a><span class="n">logger</span> <span class="o">=</span> <span class="n">get_logger_with_trace_context</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="__span-19-6"><a href="#__codelineno-19-6" id="__codelineno-19-6" name="__codelineno-19-6"></a>
</span><span id="__span-19-7"><a href="#__codelineno-19-7" id="__codelineno-19-7" name="__codelineno-19-7"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">process_order</span><span class="p">(</span><span class="n">order_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-19-8"><a href="#__codelineno-19-8" id="__codelineno-19-8" name="__codelineno-19-8"></a>    <span class="c1"># Logs automatically include trace_id and span_id</span>
</span><span id="__span-19-9"><a href="#__codelineno-19-9" id="__codelineno-19-9" name="__codelineno-19-9"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Processing order: </span><span class="si">{</span><span class="n">order_id</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="__span-19-10"><a href="#__codelineno-19-10" id="__codelineno-19-10" name="__codelineno-19-10"></a>
</span><span id="__span-19-11"><a href="#__codelineno-19-11" id="__codelineno-19-11" name="__codelineno-19-11"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-19-12"><a href="#__codelineno-19-12" id="__codelineno-19-12" name="__codelineno-19-12"></a>        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">order_service</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">order_id</span><span class="p">)</span>
</span><span id="__span-19-13"><a href="#__codelineno-19-13" id="__codelineno-19-13" name="__codelineno-19-13"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Order processed successfully: </span><span class="si">{</span><span class="n">order_id</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="__span-19-14"><a href="#__codelineno-19-14" id="__codelineno-19-14" name="__codelineno-19-14"></a>        <span class="k">return</span> <span class="n">result</span>
</span><span id="__span-19-15"><a href="#__codelineno-19-15" id="__codelineno-19-15" name="__codelineno-19-15"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-19-16"><a href="#__codelineno-19-16" id="__codelineno-19-16" name="__codelineno-19-16"></a>        <span class="c1"># Exception automatically recorded in current span</span>
</span><span id="__span-19-17"><a href="#__codelineno-19-17" id="__codelineno-19-17" name="__codelineno-19-17"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Order processing failed: </span><span class="si">{</span><span class="n">order_id</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-19-18"><a href="#__codelineno-19-18" id="__codelineno-19-18" name="__codelineno-19-18"></a>
</span><span id="__span-19-19"><a href="#__codelineno-19-19" id="__codelineno-19-19" name="__codelineno-19-19"></a>        <span class="c1"># Record exception in span</span>
</span><span id="__span-19-20"><a href="#__codelineno-19-20" id="__codelineno-19-20" name="__codelineno-19-20"></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">neuroglia.observability</span><span class="w"> </span><span class="kn">import</span> <span class="n">record_exception</span>
</span><span id="__span-19-21"><a href="#__codelineno-19-21" id="__codelineno-19-21" name="__codelineno-19-21"></a>        <span class="n">record_exception</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="__span-19-22"><a href="#__codelineno-19-22" id="__codelineno-19-22" name="__codelineno-19-22"></a>        <span class="k">raise</span>
</span><span id="__span-19-23"><a href="#__codelineno-19-23" id="__codelineno-19-23" name="__codelineno-19-23"></a>
</span><span id="__span-19-24"><a href="#__codelineno-19-24" id="__codelineno-19-24" name="__codelineno-19-24"></a><span class="c1"># Manual trace correlation</span>
</span><span id="__span-19-25"><a href="#__codelineno-19-25" id="__codelineno-19-25" name="__codelineno-19-25"></a><span class="n">log_with_trace</span><span class="p">(</span>
</span><span id="__span-19-26"><a href="#__codelineno-19-26" id="__codelineno-19-26" name="__codelineno-19-26"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">,</span>
</span><span id="__span-19-27"><a href="#__codelineno-19-27" id="__codelineno-19-27" name="__codelineno-19-27"></a>    <span class="s2">"Custom log message"</span><span class="p">,</span>
</span><span id="__span-19-28"><a href="#__codelineno-19-28" id="__codelineno-19-28" name="__codelineno-19-28"></a>    <span class="n">extra_attributes</span><span class="o">=</span><span class="p">{</span><span class="s2">"custom.field"</span><span class="p">:</span> <span class="s2">"value"</span><span class="p">}</span>
</span><span id="__span-19-29"><a href="#__codelineno-19-29" id="__codelineno-19-29" name="__codelineno-19-29"></a><span class="p">)</span>
</span></code></pre></div>
<h2 id="developer-implementation-guide">ÔøΩ‚Äçüíª Developer Implementation Guide<a class="headerlink" href="#developer-implementation-guide" title="Permanent link">¬∂</a></h2>
<p>This section provides layer-by-layer guidance for instrumenting your Neuroglia application.</p>
<h3 id="layer-1-api-layer-controllers">Layer 1: API Layer (Controllers)<a class="headerlink" href="#layer-1-api-layer-controllers" title="Permanent link">¬∂</a></h3>
<p>Controllers are automatically instrumented by FastAPI, but you can add custom attributes:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-20-1"><a href="#__codelineno-20-1" id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">neuroglia.mvc</span><span class="w"> </span><span class="kn">import</span> <span class="n">ControllerBase</span>
</span><span id="__span-20-2"><a href="#__codelineno-20-2" id="__codelineno-20-2" name="__codelineno-20-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">neuroglia.observability</span><span class="w"> </span><span class="kn">import</span> <span class="n">add_span_attributes</span><span class="p">,</span> <span class="n">add_span_event</span>
</span><span id="__span-20-3"><a href="#__codelineno-20-3" id="__codelineno-20-3" name="__codelineno-20-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">classy_fastapi.decorators</span><span class="w"> </span><span class="kn">import</span> <span class="n">post</span>
</span><span id="__span-20-4"><a href="#__codelineno-20-4" id="__codelineno-20-4" name="__codelineno-20-4"></a>
</span><span id="__span-20-5"><a href="#__codelineno-20-5" id="__codelineno-20-5" name="__codelineno-20-5"></a><span class="k">class</span><span class="w"> </span><span class="nc">OrdersController</span><span class="p">(</span><span class="n">ControllerBase</span><span class="p">):</span>
</span><span id="__span-20-6"><a href="#__codelineno-20-6" id="__codelineno-20-6" name="__codelineno-20-6"></a>
</span><span id="__span-20-7"><a href="#__codelineno-20-7" id="__codelineno-20-7" name="__codelineno-20-7"></a>    <span class="nd">@post</span><span class="p">(</span><span class="s2">"/"</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">OrderDto</span><span class="p">,</span> <span class="n">status_code</span><span class="o">=</span><span class="mi">201</span><span class="p">)</span>
</span><span id="__span-20-8"><a href="#__codelineno-20-8" id="__codelineno-20-8" name="__codelineno-20-8"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">create_order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dto</span><span class="p">:</span> <span class="n">CreateOrderDto</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OrderDto</span><span class="p">:</span>
</span><span id="__span-20-9"><a href="#__codelineno-20-9" id="__codelineno-20-9" name="__codelineno-20-9"></a><span class="w">        </span><span class="sd">"""Create order - automatically traced by FastAPI instrumentation"""</span>
</span><span id="__span-20-10"><a href="#__codelineno-20-10" id="__codelineno-20-10" name="__codelineno-20-10"></a>
</span><span id="__span-20-11"><a href="#__codelineno-20-11" id="__codelineno-20-11" name="__codelineno-20-11"></a>        <span class="c1"># Add custom attributes to the current HTTP span</span>
</span><span id="__span-20-12"><a href="#__codelineno-20-12" id="__codelineno-20-12" name="__codelineno-20-12"></a>        <span class="n">add_span_attributes</span><span class="p">({</span>
</span><span id="__span-20-13"><a href="#__codelineno-20-13" id="__codelineno-20-13" name="__codelineno-20-13"></a>            <span class="s2">"order.total_amount"</span><span class="p">:</span> <span class="n">dto</span><span class="o">.</span><span class="n">total_amount</span><span class="p">,</span>
</span><span id="__span-20-14"><a href="#__codelineno-20-14" id="__codelineno-20-14" name="__codelineno-20-14"></a>            <span class="s2">"order.item_count"</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">dto</span><span class="o">.</span><span class="n">items</span><span class="p">),</span>
</span><span id="__span-20-15"><a href="#__codelineno-20-15" id="__codelineno-20-15" name="__codelineno-20-15"></a>            <span class="s2">"customer.type"</span><span class="p">:</span> <span class="n">dto</span><span class="o">.</span><span class="n">customer_type</span><span class="p">,</span>
</span><span id="__span-20-16"><a href="#__codelineno-20-16" id="__codelineno-20-16" name="__codelineno-20-16"></a>            <span class="s2">"http.route.template"</span><span class="p">:</span> <span class="s2">"/api/orders"</span>
</span><span id="__span-20-17"><a href="#__codelineno-20-17" id="__codelineno-20-17" name="__codelineno-20-17"></a>        <span class="p">})</span>
</span><span id="__span-20-18"><a href="#__codelineno-20-18" id="__codelineno-20-18" name="__codelineno-20-18"></a>
</span><span id="__span-20-19"><a href="#__codelineno-20-19" id="__codelineno-20-19" name="__codelineno-20-19"></a>        <span class="c1"># Record important events</span>
</span><span id="__span-20-20"><a href="#__codelineno-20-20" id="__codelineno-20-20" name="__codelineno-20-20"></a>        <span class="n">add_span_event</span><span class="p">(</span><span class="s2">"order_validation_started"</span><span class="p">,</span> <span class="p">{</span>
</span><span id="__span-20-21"><a href="#__codelineno-20-21" id="__codelineno-20-21" name="__codelineno-20-21"></a>            <span class="s2">"validation.rules"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"amount"</span><span class="p">,</span> <span class="s2">"items"</span><span class="p">,</span> <span class="s2">"customer"</span><span class="p">]</span>
</span><span id="__span-20-22"><a href="#__codelineno-20-22" id="__codelineno-20-22" name="__codelineno-20-22"></a>        <span class="p">})</span>
</span><span id="__span-20-23"><a href="#__codelineno-20-23" id="__codelineno-20-23" name="__codelineno-20-23"></a>
</span><span id="__span-20-24"><a href="#__codelineno-20-24" id="__codelineno-20-24" name="__codelineno-20-24"></a>        <span class="c1"># Delegate to mediator (automatically creates child spans)</span>
</span><span id="__span-20-25"><a href="#__codelineno-20-25" id="__codelineno-20-25" name="__codelineno-20-25"></a>        <span class="n">command</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">dto</span><span class="p">,</span> <span class="n">CreateOrderCommand</span><span class="p">)</span>
</span><span id="__span-20-26"><a href="#__codelineno-20-26" id="__codelineno-20-26" name="__codelineno-20-26"></a>        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">mediator</span><span class="o">.</span><span class="n">execute_async</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
</span><span id="__span-20-27"><a href="#__codelineno-20-27" id="__codelineno-20-27" name="__codelineno-20-27"></a>
</span><span id="__span-20-28"><a href="#__codelineno-20-28" id="__codelineno-20-28" name="__codelineno-20-28"></a>        <span class="n">add_span_event</span><span class="p">(</span><span class="s2">"order_created"</span><span class="p">,</span> <span class="p">{</span>
</span><span id="__span-20-29"><a href="#__codelineno-20-29" id="__codelineno-20-29" name="__codelineno-20-29"></a>            <span class="s2">"order.id"</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">id</span>
</span><span id="__span-20-30"><a href="#__codelineno-20-30" id="__codelineno-20-30" name="__codelineno-20-30"></a>        <span class="p">})</span>
</span><span id="__span-20-31"><a href="#__codelineno-20-31" id="__codelineno-20-31" name="__codelineno-20-31"></a>
</span><span id="__span-20-32"><a href="#__codelineno-20-32" id="__codelineno-20-32" name="__codelineno-20-32"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span></code></pre></div>
<p><strong>What you get automatically</strong>:</p>
<ul>
<li>HTTP method, path, status code</li>
<li>Request/response sizes</li>
<li>Client IP address</li>
<li>User agent</li>
<li>Request duration</li>
</ul>
<h3 id="layer-2-application-layer-handlers">Layer 2: Application Layer (Handlers)<a class="headerlink" href="#layer-2-application-layer-handlers" title="Permanent link">¬∂</a></h3>
<p>Command and query handlers should use the <code>@trace_async</code> decorator:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-21-1"><a href="#__codelineno-21-1" id="__codelineno-21-1" name="__codelineno-21-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">neuroglia.mediation</span><span class="w"> </span><span class="kn">import</span> <span class="n">CommandHandler</span>
</span><span id="__span-21-2"><a href="#__codelineno-21-2" id="__codelineno-21-2" name="__codelineno-21-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">neuroglia.observability</span><span class="w"> </span><span class="kn">import</span> <span class="n">trace_async</span><span class="p">,</span> <span class="n">get_meter</span><span class="p">,</span> <span class="n">add_span_attributes</span>
</span><span id="__span-21-3"><a href="#__codelineno-21-3" id="__codelineno-21-3" name="__codelineno-21-3"></a>
</span><span id="__span-21-4"><a href="#__codelineno-21-4" id="__codelineno-21-4" name="__codelineno-21-4"></a><span class="k">class</span><span class="w"> </span><span class="nc">CreateOrderHandler</span><span class="p">(</span><span class="n">CommandHandler</span><span class="p">[</span><span class="n">CreateOrderCommand</span><span class="p">,</span> <span class="n">OperationResult</span><span class="p">[</span><span class="n">OrderDto</span><span class="p">]]):</span>
</span><span id="__span-21-5"><a href="#__codelineno-21-5" id="__codelineno-21-5" name="__codelineno-21-5"></a>
</span><span id="__span-21-6"><a href="#__codelineno-21-6" id="__codelineno-21-6" name="__codelineno-21-6"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order_repository</span><span class="p">,</span> <span class="n">payment_service</span><span class="p">,</span> <span class="n">inventory_service</span><span class="p">):</span>
</span><span id="__span-21-7"><a href="#__codelineno-21-7" id="__codelineno-21-7" name="__codelineno-21-7"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">order_repository</span> <span class="o">=</span> <span class="n">order_repository</span>
</span><span id="__span-21-8"><a href="#__codelineno-21-8" id="__codelineno-21-8" name="__codelineno-21-8"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">payment_service</span> <span class="o">=</span> <span class="n">payment_service</span>
</span><span id="__span-21-9"><a href="#__codelineno-21-9" id="__codelineno-21-9" name="__codelineno-21-9"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">inventory_service</span> <span class="o">=</span> <span class="n">inventory_service</span>
</span><span id="__span-21-10"><a href="#__codelineno-21-10" id="__codelineno-21-10" name="__codelineno-21-10"></a>
</span><span id="__span-21-11"><a href="#__codelineno-21-11" id="__codelineno-21-11" name="__codelineno-21-11"></a>        <span class="c1"># Create metrics for this handler</span>
</span><span id="__span-21-12"><a href="#__codelineno-21-12" id="__codelineno-21-12" name="__codelineno-21-12"></a>        <span class="n">meter</span> <span class="o">=</span> <span class="n">get_meter</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="__span-21-13"><a href="#__codelineno-21-13" id="__codelineno-21-13" name="__codelineno-21-13"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">orders_created</span> <span class="o">=</span> <span class="n">meter</span><span class="o">.</span><span class="n">create_counter</span><span class="p">(</span>
</span><span id="__span-21-14"><a href="#__codelineno-21-14" id="__codelineno-21-14" name="__codelineno-21-14"></a>            <span class="s2">"orders_created_total"</span><span class="p">,</span>
</span><span id="__span-21-15"><a href="#__codelineno-21-15" id="__codelineno-21-15" name="__codelineno-21-15"></a>            <span class="n">description</span><span class="o">=</span><span class="s2">"Total orders created"</span><span class="p">,</span>
</span><span id="__span-21-16"><a href="#__codelineno-21-16" id="__codelineno-21-16" name="__codelineno-21-16"></a>            <span class="n">unit</span><span class="o">=</span><span class="s2">"orders"</span>
</span><span id="__span-21-17"><a href="#__codelineno-21-17" id="__codelineno-21-17" name="__codelineno-21-17"></a>        <span class="p">)</span>
</span><span id="__span-21-18"><a href="#__codelineno-21-18" id="__codelineno-21-18" name="__codelineno-21-18"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">order_value</span> <span class="o">=</span> <span class="n">meter</span><span class="o">.</span><span class="n">create_histogram</span><span class="p">(</span>
</span><span id="__span-21-19"><a href="#__codelineno-21-19" id="__codelineno-21-19" name="__codelineno-21-19"></a>            <span class="s2">"order_value_usd"</span><span class="p">,</span>
</span><span id="__span-21-20"><a href="#__codelineno-21-20" id="__codelineno-21-20" name="__codelineno-21-20"></a>            <span class="n">description</span><span class="o">=</span><span class="s2">"Order value distribution"</span><span class="p">,</span>
</span><span id="__span-21-21"><a href="#__codelineno-21-21" id="__codelineno-21-21" name="__codelineno-21-21"></a>            <span class="n">unit</span><span class="o">=</span><span class="s2">"USD"</span>
</span><span id="__span-21-22"><a href="#__codelineno-21-22" id="__codelineno-21-22" name="__codelineno-21-22"></a>        <span class="p">)</span>
</span><span id="__span-21-23"><a href="#__codelineno-21-23" id="__codelineno-21-23" name="__codelineno-21-23"></a>
</span><span id="__span-21-24"><a href="#__codelineno-21-24" id="__codelineno-21-24" name="__codelineno-21-24"></a>    <span class="nd">@trace_async</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"create_order_handler"</span><span class="p">)</span>
</span><span id="__span-21-25"><a href="#__codelineno-21-25" id="__codelineno-21-25" name="__codelineno-21-25"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">handle_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">:</span> <span class="n">CreateOrderCommand</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OperationResult</span><span class="p">[</span><span class="n">OrderDto</span><span class="p">]:</span>
</span><span id="__span-21-26"><a href="#__codelineno-21-26" id="__codelineno-21-26" name="__codelineno-21-26"></a><span class="w">        </span><span class="sd">"""Handle order creation with full observability"""</span>
</span><span id="__span-21-27"><a href="#__codelineno-21-27" id="__codelineno-21-27" name="__codelineno-21-27"></a>
</span><span id="__span-21-28"><a href="#__codelineno-21-28" id="__codelineno-21-28" name="__codelineno-21-28"></a>        <span class="c1"># Add command details to span</span>
</span><span id="__span-21-29"><a href="#__codelineno-21-29" id="__codelineno-21-29" name="__codelineno-21-29"></a>        <span class="n">add_span_attributes</span><span class="p">({</span>
</span><span id="__span-21-30"><a href="#__codelineno-21-30" id="__codelineno-21-30" name="__codelineno-21-30"></a>            <span class="s2">"command.type"</span><span class="p">:</span> <span class="s2">"CreateOrderCommand"</span><span class="p">,</span>
</span><span id="__span-21-31"><a href="#__codelineno-21-31" id="__codelineno-21-31" name="__codelineno-21-31"></a>            <span class="s2">"order.customer_id"</span><span class="p">:</span> <span class="n">command</span><span class="o">.</span><span class="n">customer_id</span><span class="p">,</span>
</span><span id="__span-21-32"><a href="#__codelineno-21-32" id="__codelineno-21-32" name="__codelineno-21-32"></a>            <span class="s2">"order.total"</span><span class="p">:</span> <span class="n">command</span><span class="o">.</span><span class="n">total_amount</span>
</span><span id="__span-21-33"><a href="#__codelineno-21-33" id="__codelineno-21-33" name="__codelineno-21-33"></a>        <span class="p">})</span>
</span><span id="__span-21-34"><a href="#__codelineno-21-34" id="__codelineno-21-34" name="__codelineno-21-34"></a>
</span><span id="__span-21-35"><a href="#__codelineno-21-35" id="__codelineno-21-35" name="__codelineno-21-35"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-21-36"><a href="#__codelineno-21-36" id="__codelineno-21-36" name="__codelineno-21-36"></a>            <span class="c1"># Each of these creates child spans automatically</span>
</span><span id="__span-21-37"><a href="#__codelineno-21-37" id="__codelineno-21-37" name="__codelineno-21-37"></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_order</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
</span><span id="__span-21-38"><a href="#__codelineno-21-38" id="__codelineno-21-38" name="__codelineno-21-38"></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_inventory</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
</span><span id="__span-21-39"><a href="#__codelineno-21-39" id="__codelineno-21-39" name="__codelineno-21-39"></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_payment</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
</span><span id="__span-21-40"><a href="#__codelineno-21-40" id="__codelineno-21-40" name="__codelineno-21-40"></a>
</span><span id="__span-21-41"><a href="#__codelineno-21-41" id="__codelineno-21-41" name="__codelineno-21-41"></a>            <span class="c1"># Create order entity</span>
</span><span id="__span-21-42"><a href="#__codelineno-21-42" id="__codelineno-21-42" name="__codelineno-21-42"></a>            <span class="n">order</span> <span class="o">=</span> <span class="n">Order</span><span class="p">(</span>
</span><span id="__span-21-43"><a href="#__codelineno-21-43" id="__codelineno-21-43" name="__codelineno-21-43"></a>                <span class="n">customer_id</span><span class="o">=</span><span class="n">command</span><span class="o">.</span><span class="n">customer_id</span><span class="p">,</span>
</span><span id="__span-21-44"><a href="#__codelineno-21-44" id="__codelineno-21-44" name="__codelineno-21-44"></a>                <span class="n">items</span><span class="o">=</span><span class="n">command</span><span class="o">.</span><span class="n">items</span><span class="p">,</span>
</span><span id="__span-21-45"><a href="#__codelineno-21-45" id="__codelineno-21-45" name="__codelineno-21-45"></a>                <span class="n">total_amount</span><span class="o">=</span><span class="n">command</span><span class="o">.</span><span class="n">total_amount</span>
</span><span id="__span-21-46"><a href="#__codelineno-21-46" id="__codelineno-21-46" name="__codelineno-21-46"></a>            <span class="p">)</span>
</span><span id="__span-21-47"><a href="#__codelineno-21-47" id="__codelineno-21-47" name="__codelineno-21-47"></a>
</span><span id="__span-21-48"><a href="#__codelineno-21-48" id="__codelineno-21-48" name="__codelineno-21-48"></a>            <span class="c1"># Save (repository creates its own span)</span>
</span><span id="__span-21-49"><a href="#__codelineno-21-49" id="__codelineno-21-49" name="__codelineno-21-49"></a>            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">order_repository</span><span class="o">.</span><span class="n">save_async</span><span class="p">(</span><span class="n">order</span><span class="p">)</span>
</span><span id="__span-21-50"><a href="#__codelineno-21-50" id="__codelineno-21-50" name="__codelineno-21-50"></a>
</span><span id="__span-21-51"><a href="#__codelineno-21-51" id="__codelineno-21-51" name="__codelineno-21-51"></a>            <span class="c1"># Record metrics</span>
</span><span id="__span-21-52"><a href="#__codelineno-21-52" id="__codelineno-21-52" name="__codelineno-21-52"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">orders_created</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">{</span>
</span><span id="__span-21-53"><a href="#__codelineno-21-53" id="__codelineno-21-53" name="__codelineno-21-53"></a>                <span class="s2">"customer.type"</span><span class="p">:</span> <span class="n">command</span><span class="o">.</span><span class="n">customer_type</span><span class="p">,</span>
</span><span id="__span-21-54"><a href="#__codelineno-21-54" id="__codelineno-21-54" name="__codelineno-21-54"></a>                <span class="s2">"order.channel"</span><span class="p">:</span> <span class="s2">"web"</span>
</span><span id="__span-21-55"><a href="#__codelineno-21-55" id="__codelineno-21-55" name="__codelineno-21-55"></a>            <span class="p">})</span>
</span><span id="__span-21-56"><a href="#__codelineno-21-56" id="__codelineno-21-56" name="__codelineno-21-56"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">order_value</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="n">command</span><span class="o">.</span><span class="n">total_amount</span><span class="p">,</span> <span class="p">{</span>
</span><span id="__span-21-57"><a href="#__codelineno-21-57" id="__codelineno-21-57" name="__codelineno-21-57"></a>                <span class="s2">"customer.type"</span><span class="p">:</span> <span class="n">command</span><span class="o">.</span><span class="n">customer_type</span>
</span><span id="__span-21-58"><a href="#__codelineno-21-58" id="__codelineno-21-58" name="__codelineno-21-58"></a>            <span class="p">})</span>
</span><span id="__span-21-59"><a href="#__codelineno-21-59" id="__codelineno-21-59" name="__codelineno-21-59"></a>
</span><span id="__span-21-60"><a href="#__codelineno-21-60" id="__codelineno-21-60" name="__codelineno-21-60"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">created</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="n">OrderDto</span><span class="p">))</span>
</span><span id="__span-21-61"><a href="#__codelineno-21-61" id="__codelineno-21-61" name="__codelineno-21-61"></a>
</span><span id="__span-21-62"><a href="#__codelineno-21-62" id="__codelineno-21-62" name="__codelineno-21-62"></a>        <span class="k">except</span> <span class="n">PaymentError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-21-63"><a href="#__codelineno-21-63" id="__codelineno-21-63" name="__codelineno-21-63"></a>            <span class="n">add_span_attributes</span><span class="p">({</span><span class="s2">"error"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">"error.type"</span><span class="p">:</span> <span class="s2">"payment_failed"</span><span class="p">})</span>
</span><span id="__span-21-64"><a href="#__codelineno-21-64" id="__codelineno-21-64" name="__codelineno-21-64"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bad_request</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Payment failed: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="__span-21-65"><a href="#__codelineno-21-65" id="__codelineno-21-65" name="__codelineno-21-65"></a>
</span><span id="__span-21-66"><a href="#__codelineno-21-66" id="__codelineno-21-66" name="__codelineno-21-66"></a>    <span class="nd">@trace_async</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"validate_order"</span><span class="p">)</span>
</span><span id="__span-21-67"><a href="#__codelineno-21-67" id="__codelineno-21-67" name="__codelineno-21-67"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_validate_order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">:</span> <span class="n">CreateOrderCommand</span><span class="p">):</span>
</span><span id="__span-21-68"><a href="#__codelineno-21-68" id="__codelineno-21-68" name="__codelineno-21-68"></a><span class="w">        </span><span class="sd">"""Validation logic with its own span"""</span>
</span><span id="__span-21-69"><a href="#__codelineno-21-69" id="__codelineno-21-69" name="__codelineno-21-69"></a>        <span class="n">add_span_attributes</span><span class="p">({</span><span class="s2">"validation.rules_count"</span><span class="p">:</span> <span class="mi">3</span><span class="p">})</span>
</span><span id="__span-21-70"><a href="#__codelineno-21-70" id="__codelineno-21-70" name="__codelineno-21-70"></a>        <span class="c1"># Validation logic...</span>
</span><span id="__span-21-71"><a href="#__codelineno-21-71" id="__codelineno-21-71" name="__codelineno-21-71"></a>
</span><span id="__span-21-72"><a href="#__codelineno-21-72" id="__codelineno-21-72" name="__codelineno-21-72"></a>    <span class="nd">@trace_async</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"check_inventory"</span><span class="p">)</span>
</span><span id="__span-21-73"><a href="#__codelineno-21-73" id="__codelineno-21-73" name="__codelineno-21-73"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_check_inventory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">:</span> <span class="n">CreateOrderCommand</span><span class="p">):</span>
</span><span id="__span-21-74"><a href="#__codelineno-21-74" id="__codelineno-21-74" name="__codelineno-21-74"></a><span class="w">        </span><span class="sd">"""Inventory check with its own span"""</span>
</span><span id="__span-21-75"><a href="#__codelineno-21-75" id="__codelineno-21-75" name="__codelineno-21-75"></a>        <span class="c1"># Inventory logic...</span>
</span><span id="__span-21-76"><a href="#__codelineno-21-76" id="__codelineno-21-76" name="__codelineno-21-76"></a>
</span><span id="__span-21-77"><a href="#__codelineno-21-77" id="__codelineno-21-77" name="__codelineno-21-77"></a>    <span class="nd">@trace_async</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"process_payment"</span><span class="p">)</span>
</span><span id="__span-21-78"><a href="#__codelineno-21-78" id="__codelineno-21-78" name="__codelineno-21-78"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_process_payment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">:</span> <span class="n">CreateOrderCommand</span><span class="p">):</span>
</span><span id="__span-21-79"><a href="#__codelineno-21-79" id="__codelineno-21-79" name="__codelineno-21-79"></a><span class="w">        </span><span class="sd">"""Payment processing with its own span"""</span>
</span><span id="__span-21-80"><a href="#__codelineno-21-80" id="__codelineno-21-80" name="__codelineno-21-80"></a>        <span class="c1"># Payment logic...</span>
</span></code></pre></div>
<p><strong>Key patterns</strong>:</p>
<ul>
<li>Use <code>@trace_async</code> on handler methods</li>
<li>Add meaningful attributes (customer_id, order_id, amounts)</li>
<li>Record business metrics (orders created, revenue)</li>
<li>Track errors with error attributes</li>
</ul>
<h3 id="layer-3-domain-layer-entities-services">Layer 3: Domain Layer (Entities &amp; Services)<a class="headerlink" href="#layer-3-domain-layer-entities-services" title="Permanent link">¬∂</a></h3>
<p>Domain logic can be traced for complex operations:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-22-1"><a href="#__codelineno-22-1" id="__codelineno-22-1" name="__codelineno-22-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">neuroglia.data</span><span class="w"> </span><span class="kn">import</span> <span class="n">AggregateRoot</span><span class="p">,</span> <span class="n">DomainEvent</span>
</span><span id="__span-22-2"><a href="#__codelineno-22-2" id="__codelineno-22-2" name="__codelineno-22-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">neuroglia.observability</span><span class="w"> </span><span class="kn">import</span> <span class="n">trace_async</span><span class="p">,</span> <span class="n">add_span_attributes</span><span class="p">,</span> <span class="n">add_span_event</span>
</span><span id="__span-22-3"><a href="#__codelineno-22-3" id="__codelineno-22-3" name="__codelineno-22-3"></a>
</span><span id="__span-22-4"><a href="#__codelineno-22-4" id="__codelineno-22-4" name="__codelineno-22-4"></a><span class="k">class</span><span class="w"> </span><span class="nc">Order</span><span class="p">(</span><span class="n">AggregateRoot</span><span class="p">):</span>
</span><span id="__span-22-5"><a href="#__codelineno-22-5" id="__codelineno-22-5" name="__codelineno-22-5"></a><span class="w">    </span><span class="sd">"""Order aggregate with observability"""</span>
</span><span id="__span-22-6"><a href="#__codelineno-22-6" id="__codelineno-22-6" name="__codelineno-22-6"></a>
</span><span id="__span-22-7"><a href="#__codelineno-22-7" id="__codelineno-22-7" name="__codelineno-22-7"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">customer_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">items</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">total_amount</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="__span-22-8"><a href="#__codelineno-22-8" id="__codelineno-22-8" name="__codelineno-22-8"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span id="__span-22-9"><a href="#__codelineno-22-9" id="__codelineno-22-9" name="__codelineno-22-9"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">customer_id</span> <span class="o">=</span> <span class="n">customer_id</span>
</span><span id="__span-22-10"><a href="#__codelineno-22-10" id="__codelineno-22-10" name="__codelineno-22-10"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">items</span> <span class="o">=</span> <span class="n">items</span>
</span><span id="__span-22-11"><a href="#__codelineno-22-11" id="__codelineno-22-11" name="__codelineno-22-11"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">total_amount</span> <span class="o">=</span> <span class="n">total_amount</span>
</span><span id="__span-22-12"><a href="#__codelineno-22-12" id="__codelineno-22-12" name="__codelineno-22-12"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="s2">"pending"</span>
</span><span id="__span-22-13"><a href="#__codelineno-22-13" id="__codelineno-22-13" name="__codelineno-22-13"></a>
</span><span id="__span-22-14"><a href="#__codelineno-22-14" id="__codelineno-22-14" name="__codelineno-22-14"></a>        <span class="c1"># Raise domain event</span>
</span><span id="__span-22-15"><a href="#__codelineno-22-15" id="__codelineno-22-15" name="__codelineno-22-15"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">raise_event</span><span class="p">(</span><span class="n">OrderCreatedEvent</span><span class="p">(</span>
</span><span id="__span-22-16"><a href="#__codelineno-22-16" id="__codelineno-22-16" name="__codelineno-22-16"></a>            <span class="n">order_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
</span><span id="__span-22-17"><a href="#__codelineno-22-17" id="__codelineno-22-17" name="__codelineno-22-17"></a>            <span class="n">customer_id</span><span class="o">=</span><span class="n">customer_id</span><span class="p">,</span>
</span><span id="__span-22-18"><a href="#__codelineno-22-18" id="__codelineno-22-18" name="__codelineno-22-18"></a>            <span class="n">total_amount</span><span class="o">=</span><span class="n">total_amount</span>
</span><span id="__span-22-19"><a href="#__codelineno-22-19" id="__codelineno-22-19" name="__codelineno-22-19"></a>        <span class="p">))</span>
</span><span id="__span-22-20"><a href="#__codelineno-22-20" id="__codelineno-22-20" name="__codelineno-22-20"></a>
</span><span id="__span-22-21"><a href="#__codelineno-22-21" id="__codelineno-22-21" name="__codelineno-22-21"></a>    <span class="nd">@trace_async</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"order.validate"</span><span class="p">)</span>
</span><span id="__span-22-22"><a href="#__codelineno-22-22" id="__codelineno-22-22" name="__codelineno-22-22"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-22-23"><a href="#__codelineno-22-23" id="__codelineno-22-23" name="__codelineno-22-23"></a><span class="w">        </span><span class="sd">"""Complex validation logic"""</span>
</span><span id="__span-22-24"><a href="#__codelineno-22-24" id="__codelineno-22-24" name="__codelineno-22-24"></a>        <span class="n">add_span_attributes</span><span class="p">({</span>
</span><span id="__span-22-25"><a href="#__codelineno-22-25" id="__codelineno-22-25" name="__codelineno-22-25"></a>            <span class="s2">"order.items_count"</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">),</span>
</span><span id="__span-22-26"><a href="#__codelineno-22-26" id="__codelineno-22-26" name="__codelineno-22-26"></a>            <span class="s2">"order.total"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_amount</span>
</span><span id="__span-22-27"><a href="#__codelineno-22-27" id="__codelineno-22-27" name="__codelineno-22-27"></a>        <span class="p">})</span>
</span><span id="__span-22-28"><a href="#__codelineno-22-28" id="__codelineno-22-28" name="__codelineno-22-28"></a>
</span><span id="__span-22-29"><a href="#__codelineno-22-29" id="__codelineno-22-29" name="__codelineno-22-29"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_amount</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
</span><span id="__span-22-30"><a href="#__codelineno-22-30" id="__codelineno-22-30" name="__codelineno-22-30"></a>            <span class="n">add_span_event</span><span class="p">(</span><span class="s2">"validation_failed"</span><span class="p">,</span> <span class="p">{</span>
</span><span id="__span-22-31"><a href="#__codelineno-22-31" id="__codelineno-22-31" name="__codelineno-22-31"></a>                <span class="s2">"reason"</span><span class="p">:</span> <span class="s2">"minimum_amount_not_met"</span>
</span><span id="__span-22-32"><a href="#__codelineno-22-32" id="__codelineno-22-32" name="__codelineno-22-32"></a>            <span class="p">})</span>
</span><span id="__span-22-33"><a href="#__codelineno-22-33" id="__codelineno-22-33" name="__codelineno-22-33"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Minimum order amount is $10"</span><span class="p">)</span>
</span><span id="__span-22-34"><a href="#__codelineno-22-34" id="__codelineno-22-34" name="__codelineno-22-34"></a>
</span><span id="__span-22-35"><a href="#__codelineno-22-35" id="__codelineno-22-35" name="__codelineno-22-35"></a>        <span class="n">add_span_event</span><span class="p">(</span><span class="s2">"validation_passed"</span><span class="p">)</span>
</span><span id="__span-22-36"><a href="#__codelineno-22-36" id="__codelineno-22-36" name="__codelineno-22-36"></a>
</span><span id="__span-22-37"><a href="#__codelineno-22-37" id="__codelineno-22-37" name="__codelineno-22-37"></a>    <span class="nd">@trace_async</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"order.calculate_tax"</span><span class="p">)</span>
</span><span id="__span-22-38"><a href="#__codelineno-22-38" id="__codelineno-22-38" name="__codelineno-22-38"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">calculate_tax</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tax_rate</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="__span-22-39"><a href="#__codelineno-22-39" id="__codelineno-22-39" name="__codelineno-22-39"></a><span class="w">        </span><span class="sd">"""Tax calculation"""</span>
</span><span id="__span-22-40"><a href="#__codelineno-22-40" id="__codelineno-22-40" name="__codelineno-22-40"></a>        <span class="n">tax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_amount</span> <span class="o">*</span> <span class="n">tax_rate</span>
</span><span id="__span-22-41"><a href="#__codelineno-22-41" id="__codelineno-22-41" name="__codelineno-22-41"></a>        <span class="n">add_span_attributes</span><span class="p">({</span>
</span><span id="__span-22-42"><a href="#__codelineno-22-42" id="__codelineno-22-42" name="__codelineno-22-42"></a>            <span class="s2">"tax.rate"</span><span class="p">:</span> <span class="n">tax_rate</span><span class="p">,</span>
</span><span id="__span-22-43"><a href="#__codelineno-22-43" id="__codelineno-22-43" name="__codelineno-22-43"></a>            <span class="s2">"tax.amount"</span><span class="p">:</span> <span class="n">tax</span>
</span><span id="__span-22-44"><a href="#__codelineno-22-44" id="__codelineno-22-44" name="__codelineno-22-44"></a>        <span class="p">})</span>
</span><span id="__span-22-45"><a href="#__codelineno-22-45" id="__codelineno-22-45" name="__codelineno-22-45"></a>        <span class="k">return</span> <span class="n">tax</span>
</span></code></pre></div>
<p><strong>When to trace domain logic</strong>:</p>
<ul>
<li>‚úÖ Complex business rules</li>
<li>‚úÖ Calculations that might be slow</li>
<li>‚úÖ State transitions</li>
<li>‚ùå Simple getters/setters</li>
<li>‚ùå Property access</li>
</ul>
<h3 id="layer-4-integration-layer-repositories-external-services">Layer 4: Integration Layer (Repositories &amp; External Services)<a class="headerlink" href="#layer-4-integration-layer-repositories-external-services" title="Permanent link">¬∂</a></h3>
<p>Repositories and external service calls need explicit tracing:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-23-1"><a href="#__codelineno-23-1" id="__codelineno-23-1" name="__codelineno-23-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">neuroglia.data</span><span class="w"> </span><span class="kn">import</span> <span class="n">Repository</span>
</span><span id="__span-23-2"><a href="#__codelineno-23-2" id="__codelineno-23-2" name="__codelineno-23-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">neuroglia.observability</span><span class="w"> </span><span class="kn">import</span> <span class="n">trace_async</span><span class="p">,</span> <span class="n">add_span_attributes</span>
</span><span id="__span-23-3"><a href="#__codelineno-23-3" id="__codelineno-23-3" name="__codelineno-23-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">motor.motor_asyncio</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncIOMotorClient</span>
</span><span id="__span-23-4"><a href="#__codelineno-23-4" id="__codelineno-23-4" name="__codelineno-23-4"></a>
</span><span id="__span-23-5"><a href="#__codelineno-23-5" id="__codelineno-23-5" name="__codelineno-23-5"></a><span class="k">class</span><span class="w"> </span><span class="nc">MongoOrderRepository</span><span class="p">(</span><span class="n">Repository</span><span class="p">[</span><span class="n">Order</span><span class="p">,</span> <span class="nb">str</span><span class="p">]):</span>
</span><span id="__span-23-6"><a href="#__codelineno-23-6" id="__codelineno-23-6" name="__codelineno-23-6"></a>
</span><span id="__span-23-7"><a href="#__codelineno-23-7" id="__codelineno-23-7" name="__codelineno-23-7"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mongo_client</span><span class="p">:</span> <span class="n">AsyncIOMotorClient</span><span class="p">):</span>
</span><span id="__span-23-8"><a href="#__codelineno-23-8" id="__codelineno-23-8" name="__codelineno-23-8"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">collection</span> <span class="o">=</span> <span class="n">mongo_client</span><span class="o">.</span><span class="n">pizzeria</span><span class="o">.</span><span class="n">orders</span>
</span><span id="__span-23-9"><a href="#__codelineno-23-9" id="__codelineno-23-9" name="__codelineno-23-9"></a>
</span><span id="__span-23-10"><a href="#__codelineno-23-10" id="__codelineno-23-10" name="__codelineno-23-10"></a>    <span class="nd">@trace_async</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"repository.save_order"</span><span class="p">)</span>
</span><span id="__span-23-11"><a href="#__codelineno-23-11" id="__codelineno-23-11" name="__codelineno-23-11"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">save_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order</span><span class="p">:</span> <span class="n">Order</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-23-12"><a href="#__codelineno-23-12" id="__codelineno-23-12" name="__codelineno-23-12"></a><span class="w">        </span><span class="sd">"""Save order with tracing"""</span>
</span><span id="__span-23-13"><a href="#__codelineno-23-13" id="__codelineno-23-13" name="__codelineno-23-13"></a>        <span class="n">add_span_attributes</span><span class="p">({</span>
</span><span id="__span-23-14"><a href="#__codelineno-23-14" id="__codelineno-23-14" name="__codelineno-23-14"></a>            <span class="s2">"db.system"</span><span class="p">:</span> <span class="s2">"mongodb"</span><span class="p">,</span>
</span><span id="__span-23-15"><a href="#__codelineno-23-15" id="__codelineno-23-15" name="__codelineno-23-15"></a>            <span class="s2">"db.operation"</span><span class="p">:</span> <span class="s2">"insert"</span><span class="p">,</span>
</span><span id="__span-23-16"><a href="#__codelineno-23-16" id="__codelineno-23-16" name="__codelineno-23-16"></a>            <span class="s2">"db.collection"</span><span class="p">:</span> <span class="s2">"orders"</span><span class="p">,</span>
</span><span id="__span-23-17"><a href="#__codelineno-23-17" id="__codelineno-23-17" name="__codelineno-23-17"></a>            <span class="s2">"order.id"</span><span class="p">:</span> <span class="n">order</span><span class="o">.</span><span class="n">id</span>
</span><span id="__span-23-18"><a href="#__codelineno-23-18" id="__codelineno-23-18" name="__codelineno-23-18"></a>        <span class="p">})</span>
</span><span id="__span-23-19"><a href="#__codelineno-23-19" id="__codelineno-23-19" name="__codelineno-23-19"></a>
</span><span id="__span-23-20"><a href="#__codelineno-23-20" id="__codelineno-23-20" name="__codelineno-23-20"></a>        <span class="n">document</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_document</span><span class="p">(</span><span class="n">order</span><span class="p">)</span>
</span><span id="__span-23-21"><a href="#__codelineno-23-21" id="__codelineno-23-21" name="__codelineno-23-21"></a>        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">insert_one</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
</span><span id="__span-23-22"><a href="#__codelineno-23-22" id="__codelineno-23-22" name="__codelineno-23-22"></a>
</span><span id="__span-23-23"><a href="#__codelineno-23-23" id="__codelineno-23-23" name="__codelineno-23-23"></a>        <span class="n">add_span_attributes</span><span class="p">({</span>
</span><span id="__span-23-24"><a href="#__codelineno-23-24" id="__codelineno-23-24" name="__codelineno-23-24"></a>            <span class="s2">"db.inserted_id"</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">inserted_id</span><span class="p">),</span>
</span><span id="__span-23-25"><a href="#__codelineno-23-25" id="__codelineno-23-25" name="__codelineno-23-25"></a>            <span class="s2">"db.success"</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">acknowledged</span>
</span><span id="__span-23-26"><a href="#__codelineno-23-26" id="__codelineno-23-26" name="__codelineno-23-26"></a>        <span class="p">})</span>
</span><span id="__span-23-27"><a href="#__codelineno-23-27" id="__codelineno-23-27" name="__codelineno-23-27"></a>
</span><span id="__span-23-28"><a href="#__codelineno-23-28" id="__codelineno-23-28" name="__codelineno-23-28"></a>    <span class="nd">@trace_async</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"repository.get_order"</span><span class="p">)</span>
</span><span id="__span-23-29"><a href="#__codelineno-23-29" id="__codelineno-23-29" name="__codelineno-23-29"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">get_by_id_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Order</span><span class="p">]:</span>
</span><span id="__span-23-30"><a href="#__codelineno-23-30" id="__codelineno-23-30" name="__codelineno-23-30"></a><span class="w">        </span><span class="sd">"""Get order by ID with tracing"""</span>
</span><span id="__span-23-31"><a href="#__codelineno-23-31" id="__codelineno-23-31" name="__codelineno-23-31"></a>        <span class="n">add_span_attributes</span><span class="p">({</span>
</span><span id="__span-23-32"><a href="#__codelineno-23-32" id="__codelineno-23-32" name="__codelineno-23-32"></a>            <span class="s2">"db.system"</span><span class="p">:</span> <span class="s2">"mongodb"</span><span class="p">,</span>
</span><span id="__span-23-33"><a href="#__codelineno-23-33" id="__codelineno-23-33" name="__codelineno-23-33"></a>            <span class="s2">"db.operation"</span><span class="p">:</span> <span class="s2">"findOne"</span><span class="p">,</span>
</span><span id="__span-23-34"><a href="#__codelineno-23-34" id="__codelineno-23-34" name="__codelineno-23-34"></a>            <span class="s2">"db.collection"</span><span class="p">:</span> <span class="s2">"orders"</span><span class="p">,</span>
</span><span id="__span-23-35"><a href="#__codelineno-23-35" id="__codelineno-23-35" name="__codelineno-23-35"></a>            <span class="s2">"order.id"</span><span class="p">:</span> <span class="n">order_id</span>
</span><span id="__span-23-36"><a href="#__codelineno-23-36" id="__codelineno-23-36" name="__codelineno-23-36"></a>        <span class="p">})</span>
</span><span id="__span-23-37"><a href="#__codelineno-23-37" id="__codelineno-23-37" name="__codelineno-23-37"></a>
</span><span id="__span-23-38"><a href="#__codelineno-23-38" id="__codelineno-23-38" name="__codelineno-23-38"></a>        <span class="n">document</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">find_one</span><span class="p">({</span><span class="s2">"_id"</span><span class="p">:</span> <span class="n">order_id</span><span class="p">})</span>
</span><span id="__span-23-39"><a href="#__codelineno-23-39" id="__codelineno-23-39" name="__codelineno-23-39"></a>
</span><span id="__span-23-40"><a href="#__codelineno-23-40" id="__codelineno-23-40" name="__codelineno-23-40"></a>        <span class="n">add_span_attributes</span><span class="p">({</span>
</span><span id="__span-23-41"><a href="#__codelineno-23-41" id="__codelineno-23-41" name="__codelineno-23-41"></a>            <span class="s2">"db.found"</span><span class="p">:</span> <span class="n">document</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</span><span id="__span-23-42"><a href="#__codelineno-23-42" id="__codelineno-23-42" name="__codelineno-23-42"></a>        <span class="p">})</span>
</span><span id="__span-23-43"><a href="#__codelineno-23-43" id="__codelineno-23-43" name="__codelineno-23-43"></a>
</span><span id="__span-23-44"><a href="#__codelineno-23-44" id="__codelineno-23-44" name="__codelineno-23-44"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_from_document</span><span class="p">(</span><span class="n">document</span><span class="p">)</span> <span class="k">if</span> <span class="n">document</span> <span class="k">else</span> <span class="kc">None</span>
</span></code></pre></div>
<p><strong>HTTP Service Clients</strong> (automatically instrumented by HTTPX):</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-24-1"><a href="#__codelineno-24-1" id="__codelineno-24-1" name="__codelineno-24-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">neuroglia.integration</span><span class="w"> </span><span class="kn">import</span> <span class="n">HttpServiceClient</span>
</span><span id="__span-24-2"><a href="#__codelineno-24-2" id="__codelineno-24-2" name="__codelineno-24-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">neuroglia.observability</span><span class="w"> </span><span class="kn">import</span> <span class="n">add_span_attributes</span>
</span><span id="__span-24-3"><a href="#__codelineno-24-3" id="__codelineno-24-3" name="__codelineno-24-3"></a>
</span><span id="__span-24-4"><a href="#__codelineno-24-4" id="__codelineno-24-4" name="__codelineno-24-4"></a><span class="k">class</span><span class="w"> </span><span class="nc">PaymentServiceClient</span><span class="p">:</span>
</span><span id="__span-24-5"><a href="#__codelineno-24-5" id="__codelineno-24-5" name="__codelineno-24-5"></a>
</span><span id="__span-24-6"><a href="#__codelineno-24-6" id="__codelineno-24-6" name="__codelineno-24-6"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">http_client</span><span class="p">:</span> <span class="n">HttpServiceClient</span><span class="p">):</span>
</span><span id="__span-24-7"><a href="#__codelineno-24-7" id="__codelineno-24-7" name="__codelineno-24-7"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">http_client</span>
</span><span id="__span-24-8"><a href="#__codelineno-24-8" id="__codelineno-24-8" name="__codelineno-24-8"></a>
</span><span id="__span-24-9"><a href="#__codelineno-24-9" id="__codelineno-24-9" name="__codelineno-24-9"></a>    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">process_payment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">card_token</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PaymentResult</span><span class="p">:</span>
</span><span id="__span-24-10"><a href="#__codelineno-24-10" id="__codelineno-24-10" name="__codelineno-24-10"></a><span class="w">        </span><span class="sd">"""Process payment - HTTPX automatically creates spans"""</span>
</span><span id="__span-24-11"><a href="#__codelineno-24-11" id="__codelineno-24-11" name="__codelineno-24-11"></a>
</span><span id="__span-24-12"><a href="#__codelineno-24-12" id="__codelineno-24-12" name="__codelineno-24-12"></a>        <span class="c1"># HTTPX instrumentation will create a span automatically</span>
</span><span id="__span-24-13"><a href="#__codelineno-24-13" id="__codelineno-24-13" name="__codelineno-24-13"></a>        <span class="c1"># But we can add context to the current span</span>
</span><span id="__span-24-14"><a href="#__codelineno-24-14" id="__codelineno-24-14" name="__codelineno-24-14"></a>        <span class="n">add_span_attributes</span><span class="p">({</span>
</span><span id="__span-24-15"><a href="#__codelineno-24-15" id="__codelineno-24-15" name="__codelineno-24-15"></a>            <span class="s2">"payment.amount"</span><span class="p">:</span> <span class="n">amount</span><span class="p">,</span>
</span><span id="__span-24-16"><a href="#__codelineno-24-16" id="__codelineno-24-16" name="__codelineno-24-16"></a>            <span class="s2">"payment.provider"</span><span class="p">:</span> <span class="s2">"stripe"</span>
</span><span id="__span-24-17"><a href="#__codelineno-24-17" id="__codelineno-24-17" name="__codelineno-24-17"></a>        <span class="p">})</span>
</span><span id="__span-24-18"><a href="#__codelineno-24-18" id="__codelineno-24-18" name="__codelineno-24-18"></a>
</span><span id="__span-24-19"><a href="#__codelineno-24-19" id="__codelineno-24-19" name="__codelineno-24-19"></a>        <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
</span><span id="__span-24-20"><a href="#__codelineno-24-20" id="__codelineno-24-20" name="__codelineno-24-20"></a>            <span class="s2">"/api/payments"</span><span class="p">,</span>
</span><span id="__span-24-21"><a href="#__codelineno-24-21" id="__codelineno-24-21" name="__codelineno-24-21"></a>            <span class="n">json</span><span class="o">=</span><span class="p">{</span>
</span><span id="__span-24-22"><a href="#__codelineno-24-22" id="__codelineno-24-22" name="__codelineno-24-22"></a>                <span class="s2">"amount"</span><span class="p">:</span> <span class="n">amount</span><span class="p">,</span>
</span><span id="__span-24-23"><a href="#__codelineno-24-23" id="__codelineno-24-23" name="__codelineno-24-23"></a>                <span class="s2">"card_token"</span><span class="p">:</span> <span class="n">card_token</span>
</span><span id="__span-24-24"><a href="#__codelineno-24-24" id="__codelineno-24-24" name="__codelineno-24-24"></a>            <span class="p">}</span>
</span><span id="__span-24-25"><a href="#__codelineno-24-25" id="__codelineno-24-25" name="__codelineno-24-25"></a>        <span class="p">)</span>
</span><span id="__span-24-26"><a href="#__codelineno-24-26" id="__codelineno-24-26" name="__codelineno-24-26"></a>
</span><span id="__span-24-27"><a href="#__codelineno-24-27" id="__codelineno-24-27" name="__codelineno-24-27"></a>        <span class="n">add_span_attributes</span><span class="p">({</span>
</span><span id="__span-24-28"><a href="#__codelineno-24-28" id="__codelineno-24-28" name="__codelineno-24-28"></a>            <span class="s2">"payment.transaction_id"</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s2">"transaction_id"</span><span class="p">],</span>
</span><span id="__span-24-29"><a href="#__codelineno-24-29" id="__codelineno-24-29" name="__codelineno-24-29"></a>            <span class="s2">"payment.status"</span><span class="p">:</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s2">"status"</span><span class="p">]</span>
</span><span id="__span-24-30"><a href="#__codelineno-24-30" id="__codelineno-24-30" name="__codelineno-24-30"></a>        <span class="p">})</span>
</span><span id="__span-24-31"><a href="#__codelineno-24-31" id="__codelineno-24-31" name="__codelineno-24-31"></a>
</span><span id="__span-24-32"><a href="#__codelineno-24-32" id="__codelineno-24-32" name="__codelineno-24-32"></a>        <span class="k">return</span> <span class="n">PaymentResult</span><span class="o">.</span><span class="n">from_json</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
</span></code></pre></div>
<h3 id="layer-specific-metric-types">Layer-Specific Metric Types<a class="headerlink" href="#layer-specific-metric-types" title="Permanent link">¬∂</a></h3>
<p>Different layers should use different metric types:</p>
<table>
<thead>
<tr>
<th>Layer</th>
<th>Metric Type</th>
<th>Examples</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>API Layer</strong></td>
<td>Counter, Histogram</td>
<td><code>http_requests_total</code>, <code>http_request_duration_seconds</code></td>
</tr>
<tr>
<td><strong>Application Layer</strong></td>
<td>Counter, Histogram</td>
<td><code>commands_executed_total</code>, <code>command_duration_seconds</code></td>
</tr>
<tr>
<td><strong>Domain Layer</strong></td>
<td>Counter, Gauge</td>
<td><code>orders_created_total</code>, <code>order_value_usd</code></td>
</tr>
<tr>
<td><strong>Integration Layer</strong></td>
<td>Counter, Histogram</td>
<td><code>db_queries_total</code>, <code>db_query_duration_seconds</code>, <code>http_client_requests_total</code></td>
</tr>
</tbody>
</table>
<h2 id="understanding-metric-types">üìä Understanding Metric Types<a class="headerlink" href="#understanding-metric-types" title="Permanent link">¬∂</a></h2>
<p>Choosing the right metric type is crucial for effective monitoring.</p>
<h3 id="counter-ever-increasing-values">Counter - Ever-Increasing Values<a class="headerlink" href="#counter-ever-increasing-values" title="Permanent link">¬∂</a></h3>
<p><strong>Definition</strong>: A cumulative metric that only increases (or resets to zero on restart).</p>
<p><strong>Use Cases</strong>:</p>
<ul>
<li>Total requests</li>
<li>Total orders</li>
<li>Total errors</li>
<li>Bytes sent/received</li>
</ul>
<p><strong>Example</strong>:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-25-1"><a href="#__codelineno-25-1" id="__codelineno-25-1" name="__codelineno-25-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">neuroglia.observability</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_meter</span>
</span><span id="__span-25-2"><a href="#__codelineno-25-2" id="__codelineno-25-2" name="__codelineno-25-2"></a>
</span><span id="__span-25-3"><a href="#__codelineno-25-3" id="__codelineno-25-3" name="__codelineno-25-3"></a><span class="n">meter</span> <span class="o">=</span> <span class="n">get_meter</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="__span-25-4"><a href="#__codelineno-25-4" id="__codelineno-25-4" name="__codelineno-25-4"></a>
</span><span id="__span-25-5"><a href="#__codelineno-25-5" id="__codelineno-25-5" name="__codelineno-25-5"></a><span class="c1"># Create counter</span>
</span><span id="__span-25-6"><a href="#__codelineno-25-6" id="__codelineno-25-6" name="__codelineno-25-6"></a><span class="n">orders_total</span> <span class="o">=</span> <span class="n">meter</span><span class="o">.</span><span class="n">create_counter</span><span class="p">(</span>
</span><span id="__span-25-7"><a href="#__codelineno-25-7" id="__codelineno-25-7" name="__codelineno-25-7"></a>    <span class="s2">"orders_created_total"</span><span class="p">,</span>
</span><span id="__span-25-8"><a href="#__codelineno-25-8" id="__codelineno-25-8" name="__codelineno-25-8"></a>    <span class="n">description</span><span class="o">=</span><span class="s2">"Total number of orders created since start"</span><span class="p">,</span>
</span><span id="__span-25-9"><a href="#__codelineno-25-9" id="__codelineno-25-9" name="__codelineno-25-9"></a>    <span class="n">unit</span><span class="o">=</span><span class="s2">"orders"</span>
</span><span id="__span-25-10"><a href="#__codelineno-25-10" id="__codelineno-25-10" name="__codelineno-25-10"></a><span class="p">)</span>
</span><span id="__span-25-11"><a href="#__codelineno-25-11" id="__codelineno-25-11" name="__codelineno-25-11"></a>
</span><span id="__span-25-12"><a href="#__codelineno-25-12" id="__codelineno-25-12" name="__codelineno-25-12"></a><span class="c1"># Increment counter</span>
</span><span id="__span-25-13"><a href="#__codelineno-25-13" id="__codelineno-25-13" name="__codelineno-25-13"></a><span class="n">orders_total</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">{</span>
</span><span id="__span-25-14"><a href="#__codelineno-25-14" id="__codelineno-25-14" name="__codelineno-25-14"></a>    <span class="s2">"customer.type"</span><span class="p">:</span> <span class="s2">"premium"</span><span class="p">,</span>
</span><span id="__span-25-15"><a href="#__codelineno-25-15" id="__codelineno-25-15" name="__codelineno-25-15"></a>    <span class="s2">"payment.method"</span><span class="p">:</span> <span class="s2">"credit_card"</span>
</span><span id="__span-25-16"><a href="#__codelineno-25-16" id="__codelineno-25-16" name="__codelineno-25-16"></a><span class="p">})</span>
</span></code></pre></div>
<p><strong>Visualization</strong>: Use <code>rate()</code> or <code>increase()</code> in Prometheus to see rate of change:</p>
<div class="language-promql highlight"><pre><span></span><code><span id="__span-26-1"><a href="#__codelineno-26-1" id="__codelineno-26-1" name="__codelineno-26-1"></a><span class="c1"># Orders per second</span>
</span><span id="__span-26-2"><a href="#__codelineno-26-2" id="__codelineno-26-2" name="__codelineno-26-2"></a><span class="kr">rate</span><span class="o">(</span><span class="ow">or</span><span class="nv">ders_created_total</span><span class="p">[</span><span class="s">5m</span><span class="p">]</span><span class="o">)</span>
</span><span id="__span-26-3"><a href="#__codelineno-26-3" id="__codelineno-26-3" name="__codelineno-26-3"></a>
</span><span id="__span-26-4"><a href="#__codelineno-26-4" id="__codelineno-26-4" name="__codelineno-26-4"></a><span class="c1"># Total orders in last hour</span>
</span><span id="__span-26-5"><a href="#__codelineno-26-5" id="__codelineno-26-5" name="__codelineno-26-5"></a><span class="kr">increase</span><span class="o">(</span><span class="ow">or</span><span class="nv">ders_created_total</span><span class="p">[</span><span class="s">1h</span><span class="p">]</span><span class="o">)</span>
</span></code></pre></div>
<p><strong>When NOT to use</strong>: For values that can decrease (use Gauge) or need percentiles (use Histogram).</p>
<h3 id="gauge-current-value">Gauge - Current Value<a class="headerlink" href="#gauge-current-value" title="Permanent link">¬∂</a></h3>
<p><strong>Definition</strong>: A metric that represents a value that can go up or down.</p>
<p><strong>Use Cases</strong>:</p>
<ul>
<li>Current active connections</li>
<li>Queue size</li>
<li>Memory usage</li>
<li>Temperature</li>
<li>Number of items in stock</li>
</ul>
<p><strong>Example</strong>:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-27-1"><a href="#__codelineno-27-1" id="__codelineno-27-1" name="__codelineno-27-1"></a><span class="c1"># Create gauge</span>
</span><span id="__span-27-2"><a href="#__codelineno-27-2" id="__codelineno-27-2" name="__codelineno-27-2"></a><span class="n">active_orders</span> <span class="o">=</span> <span class="n">meter</span><span class="o">.</span><span class="n">create_up_down_counter</span><span class="p">(</span>
</span><span id="__span-27-3"><a href="#__codelineno-27-3" id="__codelineno-27-3" name="__codelineno-27-3"></a>    <span class="s2">"active_orders_current"</span><span class="p">,</span>
</span><span id="__span-27-4"><a href="#__codelineno-27-4" id="__codelineno-27-4" name="__codelineno-27-4"></a>    <span class="n">description</span><span class="o">=</span><span class="s2">"Number of orders currently being processed"</span><span class="p">,</span>
</span><span id="__span-27-5"><a href="#__codelineno-27-5" id="__codelineno-27-5" name="__codelineno-27-5"></a>    <span class="n">unit</span><span class="o">=</span><span class="s2">"orders"</span>
</span><span id="__span-27-6"><a href="#__codelineno-27-6" id="__codelineno-27-6" name="__codelineno-27-6"></a><span class="p">)</span>
</span><span id="__span-27-7"><a href="#__codelineno-27-7" id="__codelineno-27-7" name="__codelineno-27-7"></a>
</span><span id="__span-27-8"><a href="#__codelineno-27-8" id="__codelineno-27-8" name="__codelineno-27-8"></a><span class="c1"># Increase when order starts</span>
</span><span id="__span-27-9"><a href="#__codelineno-27-9" id="__codelineno-27-9" name="__codelineno-27-9"></a><span class="n">active_orders</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">{</span><span class="s2">"kitchen.station"</span><span class="p">:</span> <span class="s2">"pizza"</span><span class="p">})</span>
</span><span id="__span-27-10"><a href="#__codelineno-27-10" id="__codelineno-27-10" name="__codelineno-27-10"></a>
</span><span id="__span-27-11"><a href="#__codelineno-27-11" id="__codelineno-27-11" name="__codelineno-27-11"></a><span class="c1"># Decrease when order completes</span>
</span><span id="__span-27-12"><a href="#__codelineno-27-12" id="__codelineno-27-12" name="__codelineno-27-12"></a><span class="n">active_orders</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">{</span><span class="s2">"kitchen.station"</span><span class="p">:</span> <span class="s2">"pizza"</span><span class="p">})</span>
</span></code></pre></div>
<p><strong>Visualization</strong>: Display current value or average:</p>
<div class="language-promql highlight"><pre><span></span><code><span id="__span-28-1"><a href="#__codelineno-28-1" id="__codelineno-28-1" name="__codelineno-28-1"></a><span class="c1"># Current active orders</span>
</span><span id="__span-28-2"><a href="#__codelineno-28-2" id="__codelineno-28-2" name="__codelineno-28-2"></a><span class="nv">active_orders_current</span>
</span><span id="__span-28-3"><a href="#__codelineno-28-3" id="__codelineno-28-3" name="__codelineno-28-3"></a>
</span><span id="__span-28-4"><a href="#__codelineno-28-4" id="__codelineno-28-4" name="__codelineno-28-4"></a><span class="c1"># Average over last 5 minutes</span>
</span><span id="__span-28-5"><a href="#__codelineno-28-5" id="__codelineno-28-5" name="__codelineno-28-5"></a><span class="kr">avg_over_time</span><span class="o">(</span><span class="nv">active_orders_current</span><span class="p">[</span><span class="s">5m</span><span class="p">]</span><span class="o">)</span>
</span></code></pre></div>
<p><strong>When NOT to use</strong>: For cumulative totals (use Counter) or distributions (use Histogram).</p>
<h3 id="histogram-distribution-of-values">Histogram - Distribution of Values<a class="headerlink" href="#histogram-distribution-of-values" title="Permanent link">¬∂</a></h3>
<p><strong>Definition</strong>: Samples observations and counts them in configurable buckets.</p>
<p><strong>Use Cases</strong>:</p>
<ul>
<li>Request duration (latency)</li>
<li>Response sizes</li>
<li>Order values</li>
<li>Queue wait times</li>
</ul>
<p><strong>Example</strong>:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-29-1"><a href="#__codelineno-29-1" id="__codelineno-29-1" name="__codelineno-29-1"></a><span class="c1"># Create histogram</span>
</span><span id="__span-29-2"><a href="#__codelineno-29-2" id="__codelineno-29-2" name="__codelineno-29-2"></a><span class="n">order_value_histogram</span> <span class="o">=</span> <span class="n">meter</span><span class="o">.</span><span class="n">create_histogram</span><span class="p">(</span>
</span><span id="__span-29-3"><a href="#__codelineno-29-3" id="__codelineno-29-3" name="__codelineno-29-3"></a>    <span class="s2">"order_value_usd"</span><span class="p">,</span>
</span><span id="__span-29-4"><a href="#__codelineno-29-4" id="__codelineno-29-4" name="__codelineno-29-4"></a>    <span class="n">description</span><span class="o">=</span><span class="s2">"Distribution of order values"</span><span class="p">,</span>
</span><span id="__span-29-5"><a href="#__codelineno-29-5" id="__codelineno-29-5" name="__codelineno-29-5"></a>    <span class="n">unit</span><span class="o">=</span><span class="s2">"USD"</span>
</span><span id="__span-29-6"><a href="#__codelineno-29-6" id="__codelineno-29-6" name="__codelineno-29-6"></a><span class="p">)</span>
</span><span id="__span-29-7"><a href="#__codelineno-29-7" id="__codelineno-29-7" name="__codelineno-29-7"></a>
</span><span id="__span-29-8"><a href="#__codelineno-29-8" id="__codelineno-29-8" name="__codelineno-29-8"></a><span class="c1"># Record observations</span>
</span><span id="__span-29-9"><a href="#__codelineno-29-9" id="__codelineno-29-9" name="__codelineno-29-9"></a><span class="n">order_value_histogram</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="mf">45.99</span><span class="p">,</span> <span class="p">{</span><span class="s2">"customer.type"</span><span class="p">:</span> <span class="s2">"regular"</span><span class="p">})</span>
</span><span id="__span-29-10"><a href="#__codelineno-29-10" id="__codelineno-29-10" name="__codelineno-29-10"></a><span class="n">order_value_histogram</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="mf">125.50</span><span class="p">,</span> <span class="p">{</span><span class="s2">"customer.type"</span><span class="p">:</span> <span class="s2">"premium"</span><span class="p">})</span>
</span><span id="__span-29-11"><a href="#__codelineno-29-11" id="__codelineno-29-11" name="__codelineno-29-11"></a><span class="n">order_value_histogram</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="mf">22.00</span><span class="p">,</span> <span class="p">{</span><span class="s2">"customer.type"</span><span class="p">:</span> <span class="s2">"regular"</span><span class="p">})</span>
</span></code></pre></div>
<p><strong>Visualization</strong>: Calculate percentiles and averages:</p>
<div class="language-promql highlight"><pre><span></span><code><span id="__span-30-1"><a href="#__codelineno-30-1" id="__codelineno-30-1" name="__codelineno-30-1"></a><span class="c1"># 95th percentile order value</span>
</span><span id="__span-30-2"><a href="#__codelineno-30-2" id="__codelineno-30-2" name="__codelineno-30-2"></a><span class="kr">histogram_quantile</span><span class="o">(</span><span class="mf">0.95</span><span class="p">,</span><span class="w"> </span><span class="kr">rate</span><span class="o">(</span><span class="ow">or</span><span class="nv">der_value_usd_bucket</span><span class="p">[</span><span class="s">5m</span><span class="p">]</span><span class="o">))</span>
</span><span id="__span-30-3"><a href="#__codelineno-30-3" id="__codelineno-30-3" name="__codelineno-30-3"></a>
</span><span id="__span-30-4"><a href="#__codelineno-30-4" id="__codelineno-30-4" name="__codelineno-30-4"></a><span class="c1"># Average order value</span>
</span><span id="__span-30-5"><a href="#__codelineno-30-5" id="__codelineno-30-5" name="__codelineno-30-5"></a><span class="kr">rate</span><span class="o">(</span><span class="ow">or</span><span class="nv">der_value_usd_sum</span><span class="p">[</span><span class="s">5m</span><span class="p">]</span><span class="o">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="kr">rate</span><span class="o">(</span><span class="ow">or</span><span class="nv">der_value_usd_count</span><span class="p">[</span><span class="s">5m</span><span class="p">]</span><span class="o">)</span>
</span><span id="__span-30-6"><a href="#__codelineno-30-6" id="__codelineno-30-6" name="__codelineno-30-6"></a>
</span><span id="__span-30-7"><a href="#__codelineno-30-7" id="__codelineno-30-7" name="__codelineno-30-7"></a><span class="c1"># Orders over $100</span>
</span><span id="__span-30-8"><a href="#__codelineno-30-8" id="__codelineno-30-8" name="__codelineno-30-8"></a><span class="k">sum</span><span class="o">(</span><span class="kr">rate</span><span class="o">(</span><span class="ow">or</span><span class="nv">der_value_usd_bucket</span><span class="p">{</span><span class="nl">le</span><span class="o">=</span><span class="p">"</span><span class="s">100</span><span class="p">"}[</span><span class="s">5m</span><span class="p">]</span><span class="o">))</span>
</span></code></pre></div>
<p><strong>Key Benefits</strong>:</p>
<ul>
<li>Calculate percentiles (p50, p95, p99)</li>
<li>Understand distribution of values</li>
<li>Identify outliers</li>
<li>Aggregate across dimensions</li>
</ul>
<p><strong>When NOT to use</strong>: For simple counts (use Counter) or current values (use Gauge).</p>
<h3 id="comparison-table">Comparison Table<a class="headerlink" href="#comparison-table" title="Permanent link">¬∂</a></h3>
<table>
<thead>
<tr>
<th>Metric Type</th>
<th>Direction</th>
<th>Use For</th>
<th>Query Functions</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Counter</strong></td>
<td>‚ÜóÔ∏è Only increases</td>
<td>Cumulative totals</td>
<td><code>rate()</code>, <code>increase()</code></td>
</tr>
<tr>
<td><strong>Gauge</strong></td>
<td>‚ÜïÔ∏è Up and down</td>
<td>Current values</td>
<td>Direct value, <code>avg_over_time()</code></td>
</tr>
<tr>
<td><strong>Histogram</strong></td>
<td>üìä Distribution</td>
<td>Latency, sizes</td>
<td><code>histogram_quantile()</code>, percentiles</td>
</tr>
</tbody>
</table>
<h3 id="real-world-metric-examples">Real-World Metric Examples<a class="headerlink" href="#real-world-metric-examples" title="Permanent link">¬∂</a></h3>
<div class="language-python highlight"><pre><span></span><code><span id="__span-31-1"><a href="#__codelineno-31-1" id="__codelineno-31-1" name="__codelineno-31-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">neuroglia.observability</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_meter</span>
</span><span id="__span-31-2"><a href="#__codelineno-31-2" id="__codelineno-31-2" name="__codelineno-31-2"></a>
</span><span id="__span-31-3"><a href="#__codelineno-31-3" id="__codelineno-31-3" name="__codelineno-31-3"></a><span class="n">meter</span> <span class="o">=</span> <span class="n">get_meter</span><span class="p">(</span><span class="s2">"mario.pizzeria"</span><span class="p">)</span>
</span><span id="__span-31-4"><a href="#__codelineno-31-4" id="__codelineno-31-4" name="__codelineno-31-4"></a>
</span><span id="__span-31-5"><a href="#__codelineno-31-5" id="__codelineno-31-5" name="__codelineno-31-5"></a><span class="c1"># Counter: Track total pizzas made</span>
</span><span id="__span-31-6"><a href="#__codelineno-31-6" id="__codelineno-31-6" name="__codelineno-31-6"></a><span class="n">pizzas_made</span> <span class="o">=</span> <span class="n">meter</span><span class="o">.</span><span class="n">create_counter</span><span class="p">(</span>
</span><span id="__span-31-7"><a href="#__codelineno-31-7" id="__codelineno-31-7" name="__codelineno-31-7"></a>    <span class="s2">"pizzas_made_total"</span><span class="p">,</span>
</span><span id="__span-31-8"><a href="#__codelineno-31-8" id="__codelineno-31-8" name="__codelineno-31-8"></a>    <span class="n">description</span><span class="o">=</span><span class="s2">"Total pizzas prepared"</span><span class="p">,</span>
</span><span id="__span-31-9"><a href="#__codelineno-31-9" id="__codelineno-31-9" name="__codelineno-31-9"></a>    <span class="n">unit</span><span class="o">=</span><span class="s2">"pizzas"</span>
</span><span id="__span-31-10"><a href="#__codelineno-31-10" id="__codelineno-31-10" name="__codelineno-31-10"></a><span class="p">)</span>
</span><span id="__span-31-11"><a href="#__codelineno-31-11" id="__codelineno-31-11" name="__codelineno-31-11"></a><span class="n">pizzas_made</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">{</span><span class="s2">"type"</span><span class="p">:</span> <span class="s2">"margherita"</span><span class="p">,</span> <span class="s2">"size"</span><span class="p">:</span> <span class="s2">"large"</span><span class="p">})</span>
</span><span id="__span-31-12"><a href="#__codelineno-31-12" id="__codelineno-31-12" name="__codelineno-31-12"></a>
</span><span id="__span-31-13"><a href="#__codelineno-31-13" id="__codelineno-31-13" name="__codelineno-31-13"></a><span class="c1"># Gauge: Track current oven temperature</span>
</span><span id="__span-31-14"><a href="#__codelineno-31-14" id="__codelineno-31-14" name="__codelineno-31-14"></a><span class="n">oven_temp</span> <span class="o">=</span> <span class="n">meter</span><span class="o">.</span><span class="n">create_up_down_counter</span><span class="p">(</span>
</span><span id="__span-31-15"><a href="#__codelineno-31-15" id="__codelineno-31-15" name="__codelineno-31-15"></a>    <span class="s2">"oven_temperature_celsius"</span><span class="p">,</span>
</span><span id="__span-31-16"><a href="#__codelineno-31-16" id="__codelineno-31-16" name="__codelineno-31-16"></a>    <span class="n">description</span><span class="o">=</span><span class="s2">"Current oven temperature"</span><span class="p">,</span>
</span><span id="__span-31-17"><a href="#__codelineno-31-17" id="__codelineno-31-17" name="__codelineno-31-17"></a>    <span class="n">unit</span><span class="o">=</span><span class="s2">"celsius"</span>
</span><span id="__span-31-18"><a href="#__codelineno-31-18" id="__codelineno-31-18" name="__codelineno-31-18"></a><span class="p">)</span>
</span><span id="__span-31-19"><a href="#__codelineno-31-19" id="__codelineno-31-19" name="__codelineno-31-19"></a><span class="n">oven_temp</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="p">{})</span>  <span class="c1"># Heating up</span>
</span><span id="__span-31-20"><a href="#__codelineno-31-20" id="__codelineno-31-20" name="__codelineno-31-20"></a><span class="n">oven_temp</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="p">{})</span>  <span class="c1"># Cooling down</span>
</span><span id="__span-31-21"><a href="#__codelineno-31-21" id="__codelineno-31-21" name="__codelineno-31-21"></a>
</span><span id="__span-31-22"><a href="#__codelineno-31-22" id="__codelineno-31-22" name="__codelineno-31-22"></a><span class="c1"># Histogram: Track pizza prep time</span>
</span><span id="__span-31-23"><a href="#__codelineno-31-23" id="__codelineno-31-23" name="__codelineno-31-23"></a><span class="n">prep_time</span> <span class="o">=</span> <span class="n">meter</span><span class="o">.</span><span class="n">create_histogram</span><span class="p">(</span>
</span><span id="__span-31-24"><a href="#__codelineno-31-24" id="__codelineno-31-24" name="__codelineno-31-24"></a>    <span class="s2">"pizza_prep_duration_seconds"</span><span class="p">,</span>
</span><span id="__span-31-25"><a href="#__codelineno-31-25" id="__codelineno-31-25" name="__codelineno-31-25"></a>    <span class="n">description</span><span class="o">=</span><span class="s2">"Time to prepare a pizza"</span><span class="p">,</span>
</span><span id="__span-31-26"><a href="#__codelineno-31-26" id="__codelineno-31-26" name="__codelineno-31-26"></a>    <span class="n">unit</span><span class="o">=</span><span class="s2">"seconds"</span>
</span><span id="__span-31-27"><a href="#__codelineno-31-27" id="__codelineno-31-27" name="__codelineno-31-27"></a><span class="p">)</span>
</span><span id="__span-31-28"><a href="#__codelineno-31-28" id="__codelineno-31-28" name="__codelineno-31-28"></a><span class="n">prep_time</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="mi">180</span><span class="p">,</span> <span class="p">{</span><span class="s2">"type"</span><span class="p">:</span> <span class="s2">"margherita"</span><span class="p">})</span>  <span class="c1"># 3 minutes</span>
</span><span id="__span-31-29"><a href="#__codelineno-31-29" id="__codelineno-31-29" name="__codelineno-31-29"></a><span class="n">prep_time</span><span class="o">.</span><span class="n">record</span><span class="p">(</span><span class="mi">420</span><span class="p">,</span> <span class="p">{</span><span class="s2">"type"</span><span class="p">:</span> <span class="s2">"suprema"</span><span class="p">})</span>     <span class="c1"># 7 minutes</span>
</span></code></pre></div>
<h2 id="data-flow-explained">üåä Data Flow Explained<a class="headerlink" href="#data-flow-explained" title="Permanent link">¬∂</a></h2>
<p>Understanding how your telemetry data flows from application to dashboard is key to troubleshooting and optimization.</p>
<h3 id="complete-data-flow-architecture">Complete Data Flow Architecture<a class="headerlink" href="#complete-data-flow-architecture" title="Permanent link">¬∂</a></h3>
<pre class="mermaid"><code>sequenceDiagram
    participant App as Your Application
    participant SDK as OTEL SDK
    participant Coll as OTEL Collector
    participant Tempo as Tempo
    participant Prom as Prometheus
    participant Loki as Loki
    participant Graf as Grafana

    Note over App,SDK: 1. Instrumentation
    App-&gt;&gt;SDK: Create span
    App-&gt;&gt;SDK: Record metric
    App-&gt;&gt;SDK: Write log

    Note over SDK,Coll: 2. Export (OTLP)
    SDK-&gt;&gt;SDK: Batch telemetry
    SDK-&gt;&gt;Coll: OTLP gRPC (port 4317)

    Note over Coll: 3. Processing
    Coll-&gt;&gt;Coll: Receive via OTLP receiver
    Coll-&gt;&gt;Coll: Process (batch, filter, enrich)

    Note over Coll,Loki: 4. Export to Backends
    Coll-&gt;&gt;Tempo: Push traces (OTLP)
    Coll-&gt;&gt;Prom: Expose metrics (port 8889)
    Coll-&gt;&gt;Loki: Push logs (HTTP)

    Note over Prom,Graf: 5. Scraping
    Prom-&gt;&gt;Coll: Scrape metrics (pull)

    Note over Graf: 6. Visualization
    Graf-&gt;&gt;Tempo: Query traces
    Graf-&gt;&gt;Prom: Query metrics (PromQL)
    Graf-&gt;&gt;Loki: Query logs (LogQL)
    Graf-&gt;&gt;Graf: Render dashboard</code></pre>
<h3 id="step-by-step-flow">Step-by-Step Flow<a class="headerlink" href="#step-by-step-flow" title="Permanent link">¬∂</a></h3>
<h4 id="step-1-application-instrumentation">Step 1: Application Instrumentation<a class="headerlink" href="#step-1-application-instrumentation" title="Permanent link">¬∂</a></h4>
<div class="language-python highlight"><pre><span></span><code><span id="__span-32-1"><a href="#__codelineno-32-1" id="__codelineno-32-1" name="__codelineno-32-1"></a><span class="c1"># In your application code</span>
</span><span id="__span-32-2"><a href="#__codelineno-32-2" id="__codelineno-32-2" name="__codelineno-32-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">neuroglia.observability</span><span class="w"> </span><span class="kn">import</span> <span class="n">trace_async</span><span class="p">,</span> <span class="n">get_meter</span>
</span><span id="__span-32-3"><a href="#__codelineno-32-3" id="__codelineno-32-3" name="__codelineno-32-3"></a>
</span><span id="__span-32-4"><a href="#__codelineno-32-4" id="__codelineno-32-4" name="__codelineno-32-4"></a><span class="nd">@trace_async</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"process_order"</span><span class="p">)</span>
</span><span id="__span-32-5"><a href="#__codelineno-32-5" id="__codelineno-32-5" name="__codelineno-32-5"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">process_order</span><span class="p">(</span><span class="n">order_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-32-6"><a href="#__codelineno-32-6" id="__codelineno-32-6" name="__codelineno-32-6"></a>    <span class="c1"># Creates a span</span>
</span><span id="__span-32-7"><a href="#__codelineno-32-7" id="__codelineno-32-7" name="__codelineno-32-7"></a>    <span class="n">meter</span> <span class="o">=</span> <span class="n">get_meter</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="__span-32-8"><a href="#__codelineno-32-8" id="__codelineno-32-8" name="__codelineno-32-8"></a>    <span class="n">counter</span> <span class="o">=</span> <span class="n">meter</span><span class="o">.</span><span class="n">create_counter</span><span class="p">(</span><span class="s2">"orders_processed"</span><span class="p">)</span>
</span><span id="__span-32-9"><a href="#__codelineno-32-9" id="__codelineno-32-9" name="__codelineno-32-9"></a>    <span class="n">counter</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Records a metric</span>
</span><span id="__span-32-10"><a href="#__codelineno-32-10" id="__codelineno-32-10" name="__codelineno-32-10"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Processing </span><span class="si">{</span><span class="n">order_id</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>  <span class="c1"># Writes a log</span>
</span></code></pre></div>
<p><strong>What happens</strong>:</p>
<ol>
<li><code>@trace_async</code> creates a span with start time</li>
<li><code>counter.add()</code> increments a metric</li>
<li><code>logger.info()</code> writes a structured log with trace context</li>
<li>Span ends with duration calculated</li>
</ol>
<h4 id="step-2-otel-sdk-batching">Step 2: OTEL SDK Batching<a class="headerlink" href="#step-2-otel-sdk-batching" title="Permanent link">¬∂</a></h4>
<div class="language-python highlight"><pre><span></span><code><span id="__span-33-1"><a href="#__codelineno-33-1" id="__codelineno-33-1" name="__codelineno-33-1"></a><span class="c1"># Configured in neuroglia.observability</span>
</span><span id="__span-33-2"><a href="#__codelineno-33-2" id="__codelineno-33-2" name="__codelineno-33-2"></a><span class="n">configure_opentelemetry</span><span class="p">(</span>
</span><span id="__span-33-3"><a href="#__codelineno-33-3" id="__codelineno-33-3" name="__codelineno-33-3"></a>    <span class="n">batch_span_processor_max_queue_size</span><span class="o">=</span><span class="mi">2048</span><span class="p">,</span>
</span><span id="__span-33-4"><a href="#__codelineno-33-4" id="__codelineno-33-4" name="__codelineno-33-4"></a>    <span class="n">batch_span_processor_schedule_delay_millis</span><span class="o">=</span><span class="mi">5000</span><span class="p">,</span>  <span class="c1"># Export every 5s</span>
</span><span id="__span-33-5"><a href="#__codelineno-33-5" id="__codelineno-33-5" name="__codelineno-33-5"></a>    <span class="n">metric_export_interval_millis</span><span class="o">=</span><span class="mi">60000</span>  <span class="c1"># Export every 60s</span>
</span><span id="__span-33-6"><a href="#__codelineno-33-6" id="__codelineno-33-6" name="__codelineno-33-6"></a><span class="p">)</span>
</span></code></pre></div>
<p><strong>What happens</strong>:</p>
<ol>
<li>SDK accumulates spans in memory (up to 2048)</li>
<li>Every 5 seconds, batches are exported</li>
<li>Metrics are aggregated and exported every 60 seconds</li>
<li>Logs are batched and sent with trace context</li>
</ol>
<p><strong>Why batching matters</strong>:</p>
<ul>
<li>Reduces network overhead</li>
<li>Improves application performance</li>
<li>Prevents overwhelming the collector</li>
</ul>
<h4 id="step-3-otel-collector-processing">Step 3: OTEL Collector Processing<a class="headerlink" href="#step-3-otel-collector-processing" title="Permanent link">¬∂</a></h4>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-34-1"><a href="#__codelineno-34-1" id="__codelineno-34-1" name="__codelineno-34-1"></a><span class="nt">processors</span><span class="p">:</span>
</span><span id="__span-34-2"><a href="#__codelineno-34-2" id="__codelineno-34-2" name="__codelineno-34-2"></a><span class="w">  </span><span class="nt">batch</span><span class="p">:</span>
</span><span id="__span-34-3"><a href="#__codelineno-34-3" id="__codelineno-34-3" name="__codelineno-34-3"></a><span class="w">    </span><span class="nt">timeout</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10s</span>
</span><span id="__span-34-4"><a href="#__codelineno-34-4" id="__codelineno-34-4" name="__codelineno-34-4"></a><span class="w">    </span><span class="nt">send_batch_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1024</span>
</span><span id="__span-34-5"><a href="#__codelineno-34-5" id="__codelineno-34-5" name="__codelineno-34-5"></a>
</span><span id="__span-34-6"><a href="#__codelineno-34-6" id="__codelineno-34-6" name="__codelineno-34-6"></a><span class="w">  </span><span class="nt">memory_limiter</span><span class="p">:</span>
</span><span id="__span-34-7"><a href="#__codelineno-34-7" id="__codelineno-34-7" name="__codelineno-34-7"></a><span class="w">    </span><span class="nt">limit_mib</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">512</span>
</span><span id="__span-34-8"><a href="#__codelineno-34-8" id="__codelineno-34-8" name="__codelineno-34-8"></a><span class="w">    </span><span class="nt">spike_limit_mib</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">128</span>
</span><span id="__span-34-9"><a href="#__codelineno-34-9" id="__codelineno-34-9" name="__codelineno-34-9"></a>
</span><span id="__span-34-10"><a href="#__codelineno-34-10" id="__codelineno-34-10" name="__codelineno-34-10"></a><span class="w">  </span><span class="nt">resource</span><span class="p">:</span>
</span><span id="__span-34-11"><a href="#__codelineno-34-11" id="__codelineno-34-11" name="__codelineno-34-11"></a><span class="w">    </span><span class="nt">attributes</span><span class="p">:</span>
</span><span id="__span-34-12"><a href="#__codelineno-34-12" id="__codelineno-34-12" name="__codelineno-34-12"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">environment</span>
</span><span id="__span-34-13"><a href="#__codelineno-34-13" id="__codelineno-34-13" name="__codelineno-34-13"></a><span class="w">        </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
</span><span id="__span-34-14"><a href="#__codelineno-34-14" id="__codelineno-34-14" name="__codelineno-34-14"></a><span class="w">        </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">upsert</span>
</span></code></pre></div>
<p><strong>What happens</strong>:</p>
<ol>
<li><strong>Receiver</strong> accepts OTLP data on port 4317</li>
<li><strong>Batch Processor</strong> combines multiple signals</li>
<li><strong>Memory Limiter</strong> prevents OOM crashes</li>
<li><strong>Resource Processor</strong> adds common attributes</li>
<li><strong>Exporters</strong> send to respective backends</li>
</ol>
<p><strong>Why use collector</strong>:</p>
<ul>
<li>Centralized configuration</li>
<li>Data transformation and filtering</li>
<li>Multiple export destinations</li>
<li>Resilience and buffering</li>
</ul>
<h4 id="step-4-storage-in-backends">Step 4: Storage in Backends<a class="headerlink" href="#step-4-storage-in-backends" title="Permanent link">¬∂</a></h4>
<p><strong>Tempo (Traces)</strong>:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-35-1"><a href="#__codelineno-35-1" id="__codelineno-35-1" name="__codelineno-35-1"></a>Trace stored as:
</span><span id="__span-35-2"><a href="#__codelineno-35-2" id="__codelineno-35-2" name="__codelineno-35-2"></a>{
</span><span id="__span-35-3"><a href="#__codelineno-35-3" id="__codelineno-35-3" name="__codelineno-35-3"></a>  "traceID": "abc123...",
</span><span id="__span-35-4"><a href="#__codelineno-35-4" id="__codelineno-35-4" name="__codelineno-35-4"></a>  "spans": [
</span><span id="__span-35-5"><a href="#__codelineno-35-5" id="__codelineno-35-5" name="__codelineno-35-5"></a>    {
</span><span id="__span-35-6"><a href="#__codelineno-35-6" id="__codelineno-35-6" name="__codelineno-35-6"></a>      "spanID": "xyz789...",
</span><span id="__span-35-7"><a href="#__codelineno-35-7" id="__codelineno-35-7" name="__codelineno-35-7"></a>      "name": "process_order",
</span><span id="__span-35-8"><a href="#__codelineno-35-8" id="__codelineno-35-8" name="__codelineno-35-8"></a>      "startTime": 1699000000000,
</span><span id="__span-35-9"><a href="#__codelineno-35-9" id="__codelineno-35-9" name="__codelineno-35-9"></a>      "duration": 1250000,  // microseconds
</span><span id="__span-35-10"><a href="#__codelineno-35-10" id="__codelineno-35-10" name="__codelineno-35-10"></a>      "attributes": {...}
</span><span id="__span-35-11"><a href="#__codelineno-35-11" id="__codelineno-35-11" name="__codelineno-35-11"></a>    }
</span><span id="__span-35-12"><a href="#__codelineno-35-12" id="__codelineno-35-12" name="__codelineno-35-12"></a>  ]
</span><span id="__span-35-13"><a href="#__codelineno-35-13" id="__codelineno-35-13" name="__codelineno-35-13"></a>}
</span></code></pre></div>
<p><strong>Prometheus (Metrics)</strong>:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-36-1"><a href="#__codelineno-36-1" id="__codelineno-36-1" name="__codelineno-36-1"></a># Time-series stored as:
</span><span id="__span-36-2"><a href="#__codelineno-36-2" id="__codelineno-36-2" name="__codelineno-36-2"></a>orders_processed_total{service="mario-pizzeria",env="prod"} 1247 @1699000000
</span><span id="__span-36-3"><a href="#__codelineno-36-3" id="__codelineno-36-3" name="__codelineno-36-3"></a>orders_processed_total{service="mario-pizzeria",env="prod"} 1248 @1699000015
</span></code></pre></div>
<p><strong>Loki (Logs)</strong>:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-37-1"><a href="#__codelineno-37-1" id="__codelineno-37-1" name="__codelineno-37-1"></a>{
</span><span id="__span-37-2"><a href="#__codelineno-37-2" id="__codelineno-37-2" name="__codelineno-37-2"></a>  "timestamp": "2025-11-02T12:34:56Z",
</span><span id="__span-37-3"><a href="#__codelineno-37-3" id="__codelineno-37-3" name="__codelineno-37-3"></a>  "level": "INFO",
</span><span id="__span-37-4"><a href="#__codelineno-37-4" id="__codelineno-37-4" name="__codelineno-37-4"></a>  "message": "Processing ORD-1234",
</span><span id="__span-37-5"><a href="#__codelineno-37-5" id="__codelineno-37-5" name="__codelineno-37-5"></a>  "trace_id": "abc123",
</span><span id="__span-37-6"><a href="#__codelineno-37-6" id="__codelineno-37-6" name="__codelineno-37-6"></a>  "span_id": "xyz789",
</span><span id="__span-37-7"><a href="#__codelineno-37-7" id="__codelineno-37-7" name="__codelineno-37-7"></a>  "service": "mario-pizzeria"
</span><span id="__span-37-8"><a href="#__codelineno-37-8" id="__codelineno-37-8" name="__codelineno-37-8"></a>}
</span></code></pre></div>
<h4 id="step-5-grafana-queries-and-correlation">Step 5: Grafana Queries and Correlation<a class="headerlink" href="#step-5-grafana-queries-and-correlation" title="Permanent link">¬∂</a></h4>
<p><strong>Trace ‚Üí Metrics</strong> (Exemplars):</p>
<div class="language-promql highlight"><pre><span></span><code><span id="__span-38-1"><a href="#__codelineno-38-1" id="__codelineno-38-1" name="__codelineno-38-1"></a><span class="c1"># Query shows metrics with links to traces</span>
</span><span id="__span-38-2"><a href="#__codelineno-38-2" id="__codelineno-38-2" name="__codelineno-38-2"></a><span class="kr">rate</span><span class="o">(</span><span class="nv">http_request_duration_seconds_bucket</span><span class="p">[</span><span class="s">5m</span><span class="p">]</span><span class="o">)</span>
</span><span id="__span-38-3"><a href="#__codelineno-38-3" id="__codelineno-38-3" name="__codelineno-38-3"></a><span class="c1"># Click on data point ‚Üí opens trace in Tempo</span>
</span></code></pre></div>
<p><strong>Trace ‚Üí Logs</strong> (Trace ID):</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-39-1"><a href="#__codelineno-39-1" id="__codelineno-39-1" name="__codelineno-39-1"></a># Find logs for specific trace
</span><span id="__span-39-2"><a href="#__codelineno-39-2" id="__codelineno-39-2" name="__codelineno-39-2"></a>{service="mario-pizzeria"} | json | trace_id="abc123"
</span></code></pre></div>
<p><strong>Metrics ‚Üí Traces</strong> (Service Map):</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-40-1"><a href="#__codelineno-40-1" id="__codelineno-40-1" name="__codelineno-40-1"></a>Prometheus metrics ‚Üí Tempo service map ‚Üí Trace details
</span></code></pre></div>
<h3 id="why-this-architecture">Why This Architecture?<a class="headerlink" href="#why-this-architecture" title="Permanent link">¬∂</a></h3>
<p><strong>Benefits</strong>:</p>
<ol>
<li>
<p><strong>Separation of Concerns</strong></p>
</li>
<li>
<p>App focuses on business logic</p>
</li>
<li>SDK handles telemetry</li>
<li>
<p>Collector handles routing</p>
</li>
<li>
<p><strong>Performance</strong></p>
</li>
<li>
<p>Batching reduces overhead</p>
</li>
<li>Async export doesn't block app</li>
<li>
<p>Collector buffers during outages</p>
</li>
<li>
<p><strong>Flexibility</strong></p>
</li>
<li>
<p>Change backends without code changes</p>
</li>
<li>Add new exporters easily</li>
<li>
<p>Test with console exporter</p>
</li>
<li>
<p><strong>Observability of Observability</strong></p>
</li>
<li>Collector exposes its own metrics</li>
<li>Monitor data flow health</li>
<li>Track export failures</li>
</ol>
<h3 id="data-flow-performance-impact">Data Flow Performance Impact<a class="headerlink" href="#data-flow-performance-impact" title="Permanent link">¬∂</a></h3>
<table>
<thead>
<tr>
<th>Component</th>
<th>Overhead</th>
<th>Mitigation</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>SDK Instrumentation</strong></td>
<td>&lt; 1ms per span</td>
<td>Use sampling for high-volume</td>
</tr>
<tr>
<td><strong>Batching</strong></td>
<td>Memory: ~10MB</td>
<td>Configure batch sizes</td>
</tr>
<tr>
<td><strong>Network Export</strong></td>
<td>Async, non-blocking</td>
<td>Collector handles retries</td>
</tr>
<tr>
<td><strong>Collector Processing</strong></td>
<td>CPU: 5-10%</td>
<td>Scale collectors horizontally</td>
</tr>
</tbody>
</table>
<h3 id="monitoring-the-data-flow">Monitoring the Data Flow<a class="headerlink" href="#monitoring-the-data-flow" title="Permanent link">¬∂</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-41-1"><a href="#__codelineno-41-1" id="__codelineno-41-1" name="__codelineno-41-1"></a><span class="c1"># Check app is exporting</span>
</span><span id="__span-41-2"><a href="#__codelineno-41-2" id="__codelineno-41-2" name="__codelineno-41-2"></a>curl<span class="w"> </span>http://localhost:8888/metrics<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>otelcol_receiver
</span><span id="__span-41-3"><a href="#__codelineno-41-3" id="__codelineno-41-3" name="__codelineno-41-3"></a>
</span><span id="__span-41-4"><a href="#__codelineno-41-4" id="__codelineno-41-4" name="__codelineno-41-4"></a><span class="c1"># Check collector is receiving</span>
</span><span id="__span-41-5"><a href="#__codelineno-41-5" id="__codelineno-41-5" name="__codelineno-41-5"></a>curl<span class="w"> </span>http://localhost:8888/metrics<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>otelcol_receiver_accepted
</span><span id="__span-41-6"><a href="#__codelineno-41-6" id="__codelineno-41-6" name="__codelineno-41-6"></a>
</span><span id="__span-41-7"><a href="#__codelineno-41-7" id="__codelineno-41-7" name="__codelineno-41-7"></a><span class="c1"># Check collector is exporting</span>
</span><span id="__span-41-8"><a href="#__codelineno-41-8" id="__codelineno-41-8" name="__codelineno-41-8"></a>curl<span class="w"> </span>http://localhost:8888/metrics<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>otelcol_exporter_sent
</span><span id="__span-41-9"><a href="#__codelineno-41-9" id="__codelineno-41-9" name="__codelineno-41-9"></a>
</span><span id="__span-41-10"><a href="#__codelineno-41-10" id="__codelineno-41-10" name="__codelineno-41-10"></a><span class="c1"># Check Tempo is receiving</span>
</span><span id="__span-41-11"><a href="#__codelineno-41-11" id="__codelineno-41-11" name="__codelineno-41-11"></a>curl<span class="w"> </span>http://localhost:3200/metrics<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>tempo_ingester_traces_created_total
</span><span id="__span-41-12"><a href="#__codelineno-41-12" id="__codelineno-41-12" name="__codelineno-41-12"></a>
</span><span id="__span-41-13"><a href="#__codelineno-41-13" id="__codelineno-41-13" name="__codelineno-41-13"></a><span class="c1"># Check Prometheus is scraping</span>
</span><span id="__span-41-14"><a href="#__codelineno-41-14" id="__codelineno-41-14" name="__codelineno-41-14"></a>curl<span class="w"> </span>http://localhost:9090/api/v1/targets
</span><span id="__span-41-15"><a href="#__codelineno-41-15" id="__codelineno-41-15" name="__codelineno-41-15"></a>
</span><span id="__span-41-16"><a href="#__codelineno-41-16" id="__codelineno-41-16" name="__codelineno-41-16"></a><span class="c1"># Check Loki is receiving</span>
</span><span id="__span-41-17"><a href="#__codelineno-41-17" id="__codelineno-41-17" name="__codelineno-41-17"></a>curl<span class="w"> </span>http://localhost:3100/metrics<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>loki_distributor_lines_received_total
</span></code></pre></div>
<h2 id="real-world-example-marios-pizzeria">ÔøΩüí° Real-World Example: Mario's Pizzeria<a class="headerlink" href="#real-world-example-marios-pizzeria" title="Permanent link">¬∂</a></h2>
<p>Complete observability setup for Mario's Pizzeria:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-42-1"><a href="#__codelineno-42-1" id="__codelineno-42-1" name="__codelineno-42-1"></a><span class="c1"># settings.py</span>
</span><span id="__span-42-2"><a href="#__codelineno-42-2" id="__codelineno-42-2" name="__codelineno-42-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">neuroglia.observability</span><span class="w"> </span><span class="kn">import</span> <span class="n">ApplicationSettingsWithObservability</span>
</span><span id="__span-42-3"><a href="#__codelineno-42-3" id="__codelineno-42-3" name="__codelineno-42-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">Field</span>
</span><span id="__span-42-4"><a href="#__codelineno-42-4" id="__codelineno-42-4" name="__codelineno-42-4"></a>
</span><span id="__span-42-5"><a href="#__codelineno-42-5" id="__codelineno-42-5" name="__codelineno-42-5"></a><span class="k">class</span><span class="w"> </span><span class="nc">PizzeriaSettings</span><span class="p">(</span><span class="n">ApplicationSettingsWithObservability</span><span class="p">):</span>
</span><span id="__span-42-6"><a href="#__codelineno-42-6" id="__codelineno-42-6" name="__codelineno-42-6"></a>    <span class="c1"># Application settings</span>
</span><span id="__span-42-7"><a href="#__codelineno-42-7" id="__codelineno-42-7" name="__codelineno-42-7"></a>    <span class="n">database_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">"mongodb://localhost:27017"</span><span class="p">)</span>
</span><span id="__span-42-8"><a href="#__codelineno-42-8" id="__codelineno-42-8" name="__codelineno-42-8"></a>    <span class="n">redis_url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s2">"redis://localhost:6379"</span><span class="p">)</span>
</span><span id="__span-42-9"><a href="#__codelineno-42-9" id="__codelineno-42-9" name="__codelineno-42-9"></a>
</span><span id="__span-42-10"><a href="#__codelineno-42-10" id="__codelineno-42-10" name="__codelineno-42-10"></a>    <span class="c1"># Observability settings (inherited):</span>
</span><span id="__span-42-11"><a href="#__codelineno-42-11" id="__codelineno-42-11" name="__codelineno-42-11"></a>    <span class="c1"># service_name: str = "mario-pizzeria"</span>
</span><span id="__span-42-12"><a href="#__codelineno-42-12" id="__codelineno-42-12" name="__codelineno-42-12"></a>    <span class="c1"># service_version: str = "1.0.0"</span>
</span><span id="__span-42-13"><a href="#__codelineno-42-13" id="__codelineno-42-13" name="__codelineno-42-13"></a>    <span class="c1"># otel_enabled: bool = True</span>
</span><span id="__span-42-14"><a href="#__codelineno-42-14" id="__codelineno-42-14" name="__codelineno-42-14"></a>    <span class="c1"># otel_endpoint: str = "http://otel-collector:4317"</span>
</span><span id="__span-42-15"><a href="#__codelineno-42-15" id="__codelineno-42-15" name="__codelineno-42-15"></a>    <span class="c1"># tracing_enabled: bool = True</span>
</span><span id="__span-42-16"><a href="#__codelineno-42-16" id="__codelineno-42-16" name="__codelineno-42-16"></a>    <span class="c1"># metrics_enabled: bool = True</span>
</span><span id="__span-42-17"><a href="#__codelineno-42-17" id="__codelineno-42-17" name="__codelineno-42-17"></a>    <span class="c1"># logging_enabled: bool = True</span>
</span><span id="__span-42-18"><a href="#__codelineno-42-18" id="__codelineno-42-18" name="__codelineno-42-18"></a>
</span><span id="__span-42-19"><a href="#__codelineno-42-19" id="__codelineno-42-19" name="__codelineno-42-19"></a><span class="c1"># main.py</span>
</span><span id="__span-42-20"><a href="#__codelineno-42-20" id="__codelineno-42-20" name="__codelineno-42-20"></a><span class="kn">from</span><span class="w"> </span><span class="nn">neuroglia.hosting.web</span><span class="w"> </span><span class="kn">import</span> <span class="n">WebApplicationBuilder</span>
</span><span id="__span-42-21"><a href="#__codelineno-42-21" id="__codelineno-42-21" name="__codelineno-42-21"></a><span class="kn">from</span><span class="w"> </span><span class="nn">neuroglia.observability</span><span class="w"> </span><span class="kn">import</span> <span class="n">Observability</span>
</span><span id="__span-42-22"><a href="#__codelineno-42-22" id="__codelineno-42-22" name="__codelineno-42-22"></a>
</span><span id="__span-42-23"><a href="#__codelineno-42-23" id="__codelineno-42-23" name="__codelineno-42-23"></a><span class="k">def</span><span class="w"> </span><span class="nf">create_app</span><span class="p">():</span>
</span><span id="__span-42-24"><a href="#__codelineno-42-24" id="__codelineno-42-24" name="__codelineno-42-24"></a>    <span class="c1"># Load settings from environment</span>
</span><span id="__span-42-25"><a href="#__codelineno-42-25" id="__codelineno-42-25" name="__codelineno-42-25"></a>    <span class="n">settings</span> <span class="o">=</span> <span class="n">PizzeriaSettings</span><span class="p">()</span>
</span><span id="__span-42-26"><a href="#__codelineno-42-26" id="__codelineno-42-26" name="__codelineno-42-26"></a>
</span><span id="__span-42-27"><a href="#__codelineno-42-27" id="__codelineno-42-27" name="__codelineno-42-27"></a>    <span class="c1"># Create builder with observability-enabled settings</span>
</span><span id="__span-42-28"><a href="#__codelineno-42-28" id="__codelineno-42-28" name="__codelineno-42-28"></a>    <span class="n">builder</span> <span class="o">=</span> <span class="n">WebApplicationBuilder</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
</span><span id="__span-42-29"><a href="#__codelineno-42-29" id="__codelineno-42-29" name="__codelineno-42-29"></a>
</span><span id="__span-42-30"><a href="#__codelineno-42-30" id="__codelineno-42-30" name="__codelineno-42-30"></a>    <span class="c1"># Configure core services</span>
</span><span id="__span-42-31"><a href="#__codelineno-42-31" id="__codelineno-42-31" name="__codelineno-42-31"></a>    <span class="n">Mediator</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">builder</span><span class="p">,</span> <span class="p">[</span><span class="s2">"application.commands"</span><span class="p">,</span> <span class="s2">"application.queries"</span><span class="p">])</span>
</span><span id="__span-42-32"><a href="#__codelineno-42-32" id="__codelineno-42-32" name="__codelineno-42-32"></a>    <span class="n">Mapper</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">builder</span><span class="p">,</span> <span class="p">[</span><span class="s2">"application.mapping"</span><span class="p">,</span> <span class="s2">"api.dtos"</span><span class="p">])</span>
</span><span id="__span-42-33"><a href="#__codelineno-42-33" id="__codelineno-42-33" name="__codelineno-42-33"></a>
</span><span id="__span-42-34"><a href="#__codelineno-42-34" id="__codelineno-42-34" name="__codelineno-42-34"></a>    <span class="c1"># Register application services</span>
</span><span id="__span-42-35"><a href="#__codelineno-42-35" id="__codelineno-42-35" name="__codelineno-42-35"></a>    <span class="n">builder</span><span class="o">.</span><span class="n">services</span><span class="o">.</span><span class="n">add_scoped</span><span class="p">(</span><span class="n">IOrderRepository</span><span class="p">,</span> <span class="n">MongoOrderRepository</span><span class="p">)</span>
</span><span id="__span-42-36"><a href="#__codelineno-42-36" id="__codelineno-42-36" name="__codelineno-42-36"></a>    <span class="n">builder</span><span class="o">.</span><span class="n">services</span><span class="o">.</span><span class="n">add_scoped</span><span class="p">(</span><span class="n">OrderService</span><span class="p">)</span>
</span><span id="__span-42-37"><a href="#__codelineno-42-37" id="__codelineno-42-37" name="__codelineno-42-37"></a>
</span><span id="__span-42-38"><a href="#__codelineno-42-38" id="__codelineno-42-38" name="__codelineno-42-38"></a>    <span class="c1"># Configure observability (automatic!)</span>
</span><span id="__span-42-39"><a href="#__codelineno-42-39" id="__codelineno-42-39" name="__codelineno-42-39"></a>    <span class="n">Observability</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">builder</span><span class="p">)</span>
</span><span id="__span-42-40"><a href="#__codelineno-42-40" id="__codelineno-42-40" name="__codelineno-42-40"></a>
</span><span id="__span-42-41"><a href="#__codelineno-42-41" id="__codelineno-42-41" name="__codelineno-42-41"></a>    <span class="c1"># Add SubApp with controllers</span>
</span><span id="__span-42-42"><a href="#__codelineno-42-42" id="__codelineno-42-42" name="__codelineno-42-42"></a>    <span class="n">builder</span><span class="o">.</span><span class="n">add_sub_app</span><span class="p">(</span>
</span><span id="__span-42-43"><a href="#__codelineno-42-43" id="__codelineno-42-43" name="__codelineno-42-43"></a>        <span class="n">SubAppConfig</span><span class="p">(</span>
</span><span id="__span-42-44"><a href="#__codelineno-42-44" id="__codelineno-42-44" name="__codelineno-42-44"></a>            <span class="n">path</span><span class="o">=</span><span class="s2">"/api"</span><span class="p">,</span>
</span><span id="__span-42-45"><a href="#__codelineno-42-45" id="__codelineno-42-45" name="__codelineno-42-45"></a>            <span class="n">name</span><span class="o">=</span><span class="s2">"api"</span><span class="p">,</span>
</span><span id="__span-42-46"><a href="#__codelineno-42-46" id="__codelineno-42-46" name="__codelineno-42-46"></a>            <span class="n">controllers</span><span class="o">=</span><span class="p">[</span><span class="s2">"api.controllers"</span><span class="p">]</span>
</span><span id="__span-42-47"><a href="#__codelineno-42-47" id="__codelineno-42-47" name="__codelineno-42-47"></a>        <span class="p">)</span>
</span><span id="__span-42-48"><a href="#__codelineno-42-48" id="__codelineno-42-48" name="__codelineno-42-48"></a>    <span class="p">)</span>
</span><span id="__span-42-49"><a href="#__codelineno-42-49" id="__codelineno-42-49" name="__codelineno-42-49"></a>
</span><span id="__span-42-50"><a href="#__codelineno-42-50" id="__codelineno-42-50" name="__codelineno-42-50"></a>    <span class="c1"># Build application</span>
</span><span id="__span-42-51"><a href="#__codelineno-42-51" id="__codelineno-42-51" name="__codelineno-42-51"></a>    <span class="n">app</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">build_app_with_lifespan</span><span class="p">(</span>
</span><span id="__span-42-52"><a href="#__codelineno-42-52" id="__codelineno-42-52" name="__codelineno-42-52"></a>        <span class="n">title</span><span class="o">=</span><span class="s2">"Mario's Pizzeria API"</span><span class="p">,</span>
</span><span id="__span-42-53"><a href="#__codelineno-42-53" id="__codelineno-42-53" name="__codelineno-42-53"></a>        <span class="n">version</span><span class="o">=</span><span class="s2">"1.0.0"</span>
</span><span id="__span-42-54"><a href="#__codelineno-42-54" id="__codelineno-42-54" name="__codelineno-42-54"></a>    <span class="p">)</span>
</span></code></pre></div>
<div class="language-text highlight"><pre><span></span><code>return app
</code></pre></div>
<h1 id="order_handlerpy">order_handler.py<a class="headerlink" href="#order_handlerpy" title="Permanent link">¬∂</a></h1>
<p>from neuroglia.observability import trace_async, add_span_attributes, create_counter, get_meter
from neuroglia.mediation import CommandHandler</p>
<h1 id="create-metrics">Create metrics<a class="headerlink" href="#create-metrics" title="Permanent link">¬∂</a></h1>
<p>meter = get_meter(<strong>name</strong>)
orders_created = create_counter(meter, "orders_created_total", "Total orders created")</p>
<p>class CreateOrderHandler(CommandHandler[CreateOrderCommand, OperationResult[OrderDto]]):
def <strong>init</strong>(
self,
order_repository: IOrderRepository,
payment_service: PaymentService,
mapper: Mapper
):
super().<strong>init</strong>()
self.order_repository = order_repository
self.payment_service = payment_service
self.mapper = mapper</p>
<div class="language-text highlight"><pre><span></span><code>@trace_async(name="create_order_handler")  # Automatic tracing
async def handle_async(self, command: CreateOrderCommand) -&gt; OperationResult[OrderDto]:
    # Add span attributes for filtering/analysis
    add_span_attributes({
        "order.customer_id": command.customer_id,
        "order.item_count": len(command.items),
        "order.total": command.total_amount
    })

    # Create order entity
    order = Order(
        customer_id=command.customer_id,
        items=command.items,
        total_amount=command.total_amount
    )

    # Process payment (automatically traced via httpx instrumentation)
    payment_result = await self.payment_service.charge(
        command.customer_id,
        command.total_amount
    )

    if not payment_result.success:
        return self.bad_request("Payment failed")

    # Save order (MongoDB operations automatically traced)
    await self.order_repository.save_async(order)

    # Record metric
    orders_created.add(1, {
        "customer.segment": "premium" if command.total_amount &gt; 50 else "standard"
    })

    # Return result (logs automatically include trace_id)
    self.logger.info(f"Order created successfully: {order.id}")
    return self.created(self.mapper.map(order, OrderDto))
</code></pre></div>
<h1 id="run-the-application">Run the application<a class="headerlink" href="#run-the-application" title="Permanent link">¬∂</a></h1>
<p>if <strong>name</strong> == "<strong>main</strong>":
import uvicorn
app = create_app()</p>
<div class="language-text highlight"><pre><span></span><code># Uvicorn automatically instrumented via FastAPI instrumentation
uvicorn.run(app, host="0.0.0.0", port=8000)
</code></pre></div>
<div class="language-text highlight"><pre><span></span><code><span id="__span-43-1"><a href="#__codelineno-43-1" id="__codelineno-43-1" name="__codelineno-43-1"></a>**What You Get:**
</span><span id="__span-43-2"><a href="#__codelineno-43-2" id="__codelineno-43-2" name="__codelineno-43-2"></a>
</span><span id="__span-43-3"><a href="#__codelineno-43-3" id="__codelineno-43-3" name="__codelineno-43-3"></a>```bash
</span><span id="__span-43-4"><a href="#__codelineno-43-4" id="__codelineno-43-4" name="__codelineno-43-4"></a># Prometheus metrics at /metrics
</span><span id="__span-43-5"><a href="#__codelineno-43-5" id="__codelineno-43-5" name="__codelineno-43-5"></a>curl http://localhost:8000/metrics
</span><span id="__span-43-6"><a href="#__codelineno-43-6" id="__codelineno-43-6" name="__codelineno-43-6"></a>
</span><span id="__span-43-7"><a href="#__codelineno-43-7" id="__codelineno-43-7" name="__codelineno-43-7"></a># Sample output:
</span><span id="__span-43-8"><a href="#__codelineno-43-8" id="__codelineno-43-8" name="__codelineno-43-8"></a># orders_created_total{customer_segment="premium"} 42
</span><span id="__span-43-9"><a href="#__codelineno-43-9" id="__codelineno-43-9" name="__codelineno-43-9"></a># orders_created_total{customer_segment="standard"} 158
</span><span id="__span-43-10"><a href="#__codelineno-43-10" id="__codelineno-43-10" name="__codelineno-43-10"></a># http_server_duration_milliseconds_bucket{http_route="/api/orders",http_method="POST",le="100"} 95
</span><span id="__span-43-11"><a href="#__codelineno-43-11" id="__codelineno-43-11" name="__codelineno-43-11"></a># http_server_active_requests{http_route="/api/orders"} 3
</span><span id="__span-43-12"><a href="#__codelineno-43-12" id="__codelineno-43-12" name="__codelineno-43-12"></a>
</span><span id="__span-43-13"><a href="#__codelineno-43-13" id="__codelineno-43-13" name="__codelineno-43-13"></a># Health check at /health
</span><span id="__span-43-14"><a href="#__codelineno-43-14" id="__codelineno-43-14" name="__codelineno-43-14"></a>curl http://localhost:8000/health
</span><span id="__span-43-15"><a href="#__codelineno-43-15" id="__codelineno-43-15" name="__codelineno-43-15"></a>
</span><span id="__span-43-16"><a href="#__codelineno-43-16" id="__codelineno-43-16" name="__codelineno-43-16"></a># Sample output:
</span><span id="__span-43-17"><a href="#__codelineno-43-17" id="__codelineno-43-17" name="__codelineno-43-17"></a># {
</span><span id="__span-43-18"><a href="#__codelineno-43-18" id="__codelineno-43-18" name="__codelineno-43-18"></a>#   "status": "healthy",
</span><span id="__span-43-19"><a href="#__codelineno-43-19" id="__codelineno-43-19" name="__codelineno-43-19"></a>#   "service": "mario-pizzeria",
</span><span id="__span-43-20"><a href="#__codelineno-43-20" id="__codelineno-43-20" name="__codelineno-43-20"></a>#   "version": "1.0.0",
</span><span id="__span-43-21"><a href="#__codelineno-43-21" id="__codelineno-43-21" name="__codelineno-43-21"></a>#   "timestamp": "2024-01-15T10:30:00Z"
</span><span id="__span-43-22"><a href="#__codelineno-43-22" id="__codelineno-43-22" name="__codelineno-43-22"></a># }
</span><span id="__span-43-23"><a href="#__codelineno-43-23" id="__codelineno-43-23" name="__codelineno-43-23"></a>
</span><span id="__span-43-24"><a href="#__codelineno-43-24" id="__codelineno-43-24" name="__codelineno-43-24"></a># Traces exported to OTLP collector
</span><span id="__span-43-25"><a href="#__codelineno-43-25" id="__codelineno-43-25" name="__codelineno-43-25"></a># - View in Jaeger UI: http://localhost:16686
</span><span id="__span-43-26"><a href="#__codelineno-43-26" id="__codelineno-43-26" name="__codelineno-43-26"></a># - Each request shows full trace with:
</span><span id="__span-43-27"><a href="#__codelineno-43-27" id="__codelineno-43-27" name="__codelineno-43-27"></a>#   - HTTP request span
</span><span id="__span-43-28"><a href="#__codelineno-43-28" id="__codelineno-43-28" name="__codelineno-43-28"></a>#   - create_order_handler span
</span><span id="__span-43-29"><a href="#__codelineno-43-29" id="__codelineno-43-29" name="__codelineno-43-29"></a>#   - Payment service call span
</span><span id="__span-43-30"><a href="#__codelineno-43-30" id="__codelineno-43-30" name="__codelineno-43-30"></a>#   - MongoDB query spans
</span><span id="__span-43-31"><a href="#__codelineno-43-31" id="__codelineno-43-31" name="__codelineno-43-31"></a>#   - Timing for each operation
</span><span id="__span-43-32"><a href="#__codelineno-43-32" id="__codelineno-43-32" name="__codelineno-43-32"></a>
</span><span id="__span-43-33"><a href="#__codelineno-43-33" id="__codelineno-43-33" name="__codelineno-43-33"></a># Logs with trace correlation
</span><span id="__span-43-34"><a href="#__codelineno-43-34" id="__codelineno-43-34" name="__codelineno-43-34"></a># [2024-01-15 10:30:00] INFO [trace_id=abc123 span_id=def456] Order created successfully: ord_789
</span></code></pre></div>
<h2 id="advanced-features">üîß Advanced Features<a class="headerlink" href="#advanced-features" title="Permanent link">¬∂</a></h2>
<h3 id="1-custom-resource-attributes">1. Custom Resource Attributes<a class="headerlink" href="#1-custom-resource-attributes" title="Permanent link">¬∂</a></h3>
<p>Add metadata to all telemetry:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-44-1"><a href="#__codelineno-44-1" id="__codelineno-44-1" name="__codelineno-44-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">neuroglia.observability</span><span class="w"> </span><span class="kn">import</span> <span class="n">configure_opentelemetry</span>
</span><span id="__span-44-2"><a href="#__codelineno-44-2" id="__codelineno-44-2" name="__codelineno-44-2"></a>
</span><span id="__span-44-3"><a href="#__codelineno-44-3" id="__codelineno-44-3" name="__codelineno-44-3"></a><span class="n">configure_opentelemetry</span><span class="p">(</span>
</span><span id="__span-44-4"><a href="#__codelineno-44-4" id="__codelineno-44-4" name="__codelineno-44-4"></a>    <span class="n">service_name</span><span class="o">=</span><span class="s2">"mario-pizzeria"</span><span class="p">,</span>
</span><span id="__span-44-5"><a href="#__codelineno-44-5" id="__codelineno-44-5" name="__codelineno-44-5"></a>    <span class="n">service_version</span><span class="o">=</span><span class="s2">"1.0.0"</span><span class="p">,</span>
</span><span id="__span-44-6"><a href="#__codelineno-44-6" id="__codelineno-44-6" name="__codelineno-44-6"></a>    <span class="n">additional_resource_attributes</span><span class="o">=</span><span class="p">{</span>
</span><span id="__span-44-7"><a href="#__codelineno-44-7" id="__codelineno-44-7" name="__codelineno-44-7"></a>        <span class="s2">"deployment.region"</span><span class="p">:</span> <span class="s2">"us-east-1"</span><span class="p">,</span>
</span><span id="__span-44-8"><a href="#__codelineno-44-8" id="__codelineno-44-8" name="__codelineno-44-8"></a>        <span class="s2">"deployment.zone"</span><span class="p">:</span> <span class="s2">"zone-a"</span><span class="p">,</span>
</span><span id="__span-44-9"><a href="#__codelineno-44-9" id="__codelineno-44-9" name="__codelineno-44-9"></a>        <span class="s2">"environment"</span><span class="p">:</span> <span class="s2">"production"</span><span class="p">,</span>
</span><span id="__span-44-10"><a href="#__codelineno-44-10" id="__codelineno-44-10" name="__codelineno-44-10"></a>        <span class="s2">"team"</span><span class="p">:</span> <span class="s2">"backend"</span><span class="p">,</span>
</span><span id="__span-44-11"><a href="#__codelineno-44-11" id="__codelineno-44-11" name="__codelineno-44-11"></a>        <span class="s2">"cost_center"</span><span class="p">:</span> <span class="s2">"engineering"</span>
</span><span id="__span-44-12"><a href="#__codelineno-44-12" id="__codelineno-44-12" name="__codelineno-44-12"></a>    <span class="p">}</span>
</span><span id="__span-44-13"><a href="#__codelineno-44-13" id="__codelineno-44-13" name="__codelineno-44-13"></a><span class="p">)</span>
</span><span id="__span-44-14"><a href="#__codelineno-44-14" id="__codelineno-44-14" name="__codelineno-44-14"></a>
</span><span id="__span-44-15"><a href="#__codelineno-44-15" id="__codelineno-44-15" name="__codelineno-44-15"></a><span class="c1"># All traces, metrics, and logs now include these attributes</span>
</span></code></pre></div>
<h3 id="2-custom-instrumentation">2. Custom Instrumentation<a class="headerlink" href="#2-custom-instrumentation" title="Permanent link">¬∂</a></h3>
<p>Instrument specific code sections:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-45-1"><a href="#__codelineno-45-1" id="__codelineno-45-1" name="__codelineno-45-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">neuroglia.observability</span><span class="w"> </span><span class="kn">import</span> <span class="n">get_tracer</span><span class="p">,</span> <span class="n">trace_sync</span>
</span><span id="__span-45-2"><a href="#__codelineno-45-2" id="__codelineno-45-2" name="__codelineno-45-2"></a>
</span><span id="__span-45-3"><a href="#__codelineno-45-3" id="__codelineno-45-3" name="__codelineno-45-3"></a><span class="n">tracer</span> <span class="o">=</span> <span class="n">get_tracer</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="__span-45-4"><a href="#__codelineno-45-4" id="__codelineno-45-4" name="__codelineno-45-4"></a>
</span><span id="__span-45-5"><a href="#__codelineno-45-5" id="__codelineno-45-5" name="__codelineno-45-5"></a><span class="c1"># Async function tracing</span>
</span><span id="__span-45-6"><a href="#__codelineno-45-6" id="__codelineno-45-6" name="__codelineno-45-6"></a><span class="nd">@trace_async</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"complex_calculation"</span><span class="p">)</span>
</span><span id="__span-45-7"><a href="#__codelineno-45-7" id="__codelineno-45-7" name="__codelineno-45-7"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">complex_calculation</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="__span-45-8"><a href="#__codelineno-45-8" id="__codelineno-45-8" name="__codelineno-45-8"></a>    <span class="k">with</span> <span class="n">tracer</span><span class="o">.</span><span class="n">start_as_current_span</span><span class="p">(</span><span class="s2">"data_validation"</span><span class="p">):</span>
</span><span id="__span-45-9"><a href="#__codelineno-45-9" id="__codelineno-45-9" name="__codelineno-45-9"></a>        <span class="n">validated</span> <span class="o">=</span> <span class="n">validate_data</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="__span-45-10"><a href="#__codelineno-45-10" id="__codelineno-45-10" name="__codelineno-45-10"></a>
</span><span id="__span-45-11"><a href="#__codelineno-45-11" id="__codelineno-45-11" name="__codelineno-45-11"></a>    <span class="k">with</span> <span class="n">tracer</span><span class="o">.</span><span class="n">start_as_current_span</span><span class="p">(</span><span class="s2">"processing"</span><span class="p">):</span>
</span><span id="__span-45-12"><a href="#__codelineno-45-12" id="__codelineno-45-12" name="__codelineno-45-12"></a>        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">process_data</span><span class="p">(</span><span class="n">validated</span><span class="p">)</span>
</span><span id="__span-45-13"><a href="#__codelineno-45-13" id="__codelineno-45-13" name="__codelineno-45-13"></a>
</span><span id="__span-45-14"><a href="#__codelineno-45-14" id="__codelineno-45-14" name="__codelineno-45-14"></a>    <span class="k">with</span> <span class="n">tracer</span><span class="o">.</span><span class="n">start_as_current_span</span><span class="p">(</span><span class="s2">"persistence"</span><span class="p">):</span>
</span><span id="__span-45-15"><a href="#__codelineno-45-15" id="__codelineno-45-15" name="__codelineno-45-15"></a>        <span class="k">await</span> <span class="n">save_result</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span><span id="__span-45-16"><a href="#__codelineno-45-16" id="__codelineno-45-16" name="__codelineno-45-16"></a>
</span><span id="__span-45-17"><a href="#__codelineno-45-17" id="__codelineno-45-17" name="__codelineno-45-17"></a>    <span class="k">return</span> <span class="n">result</span>
</span><span id="__span-45-18"><a href="#__codelineno-45-18" id="__codelineno-45-18" name="__codelineno-45-18"></a>
</span><span id="__span-45-19"><a href="#__codelineno-45-19" id="__codelineno-45-19" name="__codelineno-45-19"></a><span class="c1"># Sync function tracing</span>
</span><span id="__span-45-20"><a href="#__codelineno-45-20" id="__codelineno-45-20" name="__codelineno-45-20"></a><span class="nd">@trace_sync</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"legacy_sync_function"</span><span class="p">)</span>
</span><span id="__span-45-21"><a href="#__codelineno-45-21" id="__codelineno-45-21" name="__codelineno-45-21"></a><span class="k">def</span><span class="w"> </span><span class="nf">legacy_function</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="__span-45-22"><a href="#__codelineno-45-22" id="__codelineno-45-22" name="__codelineno-45-22"></a>    <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="mi">2</span>
</span></code></pre></div>
<h3 id="3-performance-tuning">3. Performance Tuning<a class="headerlink" href="#3-performance-tuning" title="Permanent link">¬∂</a></h3>
<p>Optimize for high-throughput scenarios:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-46-1"><a href="#__codelineno-46-1" id="__codelineno-46-1" name="__codelineno-46-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">neuroglia.observability</span><span class="w"> </span><span class="kn">import</span> <span class="n">configure_opentelemetry</span>
</span><span id="__span-46-2"><a href="#__codelineno-46-2" id="__codelineno-46-2" name="__codelineno-46-2"></a>
</span><span id="__span-46-3"><a href="#__codelineno-46-3" id="__codelineno-46-3" name="__codelineno-46-3"></a><span class="n">configure_opentelemetry</span><span class="p">(</span>
</span><span id="__span-46-4"><a href="#__codelineno-46-4" id="__codelineno-46-4" name="__codelineno-46-4"></a>    <span class="n">service_name</span><span class="o">=</span><span class="s2">"high-throughput-service"</span><span class="p">,</span>
</span><span id="__span-46-5"><a href="#__codelineno-46-5" id="__codelineno-46-5" name="__codelineno-46-5"></a>
</span><span id="__span-46-6"><a href="#__codelineno-46-6" id="__codelineno-46-6" name="__codelineno-46-6"></a>    <span class="c1"># Increase queue size for high request volume</span>
</span><span id="__span-46-7"><a href="#__codelineno-46-7" id="__codelineno-46-7" name="__codelineno-46-7"></a>    <span class="n">batch_span_processor_max_queue_size</span><span class="o">=</span><span class="mi">8192</span><span class="p">,</span>  <span class="c1"># Default: 2048</span>
</span><span id="__span-46-8"><a href="#__codelineno-46-8" id="__codelineno-46-8" name="__codelineno-46-8"></a>
</span><span id="__span-46-9"><a href="#__codelineno-46-9" id="__codelineno-46-9" name="__codelineno-46-9"></a>    <span class="c1"># Export more frequently</span>
</span><span id="__span-46-10"><a href="#__codelineno-46-10" id="__codelineno-46-10" name="__codelineno-46-10"></a>    <span class="n">batch_span_processor_schedule_delay_millis</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span>  <span class="c1"># Default: 5000 (5s)</span>
</span><span id="__span-46-11"><a href="#__codelineno-46-11" id="__codelineno-46-11" name="__codelineno-46-11"></a>
</span><span id="__span-46-12"><a href="#__codelineno-46-12" id="__codelineno-46-12" name="__codelineno-46-12"></a>    <span class="c1"># Larger export batches</span>
</span><span id="__span-46-13"><a href="#__codelineno-46-13" id="__codelineno-46-13" name="__codelineno-46-13"></a>    <span class="n">batch_span_processor_max_export_batch_size</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span>  <span class="c1"># Default: 512</span>
</span><span id="__span-46-14"><a href="#__codelineno-46-14" id="__codelineno-46-14" name="__codelineno-46-14"></a>
</span><span id="__span-46-15"><a href="#__codelineno-46-15" id="__codelineno-46-15" name="__codelineno-46-15"></a>    <span class="c1"># Metrics export every 30 seconds instead of 60</span>
</span><span id="__span-46-16"><a href="#__codelineno-46-16" id="__codelineno-46-16" name="__codelineno-46-16"></a>    <span class="n">metric_export_interval_millis</span><span class="o">=</span><span class="mi">30000</span><span class="p">,</span>
</span><span id="__span-46-17"><a href="#__codelineno-46-17" id="__codelineno-46-17" name="__codelineno-46-17"></a>    <span class="n">metric_export_timeout_millis</span><span class="o">=</span><span class="mi">15000</span>
</span><span id="__span-46-18"><a href="#__codelineno-46-18" id="__codelineno-46-18" name="__codelineno-46-18"></a><span class="p">)</span>
</span></code></pre></div>
<h3 id="4-context-propagation">4. Context Propagation<a class="headerlink" href="#4-context-propagation" title="Permanent link">¬∂</a></h3>
<p>Propagate trace context across service boundaries:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-47-1"><a href="#__codelineno-47-1" id="__codelineno-47-1" name="__codelineno-47-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">neuroglia.observability</span><span class="w"> </span><span class="kn">import</span> <span class="n">add_baggage</span><span class="p">,</span> <span class="n">get_baggage</span>
</span><span id="__span-47-2"><a href="#__codelineno-47-2" id="__codelineno-47-2" name="__codelineno-47-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">httpx</span>
</span><span id="__span-47-3"><a href="#__codelineno-47-3" id="__codelineno-47-3" name="__codelineno-47-3"></a>
</span><span id="__span-47-4"><a href="#__codelineno-47-4" id="__codelineno-47-4" name="__codelineno-47-4"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">call_external_service</span><span class="p">():</span>
</span><span id="__span-47-5"><a href="#__codelineno-47-5" id="__codelineno-47-5" name="__codelineno-47-5"></a>    <span class="c1"># Add baggage (propagates with trace)</span>
</span><span id="__span-47-6"><a href="#__codelineno-47-6" id="__codelineno-47-6" name="__codelineno-47-6"></a>    <span class="n">add_baggage</span><span class="p">(</span><span class="s2">"user.id"</span><span class="p">,</span> <span class="s2">"user_123"</span><span class="p">)</span>
</span><span id="__span-47-7"><a href="#__codelineno-47-7" id="__codelineno-47-7" name="__codelineno-47-7"></a>    <span class="n">add_baggage</span><span class="p">(</span><span class="s2">"request.priority"</span><span class="p">,</span> <span class="s2">"high"</span><span class="p">)</span>
</span><span id="__span-47-8"><a href="#__codelineno-47-8" id="__codelineno-47-8" name="__codelineno-47-8"></a>
</span><span id="__span-47-9"><a href="#__codelineno-47-9" id="__codelineno-47-9" name="__codelineno-47-9"></a>    <span class="c1"># HTTPx automatically includes trace headers</span>
</span><span id="__span-47-10"><a href="#__codelineno-47-10" id="__codelineno-47-10" name="__codelineno-47-10"></a>    <span class="k">async</span> <span class="k">with</span> <span class="n">httpx</span><span class="o">.</span><span class="n">AsyncClient</span><span class="p">()</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
</span><span id="__span-47-11"><a href="#__codelineno-47-11" id="__codelineno-47-11" name="__codelineno-47-11"></a>        <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
</span><span id="__span-47-12"><a href="#__codelineno-47-12" id="__codelineno-47-12" name="__codelineno-47-12"></a>            <span class="s2">"http://other-service/api/process"</span><span class="p">,</span>
</span><span id="__span-47-13"><a href="#__codelineno-47-13" id="__codelineno-47-13" name="__codelineno-47-13"></a>            <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">"data"</span><span class="p">:</span> <span class="s2">"value"</span><span class="p">}</span>
</span><span id="__span-47-14"><a href="#__codelineno-47-14" id="__codelineno-47-14" name="__codelineno-47-14"></a>        <span class="p">)</span>
</span><span id="__span-47-15"><a href="#__codelineno-47-15" id="__codelineno-47-15" name="__codelineno-47-15"></a>        <span class="c1"># Trace context automatically propagated!</span>
</span><span id="__span-47-16"><a href="#__codelineno-47-16" id="__codelineno-47-16" name="__codelineno-47-16"></a>
</span><span id="__span-47-17"><a href="#__codelineno-47-17" id="__codelineno-47-17" name="__codelineno-47-17"></a><span class="c1"># In the other service:</span>
</span><span id="__span-47-18"><a href="#__codelineno-47-18" id="__codelineno-47-18" name="__codelineno-47-18"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">process_request</span><span class="p">():</span>
</span><span id="__span-47-19"><a href="#__codelineno-47-19" id="__codelineno-47-19" name="__codelineno-47-19"></a>    <span class="c1"># Retrieve baggage</span>
</span><span id="__span-47-20"><a href="#__codelineno-47-20" id="__codelineno-47-20" name="__codelineno-47-20"></a>    <span class="n">user_id</span> <span class="o">=</span> <span class="n">get_baggage</span><span class="p">(</span><span class="s2">"user.id"</span><span class="p">)</span>  <span class="c1"># "user_123"</span>
</span><span id="__span-47-21"><a href="#__codelineno-47-21" id="__codelineno-47-21" name="__codelineno-47-21"></a>    <span class="n">priority</span> <span class="o">=</span> <span class="n">get_baggage</span><span class="p">(</span><span class="s2">"request.priority"</span><span class="p">)</span>  <span class="c1"># "high"</span>
</span></code></pre></div>
<h3 id="5-selective-instrumentation">5. Selective Instrumentation<a class="headerlink" href="#5-selective-instrumentation" title="Permanent link">¬∂</a></h3>
<p>Control which components get instrumented:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-48-1"><a href="#__codelineno-48-1" id="__codelineno-48-1" name="__codelineno-48-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">Field</span>
</span><span id="__span-48-2"><a href="#__codelineno-48-2" id="__codelineno-48-2" name="__codelineno-48-2"></a>
</span><span id="__span-48-3"><a href="#__codelineno-48-3" id="__codelineno-48-3" name="__codelineno-48-3"></a><span class="k">class</span><span class="w"> </span><span class="nc">PizzeriaSettings</span><span class="p">(</span><span class="n">ApplicationSettingsWithObservability</span><span class="p">):</span>
</span><span id="__span-48-4"><a href="#__codelineno-48-4" id="__codelineno-48-4" name="__codelineno-48-4"></a>    <span class="c1"># Fine-grained control over instrumentation</span>
</span><span id="__span-48-5"><a href="#__codelineno-48-5" id="__codelineno-48-5" name="__codelineno-48-5"></a>    <span class="n">otel_instrument_fastapi</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-48-6"><a href="#__codelineno-48-6" id="__codelineno-48-6" name="__codelineno-48-6"></a>    <span class="n">otel_instrument_httpx</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-48-7"><a href="#__codelineno-48-7" id="__codelineno-48-7" name="__codelineno-48-7"></a>    <span class="n">otel_instrument_logging</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-48-8"><a href="#__codelineno-48-8" id="__codelineno-48-8" name="__codelineno-48-8"></a>    <span class="n">otel_instrument_system_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># Disable for serverless</span>
</span><span id="__span-48-9"><a href="#__codelineno-48-9" id="__codelineno-48-9" name="__codelineno-48-9"></a>
</span><span id="__span-48-10"><a href="#__codelineno-48-10" id="__codelineno-48-10" name="__codelineno-48-10"></a><span class="n">builder</span> <span class="o">=</span> <span class="n">WebApplicationBuilder</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
</span><span id="__span-48-11"><a href="#__codelineno-48-11" id="__codelineno-48-11" name="__codelineno-48-11"></a><span class="n">Observability</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">builder</span><span class="p">)</span>  <span class="c1"># Respects instrumentation flags</span>
</span></code></pre></div>
<h2 id="testing-with-observability">üß™ Testing with Observability<a class="headerlink" href="#testing-with-observability" title="Permanent link">¬∂</a></h2>
<p>Test observability components in your test suite:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-49-1"><a href="#__codelineno-49-1" id="__codelineno-49-1" name="__codelineno-49-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">pytest</span>
</span><span id="__span-49-2"><a href="#__codelineno-49-2" id="__codelineno-49-2" name="__codelineno-49-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">neuroglia.observability</span><span class="w"> </span><span class="kn">import</span> <span class="n">configure_opentelemetry</span><span class="p">,</span> <span class="n">get_tracer</span><span class="p">,</span> <span class="n">get_meter</span>
</span><span id="__span-49-3"><a href="#__codelineno-49-3" id="__codelineno-49-3" name="__codelineno-49-3"></a>
</span><span id="__span-49-4"><a href="#__codelineno-49-4" id="__codelineno-49-4" name="__codelineno-49-4"></a><span class="nd">@pytest</span><span class="o">.</span><span class="n">fixture</span>
</span><span id="__span-49-5"><a href="#__codelineno-49-5" id="__codelineno-49-5" name="__codelineno-49-5"></a><span class="k">def</span><span class="w"> </span><span class="nf">observability_configured</span><span class="p">():</span>
</span><span id="__span-49-6"><a href="#__codelineno-49-6" id="__codelineno-49-6" name="__codelineno-49-6"></a><span class="w">    </span><span class="sd">"""Configure observability for tests"""</span>
</span><span id="__span-49-7"><a href="#__codelineno-49-7" id="__codelineno-49-7" name="__codelineno-49-7"></a>    <span class="n">configure_opentelemetry</span><span class="p">(</span>
</span><span id="__span-49-8"><a href="#__codelineno-49-8" id="__codelineno-49-8" name="__codelineno-49-8"></a>        <span class="n">service_name</span><span class="o">=</span><span class="s2">"mario-pizzeria-test"</span><span class="p">,</span>
</span><span id="__span-49-9"><a href="#__codelineno-49-9" id="__codelineno-49-9" name="__codelineno-49-9"></a>        <span class="n">service_version</span><span class="o">=</span><span class="s2">"test"</span><span class="p">,</span>
</span><span id="__span-49-10"><a href="#__codelineno-49-10" id="__codelineno-49-10" name="__codelineno-49-10"></a>        <span class="n">enable_console_export</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># See traces in test output</span>
</span><span id="__span-49-11"><a href="#__codelineno-49-11" id="__codelineno-49-11" name="__codelineno-49-11"></a>        <span class="n">otlp_endpoint</span><span class="o">=</span><span class="s2">"http://localhost:4317"</span>
</span><span id="__span-49-12"><a href="#__codelineno-49-12" id="__codelineno-49-12" name="__codelineno-49-12"></a>    <span class="p">)</span>
</span><span id="__span-49-13"><a href="#__codelineno-49-13" id="__codelineno-49-13" name="__codelineno-49-13"></a>    <span class="k">yield</span>
</span><span id="__span-49-14"><a href="#__codelineno-49-14" id="__codelineno-49-14" name="__codelineno-49-14"></a>
</span><span id="__span-49-15"><a href="#__codelineno-49-15" id="__codelineno-49-15" name="__codelineno-49-15"></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">neuroglia.observability</span><span class="w"> </span><span class="kn">import</span> <span class="n">shutdown_opentelemetry</span>
</span><span id="__span-49-16"><a href="#__codelineno-49-16" id="__codelineno-49-16" name="__codelineno-49-16"></a>    <span class="n">shutdown_opentelemetry</span><span class="p">()</span>
</span><span id="__span-49-17"><a href="#__codelineno-49-17" id="__codelineno-49-17" name="__codelineno-49-17"></a>
</span><span id="__span-49-18"><a href="#__codelineno-49-18" id="__codelineno-49-18" name="__codelineno-49-18"></a><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">asyncio</span>
</span><span id="__span-49-19"><a href="#__codelineno-49-19" id="__codelineno-49-19" name="__codelineno-49-19"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_order_handler_creates_span</span><span class="p">(</span><span class="n">observability_configured</span><span class="p">):</span>
</span><span id="__span-49-20"><a href="#__codelineno-49-20" id="__codelineno-49-20" name="__codelineno-49-20"></a><span class="w">    </span><span class="sd">"""Test that handler creates trace span"""</span>
</span><span id="__span-49-21"><a href="#__codelineno-49-21" id="__codelineno-49-21" name="__codelineno-49-21"></a>    <span class="n">tracer</span> <span class="o">=</span> <span class="n">get_tracer</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="__span-49-22"><a href="#__codelineno-49-22" id="__codelineno-49-22" name="__codelineno-49-22"></a>
</span><span id="__span-49-23"><a href="#__codelineno-49-23" id="__codelineno-49-23" name="__codelineno-49-23"></a>    <span class="c1"># Execute handler</span>
</span><span id="__span-49-24"><a href="#__codelineno-49-24" id="__codelineno-49-24" name="__codelineno-49-24"></a>    <span class="n">handler</span> <span class="o">=</span> <span class="n">CreateOrderHandler</span><span class="p">(</span><span class="n">mock_repository</span><span class="p">,</span> <span class="n">mock_payment</span><span class="p">)</span>
</span><span id="__span-49-25"><a href="#__codelineno-49-25" id="__codelineno-49-25" name="__codelineno-49-25"></a>    <span class="n">command</span> <span class="o">=</span> <span class="n">CreateOrderCommand</span><span class="p">(</span><span class="n">customer_id</span><span class="o">=</span><span class="s2">"123"</span><span class="p">,</span> <span class="n">items</span><span class="o">=</span><span class="p">[],</span> <span class="n">total_amount</span><span class="o">=</span><span class="mf">50.0</span><span class="p">)</span>
</span><span id="__span-49-26"><a href="#__codelineno-49-26" id="__codelineno-49-26" name="__codelineno-49-26"></a>
</span><span id="__span-49-27"><a href="#__codelineno-49-27" id="__codelineno-49-27" name="__codelineno-49-27"></a>    <span class="k">with</span> <span class="n">tracer</span><span class="o">.</span><span class="n">start_as_current_span</span><span class="p">(</span><span class="s2">"test_span"</span><span class="p">)</span> <span class="k">as</span> <span class="n">span</span><span class="p">:</span>
</span><span id="__span-49-28"><a href="#__codelineno-49-28" id="__codelineno-49-28" name="__codelineno-49-28"></a>        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">handler</span><span class="o">.</span><span class="n">handle_async</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
</span><span id="__span-49-29"><a href="#__codelineno-49-29" id="__codelineno-49-29" name="__codelineno-49-29"></a>
</span><span id="__span-49-30"><a href="#__codelineno-49-30" id="__codelineno-49-30" name="__codelineno-49-30"></a>        <span class="c1"># Verify span created</span>
</span><span id="__span-49-31"><a href="#__codelineno-49-31" id="__codelineno-49-31" name="__codelineno-49-31"></a>        <span class="k">assert</span> <span class="n">span</span><span class="o">.</span><span class="n">is_recording</span><span class="p">()</span>
</span><span id="__span-49-32"><a href="#__codelineno-49-32" id="__codelineno-49-32" name="__codelineno-49-32"></a>        <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">is_success</span>
</span><span id="__span-49-33"><a href="#__codelineno-49-33" id="__codelineno-49-33" name="__codelineno-49-33"></a>
</span><span id="__span-49-34"><a href="#__codelineno-49-34" id="__codelineno-49-34" name="__codelineno-49-34"></a><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">asyncio</span>
</span><span id="__span-49-35"><a href="#__codelineno-49-35" id="__codelineno-49-35" name="__codelineno-49-35"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_metrics_recorded</span><span class="p">():</span>
</span><span id="__span-49-36"><a href="#__codelineno-49-36" id="__codelineno-49-36" name="__codelineno-49-36"></a><span class="w">    </span><span class="sd">"""Test that metrics are recorded correctly"""</span>
</span><span id="__span-49-37"><a href="#__codelineno-49-37" id="__codelineno-49-37" name="__codelineno-49-37"></a>    <span class="n">meter</span> <span class="o">=</span> <span class="n">get_meter</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="__span-49-38"><a href="#__codelineno-49-38" id="__codelineno-49-38" name="__codelineno-49-38"></a>    <span class="n">counter</span> <span class="o">=</span> <span class="n">meter</span><span class="o">.</span><span class="n">create_counter</span><span class="p">(</span><span class="s2">"test_counter"</span><span class="p">)</span>
</span><span id="__span-49-39"><a href="#__codelineno-49-39" id="__codelineno-49-39" name="__codelineno-49-39"></a>
</span><span id="__span-49-40"><a href="#__codelineno-49-40" id="__codelineno-49-40" name="__codelineno-49-40"></a>    <span class="c1"># Record metric</span>
</span><span id="__span-49-41"><a href="#__codelineno-49-41" id="__codelineno-49-41" name="__codelineno-49-41"></a>    <span class="n">counter</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="p">{</span><span class="s2">"test"</span><span class="p">:</span> <span class="s2">"value"</span><span class="p">})</span>
</span><span id="__span-49-42"><a href="#__codelineno-49-42" id="__codelineno-49-42" name="__codelineno-49-42"></a>
</span><span id="__span-49-43"><a href="#__codelineno-49-43" id="__codelineno-49-43" name="__codelineno-49-43"></a>    <span class="c1"># Verify (in real tests, you'd check Prometheus endpoint)</span>
</span><span id="__span-49-44"><a href="#__codelineno-49-44" id="__codelineno-49-44" name="__codelineno-49-44"></a>    <span class="c1"># In tests, just verify no exceptions</span>
</span><span id="__span-49-45"><a href="#__codelineno-49-45" id="__codelineno-49-45" name="__codelineno-49-45"></a>    <span class="k">assert</span> <span class="kc">True</span>
</span></code></pre></div>
<h2 id="common-mistakes">‚ö†Ô∏è Common Mistakes<a class="headerlink" href="#common-mistakes" title="Permanent link">¬∂</a></h2>
<h3 id="1-forgetting-to-configure-before-running">1. Forgetting to Configure Before Running<a class="headerlink" href="#1-forgetting-to-configure-before-running" title="Permanent link">¬∂</a></h3>
<div class="language-python highlight"><pre><span></span><code><span id="__span-50-1"><a href="#__codelineno-50-1" id="__codelineno-50-1" name="__codelineno-50-1"></a><span class="c1"># ‚ùå Wrong - observability not configured</span>
</span><span id="__span-50-2"><a href="#__codelineno-50-2" id="__codelineno-50-2" name="__codelineno-50-2"></a><span class="n">app</span> <span class="o">=</span> <span class="n">FastAPI</span><span class="p">()</span>
</span><span id="__span-50-3"><a href="#__codelineno-50-3" id="__codelineno-50-3" name="__codelineno-50-3"></a><span class="n">uvicorn</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>  <span class="c1"># No traces, no metrics</span>
</span><span id="__span-50-4"><a href="#__codelineno-50-4" id="__codelineno-50-4" name="__codelineno-50-4"></a>
</span><span id="__span-50-5"><a href="#__codelineno-50-5" id="__codelineno-50-5" name="__codelineno-50-5"></a><span class="c1"># ‚úÖ Correct - configure during app setup</span>
</span><span id="__span-50-6"><a href="#__codelineno-50-6" id="__codelineno-50-6" name="__codelineno-50-6"></a><span class="n">builder</span> <span class="o">=</span> <span class="n">WebApplicationBuilder</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
</span><span id="__span-50-7"><a href="#__codelineno-50-7" id="__codelineno-50-7" name="__codelineno-50-7"></a><span class="n">Observability</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">builder</span><span class="p">)</span>
</span><span id="__span-50-8"><a href="#__codelineno-50-8" id="__codelineno-50-8" name="__codelineno-50-8"></a><span class="n">app</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
</span><span id="__span-50-9"><a href="#__codelineno-50-9" id="__codelineno-50-9" name="__codelineno-50-9"></a><span class="n">uvicorn</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>  <span class="c1"># Full observability!</span>
</span></code></pre></div>
<h3 id="2-instrumenting-sub-apps">2. Instrumenting Sub-Apps<a class="headerlink" href="#2-instrumenting-sub-apps" title="Permanent link">¬∂</a></h3>
<div class="language-python highlight"><pre><span></span><code><span id="__span-51-1"><a href="#__codelineno-51-1" id="__codelineno-51-1" name="__codelineno-51-1"></a><span class="c1"># ‚ùå Wrong - duplicate instrumentation</span>
</span><span id="__span-51-2"><a href="#__codelineno-51-2" id="__codelineno-51-2" name="__codelineno-51-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">neuroglia.observability</span><span class="w"> </span><span class="kn">import</span> <span class="n">instrument_fastapi_app</span>
</span><span id="__span-51-3"><a href="#__codelineno-51-3" id="__codelineno-51-3" name="__codelineno-51-3"></a>
</span><span id="__span-51-4"><a href="#__codelineno-51-4" id="__codelineno-51-4" name="__codelineno-51-4"></a><span class="n">app</span> <span class="o">=</span> <span class="n">FastAPI</span><span class="p">()</span>
</span><span id="__span-51-5"><a href="#__codelineno-51-5" id="__codelineno-51-5" name="__codelineno-51-5"></a><span class="n">api_app</span> <span class="o">=</span> <span class="n">FastAPI</span><span class="p">()</span>
</span><span id="__span-51-6"><a href="#__codelineno-51-6" id="__codelineno-51-6" name="__codelineno-51-6"></a><span class="n">app</span><span class="o">.</span><span class="n">mount</span><span class="p">(</span><span class="s2">"/api"</span><span class="p">,</span> <span class="n">api_app</span><span class="p">)</span>
</span><span id="__span-51-7"><a href="#__codelineno-51-7" id="__codelineno-51-7" name="__codelineno-51-7"></a>
</span><span id="__span-51-8"><a href="#__codelineno-51-8" id="__codelineno-51-8" name="__codelineno-51-8"></a><span class="n">instrument_fastapi_app</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="s2">"main"</span><span class="p">)</span>
</span><span id="__span-51-9"><a href="#__codelineno-51-9" id="__codelineno-51-9" name="__codelineno-51-9"></a><span class="n">instrument_fastapi_app</span><span class="p">(</span><span class="n">api_app</span><span class="p">,</span> <span class="s2">"api"</span><span class="p">)</span>  <span class="c1"># Causes warnings!</span>
</span><span id="__span-51-10"><a href="#__codelineno-51-10" id="__codelineno-51-10" name="__codelineno-51-10"></a>
</span><span id="__span-51-11"><a href="#__codelineno-51-11" id="__codelineno-51-11" name="__codelineno-51-11"></a><span class="c1"># ‚úÖ Correct - only instrument main app</span>
</span><span id="__span-51-12"><a href="#__codelineno-51-12" id="__codelineno-51-12" name="__codelineno-51-12"></a><span class="n">instrument_fastapi_app</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="s2">"main"</span><span class="p">)</span>  <span class="c1"># Captures all endpoints</span>
</span></code></pre></div>
<h3 id="3-missing-settings-mixin">3. Missing Settings Mixin<a class="headerlink" href="#3-missing-settings-mixin" title="Permanent link">¬∂</a></h3>
<div class="language-python highlight"><pre><span></span><code><span id="__span-52-1"><a href="#__codelineno-52-1" id="__codelineno-52-1" name="__codelineno-52-1"></a><span class="c1"># ‚ùå Wrong - no observability settings</span>
</span><span id="__span-52-2"><a href="#__codelineno-52-2" id="__codelineno-52-2" name="__codelineno-52-2"></a><span class="k">class</span><span class="w"> </span><span class="nc">MySettings</span><span class="p">(</span><span class="n">ApplicationSettings</span><span class="p">):</span>
</span><span id="__span-52-3"><a href="#__codelineno-52-3" id="__codelineno-52-3" name="__codelineno-52-3"></a>    <span class="n">database_url</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="__span-52-4"><a href="#__codelineno-52-4" id="__codelineno-52-4" name="__codelineno-52-4"></a>
</span><span id="__span-52-5"><a href="#__codelineno-52-5" id="__codelineno-52-5" name="__codelineno-52-5"></a><span class="n">builder</span> <span class="o">=</span> <span class="n">WebApplicationBuilder</span><span class="p">(</span><span class="n">MySettings</span><span class="p">())</span>
</span><span id="__span-52-6"><a href="#__codelineno-52-6" id="__codelineno-52-6" name="__codelineno-52-6"></a><span class="n">Observability</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">builder</span><span class="p">)</span>  <span class="c1"># Raises ValueError!</span>
</span><span id="__span-52-7"><a href="#__codelineno-52-7" id="__codelineno-52-7" name="__codelineno-52-7"></a>
</span><span id="__span-52-8"><a href="#__codelineno-52-8" id="__codelineno-52-8" name="__codelineno-52-8"></a><span class="c1"># ‚úÖ Correct - inherit from ApplicationSettingsWithObservability</span>
</span><span id="__span-52-9"><a href="#__codelineno-52-9" id="__codelineno-52-9" name="__codelineno-52-9"></a><span class="k">class</span><span class="w"> </span><span class="nc">MySettings</span><span class="p">(</span><span class="n">ApplicationSettingsWithObservability</span><span class="p">):</span>
</span><span id="__span-52-10"><a href="#__codelineno-52-10" id="__codelineno-52-10" name="__codelineno-52-10"></a>    <span class="n">database_url</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="__span-52-11"><a href="#__codelineno-52-11" id="__codelineno-52-11" name="__codelineno-52-11"></a>
</span><span id="__span-52-12"><a href="#__codelineno-52-12" id="__codelineno-52-12" name="__codelineno-52-12"></a><span class="n">builder</span> <span class="o">=</span> <span class="n">WebApplicationBuilder</span><span class="p">(</span><span class="n">MySettings</span><span class="p">())</span>
</span><span id="__span-52-13"><a href="#__codelineno-52-13" id="__codelineno-52-13" name="__codelineno-52-13"></a><span class="n">Observability</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">builder</span><span class="p">)</span>  <span class="c1"># Works!</span>
</span></code></pre></div>
<h2 id="when-not-to-use">üö´ When NOT to Use<a class="headerlink" href="#when-not-to-use" title="Permanent link">¬∂</a></h2>
<h3 id="1-serverless-functions-with-cold-start-sensitivity">1. Serverless Functions with Cold Start Sensitivity<a class="headerlink" href="#1-serverless-functions-with-cold-start-sensitivity" title="Permanent link">¬∂</a></h3>
<p>OpenTelemetry adds ~100-200ms to cold starts. For AWS Lambda or similar:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-53-1"><a href="#__codelineno-53-1" id="__codelineno-53-1" name="__codelineno-53-1"></a><span class="c1"># Consider lightweight alternatives:</span>
</span><span id="__span-53-2"><a href="#__codelineno-53-2" id="__codelineno-53-2" name="__codelineno-53-2"></a><span class="c1"># - CloudWatch Logs only</span>
</span><span id="__span-53-3"><a href="#__codelineno-53-3" id="__codelineno-53-3" name="__codelineno-53-3"></a><span class="c1"># - X-Ray for tracing</span>
</span><span id="__span-53-4"><a href="#__codelineno-53-4" id="__codelineno-53-4" name="__codelineno-53-4"></a><span class="c1"># - Custom metrics to CloudWatch</span>
</span></code></pre></div>
<h3 id="2-ultra-high-throughput-services">2. Ultra-High Throughput Services<a class="headerlink" href="#2-ultra-high-throughput-services" title="Permanent link">¬∂</a></h3>
<p>For services handling &gt;100k requests/second:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-54-1"><a href="#__codelineno-54-1" id="__codelineno-54-1" name="__codelineno-54-1"></a><span class="c1"># Consider:</span>
</span><span id="__span-54-2"><a href="#__codelineno-54-2" id="__codelineno-54-2" name="__codelineno-54-2"></a><span class="c1"># - Sampling traces (only 1% of requests)</span>
</span><span id="__span-54-3"><a href="#__codelineno-54-3" id="__codelineno-54-3" name="__codelineno-54-3"></a><span class="c1"># - Tail-based sampling</span>
</span><span id="__span-54-4"><a href="#__codelineno-54-4" id="__codelineno-54-4" name="__codelineno-54-4"></a><span class="c1"># - Metrics-only observability</span>
</span><span id="__span-54-5"><a href="#__codelineno-54-5" id="__codelineno-54-5" name="__codelineno-54-5"></a><span class="c1"># - Custom lightweight instrumentation</span>
</span></code></pre></div>
<h3 id="3-developmentprototyping">3. Development/Prototyping<a class="headerlink" href="#3-developmentprototyping" title="Permanent link">¬∂</a></h3>
<p>For quick prototypes:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-55-1"><a href="#__codelineno-55-1" id="__codelineno-55-1" name="__codelineno-55-1"></a><span class="c1"># Simple logging may be sufficient:</span>
</span><span id="__span-55-2"><a href="#__codelineno-55-2" id="__codelineno-55-2" name="__codelineno-55-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
</span><span id="__span-55-3"><a href="#__codelineno-55-3" id="__codelineno-55-3" name="__codelineno-55-3"></a><span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
</span><span id="__span-55-4"><a href="#__codelineno-55-4" id="__codelineno-55-4" name="__codelineno-55-4"></a><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="__span-55-5"><a href="#__codelineno-55-5" id="__codelineno-55-5" name="__codelineno-55-5"></a><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">"Order created"</span><span class="p">)</span>
</span></code></pre></div>
<h2 id="key-takeaways">üìù Key Takeaways<a class="headerlink" href="#key-takeaways" title="Permanent link">¬∂</a></h2>
<ol>
<li><strong>Framework Integration</strong>: Use <code>Observability.configure(builder)</code> for automatic setup</li>
<li><strong>Three Pillars</strong>: Traces show flow, metrics show health, logs show details</li>
<li><strong>Automatic Instrumentation</strong>: FastAPI, HTTPx, and logging instrumented by default</li>
<li><strong>Trace Correlation</strong>: Logs automatically include trace_id and span_id</li>
<li><strong>Decorator Pattern</strong>: Use <code>@trace_async()</code> for easy span creation</li>
<li><strong>Performance Aware</strong>: Tune batch processing for your throughput needs</li>
</ol>
<h2 id="related-documentation">üîó Related Documentation<a class="headerlink" href="#related-documentation" title="Permanent link">¬∂</a></h2>
<ul>
<li><strong><a href="../../guides/opentelemetry-integration/">OpenTelemetry Integration Guide</a></strong> - Complete infrastructure setup and deployment</li>
<li><strong><a href="../../getting-started/">Getting Started</a></strong> - Initial framework setup</li>
<li><strong><a href="../../tutorials/mario-pizzeria-08-observability/">Tutorial Part 8: Observability</a></strong> - Step-by-step observability tutorial</li>
<li><strong><a href="../hosting/">Application Hosting</a></strong> - WebApplicationBuilder integration</li>
<li><strong><a href="../simple-cqrs/">CQRS &amp; Mediation</a></strong> - Handler tracing integration</li>
<li><strong><a href="../../mario-pizzeria/">Mario's Pizzeria</a></strong> - Real-world observability implementation</li>
</ul>
<h2 id="api-reference">üìö API Reference<a class="headerlink" href="#api-reference" title="Permanent link">¬∂</a></h2>
<h3 id="observabilityconfigure">Observability.configure()<a class="headerlink" href="#observabilityconfigure" title="Permanent link">¬∂</a></h3>
<div class="language-python highlight"><pre><span></span><code><span id="__span-56-1"><a href="#__codelineno-56-1" id="__codelineno-56-1" name="__codelineno-56-1"></a><span class="nd">@classmethod</span>
</span><span id="__span-56-2"><a href="#__codelineno-56-2" id="__codelineno-56-2" name="__codelineno-56-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">configure</span><span class="p">(</span>
</span><span id="__span-56-3"><a href="#__codelineno-56-3" id="__codelineno-56-3" name="__codelineno-56-3"></a>    <span class="bp">cls</span><span class="p">,</span>
</span><span id="__span-56-4"><a href="#__codelineno-56-4" id="__codelineno-56-4" name="__codelineno-56-4"></a>    <span class="n">builder</span><span class="p">:</span> <span class="n">WebApplicationBuilder</span><span class="p">,</span>
</span><span id="__span-56-5"><a href="#__codelineno-56-5" id="__codelineno-56-5" name="__codelineno-56-5"></a>    <span class="o">**</span><span class="n">overrides</span>
</span><span id="__span-56-6"><a href="#__codelineno-56-6" id="__codelineno-56-6" name="__codelineno-56-6"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-56-7"><a href="#__codelineno-56-7" id="__codelineno-56-7" name="__codelineno-56-7"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-56-8"><a href="#__codelineno-56-8" id="__codelineno-56-8" name="__codelineno-56-8"></a><span class="sd">    Configure comprehensive observability for the application.</span>
</span><span id="__span-56-9"><a href="#__codelineno-56-9" id="__codelineno-56-9" name="__codelineno-56-9"></a>
</span><span id="__span-56-10"><a href="#__codelineno-56-10" id="__codelineno-56-10" name="__codelineno-56-10"></a><span class="sd">    Args:</span>
</span><span id="__span-56-11"><a href="#__codelineno-56-11" id="__codelineno-56-11" name="__codelineno-56-11"></a><span class="sd">        builder: WebApplicationBuilder with app_settings</span>
</span><span id="__span-56-12"><a href="#__codelineno-56-12" id="__codelineno-56-12" name="__codelineno-56-12"></a><span class="sd">        **overrides: Optional configuration overrides</span>
</span><span id="__span-56-13"><a href="#__codelineno-56-13" id="__codelineno-56-13" name="__codelineno-56-13"></a><span class="sd">                     (tracing_enabled, metrics_enabled, logging_enabled)</span>
</span><span id="__span-56-14"><a href="#__codelineno-56-14" id="__codelineno-56-14" name="__codelineno-56-14"></a>
</span><span id="__span-56-15"><a href="#__codelineno-56-15" id="__codelineno-56-15" name="__codelineno-56-15"></a><span class="sd">    Raises:</span>
</span><span id="__span-56-16"><a href="#__codelineno-56-16" id="__codelineno-56-16" name="__codelineno-56-16"></a><span class="sd">        ValueError: If app_settings doesn't have observability configuration</span>
</span><span id="__span-56-17"><a href="#__codelineno-56-17" id="__codelineno-56-17" name="__codelineno-56-17"></a><span class="sd">    """</span>
</span></code></pre></div>
<h3 id="configure_opentelemetry">configure_opentelemetry()<a class="headerlink" href="#configure_opentelemetry" title="Permanent link">¬∂</a></h3>
<div class="language-python highlight"><pre><span></span><code><span id="__span-57-1"><a href="#__codelineno-57-1" id="__codelineno-57-1" name="__codelineno-57-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">configure_opentelemetry</span><span class="p">(</span>
</span><span id="__span-57-2"><a href="#__codelineno-57-2" id="__codelineno-57-2" name="__codelineno-57-2"></a>    <span class="n">service_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="__span-57-3"><a href="#__codelineno-57-3" id="__codelineno-57-3" name="__codelineno-57-3"></a>    <span class="n">service_version</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">"unknown"</span><span class="p">,</span>
</span><span id="__span-57-4"><a href="#__codelineno-57-4" id="__codelineno-57-4" name="__codelineno-57-4"></a>    <span class="n">otlp_endpoint</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">"http://localhost:4317"</span><span class="p">,</span>
</span><span id="__span-57-5"><a href="#__codelineno-57-5" id="__codelineno-57-5" name="__codelineno-57-5"></a>    <span class="n">enable_console_export</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-57-6"><a href="#__codelineno-57-6" id="__codelineno-57-6" name="__codelineno-57-6"></a>    <span class="n">deployment_environment</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">"development"</span><span class="p">,</span>
</span><span id="__span-57-7"><a href="#__codelineno-57-7" id="__codelineno-57-7" name="__codelineno-57-7"></a>    <span class="n">additional_resource_attributes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-57-8"><a href="#__codelineno-57-8" id="__codelineno-57-8" name="__codelineno-57-8"></a>    <span class="n">enable_fastapi_instrumentation</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-57-9"><a href="#__codelineno-57-9" id="__codelineno-57-9" name="__codelineno-57-9"></a>    <span class="n">enable_httpx_instrumentation</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-57-10"><a href="#__codelineno-57-10" id="__codelineno-57-10" name="__codelineno-57-10"></a>    <span class="n">enable_logging_instrumentation</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-57-11"><a href="#__codelineno-57-11" id="__codelineno-57-11" name="__codelineno-57-11"></a>    <span class="n">enable_system_metrics</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-57-12"><a href="#__codelineno-57-12" id="__codelineno-57-12" name="__codelineno-57-12"></a>    <span class="n">batch_span_processor_max_queue_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2048</span><span class="p">,</span>
</span><span id="__span-57-13"><a href="#__codelineno-57-13" id="__codelineno-57-13" name="__codelineno-57-13"></a>    <span class="n">batch_span_processor_schedule_delay_millis</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5000</span><span class="p">,</span>
</span><span id="__span-57-14"><a href="#__codelineno-57-14" id="__codelineno-57-14" name="__codelineno-57-14"></a>    <span class="n">batch_span_processor_max_export_batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">512</span><span class="p">,</span>
</span><span id="__span-57-15"><a href="#__codelineno-57-15" id="__codelineno-57-15" name="__codelineno-57-15"></a>    <span class="n">metric_export_interval_millis</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">60000</span><span class="p">,</span>
</span><span id="__span-57-16"><a href="#__codelineno-57-16" id="__codelineno-57-16" name="__codelineno-57-16"></a>    <span class="n">metric_export_timeout_millis</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30000</span>
</span><span id="__span-57-17"><a href="#__codelineno-57-17" id="__codelineno-57-17" name="__codelineno-57-17"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-57-18"><a href="#__codelineno-57-18" id="__codelineno-57-18" name="__codelineno-57-18"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-57-19"><a href="#__codelineno-57-19" id="__codelineno-57-19" name="__codelineno-57-19"></a><span class="sd">    Configure OpenTelemetry SDK with comprehensive observability setup.</span>
</span><span id="__span-57-20"><a href="#__codelineno-57-20" id="__codelineno-57-20" name="__codelineno-57-20"></a>
</span><span id="__span-57-21"><a href="#__codelineno-57-21" id="__codelineno-57-21" name="__codelineno-57-21"></a><span class="sd">    Initializes tracing, metrics, logging, and instrumentation.</span>
</span><span id="__span-57-22"><a href="#__codelineno-57-22" id="__codelineno-57-22" name="__codelineno-57-22"></a><span class="sd">    """</span>
</span></code></pre></div>
<h3 id="trace_async-trace_sync">@trace_async() / @trace_sync()<a class="headerlink" href="#trace_async-trace_sync" title="Permanent link">¬∂</a></h3>
<div class="language-python highlight"><pre><span></span><code><span id="__span-58-1"><a href="#__codelineno-58-1" id="__codelineno-58-1" name="__codelineno-58-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">trace_async</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
</span><span id="__span-58-2"><a href="#__codelineno-58-2" id="__codelineno-58-2" name="__codelineno-58-2"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-58-3"><a href="#__codelineno-58-3" id="__codelineno-58-3" name="__codelineno-58-3"></a><span class="sd">    Decorator for automatic async function tracing.</span>
</span><span id="__span-58-4"><a href="#__codelineno-58-4" id="__codelineno-58-4" name="__codelineno-58-4"></a>
</span><span id="__span-58-5"><a href="#__codelineno-58-5" id="__codelineno-58-5" name="__codelineno-58-5"></a><span class="sd">    Args:</span>
</span><span id="__span-58-6"><a href="#__codelineno-58-6" id="__codelineno-58-6" name="__codelineno-58-6"></a><span class="sd">        name: Optional span name (defaults to function name)</span>
</span><span id="__span-58-7"><a href="#__codelineno-58-7" id="__codelineno-58-7" name="__codelineno-58-7"></a>
</span><span id="__span-58-8"><a href="#__codelineno-58-8" id="__codelineno-58-8" name="__codelineno-58-8"></a><span class="sd">    Returns:</span>
</span><span id="__span-58-9"><a href="#__codelineno-58-9" id="__codelineno-58-9" name="__codelineno-58-9"></a><span class="sd">        Decorator function</span>
</span><span id="__span-58-10"><a href="#__codelineno-58-10" id="__codelineno-58-10" name="__codelineno-58-10"></a><span class="sd">    """</span>
</span><span id="__span-58-11"><a href="#__codelineno-58-11" id="__codelineno-58-11" name="__codelineno-58-11"></a>
</span><span id="__span-58-12"><a href="#__codelineno-58-12" id="__codelineno-58-12" name="__codelineno-58-12"></a><span class="k">def</span><span class="w"> </span><span class="nf">trace_sync</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
</span><span id="__span-58-13"><a href="#__codelineno-58-13" id="__codelineno-58-13" name="__codelineno-58-13"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-58-14"><a href="#__codelineno-58-14" id="__codelineno-58-14" name="__codelineno-58-14"></a><span class="sd">    Decorator for automatic sync function tracing.</span>
</span><span id="__span-58-15"><a href="#__codelineno-58-15" id="__codelineno-58-15" name="__codelineno-58-15"></a>
</span><span id="__span-58-16"><a href="#__codelineno-58-16" id="__codelineno-58-16" name="__codelineno-58-16"></a><span class="sd">    Args:</span>
</span><span id="__span-58-17"><a href="#__codelineno-58-17" id="__codelineno-58-17" name="__codelineno-58-17"></a><span class="sd">        name: Optional span name (defaults to function name)</span>
</span><span id="__span-58-18"><a href="#__codelineno-58-18" id="__codelineno-58-18" name="__codelineno-58-18"></a>
</span><span id="__span-58-19"><a href="#__codelineno-58-19" id="__codelineno-58-19" name="__codelineno-58-19"></a><span class="sd">    Returns:</span>
</span><span id="__span-58-20"><a href="#__codelineno-58-20" id="__codelineno-58-20" name="__codelineno-58-20"></a><span class="sd">        Decorator function</span>
</span><span id="__span-58-21"><a href="#__codelineno-58-21" id="__codelineno-58-21" name="__codelineno-58-21"></a><span class="sd">    """</span>
</span></code></pre></div>
<h3 id="get_tracer">get_tracer()<a class="headerlink" href="#get_tracer" title="Permanent link">¬∂</a></h3>
<div class="language-python highlight"><pre><span></span><code><span id="__span-59-1"><a href="#__codelineno-59-1" id="__codelineno-59-1" name="__codelineno-59-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_tracer</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tracer</span><span class="p">:</span>
</span><span id="__span-59-2"><a href="#__codelineno-59-2" id="__codelineno-59-2" name="__codelineno-59-2"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-59-3"><a href="#__codelineno-59-3" id="__codelineno-59-3" name="__codelineno-59-3"></a><span class="sd">    Get a tracer instance for manual instrumentation.</span>
</span><span id="__span-59-4"><a href="#__codelineno-59-4" id="__codelineno-59-4" name="__codelineno-59-4"></a>
</span><span id="__span-59-5"><a href="#__codelineno-59-5" id="__codelineno-59-5" name="__codelineno-59-5"></a><span class="sd">    Args:</span>
</span><span id="__span-59-6"><a href="#__codelineno-59-6" id="__codelineno-59-6" name="__codelineno-59-6"></a><span class="sd">        name: Tracer name (typically __name__)</span>
</span><span id="__span-59-7"><a href="#__codelineno-59-7" id="__codelineno-59-7" name="__codelineno-59-7"></a>
</span><span id="__span-59-8"><a href="#__codelineno-59-8" id="__codelineno-59-8" name="__codelineno-59-8"></a><span class="sd">    Returns:</span>
</span><span id="__span-59-9"><a href="#__codelineno-59-9" id="__codelineno-59-9" name="__codelineno-59-9"></a><span class="sd">        OpenTelemetry Tracer instance</span>
</span><span id="__span-59-10"><a href="#__codelineno-59-10" id="__codelineno-59-10" name="__codelineno-59-10"></a><span class="sd">    """</span>
</span></code></pre></div>
<h3 id="get_meter">get_meter()<a class="headerlink" href="#get_meter" title="Permanent link">¬∂</a></h3>
<div class="language-python highlight"><pre><span></span><code><span id="__span-60-1"><a href="#__codelineno-60-1" id="__codelineno-60-1" name="__codelineno-60-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_meter</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Meter</span><span class="p">:</span>
</span><span id="__span-60-2"><a href="#__codelineno-60-2" id="__codelineno-60-2" name="__codelineno-60-2"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-60-3"><a href="#__codelineno-60-3" id="__codelineno-60-3" name="__codelineno-60-3"></a><span class="sd">    Get a meter instance for creating metrics.</span>
</span><span id="__span-60-4"><a href="#__codelineno-60-4" id="__codelineno-60-4" name="__codelineno-60-4"></a>
</span><span id="__span-60-5"><a href="#__codelineno-60-5" id="__codelineno-60-5" name="__codelineno-60-5"></a><span class="sd">    Args:</span>
</span><span id="__span-60-6"><a href="#__codelineno-60-6" id="__codelineno-60-6" name="__codelineno-60-6"></a><span class="sd">        name: Meter name (typically __name__)</span>
</span><span id="__span-60-7"><a href="#__codelineno-60-7" id="__codelineno-60-7" name="__codelineno-60-7"></a>
</span><span id="__span-60-8"><a href="#__codelineno-60-8" id="__codelineno-60-8" name="__codelineno-60-8"></a><span class="sd">    Returns:</span>
</span><span id="__span-60-9"><a href="#__codelineno-60-9" id="__codelineno-60-9" name="__codelineno-60-9"></a><span class="sd">        OpenTelemetry Meter instance</span>
</span><span id="__span-60-10"><a href="#__codelineno-60-10" id="__codelineno-60-10" name="__codelineno-60-10"></a><span class="sd">    """</span>
</span></code></pre></div>
<h3 id="applicationsettingswithobservability">ApplicationSettingsWithObservability<a class="headerlink" href="#applicationsettingswithobservability" title="Permanent link">¬∂</a></h3>
<div class="language-python highlight"><pre><span></span><code><span id="__span-61-1"><a href="#__codelineno-61-1" id="__codelineno-61-1" name="__codelineno-61-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">ApplicationSettingsWithObservability</span><span class="p">(</span><span class="n">ApplicationSettings</span><span class="p">,</span> <span class="n">ObservabilitySettingsMixin</span><span class="p">):</span>
</span><span id="__span-61-2"><a href="#__codelineno-61-2" id="__codelineno-61-2" name="__codelineno-61-2"></a><span class="w">    </span><span class="sd">"""</span>
</span><span id="__span-61-3"><a href="#__codelineno-61-3" id="__codelineno-61-3" name="__codelineno-61-3"></a><span class="sd">    Base settings class with built-in observability configuration.</span>
</span><span id="__span-61-4"><a href="#__codelineno-61-4" id="__codelineno-61-4" name="__codelineno-61-4"></a>
</span><span id="__span-61-5"><a href="#__codelineno-61-5" id="__codelineno-61-5" name="__codelineno-61-5"></a><span class="sd">    Attributes:</span>
</span><span id="__span-61-6"><a href="#__codelineno-61-6" id="__codelineno-61-6" name="__codelineno-61-6"></a><span class="sd">        service_name: str = Field(default="neuroglia-service")</span>
</span><span id="__span-61-7"><a href="#__codelineno-61-7" id="__codelineno-61-7" name="__codelineno-61-7"></a><span class="sd">        service_version: str = Field(default="1.0.0")</span>
</span><span id="__span-61-8"><a href="#__codelineno-61-8" id="__codelineno-61-8" name="__codelineno-61-8"></a><span class="sd">        deployment_environment: str = Field(default="development")</span>
</span><span id="__span-61-9"><a href="#__codelineno-61-9" id="__codelineno-61-9" name="__codelineno-61-9"></a><span class="sd">        otel_enabled: bool = Field(default=True)</span>
</span><span id="__span-61-10"><a href="#__codelineno-61-10" id="__codelineno-61-10" name="__codelineno-61-10"></a><span class="sd">        otel_endpoint: str = Field(default="http://localhost:4317")</span>
</span><span id="__span-61-11"><a href="#__codelineno-61-11" id="__codelineno-61-11" name="__codelineno-61-11"></a><span class="sd">        otel_console_export: bool = Field(default=False)</span>
</span><span id="__span-61-12"><a href="#__codelineno-61-12" id="__codelineno-61-12" name="__codelineno-61-12"></a><span class="sd">        tracing_enabled: bool = Field(default=True)</span>
</span><span id="__span-61-13"><a href="#__codelineno-61-13" id="__codelineno-61-13" name="__codelineno-61-13"></a><span class="sd">        metrics_enabled: bool = Field(default=True)</span>
</span><span id="__span-61-14"><a href="#__codelineno-61-14" id="__codelineno-61-14" name="__codelineno-61-14"></a><span class="sd">        logging_enabled: bool = Field(default=True)</span>
</span><span id="__span-61-15"><a href="#__codelineno-61-15" id="__codelineno-61-15" name="__codelineno-61-15"></a><span class="sd">        instrument_fastapi: bool = Field(default=True)</span>
</span><span id="__span-61-16"><a href="#__codelineno-61-16" id="__codelineno-61-16" name="__codelineno-61-16"></a><span class="sd">        instrument_httpx: bool = Field(default=True)</span>
</span><span id="__span-61-17"><a href="#__codelineno-61-17" id="__codelineno-61-17" name="__codelineno-61-17"></a><span class="sd">        instrument_logging: bool = Field(default=True)</span>
</span><span id="__span-61-18"><a href="#__codelineno-61-18" id="__codelineno-61-18" name="__codelineno-61-18"></a><span class="sd">        instrument_system_metrics: bool = Field(default=True)</span>
</span><span id="__span-61-19"><a href="#__codelineno-61-19" id="__codelineno-61-19" name="__codelineno-61-19"></a><span class="sd">    """</span>
</span></code></pre></div>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  Back to top
</button>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
<div class="md-social">
<a class="md-social__link" href="https://github.com/bvandewe/pyneuro" rel="noopener" target="_blank" title="github.com">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg>
</a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.expand", "navigation.top", "search.highlight", "search.share"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
<script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
</body>
</html>