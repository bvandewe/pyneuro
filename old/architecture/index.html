
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.6.20" name="generator"/>
<title>ğŸ—ï¸ Architecture Guide - Neuroglia Python Framework</title>
<link href="../../assets/stylesheets/main.e53b48f4.min.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body data-md-color-accent="blue" data-md-color-primary="blue" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#architecture-guide">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Neuroglia Python Framework" class="md-header__button md-logo" data-md-component="logo" href="../.." title="Neuroglia Python Framework">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Neuroglia Python Framework
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              ğŸ—ï¸ Architecture Guide
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="blue" data-md-color-media="" data-md-color-primary="blue" data-md-color-scheme="default" id="__palette_0" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="blue" data-md-color-media="" data-md-color-primary="blue" data-md-color-scheme="slate" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"></path></svg>
</label>
</form>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<a aria-label="Share" class="md-search__icon md-icon" data-clipboard="" data-clipboard-text="" data-md-component="search-share" href="javascript:void(0)" tabindex="-1" title="Share">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"></path></svg>
</a>
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
</nav>
<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="../..">
        
  
  
    
  
  Home

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../getting-started/">
          
  
  
  Getting Started

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../mario-pizzeria/">
        
  
  
    
  
  Mario Pizzeria

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../patterns/">
          
  
  
  Patterns

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../features/">
          
  
  
  Features

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../guides/">
          
  
  
  Guides

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../samples/">
          
  
  
  Samples

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../references/source_code_naming_convention/">
          
  
  
  References

        </a>
</li>
</ul>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Neuroglia Python Framework" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="Neuroglia Python Framework">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
    Neuroglia Python Framework
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../..">
<span class="md-ellipsis">
    Home
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
<span class="md-ellipsis">
    Getting Started
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../getting-started/">
<span class="md-ellipsis">
    Overview
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../guides/3-min-bootstrap/">
<span class="md-ellipsis">
    3-Minute Bootstrap
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../guides/local-development/">
<span class="md-ellipsis">
    Local Development Setup
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../guides/mario-pizzeria-tutorial/">
<span class="md-ellipsis">
    Mario's Pizzeria Tutorial
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../mario-pizzeria/">
<span class="md-ellipsis">
    Mario Pizzeria
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
<span class="md-ellipsis">
    Patterns
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            Patterns
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../patterns/">
<span class="md-ellipsis">
    Overview
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../patterns/clean-architecture/">
<span class="md-ellipsis">
    Clean Architecture
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../patterns/cqrs/">
<span class="md-ellipsis">
    CQRS
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../patterns/event-driven/">
<span class="md-ellipsis">
    Event-Driven
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../patterns/repository/">
<span class="md-ellipsis">
    Repository
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../patterns/resource-oriented-architecture/">
<span class="md-ellipsis">
    Resource-Oriented Architecture
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../patterns/watcher-reconciliation-patterns/">
<span class="md-ellipsis">
    Watcher &amp; Reconciliation Patterns
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../patterns/watcher-reconciliation-execution/">
<span class="md-ellipsis">
    Watcher &amp; Reconciliation Execution
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
<span class="md-ellipsis">
    Features
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
            Features
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../features/">
<span class="md-ellipsis">
    Overview
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../features/dependency-injection/">
<span class="md-ellipsis">
    Dependency Injection
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../features/cqrs-mediation/">
<span class="md-ellipsis">
    CQRS &amp; Mediation
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../features/mvc-controllers/">
<span class="md-ellipsis">
    MVC Controllers
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../features/data-access/">
<span class="md-ellipsis">
    Data Access
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../features/event-sourcing/">
<span class="md-ellipsis">
    Event Sourcing
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../features/serialization/">
<span class="md-ellipsis">
    Serialization
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../features/object-mapping/">
<span class="md-ellipsis">
    Object Mapping
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../features/reactive-programming/">
<span class="md-ellipsis">
    Reactive Programming
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../features/background-task-scheduling/">
<span class="md-ellipsis">
    Background Task Scheduling
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../features/redis-cache-repository/">
<span class="md-ellipsis">
    Redis Cache Repository
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../features/http-service-client/">
<span class="md-ellipsis">
    HTTP Service Client
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../features/case-conversion-utilities/">
<span class="md-ellipsis">
    Case Conversion Utilities
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../features/enhanced-model-validation/">
<span class="md-ellipsis">
    Enhanced Model Validation
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../features/mermaid-diagrams/">
<span class="md-ellipsis">
    Mermaid Diagrams
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
<span class="md-ellipsis">
    Guides
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_6_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_6">
<span class="md-nav__icon md-icon"></span>
            Guides
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../guides/">
<span class="md-ellipsis">
    Overview
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../guides/project-setup/">
<span class="md-ellipsis">
    Project Setup
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../guides/testing-setup/">
<span class="md-ellipsis">
    Testing Setup
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_7" type="checkbox"/>
<label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
<span class="md-ellipsis">
    Samples
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_7_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_7">
<span class="md-nav__icon md-icon"></span>
            Samples
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../samples/">
<span class="md-ellipsis">
    Overview
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../samples/openbank/">
<span class="md-ellipsis">
    OpenBank
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../samples/api_gateway/">
<span class="md-ellipsis">
    API Gateway
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../samples/desktop_controller/">
<span class="md-ellipsis">
    Desktop Controller
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_8" type="checkbox"/>
<label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
<span class="md-ellipsis">
    References
    
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_8_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_8">
<span class="md-nav__icon md-icon"></span>
            References
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../references/source_code_naming_convention/">
<span class="md-ellipsis">
    Source Code Naming Conventions
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../references/12-factor-app/">
<span class="md-ellipsis">
    12-Factor App
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../references/python_type_hints/">
<span class="md-ellipsis">
    Python Type Hints
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../references/python_generic_types/">
<span class="md-ellipsis">
    Python Generic Types
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../references/python_modular_code/">
<span class="md-ellipsis">
    Python Modular Code
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../references/python_object_oriented/">
<span class="md-ellipsis">
    Python Object-Oriented Programming
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#what-youll-learn">
<span class="md-ellipsis">
      ğŸ¯ What You'll Learn
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#marios-pizzeria-architecture">
<span class="md-ellipsis">
      ğŸ• Mario's Pizzeria Architecture
    </span>
</a>
<nav aria-label="ğŸ• Mario's Pizzeria Architecture" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#overview-from-order-to-pizza">
<span class="md-ellipsis">
      Overview: From Order to Pizza
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#the-dependency-rule-in-action">
<span class="md-ellipsis">
      The Dependency Rule in Action
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#layer-details-with-pizza-examples">
<span class="md-ellipsis">
      ğŸ¢ Layer Details with Pizza Examples
    </span>
</a>
<nav aria-label="ğŸ¢ Layer Details with Pizza Examples" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#api-layer-customer-staff-interface">
<span class="md-ellipsis">
      ğŸ“¡ API Layer: Customer &amp; Staff Interface
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#integration-layer-external-systems">
<span class="md-ellipsis">
      ğŸ”Œ Integration Layer: External Systems
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#cqrs-implementation-in-marios-pizzeria">
<span class="md-ellipsis">
      ğŸ¯ CQRS Implementation in Mario's Pizzeria
    </span>
</a>
<nav aria-label="ğŸ¯ CQRS Implementation in Mario's Pizzeria" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#command-and-query-separation">
<span class="md-ellipsis">
      Command and Query Separation
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#benefits-of-cqrs-in-pizzeria-context">
<span class="md-ellipsis">
      Benefits of CQRS in Pizzeria Context
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#event-driven-architecture">
<span class="md-ellipsis">
      ğŸ“Š Event-Driven Architecture
    </span>
</a>
<nav aria-label="ğŸ“Š Event-Driven Architecture" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#domain-events-in-pizza-workflow">
<span class="md-ellipsis">
      Domain Events in Pizza Workflow
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#event-handler-examples">
<span class="md-ellipsis">
      Event Handler Examples
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#testing-strategy-across-layers">
<span class="md-ellipsis">
      ğŸ§ª Testing Strategy Across Layers
    </span>
</a>
<nav aria-label="ğŸ§ª Testing Strategy Across Layers" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#layer-specific-testing-approaches">
<span class="md-ellipsis">
      Layer-Specific Testing Approaches
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#end-to-end-testing">
<span class="md-ellipsis">
      End-to-End Testing
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#dependency-injection-configuration">
<span class="md-ellipsis">
      ğŸ› ï¸ Dependency Injection Configuration
    </span>
</a>
<nav aria-label="ğŸ› ï¸ Dependency Injection Configuration" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#service-registration-for-marios-pizzeria">
<span class="md-ellipsis">
      Service Registration for Mario's Pizzeria
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#benefits-of-this-architecture">
<span class="md-ellipsis">
      ğŸš€ Benefits of This Architecture
    </span>
</a>
<nav aria-label="ğŸš€ Benefits of This Architecture" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#for-marios-pizzeria-business">
<span class="md-ellipsis">
      For Mario's Pizzeria Business
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#for-development-teams">
<span class="md-ellipsis">
      For Development Teams
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#for-long-term-maintenance">
<span class="md-ellipsis">
      For Long-Term Maintenance
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#related-documentation">
<span class="md-ellipsis">
      ğŸ”— Related Documentation
    </span>
</a>
<nav aria-label="ğŸ”— Related Documentation" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#application-layer-pizza-business-workflow">
<span class="md-ellipsis">
      ğŸ’¼ Application Layer: Pizza Business Workflow
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#domain-layer-pizza-business-logic">
<span class="md-ellipsis">
      ğŸ›ï¸ Domain Layer: Pizza Business Logic
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#application-layer-srcapplication">
<span class="md-ellipsis">
      ğŸ’¼ Application Layer (src/application/)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#domain-layer-srcdomain">
<span class="md-ellipsis">
      ğŸ›ï¸ Domain Layer (src/domain/)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#integration-layer-srcintegration">
<span class="md-ellipsis">
      ğŸ”Œ Integration Layer (src/integration/)
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#data-flow">
<span class="md-ellipsis">
      ğŸ”„ Data Flow
    </span>
</a>
<nav aria-label="ğŸ”„ Data Flow" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#command-flow-write-operations">
<span class="md-ellipsis">
      Command Flow (Write Operations)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#query-flow-read-operations">
<span class="md-ellipsis">
      Query Flow (Read Operations)
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#patterns-implemented">
<span class="md-ellipsis">
      ğŸ­ Patterns Implemented
    </span>
</a>
<nav aria-label="ğŸ­ Patterns Implemented" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#1-command-query-responsibility-segregation-cqrs">
<span class="md-ellipsis">
      1. Command Query Responsibility Segregation (CQRS)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-mediator-pattern">
<span class="md-ellipsis">
      2. Mediator Pattern
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3-repository-pattern">
<span class="md-ellipsis">
      3. Repository Pattern
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#4-event-sourcing-optional">
<span class="md-ellipsis">
      4. Event Sourcing (Optional)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#5-dependency-injection">
<span class="md-ellipsis">
      5. Dependency Injection
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#testing-architecture">
<span class="md-ellipsis">
      ğŸ§ª Testing Architecture
    </span>
</a>
<nav aria-label="ğŸ§ª Testing Architecture" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#unit-tests">
<span class="md-ellipsis">
      Unit Tests
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#integration-tests">
<span class="md-ellipsis">
      Integration Tests
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#architecture-tests">
<span class="md-ellipsis">
      Architecture Tests
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#benefits">
<span class="md-ellipsis">
      ğŸš€ Benefits
    </span>
</a>
<nav aria-label="ğŸš€ Benefits" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#maintainability">
<span class="md-ellipsis">
      Maintainability
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#testability">
<span class="md-ellipsis">
      Testability
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#scalability">
<span class="md-ellipsis">
      Scalability
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#flexibility">
<span class="md-ellipsis">
      Flexibility
    </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="architecture-guide">ğŸ—ï¸ Architecture Guide<a class="headerlink" href="#architecture-guide" title="Permanent link">Â¶</a></h1>
<div class="admonition danger">
<p class="admonition-title">âš ï¸ Deprecated</p>
</div>
<p>This page is deprecated and will be removed in a future version. The content has been migrated to more focused sections:</p>
<div class="codehilite"><pre><span></span><code>- **[Clean Architecture Pattern](patterns/clean-architecture.md)** - Four-layer separation and dependency rules
- **[CQRS Pattern](patterns/cqrs.md)** - Command Query Responsibility Segregation
- **[Event-Driven Pattern](patterns/event-driven.md)** - Domain events and messaging
- **[Mario's Pizzeria](mario-pizzeria.md)** - Complete bounded context example
- **[Features](features/)** - Framework-specific implementation details

Please use the new structure for the most up-to-date documentation.
</code></pre></div>
<p>Neuroglia's clean architecture is demonstrated through <strong>Mario's Pizzeria</strong>, showing how layered architecture promotes separation of concerns, testability, and maintainability in a real-world application.</p>
<h2 id="what-youll-learn">ğŸ¯ What You'll Learn<a class="headerlink" href="#what-youll-learn" title="Permanent link">Â¶</a></h2>
<ul>
<li><strong>Clean Architecture Layers</strong>: How Mario's Pizzeria separates concerns across API, Application, Domain, and Integration layers</li>
<li><strong>Dependency Flow</strong>: How pizza order workflow demonstrates the dependency rule in practice</li>
<li><strong>CQRS Implementation</strong>: How command and query separation works in kitchen operations</li>
<li><strong>Event-Driven Design</strong>: How domain events coordinate between pizza preparation and customer notifications</li>
<li><strong>Testing Strategy</strong>: How architecture enables comprehensive testing at every layer</li>
</ul>
<h2 id="marios-pizzeria-architecture">ğŸ• Mario's Pizzeria Architecture<a class="headerlink" href="#marios-pizzeria-architecture" title="Permanent link">Â¶</a></h2>
<h3 id="overview-from-order-to-pizza">Overview: From Order to Pizza<a class="headerlink" href="#overview-from-order-to-pizza" title="Permanent link">Â¶</a></h3>
<p>Mario's Pizzeria demonstrates clean architecture through the complete pizza ordering and preparation workflow:</p>
<div class="highlight"><pre><span></span><code>â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            ğŸŒ API Layer (Controllers)           â”‚  â† Customer &amp; Staff Interface
â”‚   OrdersController â”‚ MenuController â”‚ Kitchen   â”‚
â”‚   Authentication   â”‚ Error Handling â”‚ Swagger   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ orchestrates
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       ğŸ’¼ Application Layer (CQRS + Events)      â”‚  â† Business Workflow
â”‚  PlaceOrderCommand â”‚ GetMenuQuery â”‚ Handlers    â”‚
â”‚  OrderPlacedEvent  â”‚ Kitchen Workflow Pipeline  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ uses
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ğŸ›ï¸ Domain Layer (Business Logic)        â”‚  â† Pizza Business Rules
â”‚    Order Entity    â”‚    Pizza Entity           â”‚
â”‚  Kitchen Workflow  â”‚  Pricing Rules            â”‚
â”‚   Domain Events    â”‚  Business Validation      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ implements
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      ğŸ”Œ Integration Layer (External Systems)    â”‚  â† Data &amp; External APIs
â”‚  Order Repository  â”‚  Payment Gateway          â”‚
â”‚   File Storage     â”‚  MongoDB â”‚ Event Store    â”‚
â”‚  SMS Notifications â”‚  Email Service            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
</code></pre></div>
<h3 id="the-dependency-rule-in-action">The Dependency Rule in Action<a class="headerlink" href="#the-dependency-rule-in-action" title="Permanent link">Â¶</a></h3>
<p>Pizza order flow demonstrates how dependencies always point inward:</p>
<ol>
<li><strong>API Layer</strong> â†’ Application Layer: Controller calls <code>PlaceOrderCommand</code></li>
<li><strong>Application Layer</strong> â†’ Domain Layer: Handler uses <code>Order</code> entity business logic</li>
<li><strong>Integration Layer</strong> â†’ Domain Layer: Repository implements domain <code>IOrderRepository</code> interface</li>
<li><strong>Never</strong>: Domain layer doesn't know about API controllers or database implementation</li>
</ol>
<h2 id="layer-details-with-pizza-examples">ğŸ¢ Layer Details with Pizza Examples<a class="headerlink" href="#layer-details-with-pizza-examples" title="Permanent link">Â¶</a></h2>
<h3 id="api-layer-customer-staff-interface">ğŸ“¡ API Layer: Customer &amp; Staff Interface<a class="headerlink" href="#api-layer-customer-staff-interface" title="Permanent link">Â¶</a></h3>
<p><strong>Purpose</strong>: External interface for Mario's Pizzeria operations</p>
<p><strong>Responsibilities</strong>:</p>
<ul>
<li>HTTP endpoints for orders, menu, kitchen operations</li>
<li>Customer and staff authentication (OAuth 2.0)</li>
<li>Request validation and error handling</li>
<li>OpenAPI documentation generation</li>
</ul>
<p><strong>Key Components</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># src/api/controllers/orders_controller.py</span>
<span class="k">class</span><span class="w"> </span><span class="nc">OrdersController</span><span class="p">(</span><span class="n">ControllerBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Handle customer pizza orders"""</span>

    <span class="nd">@post</span><span class="p">(</span><span class="s2">"/"</span><span class="p">,</span> <span class="n">response_model</span><span class="o">=</span><span class="n">OrderDto</span><span class="p">,</span> <span class="n">status_code</span><span class="o">=</span><span class="mi">201</span><span class="p">)</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">place_order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order_request</span><span class="p">:</span> <span class="n">PlaceOrderDto</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OrderDto</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Place new pizza order"""</span>
        <span class="n">command</span> <span class="o">=</span> <span class="n">PlaceOrderCommand</span><span class="p">(</span>
            <span class="n">customer_name</span><span class="o">=</span><span class="n">order_request</span><span class="o">.</span><span class="n">customer_name</span><span class="p">,</span>
            <span class="n">customer_phone</span><span class="o">=</span><span class="n">order_request</span><span class="o">.</span><span class="n">customer_phone</span><span class="p">,</span>
            <span class="n">pizzas</span><span class="o">=</span><span class="n">order_request</span><span class="o">.</span><span class="n">pizzas</span><span class="p">,</span>
            <span class="n">payment_method</span><span class="o">=</span><span class="n">order_request</span><span class="o">.</span><span class="n">payment_method</span>
        <span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">mediator</span><span class="o">.</span><span class="n">execute_async</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>  <span class="c1"># Framework handles success/error response</span>

<span class="c1"># src/api/dtos/order_dto.py</span>
<span class="k">class</span><span class="w"> </span><span class="nc">PlaceOrderDto</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Request DTO for placing pizza orders"""</span>
    <span class="n">customer_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">min_length</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">customer_phone</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="sa">r</span><span class="s2">"^\+?1?[2-9]\d</span><span class="si">{9}</span><span class="s2">$"</span><span class="p">)</span>
    <span class="n">customer_address</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">min_length</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">pizzas</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">PizzaOrderDto</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">min_items</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_items</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">payment_method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="s2">"^(cash|card|online)$"</span><span class="p">)</span>
</code></pre></div>
<p><strong>Architecture Benefits</strong>:</p>
<ul>
<li>
<ul>
<li><strong>Framework Independence</strong>: Pure business logic with no external dependencies</li>
</ul>
</li>
</ul>
<h3 id="integration-layer-external-systems">ğŸ”Œ Integration Layer: External Systems<a class="headerlink" href="#integration-layer-external-systems" title="Permanent link">Â¶</a></h3>
<p><strong>Purpose</strong>: Handles external system interactions and data persistence</p>
<p><strong>Responsibilities</strong>:</p>
<ul>
<li>Data persistence (file storage, MongoDB, event store)</li>
<li>External API integration (payment, notifications)</li>
<li>Infrastructure concerns (caching, logging)</li>
<li>Implements domain interfaces</li>
</ul>
<p><strong>Integration Components</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># src/integration/repositories/file_order_repository.py</span>
<span class="k">class</span><span class="w"> </span><span class="nc">FileOrderRepository</span><span class="p">(</span><span class="n">IOrderRepository</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""File-based order repository for development"""</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">orders_directory</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">"data/orders"</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">orders_directory</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">orders_directory</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">orders_directory</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">save_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order</span><span class="p">:</span> <span class="n">Order</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Order</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Save order to JSON file"""</span>
        <span class="n">order_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">orders_directory</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">order</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">.json"</span>

        <span class="n">order_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">"id"</span><span class="p">:</span> <span class="n">order</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="s2">"customer_name"</span><span class="p">:</span> <span class="n">order</span><span class="o">.</span><span class="n">customer_name</span><span class="p">,</span>
            <span class="s2">"customer_phone"</span><span class="p">:</span> <span class="n">order</span><span class="o">.</span><span class="n">customer_phone</span><span class="p">,</span>
            <span class="s2">"customer_address"</span><span class="p">:</span> <span class="n">order</span><span class="o">.</span><span class="n">customer_address</span><span class="p">,</span>
            <span class="s2">"pizzas"</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_pizza_to_dict</span><span class="p">(</span><span class="n">pizza</span><span class="p">)</span> <span class="k">for</span> <span class="n">pizza</span> <span class="ow">in</span> <span class="n">order</span><span class="o">.</span><span class="n">pizzas</span><span class="p">],</span>
            <span class="s2">"status"</span><span class="p">:</span> <span class="n">order</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="s2">"order_time"</span><span class="p">:</span> <span class="n">order</span><span class="o">.</span><span class="n">order_time</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
            <span class="s2">"total_amount"</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">order</span><span class="o">.</span><span class="n">total_amount</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="k">async</span> <span class="k">with</span> <span class="n">aiofiles</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">order_file</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="k">await</span> <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">order_data</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">order</span>

<span class="c1"># src/integration/services/payment_service.py</span>
<span class="k">class</span><span class="w"> </span><span class="nc">StripePaymentService</span><span class="p">(</span><span class="n">IPaymentService</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Payment processing using Stripe API"""</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">process_payment_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                    <span class="n">amount</span><span class="p">:</span> <span class="n">Decimal</span><span class="p">,</span>
                                    <span class="n">payment_method</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PaymentResult</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Process payment through Stripe"""</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span><span class="w"> </span><span class="nn">stripe</span>
            <span class="n">stripe</span><span class="o">.</span><span class="n">api_key</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">"STRIPE_SECRET_KEY"</span><span class="p">)</span>

            <span class="c1"># Create payment intent</span>
            <span class="n">intent</span> <span class="o">=</span> <span class="n">stripe</span><span class="o">.</span><span class="n">PaymentIntent</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
                <span class="n">amount</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">amount</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span>  <span class="c1"># Convert to cents</span>
                <span class="n">currency</span><span class="o">=</span><span class="s2">"usd"</span><span class="p">,</span>
                <span class="n">payment_method</span><span class="o">=</span><span class="n">payment_method</span><span class="p">,</span>
                <span class="n">confirm</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">return_url</span><span class="o">=</span><span class="s2">"https://marios-pizzeria.com/payment-success"</span>
            <span class="p">)</span>

            <span class="k">return</span> <span class="n">PaymentResult</span><span class="p">(</span>
                <span class="n">is_success</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">transaction_id</span><span class="o">=</span><span class="n">intent</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                <span class="n">amount_processed</span><span class="o">=</span><span class="n">amount</span>
            <span class="p">)</span>

        <span class="k">except</span> <span class="n">stripe</span><span class="o">.</span><span class="n">error</span><span class="o">.</span><span class="n">StripeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">PaymentResult</span><span class="p">(</span>
                <span class="n">is_success</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">error_message</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="p">)</span>

<span class="c1"># src/integration/services/notification_service.py</span>
<span class="k">class</span><span class="w"> </span><span class="nc">TwilioNotificationService</span><span class="p">(</span><span class="n">INotificationService</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""SMS notifications using Twilio"""</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">send_order_confirmation_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order</span><span class="p">:</span> <span class="n">Order</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Send order confirmation SMS"""</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">twilio.rest</span><span class="w"> </span><span class="kn">import</span> <span class="n">Client</span>

        <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">"TWILIO_ACCOUNT_SID"</span><span class="p">),</span>
            <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">"TWILIO_AUTH_TOKEN"</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="n">message</span> <span class="o">=</span> <span class="p">(</span><span class="sa">f</span><span class="s2">"Hi </span><span class="si">{</span><span class="n">order</span><span class="o">.</span><span class="n">customer_name</span><span class="si">}</span><span class="s2">! Your pizza order #</span><span class="si">{</span><span class="n">order</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> "</span>
                  <span class="sa">f</span><span class="s2">"has been confirmed. Total: $</span><span class="si">{</span><span class="n">order</span><span class="o">.</span><span class="n">total_amount</span><span class="si">}</span><span class="s2">. "</span>
                  <span class="sa">f</span><span class="s2">"Estimated ready time: </span><span class="si">{</span><span class="n">order</span><span class="o">.</span><span class="n">estimated_ready_time</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">'%I:%M %p'</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

        <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">messages</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
            <span class="n">body</span><span class="o">=</span><span class="n">message</span><span class="p">,</span>
            <span class="n">from_</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">"TWILIO_PHONE_NUMBER"</span><span class="p">),</span>
            <span class="n">to</span><span class="o">=</span><span class="n">order</span><span class="o">.</span><span class="n">customer_phone</span>
        <span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">send_order_ready_notification_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">order</span><span class="p">:</span> <span class="n">Order</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Send order ready SMS"""</span>
        <span class="n">message</span> <span class="o">=</span> <span class="p">(</span><span class="sa">f</span><span class="s2">"ğŸ• Your order #</span><span class="si">{</span><span class="n">order</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2"> is ready for pickup at Mario's Pizzeria! "</span>
                  <span class="sa">f</span><span class="s2">"Please arrive within 15 minutes to keep your pizzas hot."</span><span class="p">)</span>

        <span class="c1"># Implementation details...</span>
</code></pre></div>
<h2 id="cqrs-implementation-in-marios-pizzeria">ğŸ¯ CQRS Implementation in Mario's Pizzeria<a class="headerlink" href="#cqrs-implementation-in-marios-pizzeria" title="Permanent link">Â¶</a></h2>
<h3 id="command-and-query-separation">Command and Query Separation<a class="headerlink" href="#command-and-query-separation" title="Permanent link">Â¶</a></h3>
<p>Mario's Pizzeria demonstrates CQRS (Command Query Responsibility Segregation):</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Commands: Change state (Write operations)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">PlaceOrderCommand</span><span class="p">(</span><span class="n">Command</span><span class="p">[</span><span class="n">OperationResult</span><span class="p">[</span><span class="n">OrderDto</span><span class="p">]]):</span>
<span class="w">    </span><span class="sd">"""Command to place new pizza order"""</span>
    <span class="k">pass</span>

<span class="k">class</span><span class="w"> </span><span class="nc">UpdateOrderStatusCommand</span><span class="p">(</span><span class="n">Command</span><span class="p">[</span><span class="n">OperationResult</span><span class="p">[</span><span class="n">OrderDto</span><span class="p">]]):</span>
<span class="w">    </span><span class="sd">"""Command to update order status in kitchen"""</span>
    <span class="k">pass</span>

<span class="k">class</span><span class="w"> </span><span class="nc">CancelOrderCommand</span><span class="p">(</span><span class="n">Command</span><span class="p">[</span><span class="n">OperationResult</span><span class="p">[</span><span class="n">OrderDto</span><span class="p">]]):</span>
<span class="w">    </span><span class="sd">"""Command to cancel existing order"""</span>
    <span class="k">pass</span>

<span class="c1"># Queries: Read state (Read operations)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">GetOrderByIdQuery</span><span class="p">(</span><span class="n">Query</span><span class="p">[</span><span class="n">OrderDto</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">"""Query to get specific order details"""</span>
    <span class="k">pass</span>

<span class="k">class</span><span class="w"> </span><span class="nc">GetKitchenQueueQuery</span><span class="p">(</span><span class="n">Query</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">KitchenOrderDto</span><span class="p">]]):</span>
<span class="w">    </span><span class="sd">"""Query to get orders in kitchen preparation queue"""</span>
    <span class="k">pass</span>

<span class="k">class</span><span class="w"> </span><span class="nc">GetMenuQuery</span><span class="p">(</span><span class="n">Query</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PizzaDto</span><span class="p">]]):</span>
<span class="w">    </span><span class="sd">"""Query to get available pizza menu"""</span>
    <span class="k">pass</span>
</code></pre></div>
<h3 id="benefits-of-cqrs-in-pizzeria-context">Benefits of CQRS in Pizzeria Context<a class="headerlink" href="#benefits-of-cqrs-in-pizzeria-context" title="Permanent link">Â¶</a></h3>
<p><strong>Write Side (Commands)</strong>:</p>
<ul>
<li><strong>Order Placement</strong>: Validates business rules, processes payments</li>
<li><strong>Kitchen Operations</strong>: Updates order status, manages workflow</li>
<li><strong>Menu Management</strong>: Updates pizza availability, pricing</li>
</ul>
<p><strong>Read Side (Queries)</strong>:</p>
<ul>
<li><strong>Customer App</strong>: Fast menu browsing, order tracking</li>
<li><strong>Kitchen Display</strong>: Real-time queue updates</li>
<li><strong>Analytics</strong>: Revenue reports, performance metrics</li>
</ul>
<p><strong>Separate Optimization</strong>:</p>
<ul>
<li>Commands use MongoDB for ACID transactions</li>
<li>Queries use optimized read models for fast retrieval</li>
<li>Analytics use event store for historical data</li>
</ul>
<h2 id="event-driven-architecture">ğŸ“Š Event-Driven Architecture<a class="headerlink" href="#event-driven-architecture" title="Permanent link">Â¶</a></h2>
<h3 id="domain-events-in-pizza-workflow">Domain Events in Pizza Workflow<a class="headerlink" href="#domain-events-in-pizza-workflow" title="Permanent link">Â¶</a></h3>
<p>Events coordinate between different parts of Mario's Pizzeria:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Domain events flow through the system</span>
<span class="n">OrderPlacedEvent</span> <span class="err">â†’</span> <span class="n">KitchenNotificationHandler</span> <span class="err">â†’</span> <span class="n">Kitchen</span> <span class="n">Display</span> <span class="n">Update</span>
                <span class="err">â†˜</span> <span class="n">CustomerConfirmationHandler</span> <span class="err">â†’</span> <span class="n">SMS</span> <span class="n">Confirmation</span>
                <span class="err">â†˜</span> <span class="n">InventoryHandler</span> <span class="err">â†’</span> <span class="n">Update</span> <span class="n">Pizza</span> <span class="n">Availability</span>

<span class="n">OrderReadyEvent</span> <span class="err">â†’</span> <span class="n">CustomerNotificationHandler</span> <span class="err">â†’</span> <span class="s2">"Order Ready"</span> <span class="n">SMS</span>
               <span class="err">â†˜</span> <span class="n">DeliveryScheduleHandler</span> <span class="err">â†’</span> <span class="n">Schedule</span> <span class="n">Delivery</span>

<span class="n">OrderCompletedEvent</span> <span class="err">â†’</span> <span class="n">AnalyticsHandler</span> <span class="err">â†’</span> <span class="n">Update</span> <span class="n">Revenue</span> <span class="n">Metrics</span>
                   <span class="err">â†˜</span> <span class="n">CustomerHistoryHandler</span> <span class="err">â†’</span> <span class="n">Update</span> <span class="n">Customer</span> <span class="n">Profile</span>
</code></pre></div>
<h3 id="event-handler-examples">Event Handler Examples<a class="headerlink" href="#event-handler-examples" title="Permanent link">Â¶</a></h3>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">KitchenNotificationHandler</span><span class="p">(</span><span class="n">EventHandler</span><span class="p">[</span><span class="n">OrderPlacedEvent</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">"""Update kitchen display when new order placed"""</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">handle_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">OrderPlacedEvent</span><span class="p">):</span>
        <span class="c1"># Add order to kitchen queue</span>
        <span class="n">command</span> <span class="o">=</span> <span class="n">AddToKitchenQueueCommand</span><span class="p">(</span>
            <span class="n">order_id</span><span class="o">=</span><span class="n">event</span><span class="o">.</span><span class="n">order_id</span><span class="p">,</span>
            <span class="n">estimated_ready_time</span><span class="o">=</span><span class="n">event</span><span class="o">.</span><span class="n">estimated_ready_time</span>
        <span class="p">)</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">mediator</span><span class="o">.</span><span class="n">execute_async</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

<span class="k">class</span><span class="w"> </span><span class="nc">CustomerNotificationHandler</span><span class="p">(</span><span class="n">EventHandler</span><span class="p">[</span><span class="n">OrderReadyEvent</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">"""Notify customer when order is ready"""</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">handle_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">OrderReadyEvent</span><span class="p">):</span>
        <span class="c1"># Send SMS notification</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">notification_service</span><span class="o">.</span><span class="n">send_order_ready_notification_async</span><span class="p">(</span>
            <span class="n">order_id</span><span class="o">=</span><span class="n">event</span><span class="o">.</span><span class="n">order_id</span><span class="p">,</span>
            <span class="n">customer_phone</span><span class="o">=</span><span class="n">event</span><span class="o">.</span><span class="n">customer_phone</span>
        <span class="p">)</span>

<span class="k">class</span><span class="w"> </span><span class="nc">RevenueAnalyticsHandler</span><span class="p">(</span><span class="n">EventHandler</span><span class="p">[</span><span class="n">OrderCompletedEvent</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">"""Update revenue analytics when order completed"""</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">handle_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">OrderCompletedEvent</span><span class="p">):</span>
        <span class="c1"># Update daily revenue</span>
        <span class="n">command</span> <span class="o">=</span> <span class="n">UpdateDailyRevenueCommand</span><span class="p">(</span>
            <span class="n">date</span><span class="o">=</span><span class="n">event</span><span class="o">.</span><span class="n">completed_at</span><span class="o">.</span><span class="n">date</span><span class="p">(),</span>
            <span class="n">amount</span><span class="o">=</span><span class="n">event</span><span class="o">.</span><span class="n">total_amount</span><span class="p">,</span>
            <span class="n">order_count</span><span class="o">=</span><span class="mi">1</span>
        <span class="p">)</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">mediator</span><span class="o">.</span><span class="n">execute_async</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
</code></pre></div>
<h2 id="testing-strategy-across-layers">ğŸ§ª Testing Strategy Across Layers<a class="headerlink" href="#testing-strategy-across-layers" title="Permanent link">Â¶</a></h2>
<h3 id="layer-specific-testing-approaches">Layer-Specific Testing Approaches<a class="headerlink" href="#layer-specific-testing-approaches" title="Permanent link">Â¶</a></h3>
<p>Each layer in Mario's Pizzeria has specific testing strategies:</p>
<p><strong>API Layer (Controllers)</strong>:</p>
<ul>
<li><strong>Unit Tests</strong>: Mock mediator, test HTTP status codes and response formatting</li>
<li><strong>Integration Tests</strong>: Test full HTTP request/response cycle with real dependencies</li>
<li><strong>Contract Tests</strong>: Validate request/response schemas match OpenAPI spec</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">asyncio</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_place_order_success</span><span class="p">(</span><span class="n">orders_controller</span><span class="p">,</span> <span class="n">mock_mediator</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Test successful order placement through controller"""</span>
    <span class="c1"># Arrange</span>
    <span class="n">order_request</span> <span class="o">=</span> <span class="n">PlaceOrderDto</span><span class="p">(</span>
        <span class="n">customer_name</span><span class="o">=</span><span class="s2">"Test Customer"</span><span class="p">,</span>
        <span class="n">customer_phone</span><span class="o">=</span><span class="s2">"+1234567890"</span><span class="p">,</span>
        <span class="n">pizzas</span><span class="o">=</span><span class="p">[</span><span class="n">PizzaOrderDto</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"Margherita"</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">"large"</span><span class="p">,</span> <span class="n">quantity</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>
    <span class="p">)</span>

    <span class="n">expected_order</span> <span class="o">=</span> <span class="n">OrderDto</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">"order_123"</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="s2">"received"</span><span class="p">)</span>
    <span class="n">mock_mediator</span><span class="o">.</span><span class="n">execute_async</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">OperationResult</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="n">expected_order</span><span class="p">)</span>

    <span class="c1"># Act</span>
    <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">orders_controller</span><span class="o">.</span><span class="n">place_order</span><span class="p">(</span><span class="n">order_request</span><span class="p">)</span>

    <span class="c1"># Assert</span>
    <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="s2">"order_123"</span>
    <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="s2">"received"</span>
</code></pre></div>
<p><strong>Application Layer (Handlers)</strong>:</p>
<ul>
<li><strong>Unit Tests</strong>: Mock all dependencies (repositories, external services)</li>
<li><strong>Behavior Tests</strong>: Verify business workflow logic and error handling</li>
<li><strong>Event Tests</strong>: Validate domain events are raised correctly</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">asyncio</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_place_order_handler_workflow</span><span class="p">(</span><span class="n">mock_order_repo</span><span class="p">,</span> <span class="n">mock_payment_service</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Test complete order placement workflow"""</span>
    <span class="c1"># Arrange</span>
    <span class="n">handler</span> <span class="o">=</span> <span class="n">PlaceOrderCommandHandler</span><span class="p">(</span><span class="n">mock_order_repo</span><span class="p">,</span> <span class="n">mock_payment_service</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
    <span class="n">command</span> <span class="o">=</span> <span class="n">PlaceOrderCommand</span><span class="p">(</span><span class="n">customer_name</span><span class="o">=</span><span class="s2">"Test"</span><span class="p">,</span> <span class="n">pizzas</span><span class="o">=</span><span class="p">[</span><span class="o">...</span><span class="p">])</span>

    <span class="n">mock_payment_service</span><span class="o">.</span><span class="n">process_payment_async</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">PaymentResult</span><span class="p">(</span><span class="n">success</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">mock_order_repo</span><span class="o">.</span><span class="n">save_async</span><span class="o">.</span><span class="n">return_value</span> <span class="o">=</span> <span class="n">Order</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">"order_123"</span><span class="p">)</span>

    <span class="c1"># Act</span>
    <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">handler</span><span class="o">.</span><span class="n">handle_async</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

    <span class="c1"># Assert</span>
    <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">is_success</span>
    <span class="n">mock_payment_service</span><span class="o">.</span><span class="n">process_payment_async</span><span class="o">.</span><span class="n">assert_called_once</span><span class="p">()</span>
    <span class="n">mock_order_repo</span><span class="o">.</span><span class="n">save_async</span><span class="o">.</span><span class="n">assert_called_once</span><span class="p">()</span>
</code></pre></div>
<p><strong>Domain Layer (Entities &amp; Services)</strong>:</p>
<ul>
<li><strong>Unit Tests</strong>: Pure business logic testing with no external dependencies</li>
<li><strong>Business Rule Tests</strong>: Validate invariants and business constraints</li>
<li><strong>Event Tests</strong>: Ensure domain events are raised for business-significant changes</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">test_order_total_calculation</span><span class="p">():</span>
<span class="w">    </span><span class="sd">"""Test pizza order total calculation business logic"""</span>
    <span class="c1"># Arrange</span>
    <span class="n">pizzas</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">Pizza</span><span class="p">(</span><span class="s2">"Margherita"</span><span class="p">,</span> <span class="s2">"large"</span><span class="p">,</span> <span class="p">[</span><span class="s2">"extra_cheese"</span><span class="p">]),</span>
        <span class="n">Pizza</span><span class="p">(</span><span class="s2">"Pepperoni"</span><span class="p">,</span> <span class="s2">"medium"</span><span class="p">,</span> <span class="p">[])</span>
    <span class="p">]</span>

    <span class="c1"># Act</span>
    <span class="n">order</span> <span class="o">=</span> <span class="n">Order</span><span class="o">.</span><span class="n">create_new</span><span class="p">(</span><span class="s2">"Customer"</span><span class="p">,</span> <span class="s2">"+1234567890"</span><span class="p">,</span> <span class="s2">"Address"</span><span class="p">,</span> <span class="n">pizzas</span><span class="p">,</span> <span class="s2">"card"</span><span class="p">)</span>

    <span class="c1"># Assert</span>
    <span class="n">expected_subtotal</span> <span class="o">=</span> <span class="n">Decimal</span><span class="p">(</span><span class="s2">"15.99"</span><span class="p">)</span> <span class="o">+</span> <span class="n">Decimal</span><span class="p">(</span><span class="s2">"12.99"</span><span class="p">)</span>  <span class="c1"># Pizza prices</span>
    <span class="n">expected_tax</span> <span class="o">=</span> <span class="n">expected_subtotal</span> <span class="o">*</span> <span class="n">Decimal</span><span class="p">(</span><span class="s2">"0.0875"</span><span class="p">)</span>     <span class="c1"># 8.75% tax</span>
    <span class="n">expected_delivery</span> <span class="o">=</span> <span class="n">Decimal</span><span class="p">(</span><span class="s2">"2.99"</span><span class="p">)</span>                      <span class="c1"># Delivery fee</span>
    <span class="n">expected_total</span> <span class="o">=</span> <span class="n">expected_subtotal</span> <span class="o">+</span> <span class="n">expected_tax</span> <span class="o">+</span> <span class="n">expected_delivery</span>

    <span class="k">assert</span> <span class="n">order</span><span class="o">.</span><span class="n">total_amount</span> <span class="o">==</span> <span class="n">expected_total</span><span class="o">.</span><span class="n">quantize</span><span class="p">(</span><span class="n">Decimal</span><span class="p">(</span><span class="s2">"0.01"</span><span class="p">))</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_order_status_transition_validation</span><span class="p">():</span>
<span class="w">    </span><span class="sd">"""Test order status transition business rules"""</span>
    <span class="c1"># Arrange</span>
    <span class="n">order</span> <span class="o">=</span> <span class="n">Order</span><span class="o">.</span><span class="n">create_new</span><span class="p">(</span><span class="s2">"Customer"</span><span class="p">,</span> <span class="s2">"+1234567890"</span><span class="p">,</span> <span class="s2">"Address"</span><span class="p">,</span> <span class="p">[],</span> <span class="s2">"card"</span><span class="p">)</span>

    <span class="c1"># Act &amp; Assert - Valid transition</span>
    <span class="n">order</span><span class="o">.</span><span class="n">update_status</span><span class="p">(</span><span class="n">OrderStatus</span><span class="o">.</span><span class="n">PREPARING</span><span class="p">,</span> <span class="s2">"chef_mario"</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">order</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">OrderStatus</span><span class="o">.</span><span class="n">PREPARING</span>

    <span class="c1"># Act &amp; Assert - Invalid transition</span>
    <span class="k">with</span> <span class="n">pytest</span><span class="o">.</span><span class="n">raises</span><span class="p">(</span><span class="n">DomainException</span><span class="p">):</span>
        <span class="n">order</span><span class="o">.</span><span class="n">update_status</span><span class="p">(</span><span class="n">OrderStatus</span><span class="o">.</span><span class="n">DELIVERED</span><span class="p">,</span> <span class="s2">"chef_mario"</span><span class="p">)</span>  <span class="c1"># Cannot skip to delivered</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_domain_events_raised</span><span class="p">():</span>
<span class="w">    </span><span class="sd">"""Test that domain events are raised correctly"""</span>
    <span class="c1"># Arrange</span>
    <span class="n">pizzas</span> <span class="o">=</span> <span class="p">[</span><span class="n">Pizza</span><span class="p">(</span><span class="s2">"Margherita"</span><span class="p">,</span> <span class="s2">"large"</span><span class="p">,</span> <span class="p">[])]</span>

    <span class="c1"># Act</span>
    <span class="n">order</span> <span class="o">=</span> <span class="n">Order</span><span class="o">.</span><span class="n">create_new</span><span class="p">(</span><span class="s2">"Customer"</span><span class="p">,</span> <span class="s2">"+1234567890"</span><span class="p">,</span> <span class="s2">"Address"</span><span class="p">,</span> <span class="n">pizzas</span><span class="p">,</span> <span class="s2">"card"</span><span class="p">)</span>

    <span class="c1"># Assert</span>
    <span class="n">events</span> <span class="o">=</span> <span class="n">order</span><span class="o">.</span><span class="n">get_uncommitted_events</span><span class="p">()</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">events</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">events</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">OrderPlacedEvent</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">events</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">order_id</span> <span class="o">==</span> <span class="n">order</span><span class="o">.</span><span class="n">id</span>
</code></pre></div>
<p><strong>Integration Layer (Repositories &amp; Services)</strong>:</p>
<ul>
<li><strong>Unit Tests</strong>: Mock external dependencies (databases, APIs)</li>
<li><strong>Integration Tests</strong>: Test against real external systems in controlled environments</li>
<li><strong>Contract Tests</strong>: Validate external API integrations</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">integration</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_file_order_repository_roundtrip</span><span class="p">():</span>
<span class="w">    </span><span class="sd">"""Test saving and retrieving orders from file system"""</span>
    <span class="c1"># Arrange</span>
    <span class="n">repository</span> <span class="o">=</span> <span class="n">FileOrderRepository</span><span class="p">(</span><span class="s2">"test_data/orders"</span><span class="p">)</span>
    <span class="n">order</span> <span class="o">=</span> <span class="n">Order</span><span class="o">.</span><span class="n">create_new</span><span class="p">(</span><span class="s2">"Test Customer"</span><span class="p">,</span> <span class="s2">"+1234567890"</span><span class="p">,</span> <span class="s2">"Test Address"</span><span class="p">,</span> <span class="p">[],</span> <span class="s2">"cash"</span><span class="p">)</span>

    <span class="c1"># Act</span>
    <span class="n">saved_order</span> <span class="o">=</span> <span class="k">await</span> <span class="n">repository</span><span class="o">.</span><span class="n">save_async</span><span class="p">(</span><span class="n">order</span><span class="p">)</span>
    <span class="n">retrieved_order</span> <span class="o">=</span> <span class="k">await</span> <span class="n">repository</span><span class="o">.</span><span class="n">get_by_id_async</span><span class="p">(</span><span class="n">saved_order</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

    <span class="c1"># Assert</span>
    <span class="k">assert</span> <span class="n">retrieved_order</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="k">assert</span> <span class="n">retrieved_order</span><span class="o">.</span><span class="n">customer_name</span> <span class="o">==</span> <span class="s2">"Test Customer"</span>
    <span class="k">assert</span> <span class="n">retrieved_order</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">saved_order</span><span class="o">.</span><span class="n">id</span>

<span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">integration</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_stripe_payment_service</span><span class="p">():</span>
<span class="w">    </span><span class="sd">"""Test payment processing with Stripe (using test API keys)"""</span>
    <span class="c1"># Arrange</span>
    <span class="n">payment_service</span> <span class="o">=</span> <span class="n">StripePaymentService</span><span class="p">()</span>
    <span class="n">amount</span> <span class="o">=</span> <span class="n">Decimal</span><span class="p">(</span><span class="s2">"29.99"</span><span class="p">)</span>

    <span class="c1"># Act</span>
    <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">payment_service</span><span class="o">.</span><span class="n">process_payment_async</span><span class="p">(</span><span class="n">amount</span><span class="p">,</span> <span class="s2">"pm_card_visa"</span><span class="p">)</span>

    <span class="c1"># Assert</span>
    <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">is_success</span>
    <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">amount_processed</span> <span class="o">==</span> <span class="n">amount</span>
    <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">transaction_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
</code></pre></div>
<h3 id="end-to-end-testing">End-to-End Testing<a class="headerlink" href="#end-to-end-testing" title="Permanent link">Â¶</a></h3>
<p>Full workflow testing across all layers:</p>
<div class="highlight"><pre><span></span><code><span class="nd">@pytest</span><span class="o">.</span><span class="n">mark</span><span class="o">.</span><span class="n">e2e</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">test_complete_pizza_order_workflow</span><span class="p">():</span>
<span class="w">    </span><span class="sd">"""Test complete order workflow from API to persistence"""</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">TestClient</span><span class="p">(</span><span class="n">create_pizzeria_app</span><span class="p">())</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
        <span class="c1"># 1. Get menu</span>
        <span class="n">menu_response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"/api/menu/pizzas"</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">menu_response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>

        <span class="c1"># 2. Place order</span>
        <span class="n">order_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">"customer_name"</span><span class="p">:</span> <span class="s2">"E2E Test Customer"</span><span class="p">,</span>
            <span class="s2">"customer_phone"</span><span class="p">:</span> <span class="s2">"+1234567890"</span><span class="p">,</span>
            <span class="s2">"customer_address"</span><span class="p">:</span> <span class="s2">"123 Test St"</span><span class="p">,</span>
            <span class="s2">"pizzas"</span><span class="p">:</span> <span class="p">[{</span><span class="s2">"name"</span><span class="p">:</span> <span class="s2">"Margherita"</span><span class="p">,</span> <span class="s2">"size"</span><span class="p">:</span> <span class="s2">"large"</span><span class="p">,</span> <span class="s2">"quantity"</span><span class="p">:</span> <span class="mi">1</span><span class="p">}],</span>
            <span class="s2">"payment_method"</span><span class="p">:</span> <span class="s2">"card"</span>
        <span class="p">}</span>

        <span class="n">order_response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">"/api/orders/"</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">order_data</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">order_response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">201</span>
        <span class="n">order</span> <span class="o">=</span> <span class="n">order_response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

        <span class="c1"># 3. Update order status (kitchen)</span>
        <span class="n">status_update</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"status"</span><span class="p">:</span> <span class="s2">"preparing"</span><span class="p">,</span> <span class="s2">"notes"</span><span class="p">:</span> <span class="s2">"Started preparation"</span><span class="p">}</span>
        <span class="n">status_response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">put</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">"/api/kitchen/orders/</span><span class="si">{</span><span class="n">order</span><span class="p">[</span><span class="s1">'id'</span><span class="p">]</span><span class="si">}</span><span class="s2">/status"</span><span class="p">,</span>
            <span class="n">json</span><span class="o">=</span><span class="n">status_update</span><span class="p">,</span>
            <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">"Authorization"</span><span class="p">:</span> <span class="s2">"Bearer </span><span class="si">{kitchen_token}</span><span class="s2">"</span><span class="p">}</span>
        <span class="p">)</span>
        <span class="k">assert</span> <span class="n">status_response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span>

        <span class="c1"># 4. Verify order status</span>
        <span class="n">check_response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">"/api/orders/</span><span class="si">{</span><span class="n">order</span><span class="p">[</span><span class="s1">'id'</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="n">updated_order</span> <span class="o">=</span> <span class="n">check_response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">updated_order</span><span class="p">[</span><span class="s2">"status"</span><span class="p">]</span> <span class="o">==</span> <span class="s2">"preparing"</span>
</code></pre></div>
<h2 id="dependency-injection-configuration">ğŸ› ï¸ Dependency Injection Configuration<a class="headerlink" href="#dependency-injection-configuration" title="Permanent link">Â¶</a></h2>
<h3 id="service-registration-for-marios-pizzeria">Service Registration for Mario's Pizzeria<a class="headerlink" href="#service-registration-for-marios-pizzeria" title="Permanent link">Â¶</a></h3>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">neuroglia.hosting.web</span><span class="w"> </span><span class="kn">import</span> <span class="n">WebApplicationBuilder</span>

<span class="k">def</span><span class="w"> </span><span class="nf">configure_pizzeria_services</span><span class="p">(</span><span class="n">builder</span><span class="p">:</span> <span class="n">WebApplicationBuilder</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Configure all services for Mario's Pizzeria"""</span>

    <span class="c1"># Domain services</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">services</span><span class="o">.</span><span class="n">add_scoped</span><span class="p">(</span><span class="n">KitchenWorkflowService</span><span class="p">)</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">services</span><span class="o">.</span><span class="n">add_scoped</span><span class="p">(</span><span class="n">PricingService</span><span class="p">)</span>

    <span class="c1"># Application services</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">services</span><span class="o">.</span><span class="n">add_mediator</span><span class="p">()</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">services</span><span class="o">.</span><span class="n">add_auto_mapper</span><span class="p">()</span>

    <span class="c1"># Infrastructure services (environment-specific)</span>
    <span class="n">environment</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">"ENVIRONMENT"</span><span class="p">,</span> <span class="s2">"development"</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">environment</span> <span class="o">==</span> <span class="s2">"development"</span><span class="p">:</span>
        <span class="c1"># File-based repositories for development</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">services</span><span class="o">.</span><span class="n">add_scoped</span><span class="p">(</span><span class="n">IOrderRepository</span><span class="p">,</span> <span class="n">FileOrderRepository</span><span class="p">)</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">services</span><span class="o">.</span><span class="n">add_scoped</span><span class="p">(</span><span class="n">IPizzaRepository</span><span class="p">,</span> <span class="n">FilePizzaRepository</span><span class="p">)</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">services</span><span class="o">.</span><span class="n">add_scoped</span><span class="p">(</span><span class="n">INotificationService</span><span class="p">,</span> <span class="n">ConsoleNotificationService</span><span class="p">)</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">services</span><span class="o">.</span><span class="n">add_scoped</span><span class="p">(</span><span class="n">IPaymentService</span><span class="p">,</span> <span class="n">MockPaymentService</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>  <span class="c1"># production</span>
        <span class="c1"># MongoDB repositories for production</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">services</span><span class="o">.</span><span class="n">add_scoped</span><span class="p">(</span><span class="n">IOrderRepository</span><span class="p">,</span> <span class="n">MongoOrderRepository</span><span class="p">)</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">services</span><span class="o">.</span><span class="n">add_scoped</span><span class="p">(</span><span class="n">IPizzaRepository</span><span class="p">,</span> <span class="n">MongoPizzaRepository</span><span class="p">)</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">services</span><span class="o">.</span><span class="n">add_scoped</span><span class="p">(</span><span class="n">INotificationService</span><span class="p">,</span> <span class="n">TwilioNotificationService</span><span class="p">)</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">services</span><span class="o">.</span><span class="n">add_scoped</span><span class="p">(</span><span class="n">IPaymentService</span><span class="p">,</span> <span class="n">StripePaymentService</span><span class="p">)</span>

    <span class="c1"># Event handlers</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">services</span><span class="o">.</span><span class="n">add_scoped</span><span class="p">(</span><span class="n">EventHandler</span><span class="p">[</span><span class="n">OrderPlacedEvent</span><span class="p">],</span> <span class="n">KitchenNotificationHandler</span><span class="p">)</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">services</span><span class="o">.</span><span class="n">add_scoped</span><span class="p">(</span><span class="n">EventHandler</span><span class="p">[</span><span class="n">OrderReadyEvent</span><span class="p">],</span> <span class="n">CustomerNotificationHandler</span><span class="p">)</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">services</span><span class="o">.</span><span class="n">add_scoped</span><span class="p">(</span><span class="n">EventHandler</span><span class="p">[</span><span class="n">OrderCompletedEvent</span><span class="p">],</span> <span class="n">AnalyticsHandler</span><span class="p">)</span>

    <span class="c1"># Controllers</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">services</span><span class="o">.</span><span class="n">add_controllers</span><span class="p">([</span>
        <span class="s2">"api.controllers.orders_controller"</span><span class="p">,</span>
        <span class="s2">"api.controllers.menu_controller"</span><span class="p">,</span>
        <span class="s2">"api.controllers.kitchen_controller"</span>
    <span class="p">])</span>
</code></pre></div>
<h2 id="benefits-of-this-architecture">ğŸš€ Benefits of This Architecture<a class="headerlink" href="#benefits-of-this-architecture" title="Permanent link">Â¶</a></h2>
<h3 id="for-marios-pizzeria-business">For Mario's Pizzeria Business<a class="headerlink" href="#for-marios-pizzeria-business" title="Permanent link">Â¶</a></h3>
<ul>
<li><strong>Scalability</strong>: Can handle increasing order volume by scaling individual layers</li>
<li><strong>Maintainability</strong>: Business logic changes are isolated to domain layer</li>
<li><strong>Testability</strong>: Comprehensive testing at every layer ensures reliability</li>
<li><strong>Flexibility</strong>: Easy to change storage, payment providers, or notification methods</li>
<li><strong>Team Productivity</strong>: Clear boundaries enable parallel development</li>
</ul>
<h3 id="for-development-teams">For Development Teams<a class="headerlink" href="#for-development-teams" title="Permanent link">Â¶</a></h3>
<ul>
<li><strong>Clear Responsibilities</strong>: Each layer has well-defined purpose and boundaries</li>
<li><strong>Technology Independence</strong>: Can swap infrastructure without changing business logic</li>
<li><strong>Parallel Development</strong>: Teams can work on different layers simultaneously</li>
<li><strong>Easy Onboarding</strong>: New developers understand system through consistent patterns</li>
</ul>
<h3 id="for-long-term-maintenance">For Long-Term Maintenance<a class="headerlink" href="#for-long-term-maintenance" title="Permanent link">Â¶</a></h3>
<ul>
<li><strong>Evolution Support</strong>: Architecture supports changing business requirements</li>
<li><strong>Technology Updates</strong>: Infrastructure can be updated without business logic changes</li>
<li><strong>Performance Optimization</strong>: Each layer can be optimized independently</li>
<li><strong>Monitoring &amp; Debugging</strong>: Clear separation aids in troubleshooting issues</li>
</ul>
<h2 id="related-documentation">ğŸ”— Related Documentation<a class="headerlink" href="#related-documentation" title="Permanent link">Â¶</a></h2>
<ul>
<li><a href="getting-started.md">Getting Started Guide</a> - Complete Mario's Pizzeria tutorial</li>
<li><a href="features/cqrs-mediation.md">CQRS &amp; Mediation</a> - Command and query patterns in depth</li>
<li><a href="features/dependency-injection.md">Dependency Injection</a> - Service registration and DI patterns</li>
<li><a href="features/mvc-controllers.md">MVC Controllers</a> - API layer implementation details</li>
<li><a href="features/data-access.md">Data Access</a> - Repository patterns and data persistence</li>
<li><a href="references/source_code_naming_convention.md">Source Code Naming Conventions</a> - Consistent naming across all architectural layers</li>
<li><a href="references/12-factor-app.md">12-Factor App Compliance</a> - Cloud-native architecture principles with framework implementation</li>
</ul>
<hr/>
<p><em>This architecture guide demonstrates clean architecture principles using Mario's Pizzeria as a comprehensive example. The layered approach shown here scales from simple applications to complex enterprise systems while maintaining clear separation of concerns and testability.</em></p>
<h3 id="application-layer-pizza-business-workflow">ğŸ’¼ Application Layer: Pizza Business Workflow<a class="headerlink" href="#application-layer-pizza-business-workflow" title="Permanent link">Â¶</a></h3>
<p><strong>Purpose</strong>: Orchestrates pizza business operations and workflows</p>
<p><strong>Responsibilities</strong>:</p>
<ul>
<li>Command and query handling (CQRS)</li>
<li>Business workflow coordination</li>
<li>Domain event processing</li>
<li>Cross-cutting concerns (logging, validation, caching)</li>
</ul>
<p><strong>Key Components</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># src/application/commands/place_order_command.py</span>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">PlaceOrderCommand</span><span class="p">(</span><span class="n">Command</span><span class="p">[</span><span class="n">OperationResult</span><span class="p">[</span><span class="n">OrderDto</span><span class="p">]]):</span>
<span class="w">    </span><span class="sd">"""Command to place a pizza order"""</span>
    <span class="n">customer_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">customer_phone</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">customer_address</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">pizzas</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">PizzaOrderDto</span><span class="p">]</span>
    <span class="n">payment_method</span><span class="p">:</span> <span class="nb">str</span>

<span class="c1"># src/application/handlers/place_order_handler.py</span>
<span class="k">class</span><span class="w"> </span><span class="nc">PlaceOrderCommandHandler</span><span class="p">(</span><span class="n">CommandHandler</span><span class="p">[</span><span class="n">PlaceOrderCommand</span><span class="p">,</span> <span class="n">OperationResult</span><span class="p">[</span><span class="n">OrderDto</span><span class="p">]]):</span>
<span class="w">    </span><span class="sd">"""Handles pizza order placement business workflow"""</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">order_repository</span><span class="p">:</span> <span class="n">IOrderRepository</span><span class="p">,</span>
                 <span class="n">pizza_repository</span><span class="p">:</span> <span class="n">IPizzaRepository</span><span class="p">,</span>
                 <span class="n">payment_service</span><span class="p">:</span> <span class="n">IPaymentService</span><span class="p">,</span>
                 <span class="n">notification_service</span><span class="p">:</span> <span class="n">INotificationService</span><span class="p">,</span>
                 <span class="n">mapper</span><span class="p">:</span> <span class="n">Mapper</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">order_repository</span> <span class="o">=</span> <span class="n">order_repository</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pizza_repository</span> <span class="o">=</span> <span class="n">pizza_repository</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">payment_service</span> <span class="o">=</span> <span class="n">payment_service</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">notification_service</span> <span class="o">=</span> <span class="n">notification_service</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span> <span class="o">=</span> <span class="n">mapper</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">handle_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">command</span><span class="p">:</span> <span class="n">PlaceOrderCommand</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OperationResult</span><span class="p">[</span><span class="n">OrderDto</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">"""Execute pizza order placement workflow"""</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># 1. Validate pizzas are available</span>
            <span class="k">for</span> <span class="n">pizza_request</span> <span class="ow">in</span> <span class="n">command</span><span class="o">.</span><span class="n">pizzas</span><span class="p">:</span>
                <span class="n">pizza</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">pizza_repository</span><span class="o">.</span><span class="n">get_by_name_async</span><span class="p">(</span><span class="n">pizza_request</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">pizza</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">pizza</span><span class="o">.</span><span class="n">is_available</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bad_request</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Pizza '</span><span class="si">{</span><span class="n">pizza_request</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">' is not available"</span><span class="p">)</span>

            <span class="c1"># 2. Calculate order total using domain logic</span>
            <span class="n">order</span> <span class="o">=</span> <span class="n">Order</span><span class="o">.</span><span class="n">create_new</span><span class="p">(</span>
                <span class="n">customer_name</span><span class="o">=</span><span class="n">command</span><span class="o">.</span><span class="n">customer_name</span><span class="p">,</span>
                <span class="n">customer_phone</span><span class="o">=</span><span class="n">command</span><span class="o">.</span><span class="n">customer_phone</span><span class="p">,</span>
                <span class="n">customer_address</span><span class="o">=</span><span class="n">command</span><span class="o">.</span><span class="n">customer_address</span><span class="p">,</span>
                <span class="n">pizzas</span><span class="o">=</span><span class="n">command</span><span class="o">.</span><span class="n">pizzas</span><span class="p">,</span>
                <span class="n">payment_method</span><span class="o">=</span><span class="n">command</span><span class="o">.</span><span class="n">payment_method</span>
            <span class="p">)</span>

            <span class="c1"># 3. Process payment (integration layer)</span>
            <span class="n">payment_result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">payment_service</span><span class="o">.</span><span class="n">process_payment_async</span><span class="p">(</span>
                <span class="n">order</span><span class="o">.</span><span class="n">total_amount</span><span class="p">,</span> <span class="n">command</span><span class="o">.</span><span class="n">payment_method</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">payment_result</span><span class="o">.</span><span class="n">is_success</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bad_request</span><span class="p">(</span><span class="s2">"Payment processing failed"</span><span class="p">)</span>

            <span class="n">order</span><span class="o">.</span><span class="n">mark_payment_processed</span><span class="p">(</span><span class="n">payment_result</span><span class="o">.</span><span class="n">transaction_id</span><span class="p">)</span>

            <span class="c1"># 4. Save order (integration layer)</span>
            <span class="n">saved_order</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">order_repository</span><span class="o">.</span><span class="n">save_async</span><span class="p">(</span><span class="n">order</span><span class="p">)</span>

            <span class="c1"># 5. Domain event will trigger kitchen notification automatically</span>
            <span class="c1"># (OrderPlacedEvent is raised by Order entity)</span>

            <span class="c1"># 6. Send customer confirmation</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">notification_service</span><span class="o">.</span><span class="n">send_order_confirmation_async</span><span class="p">(</span><span class="n">saved_order</span><span class="p">)</span>

            <span class="c1"># 7. Return success result</span>
            <span class="n">order_dto</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapper</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">saved_order</span><span class="p">,</span> <span class="n">OrderDto</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">created</span><span class="p">(</span><span class="n">order_dto</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">internal_server_error</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Failed to place order: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</code></pre></div>
<p><strong>Architecture Benefits</strong>:</p>
<ul>
<li><strong>Single Responsibility</strong>: Each handler has one clear purpose</li>
<li><strong>Testability</strong>: Easy to unit test handlers with mocked repositories</li>
<li><strong>Transaction Management</strong>: Clear transaction boundaries</li>
<li><strong>Event-Driven</strong>: Domain events enable loose coupling</li>
</ul>
<h3 id="domain-layer-pizza-business-logic">ğŸ›ï¸ Domain Layer: Pizza Business Logic<a class="headerlink" href="#domain-layer-pizza-business-logic" title="Permanent link">Â¶</a></h3>
<p><strong>Purpose</strong>: Contains core pizza business rules and entities</p>
<p><strong>Responsibilities</strong>:</p>
<ul>
<li>Business entities with behavior</li>
<li>Domain services for complex business logic</li>
<li>Domain events for business-significant occurrences</li>
<li>Business rule validation and invariants</li>
</ul>
<p><strong>Key Components</strong>:</p>
<p><strong>Key Components</strong>:</p>
<ul>
<li><strong>Controllers</strong>: Handle HTTP requests and delegate to application layer</li>
<li><strong>DTOs</strong>: Data Transfer Objects for API contracts</li>
<li><strong>Middleware</strong>: Cross-cutting concerns like authentication, logging</li>
</ul>
<p><strong>Example Structure</strong>:</p>
<div class="highlight"><pre><span></span><code>api/
â”œâ”€â”€ controllers/
â”‚   â”œâ”€â”€ users_controller.py
â”‚   â””â”€â”€ orders_controller.py
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ user_dto.py
â”‚   â””â”€â”€ order_dto.py
â””â”€â”€ middleware/
    â”œâ”€â”€ auth_middleware.py
    â””â”€â”€ logging_middleware.py
</code></pre></div>
<p><strong>Best Practices</strong>:</p>
<ul>
<li>Keep controllers thin - delegate business logic to application layer</li>
<li>Use DTOs to define API contracts</li>
<li>Validate input at the API boundary</li>
<li>Map between DTOs and domain models</li>
</ul>
<h3 id="application-layer-srcapplication">ğŸ’¼ Application Layer (<code>src/application/</code>)<a class="headerlink" href="#application-layer-srcapplication" title="Permanent link">Â¶</a></h3>
<p><strong>Purpose</strong>: Orchestrates business workflows and coordinates domain operations</p>
<p><strong>Responsibilities</strong>:</p>
<ul>
<li>Command and query handling</li>
<li>Business workflow orchestration</li>
<li>Transaction management</li>
<li>Event publishing</li>
<li>Application services</li>
</ul>
<p><strong>Key Components</strong>:</p>
<ul>
<li><strong>Commands</strong>: Represent actions that change state</li>
<li><strong>Queries</strong>: Represent read operations</li>
<li><strong>Handlers</strong>: Process commands and queries</li>
<li><strong>Services</strong>: Application-specific business logic</li>
</ul>
<p><strong>Example Structure</strong>:</p>
<div class="highlight"><pre><span></span><code>application/
â”œâ”€â”€ commands/
â”‚   â”œâ”€â”€ create_user_command.py
â”‚   â””â”€â”€ update_user_command.py
â”œâ”€â”€ queries/
â”‚   â”œâ”€â”€ get_user_query.py
â”‚   â””â”€â”€ list_users_query.py
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ user_service.py
â”‚   â””â”€â”€ notification_service.py
â””â”€â”€ events/
    â”œâ”€â”€ user_created_event.py
    â””â”€â”€ user_updated_event.py
</code></pre></div>
<p><strong>Best Practices</strong>:</p>
<ul>
<li>Each command/query should have a single responsibility</li>
<li>Use the mediator pattern to decouple handlers</li>
<li>Keep application services focused on coordination</li>
<li>Publish domain events for side effects</li>
</ul>
<h3 id="domain-layer-srcdomain">ğŸ›ï¸ Domain Layer (<code>src/domain/</code>)<a class="headerlink" href="#domain-layer-srcdomain" title="Permanent link">Â¶</a></h3>
<p><strong>Purpose</strong>: Contains the core business logic and rules</p>
<p><strong>Responsibilities</strong>:</p>
<ul>
<li>Business entities and aggregates</li>
<li>Value objects</li>
<li>Domain services</li>
<li>Business rules and invariants</li>
<li>Domain events</li>
</ul>
<p><strong>Key Components</strong>:</p>
<ul>
<li><strong>Entities</strong>: Objects with identity and lifecycle</li>
<li><strong>Value Objects</strong>: Immutable objects defined by their attributes</li>
<li><strong>Aggregates</strong>: Consistency boundaries</li>
<li><strong>Domain Services</strong>: Business logic that doesn't belong to entities</li>
</ul>
<p><strong>Example Structure</strong>:</p>
<div class="highlight"><pre><span></span><code>domain/
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ user.py
â”‚   â”œâ”€â”€ order.py
â”‚   â””â”€â”€ address.py
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ pricing_service.py
â”‚   â””â”€â”€ validation_service.py
â””â”€â”€ events/
    â”œâ”€â”€ user_registered.py
    â””â”€â”€ order_placed.py
</code></pre></div>
<p><strong>Best Practices</strong>:</p>
<ul>
<li>Keep domain models rich with behavior</li>
<li>Enforce business invariants</li>
<li>Use domain events for decoupling</li>
<li>Avoid dependencies on infrastructure</li>
</ul>
<h3 id="integration-layer-srcintegration">ğŸ”Œ Integration Layer (<code>src/integration/</code>)<a class="headerlink" href="#integration-layer-srcintegration" title="Permanent link">Â¶</a></h3>
<p><strong>Purpose</strong>: Handles external integrations and infrastructure concerns</p>
<p><strong>Responsibilities</strong>:</p>
<ul>
<li>Database repositories</li>
<li>External API clients</li>
<li>Message queue integration</li>
<li>File system operations</li>
<li>Caching</li>
</ul>
<p><strong>Key Components</strong>:</p>
<ul>
<li><strong>Repositories</strong>: Data access implementations</li>
<li><strong>API Clients</strong>: External service integrations</li>
<li><strong>DTOs</strong>: External data contracts</li>
<li><strong>Infrastructure Services</strong>: Technical concerns</li>
</ul>
<p><strong>Example Structure</strong>:</p>
<div class="highlight"><pre><span></span><code>integration/
â”œâ”€â”€ repositories/
â”‚   â”œâ”€â”€ user_repository.py
â”‚   â””â”€â”€ order_repository.py
â”œâ”€â”€ clients/
â”‚   â”œâ”€â”€ payment_client.py
â”‚   â””â”€â”€ email_client.py
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ user_entity.py
â”‚   â””â”€â”€ payment_dto.py
â””â”€â”€ services/
    â”œâ”€â”€ cache_service.py
    â””â”€â”€ file_service.py
</code></pre></div>
<p><strong>Best Practices</strong>:</p>
<ul>
<li>Implement domain repository interfaces</li>
<li>Handle external failures gracefully</li>
<li>Use DTOs for external data contracts</li>
<li>Isolate infrastructure concerns</li>
</ul>
<h2 id="data-flow">ğŸ”„ Data Flow<a class="headerlink" href="#data-flow" title="Permanent link">Â¶</a></h2>
<h3 id="command-flow-write-operations">Command Flow (Write Operations)<a class="headerlink" href="#command-flow-write-operations" title="Permanent link">Â¶</a></h3>
<ol>
<li><strong>Controller</strong> receives HTTP request with DTO</li>
<li><strong>Controller</strong> maps DTO to Command and sends to Mediator</li>
<li><strong>Mediator</strong> routes Command to appropriate Handler</li>
<li><strong>Handler</strong> loads domain entities via Repository</li>
<li><strong>Handler</strong> executes business logic on domain entities</li>
<li><strong>Handler</strong> saves changes via Repository</li>
<li><strong>Handler</strong> publishes domain events</li>
<li><strong>Handler</strong> returns result to Controller</li>
<li><strong>Controller</strong> maps result to DTO and returns HTTP response</li>
</ol>
<div class="highlight"><pre><span></span><code>HTTP Request â†’ Controller â†’ Command â†’ Handler â†’ Domain â†’ Repository â†’ Database
                    â†“           â†“        â†“
               HTTP Response â† DTO â† Result â† Events
</code></pre></div>
<h3 id="query-flow-read-operations">Query Flow (Read Operations)<a class="headerlink" href="#query-flow-read-operations" title="Permanent link">Â¶</a></h3>
<ol>
<li><strong>Controller</strong> receives HTTP request with parameters</li>
<li><strong>Controller</strong> creates Query and sends to Mediator</li>
<li><strong>Mediator</strong> routes Query to appropriate Handler</li>
<li><strong>Handler</strong> loads data via Repository or Read Model</li>
<li><strong>Handler</strong> returns data to Controller</li>
<li><strong>Controller</strong> maps data to DTO and returns HTTP response</li>
</ol>
<div class="highlight"><pre><span></span><code>HTTP Request â†’ Controller â†’ Query â†’ Handler â†’ Repository â†’ Database
                    â†“         â†“       â†“
               HTTP Response â† DTO â† Result
</code></pre></div>
<h2 id="patterns-implemented">ğŸ­ Patterns Implemented<a class="headerlink" href="#patterns-implemented" title="Permanent link">Â¶</a></h2>
<h3 id="1-command-query-responsibility-segregation-cqrs">1. Command Query Responsibility Segregation (CQRS)<a class="headerlink" href="#1-command-query-responsibility-segregation-cqrs" title="Permanent link">Â¶</a></h3>
<p>Separates read and write operations to optimize performance and scalability:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Command (Write)</span>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">CreateUserCommand</span><span class="p">(</span><span class="n">Command</span><span class="p">[</span><span class="n">OperationResult</span><span class="p">[</span><span class="n">UserDto</span><span class="p">]]):</span>
    <span class="n">email</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">first_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">last_name</span><span class="p">:</span> <span class="nb">str</span>

<span class="c1"># Query (Read)</span>
<span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">GetUserQuery</span><span class="p">(</span><span class="n">Query</span><span class="p">[</span><span class="n">OperationResult</span><span class="p">[</span><span class="n">UserDto</span><span class="p">]]):</span>
    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span>
</code></pre></div>
<h3 id="2-mediator-pattern">2. Mediator Pattern<a class="headerlink" href="#2-mediator-pattern" title="Permanent link">Â¶</a></h3>
<p>Decouples components by routing requests through a central mediator:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># In controller</span>
<span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">mediator</span><span class="o">.</span><span class="n">execute_async</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
</code></pre></div>
<h3 id="3-repository-pattern">3. Repository Pattern<a class="headerlink" href="#3-repository-pattern" title="Permanent link">Â¶</a></h3>
<p>Abstracts data access and provides a consistent interface:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">UserRepository</span><span class="p">(</span><span class="n">Repository</span><span class="p">[</span><span class="n">User</span><span class="p">,</span> <span class="nb">str</span><span class="p">]):</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">add_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">:</span> <span class="n">User</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">User</span><span class="p">:</span>
        <span class="c1"># Implementation details</span>
        <span class="k">pass</span>
</code></pre></div>
<h3 id="4-event-sourcing-optional">4. Event Sourcing (Optional)<a class="headerlink" href="#4-event-sourcing-optional" title="Permanent link">Â¶</a></h3>
<p>Stores state changes as events rather than current state:</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">User</span><span class="p">(</span><span class="n">AggregateRoot</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">register</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">email</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">UserRegisteredEvent</span><span class="p">(</span><span class="n">email</span><span class="p">,</span> <span class="n">name</span><span class="p">))</span>
</code></pre></div>
<h3 id="5-dependency-injection">5. Dependency Injection<a class="headerlink" href="#5-dependency-injection" title="Permanent link">Â¶</a></h3>
<p>Manages object creation and dependencies:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Automatic registration</span>
<span class="n">builder</span><span class="o">.</span><span class="n">services</span><span class="o">.</span><span class="n">add_scoped</span><span class="p">(</span><span class="n">UserService</span><span class="p">)</span>

<span class="c1"># Resolution</span>
<span class="n">user_service</span> <span class="o">=</span> <span class="n">provider</span><span class="o">.</span><span class="n">get_required_service</span><span class="p">(</span><span class="n">UserService</span><span class="p">)</span>
</code></pre></div>
<h2 id="testing-architecture">ğŸ§ª Testing Architecture<a class="headerlink" href="#testing-architecture" title="Permanent link">Â¶</a></h2>
<p>The layered architecture makes testing straightforward:</p>
<h3 id="unit-tests">Unit Tests<a class="headerlink" href="#unit-tests" title="Permanent link">Â¶</a></h3>
<p>Test individual components in isolation:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">test_user_registration</span><span class="p">():</span>
    <span class="c1"># Arrange</span>
    <span class="n">command</span> <span class="o">=</span> <span class="n">CreateUserCommand</span><span class="p">(</span><span class="s2">"test@example.com"</span><span class="p">,</span> <span class="s2">"John"</span><span class="p">,</span> <span class="s2">"Doe"</span><span class="p">)</span>
    <span class="n">handler</span> <span class="o">=</span> <span class="n">CreateUserCommandHandler</span><span class="p">(</span><span class="n">mock_repository</span><span class="p">)</span>

    <span class="c1"># Act</span>
    <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">handler</span><span class="o">.</span><span class="n">handle_async</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

    <span class="c1"># Assert</span>
    <span class="k">assert</span> <span class="n">result</span><span class="o">.</span><span class="n">is_success</span>
</code></pre></div>
<h3 id="integration-tests">Integration Tests<a class="headerlink" href="#integration-tests" title="Permanent link">Â¶</a></h3>
<p>Test interactions between layers:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">test_create_user_endpoint</span><span class="p">():</span>
    <span class="c1"># Test API â†’ Application â†’ Domain integration</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">test_client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">"/api/v1/users"</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">user_data</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">201</span>
</code></pre></div>
<h3 id="architecture-tests">Architecture Tests<a class="headerlink" href="#architecture-tests" title="Permanent link">Â¶</a></h3>
<p>Verify architectural constraints:</p>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">test_domain_has_no_infrastructure_dependencies</span><span class="p">():</span>
    <span class="c1"># Ensure domain layer doesn't depend on infrastructure</span>
    <span class="n">domain_modules</span> <span class="o">=</span> <span class="n">get_domain_modules</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">module</span> <span class="ow">in</span> <span class="n">domain_modules</span><span class="p">:</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="n">has_infrastructure_imports</span><span class="p">(</span><span class="n">module</span><span class="p">)</span>
</code></pre></div>
<h2 id="benefits">ğŸš€ Benefits<a class="headerlink" href="#benefits" title="Permanent link">Â¶</a></h2>
<h3 id="maintainability">Maintainability<a class="headerlink" href="#maintainability" title="Permanent link">Â¶</a></h3>
<ul>
<li><strong>Clear boundaries</strong>: Each layer has well-defined responsibilities</li>
<li><strong>Loose coupling</strong>: Changes in one layer don't affect others</li>
<li><strong>High cohesion</strong>: Related functionality is grouped together</li>
</ul>
<h3 id="testability">Testability<a class="headerlink" href="#testability" title="Permanent link">Â¶</a></h3>
<ul>
<li><strong>Isolated testing</strong>: Each layer can be tested independently</li>
<li><strong>Mock dependencies</strong>: External dependencies can be easily mocked</li>
<li><strong>Fast tests</strong>: Business logic tests don't require infrastructure</li>
</ul>
<h3 id="scalability">Scalability<a class="headerlink" href="#scalability" title="Permanent link">Â¶</a></h3>
<ul>
<li><strong>CQRS</strong>: Read and write models can be optimized separately</li>
<li><strong>Event-driven</strong>: Asynchronous processing for better performance</li>
<li><strong>Microservice ready</strong>: Clear boundaries make extraction easier</li>
</ul>
<h3 id="flexibility">Flexibility<a class="headerlink" href="#flexibility" title="Permanent link">Â¶</a></h3>
<ul>
<li><strong>Technology agnostic</strong>: Swap implementations without affecting business logic</li>
<li><strong>Framework independence</strong>: Business logic isn't tied to web framework</li>
<li><strong>Future-proof</strong>: Architecture adapts to changing requirements</li>
</ul>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  Back to top
</button>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
<div class="md-social">
<a class="md-social__link" href="https://github.com/bvandewe/pyneuro" rel="noopener" target="_blank" title="github.com">
<svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg>
</a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.expand", "navigation.top", "search.highlight", "search.share"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
<script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
</body>
</html>